function [Y,Xf,Af] = tp0137a772_c885_4f56_8bb5_dac9e6d540f9(X,~,~)
%TP0137A772_C885_4F56_8BB5_DAC9E6D540F9 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 05-Sep-2017 02:39:55.
% 
% [Y] = tp0137a772_c885_4f56_8bb5_dac9e6d540f9(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-8184.9079341846;-2767.31086728677;-925.675633657015;-538.97327665492;-1115.63541033651;-861.953076142272;-996.664725988397;-421.625702789063;-721.553885286556;-557.27453247957;-502.132109545489;-521.810951623243;-543.177005191318;-167.207345824936;-344.52896166283;-294.401776402713;-391.01040637009;-285.680184537949;-174.294824484545;-303.609020442449];
  x1_step1_gain = [0.000202107905561193;0.000554219398814734;0.000742185534904078;0.0010185341647551;0.00103332655312913;0.00147681597144008;0.00118221307527392;0.00265958726683863;0.0012523589192447;0.00165285753177998;0.00232860128237181;0.00188013184297681;0.00198822427969293;0.00479968082327782;0.0025204716922513;0.00363117206158393;0.00272984263620493;0.00383651951608914;0.00502254586493096;0.00330771328744475];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.9672397870782596385;4.0125682176354953157;-6.6166962337051522525;-1.7928390825431159694;0.58452610738269694668];
  IW1_1 = [-0.23906880276571793043 -0.70191826785436040037 0.44342935191418436647 0.17016474292911973332 -0.4641468349650878511 0.18360092475325043293 -0.41806719066474878899 0.64939321137818462049 0.060374907639716132723 0.21894456242292328896 -0.15485562868719446317 -0.27993955821757143809 -0.23009154025030220669 0.17900200438687502436 1.2602570193851176938 1.3054567940984851404 0.0084472137549309479071 -0.95919289139137753342 -1.6033262312203131472 0.13538149813626790263;0.76801595033087177722 -0.87304046390912770637 -1.0169882468991473523 6.0042994023893943023 1.7070747915837738429 3.0199861907847553866 -3.5555771981292467743 -0.47868411506059227456 -0.31153133062220056404 1.2447541912720496704 -2.6074172311934109558 -0.23196874345623444413 -0.13590879151591223062 1.4485345746879294548 -5.9698174367361112047 1.0623470122770390933 1.0738234567290603216 1.6459195781997655317 -0.17464856691501609576 5.4771472270780288127;3.8482885411545528775 2.3927087984703359069 -2.7610396258407341463 -2.8299133025053015977 3.5809044312442814828 -0.49165258628878966141 1.7153443484052521839 1.5960742205716020869 -1.5433853513111561728 -2.1093883448948163029 2.0531509409389419041 0.65190606338202472525 -1.659959953718160186 1.8205613145551955423 -1.5992110524311557995 -0.25663675534019153579 -0.1083269463154790252 -0.66331452742227636765 0.68317773893820166187 0.22517162739120685777;-2.5161912002442816672 1.1584651320025041166 -2.0179063671692594184 -1.2059334804597567903 1.4388797824689103511 -4.6883205131468841387 -0.2594602013193673673 3.56879731375965914 2.6864849780311521599 -0.81952138908536653616 3.622546105528682947 3.1193838570215182138 -2.9496107514052933851 -3.530714844076204173 0.74762689257501413476 -0.38641858310045518188 0.59920702606454512296 0.41320741906888325268 -0.64533202158797731141 -1.0493562138720291532;-3.0475773496606062274 -6.0194257203166650072 -3.8751950025622141638 0.37813391300668097728 -3.7639840096181340634 1.4802038115067124302 -0.38667985950248762173 2.7760850581735612153 3.6819640897807404123 -0.19068528602549114637 0.88478764245852692394 0.44450380583557513869 1.5363310805970156192 -4.4175852206070480577 6.3419886322592260441 1.6001181970405593535 -3.989459089812251058 -0.98421166453476072178 -0.37372935928997452759 0.0409678448813650814];
  
  % Layer 2
  b2 = -3.0748833842711409403;
  LW2_1 = [3.4417970406405546946 11.214507794109328742 13.667248650701900203 -14.344829222531902957 12.297783696907014672];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

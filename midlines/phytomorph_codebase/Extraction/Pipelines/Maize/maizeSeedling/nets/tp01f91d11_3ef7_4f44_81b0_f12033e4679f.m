function [Y,Xf,Af] = tp01f91d11_3ef7_4f44_81b0_f12033e4679f(X,~,~)
%TP01F91D11_3EF7_4F44_81B0_F12033E4679F neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-Sep-2017 07:06:48.
% 
% [Y] = tp01f91d11_3ef7_4f44_81b0_f12033e4679f(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-5466.61789079662;-862.937878923584;-833.978767721889;-1562.45386611792;-692.538815519986;-441.043793232212;-783.66763982473;-450.026271289933;-656.555828069289;-416.411813428008;-183.589471391036;-268.743398235229;-277.584610398778;-202.979007080811;-313.061223281927;-302.321350914811;-296.419908591266;-275.82100391882;-162.786711803946;-155.93029406893];
  x1_step1_gain = [0.000192953812201724;0.000635170113819407;0.0010737117105794;0.000992967389065701;0.00140247416929524;0.00179426803546528;0.00152094087103248;0.00262475201653712;0.00199415494766511;0.00251075910029927;0.00454433874041182;0.0037866200073872;0.00302237737948967;0.00448879604138529;0.00366080733460359;0.00363057230533708;0.00381924645546845;0.00427537582274501;0.00592120551781364;0.00602422138644218];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.4767093153163330932;-2.8773609436307214793;-4.1287561857399506238;-2.3813814455929858127;-2.0788764868930553753];
  IW1_1 = [-2.1901763051552021189 6.3352951882341166367 -1.888387104522708082 -2.2386006928940758165 -1.8715150974192382716 -1.1511974325814902098 2.4483331268089698618 -1.5153676903985686675 3.904612707606909705 2.0406627560589534198 -2.0543200019244656218 -0.20465888638094284491 -0.76266100959948868176 0.9038740337816831838 -1.0504363669684506633 -0.25265114717751568918 0.24819442848368294952 1.525331333977040682 0.52310948138332091784 0.43671111198006057341;-3.2472435769869587574 -0.47454997495103512506 -3.439438038938464004 -0.97300259736807759303 -4.2323227925993665011 -1.3430146581364559299 1.7758587559324714444 -0.73925418308588630723 5.2447395349887777627 2.9035987658384758703 -4.4595497031743196459 -3.2080205431131183502 -4.8462160679705119648 -1.4707658351619175008 0.29600619616699419545 0.043863591363563020353 -0.96090172137636986616 0.66409605156194051467 0.62006421968573088854 -2.0445438921404277544;0.20811802699341344636 -2.6437751431592877438 -0.33965333491166344038 1.111740939219435953 -0.32145989841085265137 -0.092329594471294795799 -1.0356874082747482557 1.853357922895002563 1.0889534657608213042 2.0370446811702209722 -1.2373352420116230377 -0.28478682524155124467 -2.3522740866926894476 -0.20469633955718422036 1.395164384462570295 0.50513401964480564299 0.68436474590530427253 -1.4842890836965474399 0.51126272964053731673 -1.314135767015296663;-0.026483642137721880722 -0.66234487699275201855 0.19339484797293271523 -0.73114165845238920927 -0.0199216582710154827 0.046069082312914837185 -0.46010985656891401074 0.57419818391341859165 0.17115020556714560795 -0.18420463235059816864 -0.09534438263689663795 -0.14353738155270262533 -0.55016794857793793749 -0.16807271637014103982 -0.21347694835579997252 0.45250107994522631438 -0.41541822455503696343 -0.57435848948796541791 0.031631651700586412013 0.25814976853508364574;0.52792077167106143953 -0.057094995182175187209 0.28260929910066012738 0.99042442621560522475 0.25012120559089462413 -0.54824952218963285411 0.079508720920139747124 0.98574190893616220333 -0.17665060568929241702 0.26039727337183332656 -0.99843071352423684583 -1.5041792562269944433 -0.97132010921933986669 -1.1939130311916208438 1.1000411806258008074 -0.24650944200886518165 0.46084181817604685794 -0.58120735600185158276 0.0004364408085716251981 -1.4285084716530758175];
  
  % Layer 2
  b2 = -3.1124573702163176314;
  LW2_1 = [-9.0334446844831539636 10.414684035980661392 4.6179502124078446457 2.2426242591591725173 3.4043168485166068749];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

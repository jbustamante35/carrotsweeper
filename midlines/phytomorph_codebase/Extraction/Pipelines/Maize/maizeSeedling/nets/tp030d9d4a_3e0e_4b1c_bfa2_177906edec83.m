function [Y,Xf,Af] = tp030d9d4a_3e0e_4b1c_bfa2_177906edec83(X,~,~)
%TP030D9D4A_3E0E_4B1C_BFA2_177906EDEC83 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 05-Sep-2017 08:13:31.
% 
% [Y] = tp030d9d4a_3e0e_4b1c_bfa2_177906edec83(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-5310.24104946905;-3062.40716175129;-1831.68761111049;-751.778745457493;-800.631435004027;-561.234234396123;-567.818719457229;-566.708636588771;-460.813029179958;-365.327762675255;-377.913829978779;-497.927214156977;-445.050021503465;-362.027565171377;-198.123504200375;-350.309427866388;-268.266206223872;-161.912675664684;-223.562425332985;-192.300211130378];
  x1_step1_gain = [0.000187746732766858;0.000517587446146427;0.00076092913976903;0.00107683880161886;0.00113410115771159;0.00154637953830619;0.00191937835803698;0.00192268942981792;0.00211835684506624;0.00196958059572074;0.00268955398662549;0.00257377430529599;0.00284234016821656;0.00279908218986809;0.00409640929201512;0.00345584818973338;0.00422505290367573;0.00549698021899274;0.00471432618261857;0.00476878567270188];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.9319812838370127306;2.567524577606378422;1.9392573250048379396;2.8009672429932401805;-3.9109741510800475339];
  IW1_1 = [-0.18015655130086982716 3.2837897241608580146 0.26126100791004608359 0.37922423442869340748 0.091800946113066980714 -1.204705065769693384 -0.63846399975367407187 1.5499162749605299716 0.32993713769811994219 0.67098175069426002626 1.2022867834548691679 -0.95052098146816732527 -0.7745653027450507544 0.90877670887798356336 -0.14909521296470995555 0.23472831476981509402 -0.71291805465939295239 0.49864146171453388456 -1.9329472443007684745 1.2760335186611500013;8.2781299500366500865 -6.1780909361137252844 -0.98994445622428672849 0.5262059913767255237 -4.0388210835192728254 4.2449312815106567953 -3.8520591363097009818 -0.87530278480101286753 -0.49624983019299789833 -2.3224660909459928781 -2.7105313266660910898 0.12866322600217752758 0.43675605257063587761 -3.4033846493810160361 0.080163578042370786658 -1.367687691255078386 2.2554081764664113408 0.52364859517313333548 2.1376424916077825245 -2.422221185505343044;-1.2656106033674314748 -3.2622764214328059396 -0.03420658625056465646 -0.27315226764416750127 2.4422389541672999691 -0.88576161426675281696 1.3764441001537330855 -1.716382756669124543 0.20732268398740219539 -0.47117319963288378792 0.42176790094681254617 0.53415679434535312531 0.081715711427143400414 -1.1453301933968897952 0.44059876053813917807 0.93902744071416899274 -0.96930751057133979209 -0.73941323977606532303 1.2663041379803900988 0.061738095304000553676;-0.38558903855743120737 -0.38302628333734523025 0.57942588313523113452 -0.2697319552576900592 -0.018326201671790501996 -0.53687120508331687141 0.38325071381975212015 0.3395248255086163458 0.021577808326223951035 -0.41503061496225435167 0.26421949022490204273 0.38404434431638884151 0.86338669438258763833 0.14672043359778522142 -0.45033770871675560254 0.68312779227425113326 0.49655295967590690198 -0.12923071932751900581 0.031515834885199593696 -0.056981417935456177282;-0.017359018399918216963 4.2465275666293749168 1.3682251955570294832 0.19379070037790460668 -0.74483155609120554885 -1.8300997620282821732 -0.92816705076418060116 1.2519132193534638908 0.2042047250823958715 0.45125900928716200511 0.99187181113330169513 -0.27942935594898898888 -0.47827160138056767913 1.3157577161454911963 -0.57192235458250817448 0.10118916066804316267 -1.3200620939289229305 0.42734714543007557008 -1.6462002904812629289 1.2070846838644313515];
  
  % Layer 2
  b2 = -2.6680836519100430415;
  LW2_1 = [5.2681651628155261591 -12.850390766293703138 -6.5122989482086843793 -3.3986473216035637535 7.2008375363212406839];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

function [Y,Xf,Af] = tp05e01120_c9fb_4966_a68e_768c35eacb91(X,~,~)
%TP05E01120_C9FB_4966_A68E_768C35EACB91 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 05-Sep-2017 05:27:03.
% 
% [Y] = tp05e01120_c9fb_4966_a68e_768c35eacb91(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1874.99930442497;-5454.91534726369;-869.204807020143;-780.471896742374;-727.485737554804;-234.310604878461;-540.291178237134;-572.142715533789;-192.819908210792;-263.800490630851;-210.820779921782;-258.183122033522;-286.590370604325;-190.32078243269;-271.750472270933;-218.521589353917;-373.104709120362;-213.71944994576;-258.858847398814;-135.174215342511];
  x1_step1_gain = [0.00034254044244578;0.00027748074658588;0.000806013241167019;0.00156677380853905;0.00168393926281428;0.00269046527889069;0.0019808499204541;0.00236361816544284;0.00245784730269615;0.00195235680232594;0.00282106579415896;0.0042465807948296;0.00317261769260759;0.005554586874619;0.00429724736478087;0.00484270636687467;0.00333931608099046;0.00598913897545086;0.00384783002604035;0.00642488839732229];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-0.89162807365238283541;2.8816359994530138522;-5.6667233266573946437;-1.7223745055900645529;-1.4290822491759982427];
  IW1_1 = [-0.23633664434687054468 5.4122918585483885678 -3.1334549791687060782 -2.1390945672995793636 1.1657323431372232925 2.7964142308692974126 -0.4981074683823635274 1.7000400544247240564 -0.88661411296799996773 0.66579828043037903029 -0.98117793345571790997 -2.1813565297035530932 -0.37949567565667013946 0.42826956675227628724 2.1163381973985830875 -2.9873799057475887153 -0.84252057544803815592 -0.1232496373298964526 1.9466389019756684675 0.47674965145282538481;1.2503759051687683979 5.7931469722955064583 -0.44068677086398932996 1.158630429571023468 -3.4540361444821967574 1.2911484188455799593 -0.34412225618317193732 -4.2274813537237214689 1.3567079216945192588 -2.4127873962248456152 3.2704518107822249107 -1.6726724428674513145 -1.5517538642631090173 0.57585222449772155429 -1.0806388581870134402 1.5708726017492133931 -0.8162717900852493047 0.52152566732266592009 -0.17525243486477021237 0.57074335925324337637;-5.0817827608338586032 -3.2253456611894830708 -2.067045264819880046 0.0031463695284178958 2.2799146841675961284 -0.52556503482979388675 -0.38435196383970693379 4.2286083289949081276 -3.3554035773699593115 -2.8343417324978283922 -0.27243398349451308782 -0.70385228491062046263 1.8623968308276765971 -0.095099201924986775936 -2.5395050458382550929 -1.5402961286691883025 -1.0971321060446705964 -0.83109155533012479822 2.9149630088152203022 -0.9829918954865908276;-0.65533303252429264685 1.1212003275700690441 -3.176459684914665349 0.039101438973588156789 -1.6093288535572560782 -1.0964557829556620394 -1.7605080309877585432 0.91634854248561636858 -1.2181333217743572916 4.3062665937991493337 1.1531295179712521826 1.3742081758303075212 1.0720305773344240841 0.45153974990259071465 0.85456789980115166472 1.4200917812833855347 2.9163219212093403065 -1.7448303067700494662 -1.7536033637764447679 0.18194984404008712753;3.0373216503356506024 4.3428047218369716376 0.77047569699586393455 -1.6746044831639836925 0.58742173153178800504 1.1975349654873139738 -1.3572180619880132024 -1.1059446344175385413 -0.80810500151553199544 -2.3302514785106018813 2.8182931661348060715 -1.4083599724443551793 0.74190678862951864314 0.25107148104533044686 -0.42663408489706089455 -0.15371625151104867379 0.8635648483400908404 -0.35728553946515351214 2.8619977701498577893 1.4202046561902224031];
  
  % Layer 2
  b2 = -1.6056325165492006946;
  LW2_1 = [9.1336910093961982682 9.6393406907275505091 -10.023194394583009981 6.2380624926540821917 8.2945626516019999031];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

function [Y,Xf,Af] = tp097f25e7_5cdb_4fad_af7b_fa6fa9592131(X,~,~)
%TP097F25E7_5CDB_4FAD_AF7B_FA6FA9592131 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 05-Sep-2017 06:44:34.
% 
% [Y] = tp097f25e7_5cdb_4fad_af7b_fa6fa9592131(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-5466.61789079662;-862.937878923584;-1028.71862143182;-451.710971542902;-692.538815520004;-441.043793232207;-783.667639824724;-450.026271289931;-656.55582806929;-416.41181342801;-183.589471391048;-268.743398235202;-384.146123020666;-202.979007080797;-313.061223281981;-302.321350914815;-227.243600250017;-275.821003918882;-162.786711803949;-176.062817024286];
  x1_step1_gain = [0.000192953812201724;0.000635170113819407;0.0010737117105794;0.000992967389065703;0.00140247416929522;0.00179426803546529;0.00152094087103248;0.00262475201653714;0.00199415494766507;0.00251075910029925;0.00454433874041176;0.00378662000738761;0.00302237737948985;0.0044887960413862;0.00366080733460327;0.00363057230533688;0.00381924645546803;0.00427537582274424;0.00592120551781292;0.00602422138644359];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-3.541469743772914569;5.0620660879993923942;5.6954654520174150534;3.3115903075434642844;-0.37761843462447197695];
  IW1_1 = [0.50034864056556049849 1.0309838878673391882 6.1563572792323357774 3.859487297490311164 -10.478370907807743606 -6.0400927090874665382 1.4818031019714161811 -1.9711492192593997874 8.8720966455104708359 6.6164285668513969085 -7.798574226387984254 -4.6369662429581577356 8.1763106302885493193 -2.4508186550582546914 -0.18375478292224603494 -1.0337404413696649197 0.47483871485055989536 1.2102808211733131483 -1.2065220324006942221 2.1364249602915896808;0.056558553369512376552 3.1296899975060621379 -2.0922783202702226468 1.1798698181850046929 1.6622733033789272028 -1.528101665189986802 0.17860296151446847235 -0.57863848680223595178 0.30181526754453563699 -1.3636805535508726983 0.030549813417324198084 -1.0430202791566274279 0.23750717733398624132 0.83187173531641567248 -1.5718485152675396588 -0.76025733599453892975 0.35651803720846930723 1.268028563419869359 0.89262248444126901514 -0.065202645598184283404;0.50533940526985032804 3.4646376812410921708 0.13503469346279795005 2.9632032715406642076 1.8012064188286236455 -0.12265084421844632545 0.56821819265833473089 -1.9577482431371722171 -1.1856014514505024415 -2.0452816154151380879 -0.310115837000941863 -1.2837124793878715856 -2.3752041536201038419 2.8949747457892600622 -1.4280976130582183625 -0.016899230194864903187 2.2971102703524763911 2.3544397320102770088 -0.37826391124212216388 -0.39218764179146192728;-0.014464427610352109319 8.397434733819032715 4.5588151352192980426 4.8825213680934993477 -2.2071072339106998506 -1.2387977324551180391 3.7435529503091893311 -0.57839784292702434154 5.2572212595095146881 3.524928318758236756 -1.4458213495270488824 -1.1059313701889132986 -0.18922838498447655531 2.3616084693721792753 -2.7141910772101733862 1.6622392936020289333 0.1485174803821134315 0.4920541584544051994 1.4589983726198823 -0.58565764339293002738;-1.8740413780222564544 1.9276051696820075687 1.5789335640359305479 0.56205129275232568187 -1.3323764159258719708 -0.5957447057783764599 1.172884064775776114 -1.1021939267045075539 0.71891960494386386582 0.54137590759496445614 -0.52910991610160340581 -0.39398869254129659234 -0.75854716185123949312 0.85466306181577589296 0.10701629771214170306 0.17033930296505606083 -0.41315617662982778713 0.11795190286017109838 -0.48670078399416599746 -0.17890435270243740251];
  
  % Layer 2
  b2 = -7.8839264828319244316;
  LW2_1 = [17.88320789886134321 -7.0807664326109165387 -8.5859701472798750643 -13.633335814293658927 -1.5863811109668477517];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

function [Y,Xf,Af] = tp0d4e9907_073d_4f2e_92bd_2acd2d2345f9(X,~,~)
%TP0D4E9907_073D_4F2E_92BD_2ACD2D2345F9 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 29-Aug-2017 20:38:39.
% 
% [Y] = tp0d4e9907_073d_4f2e_92bd_2acd2d2345f9(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1874.99930442496;-5454.91534726369;-869.204807020143;-780.471896742375;-460.205555216351;-509.055241799413;-540.291178237134;-572.142715533788;-192.819908210793;-263.800490630853;-210.820779921782;-258.183122033515;-286.590370604325;-190.320782432688;-193.663740648593;-194.470619647334;-225.820325675014;-213.719449945775;-260.914631799833;-135.17421534251];
  x1_step1_gain = [0.00034254044244578;0.00027748074658588;0.00080601324116702;0.00156677380853905;0.00168393926281428;0.00269046527889069;0.0019808499204541;0.00236361816544284;0.00245784730269612;0.00195235680232596;0.00282106579415893;0.0042465807948297;0.00317261769260758;0.00555458687461901;0.00429724736478091;0.00484270636687468;0.00333931608099054;0.00598913897545058;0.00384783002604041;0.00642488839732228];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.6393535276708954829;0.84953180043492693141;1.2424662968942197239;-0.9663282668269054243;0.40560097455285182289;-1.3692411044886909632;2.2958002243223329941;-3.9165193459241582907;1.3510245863029726188;-4.1562481668935307155];
  IW1_1 = [-0.1127198016365004718 -0.0074248954229913580183 -0.36052590005637674686 0.48012019731490307439 -0.23035732760554814003 0.29763617199026631832 0.3484608101677092451 -0.55662065963508655653 0.47659798637091072004 0.74966459780032468352 0.31683672302641574525 0.86984601589252563691 -0.26559621872203809101 0.90306296499847482639 -0.62774611514194167405 -0.28024987528977907125 0.70595090673081595245 -0.62861517190020610446 0.53177637591139836903 0.65482010872014484448;0.1044732374969107036 0.34896195214562253373 -0.022814964800006068413 -0.54556750366897488469 2.73212365982903993 1.9500803089705074367 0.50960634678149940857 0.67416357455673692201 0.28422423827336679159 1.5455985484594836343 -0.92322243629792410946 -0.42956427886295944774 -0.57408819117118892184 0.34096391424423316829 -1.7690930336101238218 0.56309570391851926363 -0.68263309052932041876 -0.2914049548781814658 1.4565398973568617347 1.4319659977032808129;-0.48000385506353171472 -5.3266551039345229057 0.7180136593387828059 0.80743635924937384729 -1.4903592185093554878 -0.23222954146402774445 1.5858627740275585971 -0.16489814288742787873 -0.18030329538538789058 -2.4366950252961503409 -2.1289640061776640145 1.4350047982772948796 -1.2747395693258640748 -0.72121009209960595943 0.89726488374212709509 0.50573475483028340616 2.0226760293261412116 1.0624831363417426289 0.44570733973468967815 -0.45484802656102762963;0.058773344873115473952 2.6385363006245627915 -2.3048582545501972163 -3.5723382052351042582 -1.1774271543306575882 -1.1083301909513143535 -0.01943702053066338753 2.9275522565164324718 -2.0535307576621613102 0.9382736421972434071 -0.42497795440830726799 -2.2416329821638258935 -0.69627308128163412082 1.4430213894123327112 -0.53509746097363120043 1.5756483875410303153 1.1705567486940018362 0.44222085261420185365 -1.0897722376766230123 -0.27763144419494339976;2.3051512688153126263 2.9834790141999101287 -1.6037054507088464028 -0.62352904223985050614 0.97311028080730643808 -1.1768231396768868979 0.12843126419642339475 -1.5935838329557356907 -0.72446869844289507601 0.65798493602877994313 -0.19654091217651506462 0.37284920579718955347 -0.46343791781469800828 -1.1670341188801367505 -2.5118656586348726556 2.4601462873671069431 -3.1870479106825917448 -1.4993892488251612249 1.3601781883853736321 -0.095586844151584832163;0.8917217338913510094 -5.9962059261175371105 2.3527070236453009322 -1.3850729548286473403 -1.8489870087316344627 0.51719381145213971784 0.84416150153861635452 1.7074276520342752672 -0.68729964608312177354 1.979273397957910019 -3.2600184653271488955 2.2403651561970199246 0.38916563092455397355 0.013082401985956445406 0.13627761818745229294 0.31402259706689183982 -0.45780062510861807556 1.3046728399505882479 -0.032163557099155852537 -1.1777870065493911689;4.4549930407273352628 3.180661039211816643 -0.30568629720141232697 -0.48069535899976673088 2.6613311186526207308 0.070163120963477973446 0.2498183061992434173 -2.226842836359218758 0.97682818931913495408 -1.4322486156614491204 1.0139598453669038669 -0.96725477815595772846 -1.367496030095804338 -1.4041589661824216417 -0.20859069786731010421 0.75527629714865596178 3.4611039888370487283 1.7176792350182439328 -2.5948547845985285853 1.1771170351233870566;-0.068514988749256364176 1.0880153135298935574 -2.2774691136236535627 -0.22414959182866889265 -2.8341703494765244642 0.78261440234027157548 -1.1852517224856102818 2.2780430256665078481 -0.28773479122271466979 -2.0374870775085924812 -1.7776019947125611953 -0.32502950278843550924 2.1937503391766521865 -2.1545809909855768716 1.2988608226056366224 2.4672465017990696801 2.3955857376459332997 -0.28488507867182266686 -3.0860269824269024319 -1.0650227384426051991;0.35351687986546082021 -0.59229609353707202146 0.10671051783785319433 -0.28120318444268743718 -0.44550716007488111448 -0.35706569601209725562 -0.24749099914821967583 -0.62004916530097531346 -0.11832916696137686652 -0.16166159254264836354 -0.50909126019019246279 0.53366613975693721894 0.38477567848843879927 0.29868938066616096405 0.17639008780539050525 -0.42527012951785253536 -0.11188146734621907952 -0.31899953261759617096 -0.060735270404080610174 0.14367991741065011535;-1.7164951174508600307 0.88906121046030739397 -2.1111558632744351627 -2.194656685194407153 -0.77882818826179311955 -0.82046413111453275757 -0.29747332231836304262 1.2909062198116041387 -4.338964769518891984 -1.4220548015233931416 -0.95023844718178440694 -1.4831025655528367047 0.67756992753434475141 -0.13599939656900544849 0.47714692144269321705 1.658571151601794913 1.1752114871046996925 -0.46083674596738616325 -2.4755852152997031013 -0.56579535420464865947];
  
  % Layer 2
  b2 = -1.6939069243378752638;
  LW2_1 = [-2.1653358602883856499 -3.8533656498033042048 -6.5157225069384567817 6.6625052324901776757 5.5930545745682680447 -5.7211811652100168502 3.0419383463907356813 -4.6813263829079874156 -0.60635208072145008185 -5.544149498684517674];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

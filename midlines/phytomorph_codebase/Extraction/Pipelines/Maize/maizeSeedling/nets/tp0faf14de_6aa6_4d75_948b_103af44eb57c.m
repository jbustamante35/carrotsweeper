function [Y,Xf,Af] = tp0faf14de_6aa6_4d75_948b_103af44eb57c(X,~,~)
%TP0FAF14DE_6AA6_4D75_948B_103AF44EB57C neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 04-Sep-2017 02:15:49.
% 
% [Y] = tp0faf14de_6aa6_4d75_948b_103af44eb57c(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1054.92998109303;-3159.48627075363;-2114.78087604941;-1423.59192565959;-885.05794399119;-1580.09594810586;-466.558771320893;-1155.71902109269;-342.454990361199;-527.239355792853;-526.427101249704;-436.274101764847;-275.990547714347;-572.311544415314;-525.032869762636;-426.867092225849;-301.983936484956;-278.64325086646;-200.952843846003;-287.671508962967];
  x1_step1_gain = [0.000201853701047093;0.000358308876895914;0.000501068237842807;0.000831515796852233;0.00087930290309635;0.000967909908790062;0.000979217898324409;0.00108578915137917;0.00217066128634304;0.00165661710022778;0.00119050056045196;0.00160876099240961;0.00270230114420069;0.00170182021982356;0.00262305491334274;0.00249971191480294;0.00300944378896499;0.00354914054319052;0.0040689835546416;0.00313490959585092];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-0.78706050153642859168;2.2732948725559642966;-1.4144359965262152112;-3.562056863634083026;-2.6254061288472914093];
  IW1_1 = [-2.6315592333764112887 -0.33844273842836636312 -1.5247812447615489706 2.1689649115665776691 6.8602812177658591963 -1.5446615131648699926 -0.090448137568043276979 1.5465803696378888077 -1.4280398075362954469 -3.1024649955879493035 2.0321208139182278529 3.8831365776980670823 -1.9024211365703704857 -0.42528647875171371462 1.672934364985791289 -0.63750019686826542298 -2.04866698843103201 -3.3087869940319278861 1.6029759015259978927 -1.2601811767000790088;-1.5232507059409796657 -2.4054345886450767544 -0.76166233829200158389 -5.91333964654154709 -3.582744307104309911 -0.038204632974155633418 0.26176100894481701964 0.40029468544954360798 -0.29667150142572884519 1.3674079657943480903 0.10020687479748133231 -0.59920562250201658827 -0.60156691402003026337 0.59511925288352196528 -0.65277527638588894732 -2.2556206947920145467 -0.79040521429062804426 -1.6649147894615983212 0.063249631372586989642 -0.08870358441494409496;-1.6577380068270697322 2.0885187915457086305 2.8612527063137904726 -0.45307455216670355913 2.0117477494033582097 -0.51746111761359492309 -0.62040135755366898618 0.6333491099740533592 1.1949129715655486539 -0.73526542407584571936 1.4797426253272891739 1.5467562652501956055 0.10526435747758022821 1.3030248101695647289 -2.0424092787468546284 -1.7632836566264269429 -1.0631933272349785025 -2.1301463337349937355 -0.3624312425457726361 -0.4981432080519089256;2.9172913013911849767 1.1889120120300478156 -0.3896208700620699128 1.6661738892142705648 -3.8243381522631847425 2.1517669899848743675 -0.91794592001271457793 0.70657381606361047144 2.8212546163762586282 2.2830288292975744469 1.0930954460455541977 1.4214003221000919286 2.2376298472463260758 2.8488297170352572252 -2.639815778391473966 -2.6430684822397751965 0.52438682313678641744 -0.16324579708185338323 2.2896084392182913803 -1.3182925412278581057;0.14007163917607914905 0.46744418172182233828 0.31899308126855213663 -0.34013568932314958149 0.85060977272063176269 -1.3919158970559641908 1.4352995977519253934 3.4348071649359401825 -1.4391758107649228471 -1.0297024911538934511 -1.275442584670150703 -2.500047148753836268 -0.15490114602520810294 -0.073737704941368498179 1.690503156005780161 3.531640031088699061 0.33498723632223031954 -0.70575546496818286624 -0.032192988108999440189 -0.15150400817486953109];
  
  % Layer 2
  b2 = 5.8042125137844777782;
  LW2_1 = [6.8058945944589996913 -8.6944324922073814577 4.9163810386210125003 5.9700450809150247267 -8.7743653585477847656];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

function [Y,Xf,Af] = tp118a96af_99aa_4bba_b4e7_08cd6547fda9(X,~,~)
%TP118A96AF_99AA_4BBA_B4E7_08CD6547FDA9 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 05-Sep-2017 01:38:13.
% 
% [Y] = tp118a96af_99aa_4bba_b4e7_08cd6547fda9(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-2001.76879548539;-1846.28602050405;-1096.5997794271;-923.044887924524;-718.635970677915;-534.736579087549;-636.877630731668;-474.328050496926;-408.756773605248;-607.267828431693;-597.15835836912;-252.737018064953;-357.743301501266;-305.701917871558;-325.216905874602;-420.955237007927;-168.878309979169;-299.148398756992;-279.306010526074;-382.085749121084];
  x1_step1_gain = [0.000250772026915415;0.000457175383291266;0.000795694570296745;0.000975455655635303;0.00136867839470428;0.00177765334299387;0.00147664952758212;0.0019652698447852;0.00211681540578917;0.00191395299404992;0.00213803411115009;0.0031374581659882;0.00239499394158853;0.00262802245354385;0.00340299377226967;0.00307580218448476;0.00420342200465304;0.00353937526659768;0.00305696135696247;0.00320422591704689];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [0.071336324978107740202;-3.4216813927035580889;0.84870714818246473232;2.9953047963718968383;1.2904148879132637528];
  IW1_1 = [-0.85498636245268688771 6.9367914380869777347 -3.2615100079775172226 -2.3852086636110994 -1.4958630281077813784 -0.91438712475752192965 1.8792080389418917008 3.0524980358305855432 0.61240068410446391045 -2.6759234770350905919 0.77544492029308731418 -0.87173212846431014089 -0.72209870560072209056 -1.0687951262732380275 0.76222314817431535694 2.2947296474368932273 0.7703662231058880927 0.77408824589686930917 2.8376106694716916046 -1.9573984588394641726;-2.6373166044528701946 0.82510633034591929214 4.507726553994217511 0.5753348218939819958 3.1755364595433643871 0.64169938535024406701 -0.083691190900143125342 -3.8232625235840869138 0.92444787563271024755 3.5210956910337229964 6.0199788360651469432 2.3242710878146328746 -1.236463487686827234 -5.1312438999109897253 3.4673943978889396611 3.0994042050225387719 1.0222608040440688271 -1.9579004924566616452 -0.3589317784849061499 0.81882074331352272534;-0.5493490575734983894 4.8556812771336392842 -0.19252488626707561781 1.1683516600796688412 0.62255736163566888219 -0.98602262171612586883 1.9755005152151625669 1.0200418309521084304 1.6487472581682813821 -1.7979364271458411206 -2.1901449831898136544 2.0294781217325392753 3.447644280656529947 1.8735272576072117268 0.82802149373805933319 1.8842145510131926844 -0.30746941278600059544 -0.56041046636137148429 -0.76830984289515302788 1.509406134889063944;0.96183118263545319682 2.96131622568902797 1.3712900127098077707 -2.2034205028784876745 2.2122758406588691749 1.2290091487128436132 1.1042379211584141263 0.67113298319796199642 -2.292538204190980089 -2.1972735401167016178 3.4977736073296705754 1.1391942223416269275 3.9455313650000247705 1.4638719148361869493 -0.84560157406351543763 -1.0571314408240954918 -0.084396737500569626866 0.49988535796275923584 -0.40685017172683873854 3.8214658348466881144;3.0186799758268643146 -3.1417968760267069861 -0.10920584409351126454 3.349760337211144634 2.3884295929530385827 0.75049639280452762335 0.44805605306416385059 -1.9171646797788550742 -1.4242504052288382788 2.1468227471184309074 -2.3479019918442567416 -0.63029669452821179831 -7.5296103652907646619 -1.872705403990928108 2.1304623533334847707 0.76890599304652496038 -1.0705967238272837694 -0.53817002037177574802 0.58299185173656897785 1.0707254182527634612];
  
  % Layer 2
  b2 = -3.3870822662293531558;
  LW2_1 = [-9.5222967529988817859 8.8213866562823195494 -9.2099537411129155373 -7.4276927351606181205 9.5999993323340646612];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

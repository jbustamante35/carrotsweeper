function [Y,Xf,Af] = tp11c6f5e0_f532_452a_812d_9771ea7ea082(X,~,~)
%TP11C6F5E0_F532_452A_812D_9771EA7EA082 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-Sep-2017 22:11:51.
% 
% [Y] = tp11c6f5e0_f532_452a_812d_9771ea7ea082(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-7409.93644730062;-911.082072190464;-1068.86784991252;-1175.93373113978;-1366.53951203702;-713.224898465735;-638.058802539163;-604.796304556691;-546.41950709658;-435.830146318414;-311.040988170587;-332.822721465579;-407.901071240806;-237.14382758463;-308.974324228945;-284.621358963176;-260.19985645116;-137.271225529413;-228.698126275217;-217.514535510725];
  x1_step1_gain = [0.000226370837385414;0.000563347828528141;0.000948114745185446;0.000858032283205085;0.00073024238319975;0.00151716399266529;0.00146770964020619;0.00151546500149801;0.00206494173697167;0.00202475070577029;0.00326439309746538;0.00229997229518739;0.00248425272472342;0.00412752991038798;0.00322794766513114;0.00343797851616055;0.00328303385537609;0.00723300236088428;0.00445727486740883;0.00407527899100777];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.3232640132895874263;0.18873334586485066011;-7.531165617583152283;2.4326342715211031198;-1.4396908763644098439];
  IW1_1 = [0.23118487226550421543 -0.92806054462741804922 -0.068985128842896370482 0.30370301754714568165 0.41820711536863103275 0.4880470505182398222 -0.91477553030989666727 -0.16772158117837188129 0.32458679717113014807 0.96757318225878119478 1.1230888946461792255 -0.75467250901304117061 0.14549180808981582169 1.2330789051425627978 0.23368627132866626184 0.2191815556974014978 -1.3168618987622062733 -0.4027400102333628662 1.5073151839584646439 0.90649294013544290394;-1.1546841635104614365 -3.561243690191829625 -1.0788973229690397293 -2.8446608740686709638 2.6572332132173213104 1.1308709809821007042 -0.79968882309343958248 -1.725741919836788707 -1.8457643485545240924 2.9832807231839826301 1.2328139969736779946 -5.5020498354356162096 2.0091849730529993678 0.43282145105021851972 -0.73408670287841293334 -1.1726523924184681924 2.1192053882039925128 -0.28541518616376748696 0.72661688728294060446 0.47245460763049085262;6.942693213995758228 -9.325491489680294066 0.13071260788198652003 -1.1190136568882924628 7.3790678794641095806 -1.5805011972692268873 1.4828498005744650268 3.0755120940294977672 2.0945043581145652567 -4.5880169658938436683 -2.0165809485315930871 3.8762368086509595422 -0.99212829349300812876 -1.4686992645737169116 0.92189062656445075472 0.41300176670611798979 2.9184216189847158596 -0.47877779762762301408 -2.3100613129151899017 1.335234174005775154;0.56565807988032956732 2.2868891284232515382 -4.9524633144793730466 1.0923531982330410006 0.10592225270477170773 -1.2804725160665617611 1.9252925467450976438 2.4150332108097960493 0.54598638982129776842 -2.4542919155632008099 -0.86400811545165645544 1.280040781833307495 0.19456990824506098514 0.1309348821123591522 2.5153268531428367716 1.2836287769137566528 1.2278766434688206388 -2.0510433415886422104 -0.5749577738076716571 3.3085991670645111817;-1.3493842652263907667 -0.888529920910401394 4.296377120145495887 -0.2408159531610871984 4.8199166256556233989 -1.4443263356946209885 -0.78375859194031116672 0.81739707889343138358 -3.3711133129533430441 3.8459800963949648533 3.2043542616102831389 -2.8022278710510786226 1.239477459319489272 0.36378187785980192759 -1.7249365606437923049 -0.24825967612305205323 2.1097599098358745806 0.92354786341620120904 0.012337371513888965857 0.74321669961725478348];
  
  % Layer 2
  b2 = -5.3107491752657969286;
  LW2_1 = [-5.3821444045578630266 -9.0221020751967238027 -12.355126785514094934 7.2670458308498355748 -8.2754855331860532885];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

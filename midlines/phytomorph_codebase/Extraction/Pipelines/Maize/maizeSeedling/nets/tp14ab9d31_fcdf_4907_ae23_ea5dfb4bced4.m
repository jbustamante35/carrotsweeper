function [Y,Xf,Af] = tp14ab9d31_fcdf_4907_ae23_ea5dfb4bced4(X,~,~)
%TP14AB9D31_FCDF_4907_AE23_EA5DFB4BCED4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 06-Sep-2017 22:15:45.
% 
% [Y] = tp14ab9d31_fcdf_4907_ae23_ea5dfb4bced4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-5310.24104946905;-801.67419279183;-796.678021735527;-751.778745457493;-962.879682501261;-561.234234396123;-567.818719457229;-566.708636588774;-460.813029179945;-650.116847383025;-377.913829978795;-279.141698173314;-258.595524643434;-362.027565171382;-198.123504200374;-350.30942786642;-268.266206223887;-201.923452595295;-200.676357162366;-192.300211130348];
  x1_step1_gain = [0.000187746732766858;0.000517587446146427;0.00076092913976903;0.00107683880161886;0.00113410115771159;0.00154637953830619;0.00191937835803698;0.00192268942981792;0.00211835684506627;0.00196958059572075;0.00268955398662543;0.00257377430529597;0.00284234016821653;0.00279908218986807;0.00409640929201511;0.00345584818973325;0.00422505290367575;0.00549698021899278;0.00471432618261896;0.00476878567270234];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [5.0764306487809696122;1.4450183812514914017;-4.8200201905959252358;-0.11695710428124821145;1.9031157316229914134];
  IW1_1 = [0.61577667751603959445 5.1683214733425772991 2.2540712221935428339 -0.74048189909666140007 -1.0906262325462232621 2.3231268736658936547 0.32328370315953869341 -1.9909555550505448895 0.53171888425522362276 1.1360086846390247128 -1.2640207324906274078 -0.73325340952551854024 0.32183235015700417669 -2.7759073511622922581 -0.06062584139434303715 0.024409574010175915521 0.056655194632115657427 0.27395674185697282965 -2.2940651235939055752 -2.1172166135471668369;-1.393860464073940264 2.8886559698800584606 -0.25395201786060189741 -0.77772333162988982469 -1.301015111738580865 -0.34996832523305487772 0.54001120539366254114 -1.6983181380333751687 0.96232722545796689495 0.79798216923164466685 0.69791540018657072242 -0.70666818240816431373 0.20324152797180161656 -0.4981164745053512366 0.78145262784898483766 1.5231856798294873823 -0.37888804549332744109 1.2259720933797926268 -1.3401347515336077265 -0.57457428202393323602;-0.60366980288641314267 -5.3340364108699036549 -1.7752929027475590207 0.081957346338356718007 0.93389528637675678358 -2.5063247935992296611 -0.11517138639436320935 2.8022528408456834903 -0.98190494121387705828 -0.84875461981831190617 1.6539132772943487826 0.55523297277277494643 0.54740932962511357207 2.5139997462358487645 -0.82067984259746795672 -0.19219358980370920831 -0.68043486016357324075 -0.090878488195875184452 2.0996916224173038934 2.5074593417136843421;-2.5648843815406334734 2.3640906249999047439 0.54122065749243630783 -0.66530001789340764695 -1.7902216289999333121 0.39610860388381385899 1.6304063440940983476 -1.2479841190902081216 0.1819984494469924774 0.063447249539407460373 -0.26548217705676202538 -0.32800294889140718668 -0.32485254598394913694 0.093754667084721243775 1.2455874739764245529 1.4432116227515365825 0.29568744766984494943 0.62380548190875051429 -0.47195426716818966728 -0.10766371964643733916;10.629352819541978192 4.897417727885783556 1.0185236515821483039 2.4866220615891849732 4.5859028623956907822 6.3293187896813316584 -6.3097504602708722743 -1.1504524225396108861 -0.51437343383589584356 2.956558531338696838 -3.2923013105472151985 1.4428033957446932956 -0.25607269049341169209 -3.3927527782472628459 0.60324890115012808067 -2.2697700080379985543 2.1192463959288874165 0.022932697656003829534 -2.5214919720900792477 -1.1268089714148321612];
  
  % Layer 2
  b2 = -2.1949942881245401161;
  LW2_1 = [-8.4407609942893060406 -4.0728790840648745331 8.6030905375126849322 -3.7065071600119203765 -10.45547498137996989];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

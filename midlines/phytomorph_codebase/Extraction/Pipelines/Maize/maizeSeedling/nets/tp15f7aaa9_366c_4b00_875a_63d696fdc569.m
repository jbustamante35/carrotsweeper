function [Y,Xf,Af] = tp15f7aaa9_366c_4b00_875a_63d696fdc569(X,~,~)
%TP15F7AAA9_366C_4B00_875A_63D696FDC569 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 06-Sep-2017 09:11:36.
% 
% [Y] = tp15f7aaa9_366c_4b00_875a_63d696fdc569(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-5466.61789079662;-862.937878923584;-1028.71862143181;-451.710971542894;-692.538815520008;-441.043793232208;-783.667639824726;-450.026271289942;-656.555828069282;-416.41181342801;-183.589471391045;-259.432124024243;-384.146123020669;-202.979007080783;-233.266353450961;-248.555985162479;-227.243600249821;-191.974128700877;-174.982344511272;-176.062817024351];
  x1_step1_gain = [0.000192953812201724;0.000635170113819408;0.0010737117105794;0.000992967389065706;0.00140247416929522;0.00179426803546528;0.00152094087103248;0.00262475201653709;0.00199415494766511;0.00251075910029924;0.00454433874041211;0.00378662000738753;0.00302237737948984;0.00448879604138618;0.00366080733460355;0.00363057230533666;0.00381924645546909;0.00427537582274407;0.00592120551781277;0.00602422138644249];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.2912805873601536089;-2.9349984523600260999;0.20040240769483547156;1.4338304154489185382;4.1578497705929544637];
  IW1_1 = [-1.7250931630013484064 2.8733349192597628097 2.6270575933130064783 0.25965998069489332201 -5.8915371575849260211 -1.6699862445612767559 5.8786964002475450286 -2.8573166332450115057 4.98053358469036489 3.6505766185199295393 -4.8648646857847523961 3.4778423120893835474 5.2700802995046016619 -2.5386954903906460146 0.26757954678581830077 1.3155900391061472465 1.0471421029504477396 -0.91948207855610530892 -0.148880232026119802 1.6605234815758032063;0.713568439467034632 -5.0183705210725282342 -1.5994487340662992825 -2.9513323736542251829 0.35564640765575100678 -0.016666737763010870677 -1.477147626908097422 0.83688052509006372048 -2.3580492361836951076 -0.50499958996683602663 0.27844727005336483705 -0.35113950826184564535 1.5570944125021715099 -0.95087015531656515765 -0.94824799653870794902 -0.50650160582267389486 -0.94416007761936782128 2.2676157628549979961 -0.25500146866303052828 0.92056982375881746261;-4.1506711665494764318 -1.7587574553023166413 -0.63617989066446900548 -1.7204525063833335796 1.657287037266770735 0.37322294548387274782 -0.56047188024887073521 0.5457759538218454054 -1.9835192294498280585 -0.89887477844070107214 1.6739547571805664106 -0.36778254588697928407 -3.306356427948380361 2.6395063111613472628 1.8800599821587942184 -0.76149015458093294306 0.16769787868146945886 -0.93308880552374551254 0.47181419353151965446 -2.059811661926346904;-0.39653588679403289907 5.2744098899528459867 1.5092196252797764888 1.1747314286419965335 -1.4469616305178905069 -0.37222244496586015527 2.9645615199879036261 -0.65561691689013690265 2.94399594945509957 1.9778560856234934651 -1.6403593809762151423 0.95495447658005294667 0.88358395972039438515 0.99534900301527307054 0.88867438005376941934 0.37542737181188667872 0.86967613432884782743 0.42773629551206832078 -1.3664229757575205859 -0.1937862893946376841;-0.19706671002898668021 2.6440388557054670393 -1.4954259109612857426 1.1557250962009686379 1.9863036117186720908 0.48138537178742690781 0.38114417439567849222 -1.5118175338380779316 0.051000117610142225999 -1.7921680682665914741 0.33614021902643098638 1.1611360602665161679 -0.96701006034285630353 -0.1320403228169400589 0.0774946205489244061 1.1736547171478883822 -0.36406645111276880744 -1.0149742566266850563 -0.61992710211073409621 -0.84433125063727632043];
  
  % Layer 2
  b2 = -6.6246733876052950052;
  LW2_1 = [13.274225237057462934 7.3077398925102441396 -5.8451417873197826225 -7.8560366724047776543 -8.2265888529162722875];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

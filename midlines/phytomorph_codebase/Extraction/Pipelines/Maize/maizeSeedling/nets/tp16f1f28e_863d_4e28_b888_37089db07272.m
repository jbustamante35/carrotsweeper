function [Y,Xf,Af] = tp16f1f28e_863d_4e28_b888_37089db07272(X,~,~)
%TP16F1F28E_863D_4E28_B888_37089DB07272 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-Sep-2017 14:48:13.
% 
% [Y] = tp16f1f28e_863d_4e28_b888_37089db07272(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1054.92998109303;-3159.48627075363;-2114.78087604941;-1423.59192565959;-885.057943991189;-1580.09594810587;-1575.88755591873;-686.259228054125;-578.923214789103;-680.040226027844;-526.427101249706;-436.274101764853;-464.119415341447;-602.900723427737;-237.436871082876;-426.867092225872;-362.59069598817;-284.873458506247;-200.952843845975;-350.305421104451];
  x1_step1_gain = [0.000201853701047093;0.000358308876895914;0.000501068237842808;0.000831515796852233;0.00087930290309635;0.00096790990879006;0.000979217898324411;0.00108578915137916;0.00217066128634302;0.00165661710022777;0.00119050056045196;0.00160876099240961;0.00270230114420067;0.00170182021982356;0.0026230549133428;0.00249971191480289;0.00300944378896512;0.00354914054319044;0.00406898355464238;0.00313490959585129];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-3.4204189754997518236;-1.7158645002823440517;0.79962349978581026555;0.60488460127419729773;-2.007114816951369729];
  IW1_1 = [1.5795581878282427546 1.2636295750363706336 1.780878189267395495 6.1090494965688506568 1.485710771665198493 1.5128088828223718032 0.83969348828599499335 1.4089625504876726048 -0.8338981558602462929 -0.53800871624035762064 0.3393904981465097892 1.3608736805537240411 -1.5046100415234691106 -0.41372313894794277012 -0.10510494055965419191 0.81823041060141243896 0.35017893778349074019 -1.6655272417023754272 0.78971499669651201714 0.92402036428605094365;0.89273596842645763783 0.20550311492503806066 1.1804297264870298179 -1.6352417491401658456 -0.62376684844267815677 -1.6262609762941919733 -2.0390547341475242504 -2.6930811565762584614 1.200686911807200552 0.74836053719178430299 -2.5380142292322576125 -2.7121971144102041684 0.42924085254156646441 0.68624664916532807091 -1.640878699467055668 3.822186638433177297 -0.2930156078963222499 -0.55741345008918985471 0.002036861515067554633 -0.15378766627836709668;0.9704498417746503236 -1.5105551791659703742 -1.3429187616121198712 0.058280723100655705549 -3.0443465739880433141 2.4307985411716170887 -1.1574344123872934986 1.5863343279143036213 0.35391768363710773837 -0.24710428109288468113 -1.5366605673829378809 -1.3045695817211042655 -1.3435856917889219542 0.68171043184284541017 -0.47896330914433243864 1.9317395751306059015 1.3774307342328901971 -0.21207396098027578302 -1.140256557140453042 -0.45463391268903019515;1.1715788200220351722 0.37995332808194531848 1.4093727734223888692 -2.4633343507611926704 -6.0890836714093676818 0.75503994517209571669 -0.30576914861836551607 -0.035679656047895982884 -1.7351349882049373896 -2.6401870935833504639 -1.4649925779646704171 -2.3375317275291234154 -0.91629807677863461812 -1.3281926836576853912 0.70277152477560456134 0.51873062793977831042 -2.871547135194315814 -2.4570820154228947274 -0.84381846075276478736 -0.71723042054533758805;0.1428513099919210827 -0.12204048791474995939 0.25154240675975891861 -0.23442555582128760117 -0.18716751388666363898 -0.3619253605335781554 0.010714694996525480492 0.20026722794886295254 0.041091626031775511929 -0.036662650332224620831 0.77404741206799887454 0.31274397592730007744 0.13305274725224708332 0.72013638007929248186 -0.30841146707815969563 0.16391851999172560306 0.16437942374487332642 0.21788575734472795387 -0.51974471169299463202 0.11241441876365243502];
  
  % Layer 2
  b2 = 2.7240139146952975224;
  LW2_1 = [7.7693487108011289877 -7.5532401470355861051 -5.9131775730741003017 -5.4049412561632337315 -1.8217290098091214468];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

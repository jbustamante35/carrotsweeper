function [Y,Xf,Af] = tp18c02adf_d910_480c_8380_db457986d9db(X,~,~)
%TP18C02ADF_D910_480C_8380_DB457986D9DB neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 31-Aug-2017 23:21:55.
% 
% [Y] = tp18c02adf_d910_480c_8380_db457986d9db(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1874.99930442497;-5454.91534726369;-869.204807020144;-780.471896742375;-460.20555521635;-234.31060487846;-540.291178237133;-572.14271553379;-192.819908210792;-263.800490630849;-210.820779921782;-212.784015206652;-286.590370604324;-190.32078243269;-193.663740648591;-194.470619647338;-225.820325675026;-213.719449945745;-258.858847398799;-176.115238468632];
  x1_step1_gain = [0.000342540442445779;0.00027748074658588;0.000806013241167017;0.00156677380853904;0.00168393926281428;0.0026904652788907;0.00198084992045411;0.00236361816544284;0.00245784730269614;0.00195235680232595;0.00282106579415896;0.00424658079482958;0.00317261769260759;0.00555458687461899;0.00429724736478088;0.00484270636687452;0.00333931608099044;0.00598913897545125;0.0038478300260404;0.00642488839732225];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.5488902727683364624;0.72949469120038434866;-4.2756978812125439049;-6.64685980491328543;-0.17620592086531017273];
  IW1_1 = [1.6576575533464714685 -3.5888090649481778627 0.1655349457523755119 0.12960879706786021526 0.66053318713685482688 0.22516677427814998924 0.51972272279961673203 3.7629504636549460095 1.1184691252776191028 3.8102854589772547911 -3.4998431729135850432 -0.10422135462470448475 0.098560287695458062562 -1.1044465048042058086 -0.38897838203986023764 2.4852102743402033624 2.3239045916098812761 -1.6025276230072731387 -2.4170826714648327993 1.1285689442511011027;-6.3145138853999487338 -5.6340872637021801594 -0.44150721288667199582 3.1184745265116897706 -5.3421538432719115619 0.42793681721000598195 1.0895355135026765225 -0.51976511473226838511 3.4357304055019364242 1.3626260060723021095 -2.8552223001922181211 -0.97713331305454431686 -0.90418016870480788505 1.0578759637082093548 1.0276139144086284816 -2.4468694320659141184 0.76481824454158875426 -1.7791744203029011828 -3.7627845882239130404 1.7642221021102293399;-3.7732512177722101754 -7.0780504293081625278 0.8992025304372771588 -1.5259859956006607273 -2.6107737193778293161 -1.5477156200273651798 0.082919798036389408269 3.4975678884343475161 -5.8094515777598694228 -3.7625825561688261978 0.21937373705385471157 -1.8089033950728634625 2.4009338972634606257 2.5535244419525278126 0.88598565135859908004 0.42391961659719135103 2.1556691092864688208 -0.17710457797570389182 4.5038243546898648617 1.4725948971482198946;-4.568402354970028334 -5.4710495482232603948 -0.34719362719162732978 -1.170657063051760538 -3.7806858634333253555 -2.1285663259890745813 -0.68033386893915626104 6.1524492935565060492 -3.6470872522530446425 -1.5409781475602837286 -3.4296704724587296909 0.37086872114381724819 1.917684169147571005 -1.8006413990816796389 2.6016393678885800789 2.5945871683218761916 1.7219786372799490426 0.36499771088605259539 2.943525801422720356 1.0439143445076097816;1.8975741070624703166 5.3847486988230093274 -1.9820336834863871989 -4.2154351080627847637 -0.23205594116808081484 1.1421349750255984645 -1.1109431278136281396 4.0312861058601674458 -1.4449546508599464545 2.4215059566517247447 0.77814827025894517387 -0.012260976169266475655 0.7688093852350675883 0.73957932019948391389 -3.0368081694653690228 0.83905113214246385134 -0.53234180392737695531 -0.97110535361809036115 -0.35325694138103352904 -0.0044225835484724904112];
  
  % Layer 2
  b2 = -4.0994032746457325089;
  LW2_1 = [-7.9353855413548677333 -9.4162892511225830816 -10.234959584755268125 -10.463178884778617572 9.5774963753158637303];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

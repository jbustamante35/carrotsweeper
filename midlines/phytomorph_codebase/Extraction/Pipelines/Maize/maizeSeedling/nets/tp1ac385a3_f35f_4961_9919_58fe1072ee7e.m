function [Y,Xf,Af] = tp1ac385a3_f35f_4961_9919_58fe1072ee7e(X,~,~)
%TP1AC385A3_F35F_4961_9919_58FE1072EE7E neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 06-Sep-2017 16:50:19.
% 
% [Y] = tp1ac385a3_f35f_4961_9919_58fe1072ee7e(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-8184.90793418462;-841.368302509968;-1769.06834334395;-1424.63292253515;-1115.63541033651;-861.953076142261;-996.664725988401;-421.625702789083;-721.553885286554;-557.274532479558;-502.132109545502;-541.944235264827;-543.177005191321;-167.20734582491;-344.528961662839;-294.40177640271;-391.010406370084;-285.680184537951;-174.294824484544;-303.609020442443];
  x1_step1_gain = [0.000202107905561193;0.000554219398814734;0.000742185534904077;0.0010185341647551;0.00103332655312912;0.00147681597144009;0.00118221307527392;0.00265958726683854;0.00125235891924471;0.00165285753178002;0.00232860128237175;0.00188013184297679;0.00198822427969294;0.00479968082327816;0.00252047169225125;0.0036311720615839;0.002729842636205;0.00383651951608909;0.00502254586493079;0.0033077132874447];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.6474891145549057647;-1.1037295520439216467;-6.9006571617420586762;-2.1441486818575201667;-1.5425205776406476499];
  IW1_1 = [-1.9965476011775966647 -1.2263023143230982193 2.9206792381842863193 -1.1331127791475972266 1.5395240851175282515 -3.0871582214110260267 -0.24255968039928238467 4.0723517410406069317 0.82103405820518615688 1.8205119117812571528 3.4791493144047977992 -4.5234293062709358679 -4.3009964204646458086 -1.8602608435038943124 -0.040938393545997278644 2.0218450386313069345 1.0559687958489216708 0.63104833050964159735 -1.2219703590253192527 0.70203201599374043251;-1.1571879028864084926 -1.4752903430091508508 -1.1794179527900170434 1.2611326225899757159 -0.52597381257489494999 -1.8794833295556514496 -0.12249823975959510391 1.6374084060525126993 -0.36547517732624273945 -2.5029723835589905434 0.14503628799433482266 -2.4713686519065229952 -1.7843754658697899007 0.26427857310902402865 1.3015861458552502317 -0.41955732029611436662 -0.44420928244881924263 2.9478032956654018903 2.1905683626341949655 -6.5313028399138959301;3.9956583446469999821 -2.9274867197340768143 2.4137222258766120042 0.47992330607071781445 3.6684378633181173868 2.8631227962803591502 -1.4834624064525643306 0.14041608911793038161 -2.3011898745606882422 0.58433345203879150098 -2.8827368198413609868 0.54713256727530812373 -2.3575625356606426664 4.3390303868935058418 -4.9508471967673033376 1.7525023879147296757 0.083526793201287752311 3.0218736253811528947 -0.15934407284185686526 1.3924156944321359752;2.4406252599826001592 5.504829654921968185 3.1517171108051833528 -0.72154079179303654001 0.048576676446107740215 1.0734970508514987131 0.80851398770914417735 2.927612247435966264 -0.57571416202966496645 -0.41209513317482293626 3.2731092752796722145 0.53229729246179890989 -0.78503056056131315099 -1.5330381798458714293 4.7699858003438162513 1.8769681228347832036 -3.3091969888100662978 -1.4621709131772755441 0.53206238203568068101 -0.41101594243564698594;-1.1919293459512723121 2.9361999514175511905 -0.24285933924974725806 2.6128005387524906311 0.24413338595032263445 3.3101317038836106654 0.62461386884392466889 -2.8601444436116412184 -1.2654586286736311251 -1.4423063621504521592 -1.9755243431492406359 3.3333560914677620168 4.0764925856193947595 -2.3011553994529769795 3.7629096365119392154 1.2864654623993660998 0.53869005333572750338 1.084364002443821251 -0.74468482221783860453 -1.2574952653990221219];
  
  % Layer 2
  b2 = -1.459075041998988187;
  LW2_1 = [-13.333994237536195726 -9.8228875943490621125 12.021334052781989854 11.042072499634063121 -9.5915809146606765268];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

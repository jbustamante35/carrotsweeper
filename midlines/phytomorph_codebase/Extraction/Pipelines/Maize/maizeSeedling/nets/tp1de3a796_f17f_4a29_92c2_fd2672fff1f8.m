function [Y,Xf,Af] = tp1de3a796_f17f_4a29_92c2_fd2672fff1f8(X,~,~)
%TP1DE3A796_F17F_4A29_92C2_FD2672FFF1F8 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-Sep-2017 22:33:36.
% 
% [Y] = tp1de3a796_f17f_4a29_92c2_fd2672fff1f8(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1710.79601884287;-841.368302509967;-925.675633657014;-1424.63292253516;-1115.6354103365;-861.953076142281;-996.664725988392;-421.625702789085;-721.55388528656;-557.274532479555;-502.132109545491;-541.944235264836;-462.74572718216;-167.207345824939;-344.528961662813;-294.401776402712;-391.010406370096;-285.680184537943;-174.294824484546;-303.609020442435];
  x1_step1_gain = [0.000202107905561193;0.000554219398814734;0.000742185534904079;0.0010185341647551;0.00103332655312913;0.00147681597144007;0.00118221307527393;0.00265958726683853;0.0012523589192447;0.00165285753178002;0.00232860128237178;0.00188013184297677;0.00198822427969293;0.00479968082327778;0.00252047169225137;0.00363117206158398;0.0027298426362049;0.00383651951608925;0.00502254586493091;0.00330771328744495];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.721619286553290884;-2.7249191492106028534;-2.7049869142952847056;-6.9609544801043314877;0.95721113828471215967];
  IW1_1 = [3.1388590085412726438 -1.7407306486796865208 1.3066957024320158265 1.6300260727536803884 -0.67192772749118101494 -1.6633937951878177142 -0.52276497162036283939 -0.35726589584346596373 -0.31457977171327800026 2.4344031856977288442 2.4327973859631906173 -0.76385731096305053978 0.59042500332992819967 -3.0186468109674415849 0.44201168413861907647 -3.3585630443858192073 1.4448927392697745731 0.13945848697141152717 -1.5709158885100162895 -0.3539209594180726115;0.35079725359911878568 -2.3604139152205729779 -0.40859467016592787569 -2.5978791510785956831 1.5619713869285452024 4.1815706918375763479 3.3133055962878406042 -2.576870921965780159 -1.2437710549724172449 -2.2161220522282194523 -4.457295605002633998 4.0786896109831145552 -0.20627530591016030037 1.3475556705082263331 -2.8564097416390592521 -2.0104430732121971737 2.1650628395940709758 -0.61562387059947987211 1.7627525574259426122 -3.3665712415913970901;-4.3378349123710648882 0.40635081089716951208 -0.25696608553945582409 -1.2069551535107296836 1.9911541717788521222 0.97063916511158099265 -0.93491312949763349938 -1.0462851938991228895 -2.1389471681664282698 0.054311446268744137389 -0.11598659086260403039 1.9646733317005942165 0.094204627849020033947 1.2366508551095132251 -0.26068143591072329146 0.85099126835622451726 -0.16004738858952669012 0.21349373116005232465 0.5852482669533031201 -0.69126321086355957402;-2.5891506793990153312 -3.20693538546265966 -2.2834686905843830651 1.277240394667075174 6.3950044164259889357 0.56137347104479451421 -2.7041299527473068309 0.72723809133938210891 3.3062799862166474263 2.2380170022996561663 -0.70730963019104819978 0.96270275372278202308 5.773967263897464619 0.61158715945908026512 -3.5851577943949082261 -1.3585414093986880602 5.712430781458760265 2.5739821310516797226 -1.1964529068746203588 1.326411090940091464;1.6191968435135450921 4.6394873406680465777 -0.43401448578773565989 -0.28331533896727395527 -3.1757646756356980866 2.1419674766548832956 0.0065095825866521295211 3.5903153045458617854 3.345874917888989053 1.4154214110214049516 -1.1272437081109298873 0.11574912145054312707 -0.40045636644006926685 -0.86538192180717055102 1.8068337340152134107 -0.0051120758486304642906 0.23201666198711970446 -0.18658123661606271226 -0.94491086305745464191 3.2354875380269940699];
  
  % Layer 2
  b2 = -4.0404447977302622164;
  LW2_1 = [-6.8004188181034015415 -7.3213505144462303065 10.908291335635144748 -10.232130400779119839 5.7831713576088166207];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

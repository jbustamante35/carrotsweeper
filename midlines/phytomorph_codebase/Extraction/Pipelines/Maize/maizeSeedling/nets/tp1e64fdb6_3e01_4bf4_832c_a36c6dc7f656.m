function [Y,Xf,Af] = tp1e64fdb6_3e01_4bf4_832c_a36c6dc7f656(X,~,~)
%TP1E64FDB6_3E01_4BF4_832C_A36C6DC7F656 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-Sep-2017 13:08:25.
% 
% [Y] = tp1e64fdb6_3e01_4bf4_832c_a36c6dc7f656(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-8184.9079341846;-2767.31086728677;-1769.06834334395;-1424.63292253516;-1115.63541033651;-861.953076142266;-996.664725988394;-421.625702789083;-721.553885286553;-557.274532479567;-502.132109545496;-541.944235264828;-462.745727182162;-167.207345824931;-448.973304658423;-294.401776402698;-391.01040637012;-285.680184537958;-174.294824484549;-303.609020442425];
  x1_step1_gain = [0.000202107905561193;0.000554219398814734;0.000742185534904078;0.0010185341647551;0.00103332655312912;0.00147681597144009;0.00118221307527392;0.00265958726683854;0.00125235891924471;0.00165285753178;0.00232860128237177;0.00188013184297679;0.00198822427969292;0.00479968082327787;0.00252047169225139;0.00363117206158383;0.00272984263620486;0.00383651951608898;0.00502254586493065;0.00330771328744498];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-0.4850492050667832844;-2.3908290771213045467;-5.6810785096288176632;4.4090512357349611605;-0.73481715419690107893];
  IW1_1 = [-2.2569711491041029028 -0.71486983118793112624 0.3996029781322733565 -1.6128596051283019541 -1.533501104539427784 0.7678194580680385295 -0.074113125081540026651 -0.6461802101109990204 -0.33383573866552113119 -2.705335686487947644 -4.9206082703509510523 4.5475886271618151113 -2.2078775898926283894 -2.8189580478110873862 -0.30441774759900896985 -0.91812984504549055575 2.3239794705395802055 3.6783036882885542518 -1.505029539871516997 -4.0768179241345174901;-2.8693672499911566653 2.9958937103882887776 -0.40413971488610161975 4.6681075589973950457 3.1904219115288792175 0.99966139607147985746 3.3207730150827012849 0.17347563214282774036 1.3311796756025562338 -3.8717296152110676211 -5.6747038880879889788 3.0546428419143309974 0.42697973558161511631 0.22524097805677215089 -1.0898170023833713138 1.625135257452317683 4.2416887644311298544 2.4727223620624076972 -5.3396203422126697902 2.9128669702909126826;3.1311425677955857516 1.1645832897847130383 0.97528970148602578405 1.298345075970797291 3.9948786312399913179 1.792855811690908574 2.1389370823659219489 0.91867747728951842934 -1.7794934999759455252 -2.5551797425770845784 -2.1380192156940740489 0.10488222428830872024 0.58335954584430282921 2.5744722387781875383 5.045843645502527508 1.4534786563438819584 2.3604970613363516208 2.0034117058315450421 -0.57108220003409948529 -0.97856430578122788333;0.45319568961209910629 -1.3724570319666169471 -1.85092124283373205 -2.9225958274057663999 -1.3958846451059228055 3.1488614275813722188 -0.33824607819951196808 -2.9311062866606967248 -2.2434841659141597781 1.6471090786714495113 -3.6485042124032109889 2.684933315676668375 -3.5323873326998977973 1.0432811553317460351 -0.45231531054161466798 -0.19646705172209508183 -1.9529340892299229537 0.66949340581842720077 0.065850078775953724275 5.9795863923266088236;3.2715846544802560381 6.0239792648209862236 -2.3630896945299006973 0.13708703155526136275 3.1444034656433585972 -1.1825314740294621263 1.9247966223258050622 -3.2941569182239964775 -3.1181790325009552944 -0.095123901331853027985 -0.51726516524495580462 1.208027865376827048 -0.09502191859862599288 3.7396193380508409021 4.2207243161171650314 -1.4513098484381372621 3.9246873529438168759 1.685691399827690784 0.72301044659705837603 -0.57792721906713517832];
  
  % Layer 2
  b2 = -2.2013195589353946602;
  LW2_1 = [-9.0606462635119591198 -6.2942577857023600529 9.5488114732336697443 11.652586498603637821 -10.132831388220607138];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

function [Y,Xf,Af] = tp1e6970b7_b474_4fdd_b86f_48314aa8b422(X,~,~)
%TP1E6970B7_B474_4FDD_B86F_48314AA8B422 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 04-Sep-2017 22:04:39.
% 
% [Y] = tp1e6970b7_b474_4fdd_b86f_48314aa8b422(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1874.99930442497;-5454.9153472637;-869.204807020144;-780.471896742374;-460.20555521635;-234.310604878459;-540.291178237133;-572.14271553379;-192.819908210792;-263.800490630849;-210.820779921782;-258.183122033527;-286.590370604325;-169.741999038738;-271.750472270933;-194.47061964734;-373.10470912036;-213.719449945761;-258.858847398802;-135.174215342508];
  x1_step1_gain = [0.00034254044244578;0.00027748074658588;0.000806013241167019;0.00156677380853905;0.00168393926281429;0.00269046527889069;0.00198084992045411;0.00236361816544284;0.00245784730269614;0.00195235680232595;0.00282106579415897;0.00424658079482956;0.00317261769260759;0.00555458687461898;0.0042972473647809;0.00484270636687456;0.00333931608099047;0.00598913897545092;0.0038478300260404;0.00642488839732231];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-4.2473470202916940863;0.1983096609447449199;4.0466722292317909293;2.1637800227092247596;0.52112064369444233147];
  IW1_1 = [-4.5908799640649631257 -3.6809367431618724709 0.52928376042512026434 0.70009130973884359239 -1.3443539471816075004 -3.3028680025964027855 -0.068145142866415209237 0.72336260699475607439 -0.65700164370311464612 -2.2756648003703516814 0.17231746725753210869 0.033932433113412083237 0.075161859541596473533 -0.11697534205976169164 -3.4794408941304815208 -1.7283977655630293757 -2.307432731731941189 0.99395843608145628689 1.9533725711068468112 -0.80007964803359943318;-0.52052146220132455845 1.815336270647755601 -0.92578224998178226812 -2.1029011383137552471 0.44187924603632794396 1.9721564043415953371 -0.31436038021509388196 0.93392495158948407585 -2.1575389773988118414 -0.991887317484284603 -0.14530487724374360758 -1.6094956825886321816 -0.81096364538280141243 -1.8404468227984009943 0.70757756727706366817 0.67738841998399590416 0.11083830687828467865 0.39124903943010752583 1.8250965466281898752 0.26290823124379347764;3.5006967381328792932 4.3411187336579457607 0.50681127719094531958 -0.1547630095584854315 1.9389337767743741736 0.75006612891602397752 0.022203110815778016179 -3.8165469064423227508 2.0006296941773493714 0.21781299177479326867 3.1986753486808026103 -1.7187294018100409687 -2.1081263250251183194 0.23008709280004990827 0.041538697395268241175 -1.5984151761825922122 1.4040013569299132357 0.72165044287385116117 -0.063604984046069595882 1.7270948985315524027;-1.075733872453800366 0.10044347240714181224 -0.3360352434042175318 0.58417376910527085698 -0.22391619992221525881 -0.4618297374879283268 0.11314551186599781929 0.24597411007149347362 -0.42097038145416537658 0.27979790821604266782 -1.1517079732935329162 0.7864395955510573577 -0.22434333005056639188 0.19019475828419624142 -0.45175554076160162609 0.50706543238638179805 0.24519243388828729224 0.66332063946064312443 -0.60332089417119150188 -0.2297016842368470313;1.252975906385594751 -0.07057367016199109222 -1.0034632942770160824 -1.4189149006940129372 -0.73997904226295219132 2.1853400616549505386 -0.59025456114556229537 -1.1553248566793821173 -0.16533254462036792165 -3.5356070706443207818 -1.1855944864113647785 -1.8651079036280928669 0.091174937776158301861 0.53154920320290455216 -0.67160995299320591645 0.56236333627320300721 -1.492368358615946633 0.55576634666972202226 2.8186838285104496293 1.5050156950953290647];
  
  % Layer 2
  b2 = -4.3240388883816844867;
  LW2_1 = [-5.7792761704422463964 7.9059408653448111082 5.4023512262659094674 -4.9835803474696751536 -4.5472652203338697063];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

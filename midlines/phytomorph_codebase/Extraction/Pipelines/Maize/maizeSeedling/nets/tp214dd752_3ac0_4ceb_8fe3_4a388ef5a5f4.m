function [Y,Xf,Af] = tp214dd752_3ac0_4ceb_8fe3_4a388ef5a5f4(X,~,~)
%TP214DD752_3AC0_4CEB_8FE3_4A388EF5A5F4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 04-Sep-2017 02:08:57.
% 
% [Y] = tp214dd752_3ac0_4ceb_8fe3_4a388ef5a5f4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1054.92998109303;-3159.48627075362;-2114.78087604941;-1423.59192565959;-885.057943991189;-1580.09594810586;-466.558771320894;-686.259228054129;-578.923214789102;-527.239355792852;-526.42710124969;-436.274101764848;-275.990547714348;-602.900723427735;-237.436871082881;-426.867092225934;-362.590695988101;-284.873458506255;-200.952843845976;-350.305421104439];
  x1_step1_gain = [0.000201853701047093;0.000358308876895914;0.000501068237842808;0.000831515796852234;0.000879302903096352;0.000967909908790062;0.000979217898324406;0.00108578915137916;0.00217066128634304;0.00165661710022779;0.00119050056045196;0.0016087609924096;0.00270230114420069;0.00170182021982355;0.00262305491334275;0.00249971191480277;0.00300944378896527;0.00354914054319056;0.00406898355464206;0.00313490959585141];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [2.3081425402556741133;-1.3133666819550444682;2.2112618288346355122;-0.41470188662670764979;-0.7464423834378988154];
  IW1_1 = [-1.553267740456973689 -1.6612953043170171075 1.3915557650479424279 -6.4465861024387711709 -2.6425549150235658757 -2.863278703814452264 -1.9801590652605607357 -0.84531471643809497074 1.3576789957565784661 1.583263168916656527 0.19918144067598919644 -1.8766932260258872844 -1.8681399669949056985 -1.222925498136690603 -0.59901976364974451883 -2.9646159760104304759 0.84396486032166173619 1.5410687573949941598 0.13017475685845122935 0.0068302395232522020857;0.65940674203632643202 -1.5807267018285982019 -2.4431366061607726614 -0.6520875346900065761 -3.2535658296142662138 3.6508119076077560905 -1.8708929992340537218 2.0186973789200770568 -2.3909006592849357808 2.6833481894638246956 2.3837241722942299482 1.9456985603906249427 -1.2970998553878769766 0.66842071153567195196 3.7791491641968568693 -0.80414712123125542398 1.2424540582011691647 0.19054271245561210657 2.3323133198594416804 3.0864479914476281586;-1.6157863795911875382 -0.46584036764684649823 -0.76453384353706532739 -3.7576749781018436991 -2.2377977509673132595 1.7388215505076947132 -1.6970369021423146183 -0.44741809142284222345 1.7292918834177375409 -0.070295291773114373934 -0.77740005531303102426 -0.4883290016524081123 -0.51370298945184011963 0.1272614229579426548 -1.2094682634084299444 0.43405565833646014839 -0.29030691909531702866 0.073989855519193403754 -1.1272489075252447588 0.48657102087768272503;-1.1977569464978008451 3.9848834604286049732 4.1418499701554285508 3.9913102197182919184 5.1590774210239347397 -1.0447477061963501566 -0.87408146637803085799 -0.14885028907628169992 -2.6313719295459252479 -1.2142531290363083318 2.4174435185651601543 4.5192950077773703654 1.2256679135255399427 -2.1906159584371476257 1.0346042218483921804 -3.1555567750484820877 -0.64929173568683595796 0.41596893451612021453 0.16581313027046307162 1.7130080016670452547;-2.1824234582260499948 -1.3613237863697364993 -3.3976494095774376625 1.197195513921918586 4.9938493359470310651 -1.6933809066996901027 -2.8364334426524746569 1.5289897776852070521 2.1075180290030099961 -2.7400982134526956635 1.6493599048870219992 4.362355963883208787 -3.4825380208899900936 -1.3903383812261207453 0.053165023561005296526 -1.607783484074040814 3.0875767705203616131 3.2278898526774155719 0.70334822002893893078 -0.29406151551936993149];
  
  % Layer 2
  b2 = 6.7570198746908980425;
  LW2_1 = [-6.7171222206938194788 6.3178409243619748636 2.7913374940527297952 9.5958652034109661599 11.243992249789487303];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

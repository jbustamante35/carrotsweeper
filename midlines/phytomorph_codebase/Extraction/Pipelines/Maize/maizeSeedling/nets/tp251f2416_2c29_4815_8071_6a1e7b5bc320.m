function [Y,Xf,Af] = tp251f2416_2c29_4815_8071_6a1e7b5bc320(X,~,~)
%TP251F2416_2C29_4815_8071_6A1E7B5BC320 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 06-Sep-2017 21:11:07.
% 
% [Y] = tp251f2416_2c29_4815_8071_6a1e7b5bc320(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-3289.74882371951;-1498.84051842406;-977.818006857931;-2473.29678142316;-579.957172766838;-720.151909430017;-474.399996307269;-522.242249232239;-420.226401116415;-417.475292942102;-306.200888877846;-388.367090162115;-285.018101170375;-376.411586177091;-312.43050061952;-321.397730757896;-231.052600123328;-207.605781402899;-300.292838284029;-183.531087713645];
  x1_step1_gain = [0.000377693156370527;0.000577456077299579;0.000763241531595338;0.000656175798642299;0.00207889551360641;0.00132289146378878;0.0021050120182425;0.00188095402340317;0.00237297796658717;0.00258788322162196;0.00300539389135355;0.00292429008303262;0.00346972867854873;0.00273531031890042;0.003119740053355;0.00346508516159045;0.00478122411926407;0.00448287798328063;0.00393490060972038;0.00521177147160685];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.5081633969462653333;1.0266611452484504241;0.81167099026552413932;0.62272697815609145966;0.25554477841653028269];
  IW1_1 = [0.68603571455812373259 0.52936445810220422725 -0.95610890772011858374 0.089413788595761281575 2.4062184435206477318 -0.0071664261557603144148 0.076955685961105038673 0.58459845238362839748 -0.010961885061219285922 -0.77518758883535499038 0.37322702359082216006 -0.84182166153554394139 -1.2968820261452571607 0.2064074761202132624 0.088093252030819940712 0.6349724062675933256 -0.51601755995719278403 1.7092732075327299324 -0.69844576805423896904 0.031412369688805383272;-1.1534162756478585354 -1.5397070816791655901 -0.93462727072758911007 -2.4093991612863261409 -0.57270894963592888782 0.073030641569768864341 -1.0922396334616626401 0.77152050870388710901 -0.71673326205882970097 -0.15792965050640259128 -1.3912870648099653348 0.20261552510492122914 -0.35830289843267859595 -0.79322933030351339134 0.42433448434609599698 0.75462125459323625698 -0.62718996448043451419 -0.80138091651697518358 -1.265736213038423319 -0.16719422923988308538;-0.6150332352021808946 1.2527694596982181796 -0.23635218895054208033 -0.86885745029687844188 1.7471931340695323609 -0.0047292812778104570404 -0.46063325349493089433 1.8281637666755659044 1.4149946561911053156 1.3261575086368644349 0.18150097667697812076 -0.93018483522106376604 0.32480861260882071262 0.36764344470425619482 -0.20110096015563636018 1.4639269310096094667 -0.25880738476329800957 0.93560771310435797421 0.39651870817913636991 0.78006456182467964755;-3.855798305134469306 -4.1604407570613428646 1.6860763111565149064 0.32089420466828211254 0.7628135270844466076 -2.4150623643489961268 0.93826665998379632505 1.1718479837252089304 -1.6042910072615279571 0.54958932220224643306 1.001842021438756003 0.66497639645436279476 0.39055004259330489136 -1.7218116958228593116 2.8545950960583499345 1.6792518694404718893 1.392311470127858497 0.37534264230145458763 0.76908880837478799108 1.2386723003479764849;-2.4242150814393568226 0.49349155746180201065 0.19498126328321901957 -1.9320210177626266912 -0.45475730394279456625 -0.57456608633370209738 3.2488645262438833328 0.74097944257636749743 -0.96566432103012500576 1.2057086397714684711 1.0385905168936202525 1.0246193688312299486 0.035160380797668588926 -0.77899582902985764488 -0.97542533541134424091 -2.1434440459138675017 -0.13402613053906400897 -0.011282249051090733477 1.5618536602485924014 0.016716148396928129372];
  
  % Layer 2
  b2 = 0.4204431131248557163;
  LW2_1 = [2.9014687060173658395 -4.1640829163183861183 -4.7765375668924026087 -5.7350311530335469357 -5.5220575395986903899];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

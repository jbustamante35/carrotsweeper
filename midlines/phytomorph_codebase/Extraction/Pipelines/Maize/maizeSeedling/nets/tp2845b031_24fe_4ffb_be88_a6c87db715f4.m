function [Y,Xf,Af] = tp2845b031_24fe_4ffb_be88_a6c87db715f4(X,~,~)
%TP2845B031_24FE_4FFB_BE88_A6C87DB715F4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-Sep-2017 14:41:17.
% 
% [Y] = tp2845b031_24fe_4ffb_be88_a6c87db715f4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1054.92998109303;-3159.48627075363;-2114.78087604941;-1423.59192565959;-885.057943991189;-486.212064486039;-466.558771320891;-686.259228054127;-342.454990361201;-680.040226027835;-526.427101249688;-436.274101764845;-275.990547714356;-602.900723427733;-525.032869762624;-426.867092225905;-362.590695988145;-284.873458506235;-290.570400999433;-287.671508962954];
  x1_step1_gain = [0.000201853701047093;0.000358308876895914;0.000501068237842809;0.000831515796852232;0.00087930290309635;0.000967909908790058;0.000979217898324413;0.00108578915137916;0.00217066128634303;0.00165661710022779;0.00119050056045196;0.0016087609924096;0.00270230114420062;0.00170182021982357;0.00262305491334279;0.00249971191480287;0.00300944378896506;0.00354914054319065;0.00406898355464109;0.00313490959585102];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.4652737200992760336;1.9298076608457073178;0.85581668603216276558;-0.70562821638067674268;1.4216142246691891859];
  IW1_1 = [0.58405944569167778102 -0.14052647208568683213 -0.32512066917876319971 1.4875471989007107432 -0.68559090789354448781 -1.1702825055007783916 0.87021812079756410974 0.031499976322897124681 0.55782628965605274285 -0.69704069459737028058 -0.51796350128694856885 -0.2225126759672025889 0.3663511501211941801 0.46282555206634395928 0.84210222098672105062 1.7376027579818655866 0.64707661946068717462 -2.247982670449034881 -0.46977865330356199935 0.39481698085175775947;0.62516382385582180969 -0.0083074623340419588569 1.2735647643399863327 -0.73510469438436665257 0.519218674518062695 0.84146037731479694788 1.56256519374953462 -0.067735826712143162864 -0.15184143651670953257 0.82511087627332546646 0.91429975425908083242 -1.3121964715256480005 0.19430966748011385681 1.2832983425213713158 1.6106884116950195285 -1.7584762160740705639 -1.1579595333219896425 0.34457158109223928744 2.2664389124761572525 1.1790242914730608703;-0.6955494504795721733 -2.070686961230069123 -0.26822189404199403562 -5.6664721576348027199 -4.5091668204855839264 -0.87455284523821841258 0.71980073998216487219 -1.1141402986528068375 -0.27714739699216373037 -2.0947029792174469698 -1.1555273056889885375 -2.9761428028752607844 -0.53761313087705231428 -1.1556987183523472762 -1.1171076573128169152 0.069533437937148667718 -0.49029472761503001266 0.61759392046250960462 -1.3700251886969607718 -0.2671104215768172474;3.2987747036833661163 0.57068819025649353271 -0.26354030718002469103 -0.29452889524874914517 -3.0708530428504814402 1.6853518909435172279 -0.55710869440496257887 -0.16474765104951261119 -0.38191571558563980338 -0.058225490859544530575 -2.1580182587265435146 -2.767779262284066899 -1.6708319286301933637 1.1019233575468443398 1.2776643193197407822 3.9128047435816646349 -0.61265268146655338377 0.20585755157407190086 -0.65676807623157573701 0.98931340374343301747;0.78456444803373648345 0.34778151669152695957 0.83423806507396425225 -0.45981584295256267003 0.21526155328254192867 -0.052348072809181314669 -1.0559692533138738124 2.1917705066880524001 0.8375261813159490254 -0.77299647493656564734 0.71087002582149427798 0.31152717265764673371 -1.1100742720854579471 -0.021893332546485445161 -0.13377426976351353138 0.24782621530264778431 0.92987999918390706888 -0.38449779450089177635 -0.75216740499585643676 -1.7088757466215125369];
  
  % Layer 2
  b2 = 3.0771112805717160121;
  LW2_1 = [-4.5586698549715167772 -5.5712504589169506986 -8.9825068925863948976 -7.2285316705375235458 4.7657566709555103657];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

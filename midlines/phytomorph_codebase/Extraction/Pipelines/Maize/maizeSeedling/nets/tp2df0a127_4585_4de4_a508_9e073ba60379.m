function [Y,Xf,Af] = tp2df0a127_4585_4de4_a508_9e073ba60379(X,~,~)
%TP2DF0A127_4585_4DE4_A508_9E073BA60379 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 06-Sep-2017 20:55:51.
% 
% [Y] = tp2df0a127_4585_4de4_a508_9e073ba60379(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-5466.61789079662;-862.937878923584;-833.978767721887;-1562.45386611792;-692.538815519982;-441.043793232209;-531.307871775741;-311.950474474653;-656.55582806929;-416.411813428008;-183.589471391041;-259.432124024279;-384.146123020655;-202.979007080796;-233.266353450971;-248.555985162501;-227.243600249879;-275.821003918828;-174.982344511245;-176.062817024303];
  x1_step1_gain = [0.000192953812201725;0.000635170113819407;0.0010737117105794;0.000992967389065699;0.00140247416929524;0.00179426803546528;0.00152094087103248;0.00262475201653713;0.00199415494766509;0.00251075910029927;0.00454433874041176;0.00378662000738717;0.0030223773794897;0.00448879604138527;0.00366080733460349;0.00363057230533651;0.00381924645546881;0.00427537582274508;0.00592120551781319;0.00602422138644343];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [4.0953827035874139639;-3.241403172677904454;-0.9789776232979215953;-2.90397639643071237;-1.1717910762719057072];
  IW1_1 = [3.6768280814707026138 0.99097519424953472988 2.8471563614432224831 -3.0163131996781165078 -0.23681990065790178845 3.0767255543546601082 -1.5995974644646027141 0.88756957386757684425 -3.0988990810460039782 -2.5398000178107684732 0.94439306730860872463 1.7578070608745550718 -0.17876371666928550508 0.94742539415118898205 0.28480360395324827438 -0.32237836005990311294 3.4465601315940563865 -0.13907753204057093921 -1.5103533379098876832 -1.0302125726230280112;1.5168575117803553276 -2.8535173084345135663 2.2057506334083214483 2.8196039707510949235 -0.092419665245969132017 1.0686576264884288801 1.5911750047941639608 -2.297584446734246999 0.28484099351745828521 0.082759895922782891753 -1.8521302135619577278 1.6759732090030097229 4.3471920461634043775 -1.1255361886585200093 -1.5020503508394340564 0.42608775211396515692 1.7102876175058820962 -3.4348541523454598767 -0.23191178210360013923 0.20260416932619834673;0.13384059274842252663 1.7436652750167307424 -4.2144012348453525618 -2.9811325037490559176 -6.9967657129280542705 -2.8659948634455543193 -1.9695928048224795592 1.6869065482126444078 4.5124486970461852309 4.0516863133994771573 -5.1830664027551094364 2.5170801188806524173 5.2056479623283564706 -1.5087148133002576955 -0.29469830921255196765 -0.02653424293659282715 -0.42389494103117864032 0.22705919803326035655 -0.5493441332583450798 0.90392449106375394319;-1.2399532967297588471 0.72887479249775932733 0.041480764597256435111 -1.0979276614503226117 -1.2365577814558319503 0.13407348203072957937 0.59602967507927984148 0.20081914623751859206 -0.2558538050068531744 0.56078402293401496959 0.19179958643016400965 0.38920107573169049342 0.18932333927238020888 -0.22154402810717441219 0.012707429516834213568 0.15772088134395123582 0.22258055677666666039 -0.40060953112067121396 -0.52445402231503324142 0.14567817591497878027;1.1563009743988459377 -4.5474740161667472904 2.7089184479496939417 2.6206150860531338687 2.4004855710419326087 0.38334405783048453031 0.54695546380292436872 -0.5789248894106855392 -2.5679605094783704011 -2.0368760961707641499 0.57550728727673683416 -1.8543493840501104053 -0.83538518628032876201 -0.40672395871983868521 0.74088345819272305448 -0.80204772558105885683 -0.23214584839450749798 0.3812785473332880315 0.001232427358051083055 -0.52546105197342485305];
  
  % Layer 2
  b2 = -7.0976966069912101887;
  LW2_1 = [-6.6883264736807079842 8.6175703708543007764 11.149273769499746578 5.0722534410733377541 7.5836733630309121068];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

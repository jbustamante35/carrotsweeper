function [Y,Xf,Af] = tp2e3518bf_b5c8_4967_855f_db110fca466b(X,~,~)
%TP2E3518BF_B5C8_4967_855F_DB110FCA466B neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 02-Sep-2017 15:38:51.
% 
% [Y] = tp2e3518bf_b5c8_4967_855f_db110fca466b(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1710.79601884287;-841.368302509967;-925.675633657014;-1424.63292253516;-1115.63541033651;-861.953076142263;-996.664725988398;-421.625702789088;-721.553885286545;-557.274532479573;-502.132109545498;-541.944235264823;-462.745727182146;-167.207345824914;-344.528961662828;-294.401776402713;-341.632557540989;-285.680184537934;-174.294824484561;-303.609020442436];
  x1_step1_gain = [0.000202107905561193;0.000554219398814734;0.000742185534904079;0.0010185341647551;0.00103332655312913;0.00147681597144009;0.00118221307527392;0.00265958726683851;0.00125235891924472;0.00165285753177998;0.00232860128237178;0.00188013184297679;0.00198822427969294;0.00479968082327803;0.00252047169225129;0.00363117206158384;0.00272984263620488;0.00383651951608942;0.00502254586493024;0.00330771328744474];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [2.9672542735698939076;-0.94465986316786854093;0.37453863339826448664;1.9043972413645071651;4.5916244326954096522];
  IW1_1 = [-2.4224016360214002397 0.66658683900089099605 1.1200545871839291401 -3.9337290255737631384 0.43648456379756706003 2.463674286313891848 -0.77142680410047026474 -2.095556653972313832 -2.7680553472640148094 2.4761588352365162535 -2.4505796914973712042 0.93131728211767539349 0.011196225915216680841 3.0196610650587420999 -3.0461058357836945376 -3.0579361980350010519 -0.10556132113357638569 -0.21368248904389539056 4.2872361853116602859 -3.6262756836029783614;0.48150262738922466887 1.2073268538340433675 -1.2770137183404950409 -0.42022301476701101608 -1.3707917223045205102 1.5078160623597460788 -0.79781319243216164416 0.81329738636541060171 0.88461183963458334123 -0.75508450773814916879 -0.67340361799887971106 0.62026830778479324913 -0.25908533988940690707 -0.66987596283808303887 -0.060093538496361328938 0.56546787353439009749 -0.48144167960159922615 -0.17643262419587860124 -0.9922683679894162001 1.4582891813972633788;3.5113327064701307378 -2.192415469121701932 -3.6965825873055702111 -1.8680589698605654103 2.782627104861647549 0.49819356471605502623 -3.7099111291689221837 0.51543899252351799145 -0.2966133248869238237 4.1346575414041808472 -0.21258876066537951699 -1.5897788183830547926 -0.46718650617208812292 0.88844469737722286951 -4.6890062760516970641 -2.7643206703304130656 -3.2631035296801460532 1.3333823852548631894 0.38815867809338699956 -1.537269768080507415;-0.60078830512063741143 3.7893577721868734187 -3.8900230875638373007 0.67813339189845212029 0.13321926538899958592 -0.071263335509501674059 -1.762840473930732621 -0.98621044831276150067 0.62187412044062351235 4.2946732512255980652 0.19424748054734353175 -0.64340126239857065027 -4.1849026057599232331 0.76754386393478635231 3.6165941257650455753 5.7545070787270864443 2.254044372773716276 -0.25432511670902430145 -0.556651521479951783 -1.1258790303218426665;0.91044316422750404261 0.73000513210365014505 -0.92070131340498495565 -1.9195617717579627204 -0.7070080052906027035 -2.8650349022252505904 0.9085643601377615397 1.9786945124917800776 -0.20867060833355258187 -0.31253360363733490024 3.3430862193249426539 -3.7753153645756136747 -0.099413079653743866015 2.4195675646214818144 -0.45547155323478683009 -1.2129302305886957569 0.71662275579744494358 0.24501481749869521987 1.5417413263744565999 -1.2202793963440516922];
  
  % Layer 2
  b2 = -7.190542728449092813;
  LW2_1 = [6.7017683480544549823 8.1872120292995091972 -8.9193002997941359666 7.6784232001253842625 4.3571442400898963143];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

function [Y,Xf,Af] = tp2f45f157_ef7b_4ff4_91b3_89b5a5034b9e(X,~,~)
%TP2F45F157_EF7B_4FF4_91B3_89B5A5034B9E neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 31-Aug-2017 19:19:02.
% 
% [Y] = tp2f45f157_ef7b_4ff4_91b3_89b5a5034b9e(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-5466.61789079661;-862.937878923585;-1028.71862143182;-451.710971542896;-692.538815519991;-441.04379323221;-783.667639824728;-311.950474474655;-656.555828069292;-416.411813428009;-256.51856505755;-268.743398235234;-384.146123020665;-202.9790070808;-313.061223281972;-302.321350914821;-227.24360024997;-191.974128700847;-162.786711803931;-176.062817024284];
  x1_step1_gain = [0.000192953812201725;0.000635170113819406;0.0010737117105794;0.000992967389065702;0.00140247416929523;0.00179426803546528;0.00152094087103248;0.00262475201653709;0.00199415494766513;0.00251075910029927;0.00454433874041203;0.00378662000738724;0.00302237737948968;0.00448879604138601;0.00366080733460328;0.00363057230533662;0.00381924645546839;0.00427537582274562;0.00592120551781312;0.00602422138644409];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [0.2991711213346588405;-1.1438725920464001273;-4.8471192616555578425;1.5685620764306069663;-0.49370503665458048692;-2.1669128179501280229;0.64247718972561718154;2.6808151963173965093;-2.0223903497722219846;2.4413535666283068259];
  IW1_1 = [-1.3100250675862536998 -0.49372369756883693892 0.41727301119011689368 1.131489444395393118 -0.056660756145749779922 -0.39396859033523912164 -0.75673613081030921546 -0.16231213351031231751 0.49508696298939586233 0.69796114383348084598 -0.15440463825689801358 -0.17042729346670951185 -0.14013462978906959799 0.59679393619007237159 0.34161564603345828672 -0.46975522408694020404 -0.018084338127319059958 -0.032907287499563821209 0.13594280342216977231 -0.38797676531811003953;0.20154479225386029428 0.064962431483022914369 -0.61975501339821215119 0.4101578009664045843 0.75868180828076081657 -0.0306214821647054318 -0.051334860234745316454 -0.17210359074945971725 -0.18101731975337220781 -0.55292965138770822087 -0.12785133264852932555 -0.42475682784983548324 -0.2271873309531272922 -0.070763585258462963212 0.096678071940208984425 0.37093861888035811747 0.55287884369407402918 0.34049363159138362755 -0.76759297761325084863 0.21961058781364914405;-2.2665207716319564213 -5.5080022404446919992 -2.6549367655611937344 -5.9881742257649843708 3.4261988679999317853 1.7386690971957419194 -1.8725463755507465446 -0.62053462110044765865 -0.98608412492945562988 -1.8624910971829400363 1.0611586322586152864 -1.0414478285828703275 1.7756759167823170653 -0.72942321463503489998 1.8081841534192839571 -1.4524161902218246656 1.6338467651707220263 1.9799720222854226837 1.3146272771456870565 -0.45888255108953523997;0.32903181168978001825 -0.14883730693138250145 0.15306660680001971109 -0.52394801340998253814 -0.073794391319475710622 0.52102838584542010558 0.0010108527015677572485 0.57876936797146771863 0.31303227913124087589 0.52622974351350304545 1.4245890754775631937 -0.10594729740393303563 -0.64551845567713872498 -0.22521301386676234602 -0.51950145139555592433 0.36179848484682186616 -0.27974521136025376489 -0.35603728773790760398 0.63724113163824580575 -0.26760432618711721409;-5.1145598999199917145 0.01545107797964467844 2.451087392114203567 -0.83194707994396266404 -0.55325004320823656379 -0.71870193583198105358 1.2170121297566576235 0.32544319236520452554 2.5211893919799832631 0.30473791359532614864 1.1470577610163665838 -0.56577540476503429545 1.7284265279542887495 -0.22841398280944588683 1.2082099486699093838 0.73241183610158433481 0.42366309353522008108 0.60092976601944270154 1.459853504168536098 -1.153024021932767651;1.8592912280011131276 -4.1010863531160621775 -3.2028313874224796365 -2.6990682524973061973 2.37411147096544628 -0.019546259810791152822 -0.004376190792795801518 0.46688719175957166252 -0.29457350526107389799 -1.106316622338589184 -0.1493712150377537462 -0.95579317816081788006 0.42261803195984165571 -0.56607761478822016254 0.55787247881244994563 0.10033921794248747139 -1.4898313008970394122 -0.086389083892435117318 -0.5591752512084804394 1.0393908358195664832;0.11215274258362649407 0.48148132145837052587 0.51107339371173476916 -0.27245616852263654373 -0.66706750611549370245 0.35118015718764167277 0.81475438140161970946 -1.2876628632979565392 0.33057490179064646929 -1.0453498505656884099 -2.2466289446677780717 0.23802202210207876187 -0.34956591428380123787 -0.18081871881651578882 -0.76208822985579427467 0.10287390591575922005 0.27068101879189687686 0.10619093552047967344 1.3053818896519795434 -0.15640205548137756097;1.3410747740895991864 0.31103996876159534235 0.43622158728477733458 1.1746935057138991887 0.61239713094668168925 -0.90697399885668072983 0.26049235289625366496 1.7704733017885159185 -0.92693939363798505404 0.1684289490311683124 -0.16254685851235439742 -0.42725820401335612431 0.41196080729115602814 0.66858145334018104222 -0.27834672280162858771 0.60187161047660575619 0.61389673029891833611 0.3472074553587751744 0.81903498320918977083 -1.1532336565550522778;-5.0904346319016946509 -1.6007506988299111672 4.3745777011248723198 -0.29414058595650893757 -2.6182621574033331235 -2.2546123420788544145 0.70000843048885563746 -0.38868090794775633778 5.3373300013066975467 2.7112352692558454592 1.3341964765836171747 -0.84367000355714882875 3.6691120519659206067 0.67423499821069776683 -0.44286241996046449287 -0.128147503602726337 3.0038582405579461465 0.66610789050081931073 2.118313614660022548 -1.3134535564813696329;0.80365029377319363579 -0.10106330604235332082 -0.25311819228709736551 1.3029191099869037451 -0.18798256104861119087 -0.88444997168848082936 0.70350358122542522299 1.2034349292141479637 0.29508965904147926862 0.39173460124174358521 2.187638099289869853 0.30719033489314601093 -1.1698523802362874591 0.24184255107736313262 -1.4390160075417552932 0.30641999679381964894 0.16208783233164850146 -0.223460762145962194 2.4753535951925540459 0.6218690655291074787];
  
  % Layer 2
  b2 = -4.4644177452570739106;
  LW2_1 = [0.053283599689039430614 2.05201506442636461 10.710904469665457839 -2.525129338723239858 5.8198683039475973544 7.4641888235870821333 -3.700939781252410743 -3.5775925242425574702 8.0605212743811431864 -4.6515837917724285333];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

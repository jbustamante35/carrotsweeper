function [Y,Xf,Af] = tp326b86d9_0274_43ee_9f39_ae6ebddd54bc(X,~,~)
%TP326B86D9_0274_43EE_9F39_AE6EBDDD54BC neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-Sep-2017 05:08:47.
% 
% [Y] = tp326b86d9_0274_43ee_9f39_ae6ebddd54bc(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1874.99930442496;-5454.91534726369;-869.204807020144;-780.471896742374;-460.205555216349;-234.31060487846;-540.291178237134;-572.14271553379;-192.819908210792;-760.602424664805;-210.820779921778;-258.183122033523;-343.803894881911;-190.320782432688;-193.663740648591;-218.52158935392;-373.104709120357;-213.719449945763;-260.91463179983;-135.174215342503];
  x1_step1_gain = [0.00034254044244578;0.00027748074658588;0.00080601324116702;0.00156677380853905;0.00168393926281428;0.00269046527889069;0.0019808499204541;0.00236361816544283;0.00245784730269616;0.00195235680232595;0.00282106579415898;0.00424658079482959;0.00317261769260759;0.00555458687461906;0.00429724736478091;0.0048427063668746;0.00333931608099053;0.00598913897545079;0.00384783002604035;0.00642488839732247];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-3.0315937147593441381;0.86619574514481156857;4.2823521996275957235;-1.8744528668083395573;-0.033155957675419941988];
  IW1_1 = [-3.8107830981681156679 -3.4323845609704877191 -4.6993206322752554271 0.52169623553804000959 1.3275599954600365571 0.39823592046126482513 1.9421694577802666171 -0.1651119657330422652 -0.27397230401470751282 -1.4953082732577283043 -0.80387997359641383266 1.4275202271869238402 1.1446159341035311297 0.018667248182084580921 -1.7234045888619651254 -0.055974031519157238512 2.10381465351427277 -0.41483202786253137173 2.7797939272292837565 -0.57181056994602985633;5.5709175715152987607 5.9915994737141637927 -2.9691380926130483964 -2.26979087397186996 1.2149721201509429136 -0.24894498089731070811 0.75257790029742555049 1.1707120818124872041 -0.38519908886708831286 1.4340883578827017253 1.9336640779448126537 -0.73878922010648151453 0.85372032984989076887 -2.7381022882666528062 -0.49559611357445382263 -1.245365906128477862 0.015145499026821322708 -3.1570300704208635878 1.0841241338763283331 -0.50240020415894026673;2.7429458134573003747 2.6207898390713499914 0.80423201226665985697 1.0420239092108254386 1.5188808126880795069 2.1681858105831719463 -0.29124025736086045502 -3.6557656453731537383 1.9330198635535853491 -0.012103025300515650453 1.362477807255555895 -0.58928081066847659564 1.0165951955123633255 -0.11084908526144346408 -0.0706876192987751506 0.5331151723213719551 0.60166415008693296951 0.44874757671429954531 -0.2659758673319411737 0.74334353921083085037;2.4320358184786341482 5.8420015196440058247 2.9152005042052469008 -3.0180709311978963783 0.92171422453835771815 -3.4716939571583798063 -2.3774529514179514322 2.4803090186055003485 -0.45581204010069181765 -2.1992235545443254985 1.9152936940451954495 0.23067773777125386014 -1.2201279058919214382 1.2208655116953126551 -1.8318385422097900328 1.240737123197762859 1.6862523278902512569 0.42149743239717424315 -0.27810764678529203975 0.17045992304630586123;-2.1674600794482956623 0.95496347662026992431 -1.3354924822776936821 2.6120223022255464329 0.85097692717375483795 1.2399523452464784601 -0.74137204885192642401 1.1352560113666174679 -2.1838245249610208631 1.9500649666335609922 0.78686181817281175555 -1.7103587468411940442 -0.60354070791429414999 -0.65984135718970782225 0.7210622517841664969 0.014181346541849708387 -0.48588115900595629792 0.12397401284781603414 -1.1731607289712213671 -0.20171878363763465214];
  
  % Layer 2
  b2 = -1.154691495467087492;
  LW2_1 = [7.8744907060200866056 3.4234357752627611049 9.8194084298062822569 5.5715391429825729119 4.5424533951576666624];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

function [Y,Xf,Af] = tp3f42062f_a7d7_46e9_9c19_d3bb742c45e5(X,~,~)
%TP3F42062F_A7D7_46E9_9C19_D3BB742C45E5 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-Sep-2017 07:49:31.
% 
% [Y] = tp3f42062f_a7d7_46e9_9c19_d3bb742c45e5(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-3289.74882371951;-1498.84051842406;-977.81800685793;-2473.29678142316;-579.957172766839;-720.151909430017;-474.399996307271;-522.24224923224;-420.226401116413;-417.475292942103;-306.200888877846;-388.367090162113;-291.395845074128;-376.411586177092;-312.430500619517;-321.397730757892;-231.052600123327;-238.53618531116;-300.29283828403;-183.531087713644];
  x1_step1_gain = [0.000377693156370527;0.000577456077299579;0.000763241531595339;0.000656175798642298;0.00207889551360641;0.00132289146378878;0.0021050120182425;0.00188095402340317;0.00237297796658717;0.00258788322162196;0.00300539389135356;0.00292429008303262;0.00346972867854873;0.00273531031890041;0.00311974005335499;0.00346508516159046;0.00478122411926402;0.0044828779832807;0.00393490060972029;0.00521177147160687];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.049186503074540866;0.45713457925584577435;-2.0959279438178728405;0.72468768802782312921;-2.3858540732255018035];
  IW1_1 = [0.9812265774587756173 -0.44288194096066851868 0.13884312140423385462 1.1235073504887744811 0.18545520518105634844 -1.5746751546615724848 0.29815468959101043556 -0.16544401073751108244 -0.67963510071250088362 0.12289368204551065489 0.17737907264947394559 0.44191854657529794359 0.38867733167950396789 0.43030698577838472074 -0.29011361500602961261 -0.12660427208153887668 0.5563901836395147571 0.44779397450784413914 -0.37585003177160353216 -1.4062250728047427373;-1.1694356895668971408 -1.109864956009111614 0.76384681114109065359 -0.4389693144101495248 1.1642034304455204374 1.8748264868918189663 -1.2963700146662353596 1.7263936348549964173 1.281589146479479302 0.33602628918780652612 1.099503948765888639 1.0180037198692362121 -0.89748363750559656538 1.1319900208105786454 0.10229890323665710716 2.7758610530107667991 -1.6362004846262669933 -1.3011401659438497358 0.60923978947211265833 3.3171424090177912269;4.5635127729650708517 0.75112135077444663889 0.49994022190876830081 4.0448633593300016287 0.51015937304489344939 0.9844144425258209985 -1.5760319933128923431 -2.0337270267752689534 1.6034798815010056217 -3.3726724389987863262 -1.4975791350764069421 -0.94566683587692146329 0.50110266957012128408 2.7901817795723151683 -0.1699259005719678528 1.7235771616302417719 -1.1468380246619571672 0.47955990342184595665 -0.40534042857009744409 1.3607092498232888911;-4.4345920011380837167 -6.0104130974261407161 4.5518041706042380312 -0.50747984020903247337 1.279138392376354405 -2.2794430421652385199 1.7042278388655198729 1.4976637668175616369 -2.2558274070018367041 0.029069678849294174755 -0.48950562207989017915 -0.35254894600094571766 0.053493231373224189862 -1.3287893974894451343 1.5341020277336667732 3.2399120537858276947 1.6462839203382677589 3.4500376142389250766 0.90657691400179907237 1.3833744114839743311;0.30146328981150100068 0.21358115384828227357 -1.3199229000663081912 -0.66722614917904876641 0.67454008590388381261 -1.1090478399341989757 1.2202966971656474815 -2.1812373962713649256 0.39673076730280593116 -3.221273762150050235 1.6329723624029623963 -1.7092493607639822617 2.2405039237122901241 -1.3513928824513703475 -0.4681226300660961126 -0.52483157335050556469 1.4375328835327987331 2.8133511053509328015 -2.201572984506904529 2.6961594743905328286];
  
  % Layer 2
  b2 = -0.44569915931856490809;
  LW2_1 = [1.9072490865647262481 -6.2908083053600902801 12.580715696710564444 -8.2069846186258370579 6.1854002056799934905];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

function [Y,Xf,Af] = tp4018f6b0_5f03_4769_bde5_e7974f784d4a(X,~,~)
%TP4018F6B0_5F03_4769_BDE5_E7974F784D4A neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 05-Sep-2017 06:20:03.
% 
% [Y] = tp4018f6b0_5f03_4769_bde5_e7974f784d4a(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-5466.61789079663;-862.937878923584;-1028.71862143181;-451.710971542895;-692.538815520003;-441.04379323221;-783.667639824725;-311.950474474657;-656.555828069295;-416.411813427998;-256.518565057574;-268.743398235246;-277.584610398805;-202.979007080823;-313.061223281952;-302.321350914849;-296.419908591268;-275.821003918891;-162.786711803949;-155.930294068955];
  x1_step1_gain = [0.000192953812201724;0.000635170113819407;0.0010737117105794;0.000992967389065706;0.00140247416929522;0.00179426803546528;0.00152094087103248;0.00262475201653708;0.0019941549476651;0.00251075910029929;0.00454433874041187;0.00378662000738716;0.00302237737948958;0.0044887960413849;0.0036608073346035;0.00363057230533662;0.00381924645546894;0.00427537582274412;0.0059212055178135;0.00602422138644372];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [0.29867819837830167362;-2.8117523527451413479;-0.031759763162068806175;-1.3599163455493974428;0.94477994486129113216];
  IW1_1 = [0.38910148418206080834 2.9339632394771104629 2.8104452303875113728 1.1614984068685940688 -3.926378976681237809 -1.0403222669269471812 3.5793726945399195749 1.5527575327838785135 3.0960369669579792529 1.8679937531662273997 2.3744567357249097839 -2.9963631490816102776 -2.7651039294566892579 -1.3698427336207494864 1.4378397466785166614 0.1282305511292564093 0.62667482148680164755 2.8548907826561911172 0.56082798574937564595 -0.21922356192874448144;0.16637795384125983467 -6.3365808829679117764 -1.7636958820431096751 -3.5890901819038023568 1.2885708642547004654 -0.14530310546125504989 -3.3855882637737679808 -0.7495815024667618065 -3.1486595219205004703 -1.9467272916058300236 -0.62129430049052247753 0.48190386461822870556 -0.695357273016056876 -2.0443359868594779272 1.8753305129712858346 -0.68399382722857460237 -0.37106772823067041278 -0.92675921467882793614 -0.54935979922801225772 -0.65464407436822347197;1.1366085565416603753 -0.14622565362829423319 0.85200486674034847656 2.2737569598011937444 -1.6585685480174023887 0.96028783242245285834 1.5800531571280105325 0.33714012884153626848 1.2121163428022461162 1.6009195644763409838 0.94097381410158509318 0.44795545074732978641 -2.6927838101006615901 0.92782757427140616358 -2.5514512052339854975 1.010080169466788691 -0.73385144299185578465 -0.19994040668095441893 0.65784218320595588825 -0.36116527937444731222;0.91246742932786450986 -0.51906368538955394154 -0.6681008112270143684 2.2152224760035164053 0.66319027808338593122 -0.86597669147723688177 -0.30234455403224236303 0.63603242961760109164 0.30983478217736559746 -0.74517901624384275117 2.0843587673995362941 -0.86053251668607733116 1.1971915033538327311 -0.32618259925775611174 1.2605435663878210573 0.49383343158293380171 -0.058950936439126133681 -0.81274736761482291314 -1.3801489918476539387 -0.79365994254027105725;-0.42989255360173844744 -2.1144275159924772467 1.7200856017556056532 -0.57807592904215465701 -0.4790509621375907412 0.97236880801786129691 -1.0149533793380050017 -0.53506164629866803661 0.68922567315730298709 -0.51949097088502427244 0.62579207216458354601 0.4301780993810418452 -0.16185859202336511098 -0.59417334974804081327 -0.63922557758891462854 0.79513992354453377764 0.12736699155466205124 -0.31697376482089850702 -0.33919292674227702333 -1.0158763945665409967];
  
  % Layer 2
  b2 = -2.8210512116551380579;
  LW2_1 = [8.7875455942129239162 7.638147052959358696 3.9198540855943457828 4.3181562322161131107 -3.355437441272964616];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

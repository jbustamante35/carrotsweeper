function [Y,Xf,Af] = tp43391b79_a192_41d1_b805_811a2d535e60(X,~,~)
%TP43391B79_A192_41D1_B805_811A2D535E60 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 06-Sep-2017 22:05:14.
% 
% [Y] = tp43391b79_a192_41d1_b805_811a2d535e60(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-5310.24104946905;-3062.40716175129;-796.678021735526;-751.778745457494;-962.879682501259;-561.234234396124;-567.81871945723;-473.500961999076;-460.813029179948;-365.327762675254;-365.703888775154;-279.141698173319;-445.050021503462;-352.492361124265;-290.108959264282;-350.30942786642;-268.266206223894;-201.923452595299;-223.562425332959;-192.300211130367];
  x1_step1_gain = [0.000187746732766858;0.000517587446146427;0.00076092913976903;0.00107683880161886;0.00113410115771159;0.00154637953830619;0.00191937835803697;0.00192268942981792;0.00211835684506627;0.00196958059572075;0.00268955398662545;0.00257377430529594;0.00284234016821657;0.00279908218986807;0.00409640929201503;0.00345584818973324;0.00422505290367559;0.00549698021899266;0.00471432618261881;0.00476878567270207];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [5.2231167054685982976;0.4910905474997399045;-1.573717830088702252;-0.99336123409390209016;-1.3520197729402980702];
  IW1_1 = [0.023934075449246618172 -5.3176817881110096664 1.8736677457087282939 -0.78713418237273014011 -1.1684219597894605069 1.913718502565780577 -1.1086425657902239106 2.0578950809434339853 0.74527338335151227522 -1.7655506204977196028 1.6494412869911048158 -0.22607363104336200554 -0.45490744180408931863 2.6173703710898217345 -0.59741276914308094614 0.6731200478325328751 0.44045155308073158373 -0.28527556126070691134 2.1417512867644967756 -2.1083201847251777927;-4.9038400084228221942 0.89007367371012269253 0.12184205966272436406 -0.75392208356750789466 -1.7252714747418389507 -2.6815724288263766972 2.0879767585883897141 0.88026703753176815948 0.41058729614549849263 0.81299642278522543659 -1.048250676017844718 -0.28180944189934492572 -0.42142902028653267399 -0.97842946403783692677 0.3708784146933160053 1.8236903031011055809 -1.3477930023710720242 0.038861154822036211853 0.16214786283806637002 0.48888674334229570428;1.9727823861645412684 3.5040589412258071889 0.48442837445458158951 0.12953086997040647033 1.9752647829425733494 -0.25585814085805375084 -0.80074345427633186745 -0.84490751875509528812 -0.42906816107881062816 -0.055560383167725956033 0.12078184848444403765 0.32164591298688627319 -0.068913058140228827808 0.33916322814230509541 0.33121078302452100495 -1.1652473969033043666 -0.43709372102266541571 -1.5224928199810499052 -0.7572359491394934361 0.36828794127734343355;-0.12546396479824720172 0.26005175786072226574 0.43411045732432124167 0.15266385373109361834 0.23368656885987323935 0.082443830881208504668 -0.0028427936068189628427 -0.67081514920289075921 -0.70428743510103963832 0.42401232698416096989 -0.19477029046621804897 0.17617828071244631682 -0.16755127826746246678 -0.63396146005839115745 0.44732967418938879289 -0.2755529468134671478 -0.38061093581768540295 -0.49908108043708793167 0.3383914966874302932 0.39345863230013244927;0.16994244749473622069 -0.17447723787465235779 -0.21838652516660730929 -0.14220581881815416714 0.50012636722118708477 0.21017377046396734652 -0.29122978383331699082 -0.51778537093007293013 0.10970503767926248484 0.53936963567018503252 0.090565287090467225251 -0.074938498867386654778 -0.058353588935167566287 0.46001642562208766574 -0.47632419734519360066 -0.70192135544176115225 -0.17545523916813843268 -0.51164304469865862224 0.34350724895565165617 -0.017212184783894787787];
  
  % Layer 2
  b2 = -1.2654998646924557892;
  LW2_1 = [-8.9770519937089776619 6.1566432100386396797 5.0597357232324347009 1.6259661143536958683 -0.33209564309899053391];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

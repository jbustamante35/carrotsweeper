function [Y,Xf,Af] = tp4498531c_a86c_4a17_826d_dcb476bded21(X,~,~)
%TP4498531C_A86C_4A17_826D_DCB476BDED21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 02-Sep-2017 16:23:04.
% 
% [Y] = tp4498531c_a86c_4a17_826d_dcb476bded21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-2001.76879548539;-1846.28602050405;-1096.59977942709;-1127.27896682562;-718.635970677915;-534.73657908755;-717.539895324646;-474.328050496923;-408.756773605262;-437.689914113482;-597.158358369101;-384.721680725407;-357.743301501242;-305.701917871542;-262.500890231169;-420.955237007933;-168.878309979165;-299.148398756992;-279.306010526108;-382.085749121024];
  x1_step1_gain = [0.000250772026915415;0.000457175383291266;0.000795694570296745;0.000975455655635301;0.00136867839470428;0.00177765334299387;0.00147664952758212;0.00196526984478522;0.00211681540578911;0.00191395299404995;0.00213803411115015;0.00313745816598813;0.00239499394158854;0.00262802245354391;0.00340299377226973;0.00307580218448467;0.00420342200465333;0.00353937526659766;0.0030569613569622;0.00320422591704728];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-0.44892494556560452734;0.92448733827967999321;-1.0670190153561278645;-1.2462863049175516572;-0.42367122105982524261];
  IW1_1 = [1.969315029256136329 4.431744320226379763 0.05462311932928688718 0.7684108746204421081 0.41436192206269439886 1.7039081459361899995 -2.2295982436771937252 -1.0741598102289295902 0.888810904107409816 1.8052343357812690172 -4.3482744411754596925 -0.25996047214773426726 -6.2359795833238234053 -0.31576632248782221524 -0.22327464744113748041 0.13727852847954827298 -1.4854274391697432911 0.57641649211976386802 -2.0208820883362790255 1.7374329352111215208;0.42463962016208112171 5.0797881090710035323 -0.61369399630334320328 0.83407771313260647972 -1.2646113543481705133 -1.9793615764319596462 -0.021037978104739538804 1.7904814772181878446 0.86679349005547745577 1.6355664994430012538 0.33854957201355867502 0.28853848497807504936 4.7674837271030847674 0.31057381656354110522 0.28454335306511968628 -1.3629399145309601948 -0.18046866237486403062 0.68668561895474322654 -0.056713711160656495036 1.5718657575229830758;2.7657507492866097998 3.2386879994372446134 -0.50430138075782660056 0.76608794828202819716 0.4587270411069218623 1.6731902753969070119 -0.021741015690300333207 -0.50239163871034586695 0.70838298654774900509 3.0510843635487887582 -4.421833006730790494 -1.5016663211618392904 -8.970622330613135631 -2.3750313151816482282 -1.4449590507502447778 0.95921254505064679208 -0.9208105428247058688 -0.51343775005826775004 -1.7118643090570559995 2.1012446792070402779;0.70942998830954440148 -3.3779648617037607572 1.1633427322005911453 -2.3242723727649781118 0.48388213839543603445 -0.77335758411936617041 2.2853612409831156604 0.54547700313997948829 -0.51858987640675058284 -1.6142632253089459482 1.0249535306235242338 -0.18442112004242308676 -1.5367712773833801521 -2.7817791269748157745 -1.9697103620636136068 -1.8048448913199435228 0.90457250684606804736 -2.0105560972787941409 -2.3414215435979861546 1.3711689865004434985;1.6337340524865728852 -0.1872930371732152155 1.2925168508027085057 0.33926413792003429215 0.71647164776517013873 -0.94431120251845046543 2.0321140593707425204 0.80094099731362278227 0.86987808052045589857 -3.3690338217243507302 0.29738477222346693107 1.027719084324806964 -3.0439458679564079802 -1.4455561455108194568 0.79241701588577062587 -0.2568364546981375951 0.18949807834315710031 0.42054872949728228093 0.58593456384693209937 0.38445814032272712657];
  
  % Layer 2
  b2 = -2.0424960151065132408;
  LW2_1 = [6.0353527157599673458 -5.8512108255488408659 -6.9591719394025925993 4.8885000316139359811 4.2570512375783602366];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

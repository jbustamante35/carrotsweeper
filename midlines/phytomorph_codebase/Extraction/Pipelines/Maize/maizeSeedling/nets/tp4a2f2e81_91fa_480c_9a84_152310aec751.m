function [Y,Xf,Af] = tp4a2f2e81_91fa_480c_9a84_152310aec751(X,~,~)
%TP4A2F2E81_91FA_480C_9A84_152310AEC751 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 05-Sep-2017 08:03:27.
% 
% [Y] = tp4a2f2e81_91fa_480c_9a84_152310aec751(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-5342.40771051541;-3062.40716175129;-796.678021735527;-751.778745457493;-962.879682501258;-561.234234396122;-567.818719457231;-566.708636588771;-460.813029179952;-650.116847383032;-365.703888775155;-279.141698173315;-445.050021503461;-362.027565171374;-290.108959264271;-350.309427866388;-268.266206223872;-201.923452595308;-223.562425333006;-192.300211130402];
  x1_step1_gain = [0.000187746732766858;0.000517587446146427;0.00076092913976903;0.00107683880161886;0.00113410115771159;0.00154637953830619;0.00191937835803698;0.00192268942981793;0.00211835684506625;0.00196958059572074;0.00268955398662546;0.00257377430529598;0.00284234016821658;0.00279908218986814;0.00409640929201513;0.0034558481897334;0.00422505290367584;0.00549698021899225;0.00471432618261863;0.00476878567270148];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-2.0240694684502527068;1.6998084488902072131;-2.4482363675718854523;-3.7868289758973348036;-1.7562781157976403712];
  IW1_1 = [0.12452511205708985398 0.23218506076102524149 -0.31956520384605707763 -0.080751335930641890415 -0.17558090770511697309 0.15137325485799807412 -0.55538800525736375935 -0.5096385988067009265 0.26564131759318537762 -0.22276843570946208706 0.43689830167923249249 0.18261508122988012737 0.085530184205305975764 0.41986875933194978128 -0.10027080981965370843 -0.42034493435369602032 0.13421507171240532053 -0.13991209903482648702 -0.33283075860718808192 0.48936219579562473259;-6.585781656093497638 -4.4137631349129078373 1.0005935744848404312 1.6760100450753898649 3.4556192120204625162 4.6268013204583082754 -3.5567172165702540809 -1.1056947840562143526 -1.1050123012523860311 2.1478960216750371259 2.9626670995939465847 -0.57596432407577391466 0.092216024524827730491 -3.6920815388724497197 -0.11186513272096275384 -2.1576116947242578448 2.0349394543547072445 -0.40515628102369360963 1.7715651012341568915 -1.7910305895447566904;-1.4975001341475235872 4.8988449600680263885 0.32475841387176734854 0.64180782786854828625 1.8692442416958812146 0.046260327240111732972 -1.3227232888119813126 1.9715616956240329394 -0.65861898451128919607 -0.61189095248049607534 0.0014268434770061885764 0.56232650302101039319 -0.23497517099012227293 0.94667560081504298353 0.1237953419913327413 -1.0887295023408116723 0.0050977419803734033699 -1.4842964811098189326 -0.86207401837734420891 0.14743023638591762348;0.28452685615639311534 4.5825340859053111942 -1.2595274913870846412 0.86625781879680041619 0.28887022046003102416 -1.3583661140374541088 -0.61711448342721242355 1.8916665715753042676 0.11288754307740754557 -0.55845017681562525436 -1.3461162703811337948 0.66190333808492707313 -0.55247673764440052846 2.0983062069835041186 -0.46014902909712285251 0.38567326860375811259 -1.2341641603768263025 -0.011395752849696037801 -1.9170412718761435933 1.4379718302903918836;-0.58764758162389407747 0.43232733313371157768 -0.15313595501943538801 0.42956688062829062602 -0.12677544658376760367 -0.26450587311678663838 0.32483358960549219008 -0.49633281627924230595 -0.44931672318012111367 -0.077499120748824618099 -0.38361550335565475223 0.15152678608814462713 0.51910826808777454922 -0.3254329575620215631 -0.047433202326896170553 0.19489277287764636415 -0.057959288282947551973 0.0773938920405498193 -0.51999326330061124146 0.17158788622309145699];
  
  % Layer 2
  b2 = -1.8854347109759550527;
  LW2_1 = [2.652613766238347548 -10.886450264130703047 7.0201732588459435647 7.3000160468313977091 1.7409729900771346855];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

function [Y,Xf,Af] = tp4d10f53c_812e_4d89_baa6_9394c850d537(X,~,~)
%TP4D10F53C_812E_4D89_BAA6_9394C850D537 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 01-Sep-2017 07:36:02.
% 
% [Y] = tp4d10f53c_812e_4d89_baa6_9394c850d537(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1874.99930442497;-5454.9153472637;-869.204807020144;-780.471896742374;-460.20555521635;-234.31060487846;-540.291178237133;-572.142715533789;-620.900292310245;-760.602424664804;-210.820779921779;-258.183122033522;-343.803894881911;-190.32078243269;-271.750472270932;-194.470619647337;-373.104709120362;-213.719449945762;-260.914631799826;-176.115238468629];
  x1_step1_gain = [0.00034254044244578;0.00027748074658588;0.000806013241167019;0.00156677380853905;0.00168393926281428;0.0026904652788907;0.00198084992045411;0.00236361816544284;0.00245784730269615;0.00195235680232595;0.00282106579415897;0.00424658079482962;0.0031726176926076;0.00555458687461896;0.00429724736478089;0.00484270636687459;0.00333931608099046;0.00598913897545087;0.00384783002604036;0.0064248883973224];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [3.1637306670830875888;-0.56576359416317778539;0.54596209037327880775;-3.2813198712194981965;-0.90776153816230542581];
  IW1_1 = [0.62244671072176627202 1.9583874592845924578 -1.5334179482703487185 0.10971525557923450522 3.289357808184301124 1.2784715591087691955 1.1942234396078017511 -3.2115931008395257606 -2.0341200945828807889 -4.3071974768194829508 0.95342647230487043153 1.5906436745913214992 1.9358033715733733438 0.048130756914705641325 2.2247456388047486264 -1.051272048515713875 2.532813235675448027 -0.1845872935896921696 4.3333533496959057985 -0.42048356323749042085;3.0131987115829055313 3.910468947946281304 2.3143492313988742737 -0.80898485896161553832 -0.75566453100178598845 -0.41830886489404073281 -0.94966442922244675984 -0.17628625027262245784 -0.5631467969086464409 0.39547677217845172981 1.5077105296589556893 -0.96143243327399852127 0.098785226854806035268 0.17326439432773860227 -0.17565081764083254057 -1.1877759301995667318 1.6921823952246812794 0.27003733249576999942 -3.0154467997345917318 -1.1074366308432412875;1.7269255017712388245 4.2372275699732986354 -2.7335988644761379796 -2.7601522040111596823 -0.029833661828678591926 1.6827580901376251177 -0.33338379284011093739 2.1194409486215408656 0.10207043516890675072 -0.49359188254949587504 -0.20375314549723436142 -0.8693293406582678351 -0.12573922789067498718 -0.25471772875307152617 2.0983907816790035028 2.0247819941222018336 -0.34209174077576542938 -1.0217623715248178584 0.36928057960132198989 0.38593039805123080521;-3.4073374469246870966 -2.8580999569149176942 0.81894077124405273427 -2.0480418681011838267 -3.6332185405967196701 -0.68920318107620304193 -0.71777181413642188179 1.5301484816731047989 0.50147220240813561443 -0.68107872490509901997 -2.3700633683182621425 1.7716755533557859703 -1.4091430653142218432 0.32094702825878040908 0.1466895451012916185 0.28819861092912890665 0.042161578927390336302 -0.40333070953093719258 -1.1138450496578837789 0.75180660875462934634;-1.39806442939743647 3.537740515936075969 -2.536477908809443349 -0.5769411400078535701 -1.2849534366999804114 0.58136945129289208101 -0.68453534285607364751 -0.35814534866979486072 2.3045070504565803304 1.7174068966930318147 0.92087330212594897816 -1.007194366087929005 -0.21064734725316083819 0.66751365605977153184 -0.94886412872470815572 0.45508502373342973879 0.034440981024482175687 -0.55104677466570139988 -1.4194812830160885575 -0.91516380759439608372];
  
  % Layer 2
  b2 = -4.048756494269853512;
  LW2_1 = [5.2568941839123812798 6.4252994867073853769 4.7146273626606278739 -5.0336658709806672007 4.1591758922304649104];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

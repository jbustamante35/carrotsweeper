function [Y,Xf,Af] = tp50a38aa4_b405_43a7_996b_e05f2885139a(X,~,~)
%TP50A38AA4_B405_43A7_996B_E05F2885139A neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 04-Sep-2017 04:40:45.
% 
% [Y] = tp50a38aa4_b405_43a7_996b_e05f2885139a(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-5466.61789079662;-862.937878923584;-833.978767721889;-1562.45386611791;-692.53881551999;-441.04379323221;-783.667639824722;-450.026271289927;-656.555828069292;-416.411813428023;-256.518565057563;-259.432124024281;-277.584610398764;-242.574763141847;-313.061223281954;-302.321350914798;-296.41990859125;-275.821003918809;-162.786711803933;-155.930294068956];
  x1_step1_gain = [0.000192953812201724;0.000635170113819407;0.0010737117105794;0.000992967389065702;0.00140247416929523;0.00179426803546528;0.00152094087103249;0.00262475201653715;0.00199415494766506;0.00251075910029921;0.00454433874041179;0.00378662000738713;0.00302237737948966;0.00448879604138604;0.00366080733460336;0.00363057230533676;0.00381924645546788;0.00427537582274533;0.00592120551781284;0.00602422138644533];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [5.91247473327758577;-1.6808178931416017932;2.593144361324622782;-2.7685732664764199917;0.66836053449611143584];
  IW1_1 = [0.53795318037520833965 3.5736516909074151904 1.3369339785018947708 -1.8417953258612125289 2.4624799516521407305 2.6592519293242173894 2.6047963353990368773 -3.3554202989113841582 -2.3709637666196852201 -2.6879244498467733671 -1.8657348304688583518 0.58117167239290901115 1.8794904217173047378 0.075511565491946541773 -1.2408501985495485886 -0.45091157432101025559 -0.23341862836611318444 2.7670211407482634414 0.79665529343910435056 2.5538245848252292269;0.18545691335231062613 2.6461421863572129887 0.22437065425568200605 -0.48318960852980152865 0.81285077150353390874 0.83409587222916836691 -1.0366451942190693103 0.24768947121884152263 -0.58929817837667541891 -0.40234650278219297181 -1.2189445927405380132 -0.43535443809956203554 -0.032725281603153369425 -0.19666982208508418384 -0.17551793901208936899 0.16289988335665755992 -0.057154760321006095602 -0.52516054907170461874 0.45735306007371379078 0.38331348964870953777;0.15996192401346967515 -0.27263775823358094019 2.4230497281389031805 0.49907364905329953952 5.5378215077683359269 3.435650091048950916 -0.362114856234706739 0.50173682974663413869 -4.6649763965005091038 -3.3720254974370589274 -4.817421142573359738 -1.7819455336063181328 3.8047731782710934034 -0.94623798070684528305 -0.35268038363636894372 -0.37668607752798027866 -0.1858992259947701009 0.61052549300190261938 0.41769282197601548257 1.5158756257400707312;0.48585210646572124515 -5.8509332032896415043 1.6506150893817972403 4.2678490646884643667 3.3867446329935733118 1.1292256582032518253 -2.9808348575123395641 1.1174378344497126747 -1.9705230514009250964 -3.2506121188673247069 -1.062961162293639239 0.32358459218102236798 0.51733142781248764308 2.5622865035875235229 0.80823006641904904246 -0.37355714761998370932 -1.0064889690571270364 -0.68657316486396535726 -0.4585151246304059458 1.3269849968910656379;-6.1405626851270600497 -1.7381487073154646694 1.4438985157174719642 0.72861557594547421424 2.4341713457009372945 2.140700372991386935 0.038651078644377362403 -1.4099549393402803776 -1.8333335071077581091 -2.7707242025606149127 -2.3918555486753825257 -1.3173968938425246744 3.1151843835982666597 -0.7200317067105799218 -1.3114016546680737907 1.8700088853406524603 -0.35584660254680228197 2.5134403417421986582 0.22796061679013754353 2.1091396211504291891];
  
  % Layer 2
  b2 = -7.3480011281866195461;
  LW2_1 = [-6.2520546058866850458 3.7532029713455359321 -9.8081544292410711705 10.237181813932826557 -7.784443445602080125];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

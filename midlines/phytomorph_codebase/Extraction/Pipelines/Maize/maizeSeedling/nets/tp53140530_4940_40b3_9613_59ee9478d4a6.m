function [Y,Xf,Af] = tp53140530_4940_40b3_9613_59ee9478d4a6(X,~,~)
%TP53140530_4940_40B3_9613_59EE9478D4A6 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 04-Sep-2017 23:20:58.
% 
% [Y] = tp53140530_4940_40b3_9613_59ee9478d4a6(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1425.12385949519;-911.082072190463;-1068.86784991253;-1175.93373113977;-1366.53951203701;-713.224898465742;-638.058802539158;-604.796304556694;-546.419507096573;-435.830146318442;-311.040988170572;-332.822721465584;-397.169999063711;-247.407476323916;-310.614407522914;-284.621358963186;-260.199856451144;-137.271225529377;-228.698126275213;-217.514535510752];
  x1_step1_gain = [0.000226370837385414;0.000563347828528141;0.000948114745185445;0.000858032283205087;0.000730242383199752;0.00151716399266527;0.0014677096402062;0.00151546500149801;0.00206494173697171;0.00202475070577014;0.00326439309746543;0.00229997229518744;0.00248425272472343;0.004127529910388;0.0032279476651312;0.00343797851616058;0.003283033855376;0.00723300236088558;0.00445727486740904;0.00407527899100748];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.3974045020735998968;-5.5086882514910984199;2.4316643926608700887;-0.83346892874520794869;1.7245017157980047084];
  IW1_1 = [-0.83543171141152150483 2.2341267354644851473 -3.8236650201504889246 -1.3931126399602002941 -3.8658665351922798514 -3.2640529409387406545 1.4326373551932194417 -0.011028668168050868512 0.63612977508880430566 -4.1011628866917950731 -0.72753296339099426948 -0.23207050171940010741 -0.42464632711882183136 0.19989594271081626009 -3.3348399357836648882 2.8306569723296117758 -1.3018113926128023206 0.71228746135197174016 1.1434523935464446787 -0.62457748794807443904;-4.4065238359456646577 -5.7833412101856325194 -0.99140903686630421632 -2.3425718985939041339 4.2503009329283987228 -0.57649518188590898049 2.2571158489533380553 1.3521623352812663921 -0.058710667935193479317 -2.9097507993272833104 -0.97951590212446337791 2.1991891569194126355 0.398366465593147423 1.9071328928985797901 -1.2963439845937514416 -0.055241161390753010241 0.33438971985139775978 0.13282070653631153356 1.2106693181476422261 -1.8200776235146687299;-1.6909175641083569186 1.6123316393451478934 -3.0274969885123335089 1.7546245510641476084 -3.6872450306506152629 1.0853437077623779849 0.0037242207882365024191 1.3497121486677434721 2.9458234004418466512 -3.3946378574281239615 -2.6914650068817485007 4.0230044596203633489 1.761786503230332368 0.10242766901751772235 -0.81835785522798332181 -0.56621019640585190658 -0.92001663740225225752 -2.0112758490427995461 -1.7339906450340054622 1.6733073316158484367;-1.4015232542757589673 3.3798445376073531499 -0.98305873742422544836 -0.64996221012133681416 2.0740756020813231331 -1.3731578058356348482 0.1821714584792304692 -0.76132885069059763605 1.0476056183969115754 -1.4028302304478537099 -2.0965952377604346601 2.3033572634677104141 0.25185687677736523504 0.14312340026587463959 -0.66494557849621505063 -0.23635946138578112219 -1.8040175246123348884 0.32580388628157092024 -0.46151576468220562033 -0.89649510030694579132;-0.094832753249215306912 0.51628964164642532353 -0.22223889205072705488 -0.87041847318417253643 0.096333900562545676793 0.58706554323154680475 -0.31603808595479226939 -0.65540582585241236036 -0.40461327094946664129 0.46610209846043154647 -0.53116644939075940979 -0.30956362764684303146 -0.44629135390918450721 -1.0356277928189812076 -1.2783772819476348914 0.36451842325108674281 -1.3375170775843456816 0.67335360153410872552 -0.71061735880424492517 1.2592124808882290132];
  
  % Layer 2
  b2 = -7.7350950233943844836;
  LW2_1 = [6.0866948126970292776 -7.5568731032236362566 7.4787906638469321408 4.2143485042223849391 -6.8830332530139406444];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

function [Y,Xf,Af] = tp541b940f_5e3e_4740_89f7_eb1cf110911d(X,~,~)
%TP541B940F_5E3E_4740_89F7_EB1CF110911D neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 01-Sep-2017 11:31:16.
% 
% [Y] = tp541b940f_5e3e_4740_89f7_eb1cf110911d(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-5466.61789079662;-862.937878923584;-1028.71862143181;-451.710971542896;-692.538815519994;-441.043793232209;-783.667639824726;-450.026271289938;-656.555828069283;-380.160028036833;-256.518565057554;-268.74339823524;-384.146123020657;-242.574763141905;-233.266353450967;-248.555985162512;-227.243600249915;-191.97412870084;-174.982344511213;-155.93029406896];
  x1_step1_gain = [0.000192953812201724;0.000635170113819408;0.0010737117105794;0.000992967389065703;0.00140247416929523;0.00179426803546528;0.00152094087103248;0.00262475201653712;0.0019941549476651;0.00251075910029927;0.00454433874041198;0.00378662000738717;0.00302237737948969;0.00448879604138531;0.00366080733460341;0.00363057230533673;0.00381924645546873;0.00427537582274519;0.0059212055178136;0.00602422138644384];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.2682907261512650354;1.4075142768870247956;3.8588887080278344577;-4.7586457366317631568;2.2593325973254194672];
  IW1_1 = [-2.0750391059293149532 1.5351387404654581736 1.6180864163858184046 1.9806424308684640323 -3.1169956015764173074 1.5225361829934123126 1.7098229225636578654 -1.3397247619310499456 2.8045389618911849006 -1.1907814278499979643 1.8613309131603255064 -1.7522393896870225305 2.9703609904724701529 1.3689203980946444972 0.38919568966301099078 0.048630579504731034912 0.99189712653655970342 -2.2417159720581083526 -0.14666311587771344027 -1.2735698616900321678;3.3728309786366645895 2.1977566751543151646 -0.83373121484362588962 1.3219086494216096828 2.2350376801142406435 0.82596095847143480295 0.95156065836959824455 -0.48596715507536891732 0.076473851857875474458 0.6456186287910610222 -1.7629352978925245665 2.3146270812494691427 -3.759300023324330553 -1.3183945845051905366 -1.0080586167620777527 -0.50531368538083498709 -1.9652924244318374924 0.46229885195354908367 -0.36667672384093957794 0.42090908294295420466;-2.2276536736840668596 2.9113739137849079519 0.79920988689248884107 -0.41966000025472394164 0.46047270841922327556 0.60441002425372136742 1.2157188861123440216 -0.047307769164314374122 -0.47363725319596461372 0.3581237518749454396 -0.61966036657885126271 0.22820617615457600147 -0.89632141232870543579 -0.52332921709108970454 -0.10820976812518927346 0.24836923228230706195 0.47982118763950259988 -0.87634382911122743476 0.38468666008178786786 0.99364864020790077959;-0.85517001569604444988 -2.173254620698910955 2.311975147990246171 -2.0528341497073365751 -0.63583288729357911873 -2.0865453845219872342 -0.35358880693279737262 0.79043210990010570605 2.810320690922888609 -2.0105711515871127482 2.7315916545618441624 -0.055176049836783327973 2.5514387106392835136 -0.29031430499893079444 0.36503364554212441861 -1.2002740669618250369 -1.1133812463217420685 1.5465900388138209554 -0.89538954710265628023 -0.66222693461212589483;4.6263702329049731787 -0.48714735672209463768 -1.6650452543733351707 -0.82684403133770456584 1.4925068119718190029 0.034811604517875335829 -0.53076270524124113948 1.0651828337466067165 -2.3143936227147774432 0.69524499894027258495 -1.5712668122007327209 0.72054525805708491415 -1.3630795093518157657 0.12578225078738158871 -0.044180728201559785195 0.070668519459806844463 0.2863072164939737263 1.1328781741831328578 0.55285376101386518588 -0.46871143286308680764];
  
  % Layer 2
  b2 = -6.0702114124245092341;
  LW2_1 = [5.5525308537685278409 -2.9077988306462669854 -5.2669895611459756068 2.5340969380325479854 6.7935197102635509481];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

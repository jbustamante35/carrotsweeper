function [Y,Xf,Af] = tp55224043_1eb7_4e57_8e4e_a428dc7836a3(X,~,~)
%TP55224043_1EB7_4E57_8E4E_A428DC7836A3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 04-Sep-2017 23:44:56.
% 
% [Y] = tp55224043_1eb7_4e57_8e4e_a428dc7836a3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1425.12385949519;-2639.1224350771;-1040.58146532707;-1175.93373113978;-1366.53951203701;-713.224898465734;-638.058802539161;-604.79630455669;-546.419507096575;-435.83014631843;-311.040988170563;-332.822721465597;-397.169999063722;-247.407476323859;-308.974324228948;-284.621358963201;-348.992764796129;-137.271225529358;-220.006532848166;-217.514535510723];
  x1_step1_gain = [0.000226370837385414;0.000563347828528141;0.00094811474518545;0.000858032283205084;0.000730242383199752;0.00151716399266529;0.00146770964020619;0.00151546500149801;0.00206494173697169;0.0020247507057702;0.00326439309746557;0.00229997229518734;0.00248425272472332;0.00412752991038863;0.0032279476651311;0.00343797851616059;0.00328303385537591;0.00723300236088623;0.00445727486740916;0.00407527899100785];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.799246934724178848;5.3229970713164727059;2.2138553393048447937;-4.3004971946030750019;-1.5778373864029719975];
  IW1_1 = [-1.2869484162804083471 -1.7259937276547432372 3.8826881558321253429 0.78045057706578091494 -4.675253896133243714 -0.67187095498880777811 -0.35862458902309868325 0.80251018036556354129 2.0852064319405130277 -3.8255339804744434851 -2.4429131349284283203 4.4281785951403254131 0.8605196212522794319 1.3030980785146091261 1.4473871161517830597 -0.020772678485009722638 0.77195032552554898597 -0.92884047654702950325 0.40554896177343524588 0.98768487036743135565;5.2726306934070787946 -6.7866740846027893141 1.2327319137814209959 0.36197728744859680727 -5.8613077733295497751 -0.016648619036740641697 -2.0583367982445435196 -2.8699108831719626345 -1.79245594616611581 2.7085484313159096104 0.77714039392841083309 -2.6388305790293027364 -0.63409717785869657014 -1.0888678742941240163 1.1903336529896140217 1.0747048564526868741 2.9124024469125733283 0.34204266153411300166 -0.37404044220597243431 -1.2259606842212569244;0.74643760406329340285 -1.4577998209430327314 2.9295240084851230655 0.35110657184522803265 1.1550175448294393021 -2.0028335362634241967 2.3179600136317253245 1.8450064943190194189 0.55698919204671704097 0.45104830622633645953 0.61369985400530202568 0.65055218586309870865 0.11404136143008483661 0.49155813981989116002 1.7851986672686901425 4.1503628742242080207 0.088069264091747201384 0.067678806720410489284 0.75892760430688033235 1.8611199257079782399;-2.5920658861826608721 7.4888200415470036475 3.4139165909086175432 -2.3184599795810423295 4.2987208338690230391 -1.8429828659780114197 3.2186813937029312704 3.0212532579446405023 -0.91328391117283014289 -0.81756768688548697721 0.72591089028992561438 1.0742539571044822377 0.89307397800527354992 2.2935232556273121851 4.4137293178574452668 3.9772535097123888903 0.18787455978221023756 0.90214469672823671687 -0.10263175040754705936 -1.9919562017295868728;-0.42049124350634781155 -0.76965466139714500127 -1.6416880333912418077 1.8752319016406433505 -0.34141907866696258322 -0.09738846418144010697 0.53538131142210976243 1.1323510011974871059 0.0059705815265799627722 -0.30561423211418325963 0.13742097138993550343 1.4547988061818981631 -0.044330398562676225083 -0.89842610534772759934 -0.014018946203774286519 1.594611032455231614 0.85564481423705129881 -0.026223944234007676851 -1.0787120094659132796 -1.4636771433845716661];
  
  % Layer 2
  b2 = -8.0993715652969324736;
  LW2_1 = [12.0154604937611591 8.3296132184246296504 7.7423650907415160205 -8.0929566757171969016 7.9813696345465263704];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

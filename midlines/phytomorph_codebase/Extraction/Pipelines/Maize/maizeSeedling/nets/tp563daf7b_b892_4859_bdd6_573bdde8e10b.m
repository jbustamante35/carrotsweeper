function [Y,Xf,Af] = tp563daf7b_b892_4859_bdd6_573bdde8e10b(X,~,~)
%TP563DAF7B_B892_4859_BDD6_573BDDE8E10B neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 02-Sep-2017 18:29:57.
% 
% [Y] = tp563daf7b_b892_4859_bdd6_573bdde8e10b(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1710.79601884287;-841.368302509968;-925.675633657015;-1424.63292253516;-1115.63541033651;-861.953076142277;-996.664725988392;-421.625702789099;-721.553885286547;-557.274532479564;-502.13210954551;-541.944235264822;-543.177005191331;-167.207345824937;-344.528961662812;-294.401776402712;-391.010406370084;-285.680184537935;-174.294824484568;-301.038307242063];
  x1_step1_gain = [0.000202107905561193;0.000554219398814734;0.000742185534904079;0.0010185341647551;0.00103332655312913;0.00147681597144007;0.00118221307527393;0.00265958726683844;0.00125235891924473;0.00165285753178;0.00232860128237171;0.00188013184297682;0.00198822427969292;0.00479968082327785;0.00252047169225141;0.00363117206158393;0.00272984263620497;0.00383651951608942;0.00502254586493033;0.00330771328744473];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [3.8551857331270684703;-1.3644627152638182377;2.681752010716786927;-1.1988909717295457291;7.3541019147456445637];
  IW1_1 = [0.2014679544866488925 -1.0305572242384328785 0.43023769606717987557 -3.0672783052169072526 0.30388834993578678345 3.7474707179010753322 1.4264217454330712087 -1.0616803734344084642 -1.841175899380034453 -0.11518322523186590167 -0.40405437395068088957 0.32983446478863731599 0.47197649033282002007 4.3655913058578681429 0.2237076898922312207 -4.8473915531351723374 -1.886691513497453121 -1.9965551310777043259 -0.068852136394734336777 -1.6450422588573259119;-3.756311695050563948 -2.2840898179878368346 1.1126916546953558029 -0.19544560327198237659 -3.2839462378156634159 2.7440656432455776681 1.1003840230252970311 -4.2873974639920868768 -1.0197705240396590654 0.20462543071587774302 -4.7665175656282237071 4.1468148968829625645 4.4671305480417160538 2.0189395339164062371 1.9676331739898198503 -1.4881918122718842401 -0.4250813933060368921 1.2260879962265787135 0.13222644187943877192 2.6629485993433976709;-2.5278154543188344761 2.0803307293657513632 -0.30070158378988948167 -4.8790317920666828044 1.1283567753889185425 4.0447112539716938429 -2.7267922423449055813 -1.2928490030536168298 -0.7620646109327345874 1.2312050015610891407 -3.1451334028571125145 -0.70840377770945039959 0.23651508891146355573 2.5445464155490209457 -5.3101071248072422293 3.0096533266554361674 1.6022558679596352604 2.077414345112480909 -0.56986009503742884874 -4.1540777796490209184;-3.2750177826822577387 -6.5811799811290452311 3.0849770488045864525 -0.20306736320567281284 3.5570656108582170418 -1.372818741515459795 0.47170547541633112143 -3.0355008708371582493 -3.3472100589713726926 -0.017120780023703756345 -1.0689554110082104543 -0.00069988839920293261041 -1.9575376199144929323 3.9121785737867194044 -6.6014597304768800612 -2.0017690359989490645 4.3493176605915415678 1.179575957809831932 0.58872448448555070311 0.64760064552356710887;4.6348302235042124764 0.55053951540480050575 3.266040565592658762 -3.262714433006175252 -4.2734085366226244318 -1.5862594489473433867 -2.6715743388198398556 -0.64444652072016384015 1.7839815262157825426 0.92836348516845068612 -0.27007914670495808407 1.6930652350125678929 1.0007826687809595612 -1.630112161934082593 2.9339420497207138183 -2.6390077023001694556 0.54379945363120674173 0.62204452926535591661 -1.2551911938550108783 1.197972830399733235];
  
  % Layer 2
  b2 = -4.402867921591456124;
  LW2_1 = [11.412948058481765301 9.9501959698868169824 8.3210984866089017231 -15.912644277824634642 -12.30046167680141167];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

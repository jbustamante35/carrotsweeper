function [Y,Xf,Af] = tp5949d046_4b44_4d77_822d_c6d64987d7aa(X,~,~)
%TP5949D046_4B44_4D77_822D_C6D64987D7AA neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 05-Sep-2017 01:55:46.
% 
% [Y] = tp5949d046_4b44_4d77_822d_c6d64987d7aa(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-2001.76879548539;-1846.28602050405;-1096.59977942709;-923.044887924523;-718.635970677916;-534.736579087549;-636.87763073167;-543.343901935942;-408.756773605248;-437.689914113486;-597.158358369105;-252.73701806495;-357.743301501244;-305.701917871547;-262.500890231183;-420.955237007948;-168.878309979178;-265.923075543756;-279.306010526073;-382.085749121044];
  x1_step1_gain = [0.000250772026915415;0.000457175383291266;0.000795694570296745;0.000975455655635304;0.00136867839470428;0.00177765334299387;0.00147664952758212;0.00196526984478521;0.00211681540578918;0.00191395299404994;0.00213803411115011;0.00313745816598823;0.0023949939415886;0.0026280224535439;0.00340299377226946;0.00307580218448472;0.00420342200465327;0.00353937526659769;0.00305696135696241;0.00320422591704702];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [0.35043158351634562386;-3.3761862479542834592;-0.50568895308862016336;1.4235678786309431398;0.58236696489765205076];
  IW1_1 = [-1.3252783044047826699 4.4183355641825068361 -2.4089383969684723397 -0.088943293413483531795 3.1922700511797588163 -0.78039138295283827507 1.4216505455752030951 -4.6168108117937078916 -2.3537105146056807037 2.0856735784592430605 0.79924505906427212309 1.7249539340784725283 0.15543734149690080493 -2.03714295083321284 -4.5924514619699108309 4.3972767299025568022 0.67736550408576212678 2.4490050027534029375 3.5976180647674507185 -0.9390127857047013693;-1.2940848945401794978 -7.6685180317739014555 2.6450162095273563878 1.5197393331039279474 1.5808423599732690512 1.3557897321765122189 -2.0663557046720315569 3.1232223627895097096 0.78811712480281992388 -4.6260115481742962729 3.1097253012445644771 -0.40621580532582779455 -4.8417540015221121052 -3.4310852968467311364 -1.8053541271654818257 -0.35225567783585276516 0.028943782946478348317 1.4226141990098732926 -0.73108744248688417589 -1.7726607101766518326;-2.5350499920760394268 2.8440973662217947648 -0.99993090341666457377 -1.7816773350164949452 -2.6225866068741834347 -0.16935636767697750948 1.0570476563876181064 -1.8575953181278748172 2.6659962256212623721 3.9522309882081350096 2.2037050098049659752 -0.87457063673521373559 8.055587800970675616 1.006989656511100506 2.9223084469793962903 -1.4817377082825065049 1.0480951058876895043 -0.91538224547763924477 0.40272424991608329892 -2.0299394953107472439;-1.6739013614488864601 -3.0077244903224160666 -0.10886003713902053791 -0.21713281467635314748 0.92446830484621889124 0.62779765306990553686 0.63347682288122020289 -0.46000424295468461677 0.68401648200623366147 0.53520382710312319752 -0.40721264396532536045 -0.21523405654699306888 3.8447961542405750812 2.1215386331355756688 0.07491424297609694527 -0.90409388567401893777 -0.53762884197936078312 0.0047224319924344844435 0.12808757155412761608 3.6641460378738268666;0.43084402317197117993 2.5064266439225986183 -0.11407264997909391524 -3.1239837852706551224 1.1325451014604821509 -1.3560667585002401658 1.7346286765301062172 3.7089159768619066604 5.4154413942332277898 0.4822436957281245884 -0.8622406879881638897 2.4921083604497504815 -0.64323021284372072781 0.22014124007886526346 -0.82873376110654295434 0.93358228117831509874 -0.065631949072695039415 -0.23341398834226440018 1.1116934671948031088 -0.56373557741938395971];
  
  % Layer 2
  b2 = -5.8697122281468043781;
  LW2_1 = [-9.3554326884321010738 12.124394424859760377 -14.10173911587303941 -6.4760424794364901402 -8.6883444159198219836];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

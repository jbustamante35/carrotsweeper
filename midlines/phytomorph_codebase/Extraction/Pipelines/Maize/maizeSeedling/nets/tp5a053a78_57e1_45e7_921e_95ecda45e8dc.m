function [Y,Xf,Af] = tp5a053a78_57e1_45e7_921e_95ecda45e8dc(X,~,~)
%TP5A053A78_57E1_45E7_921E_95ECDA45E8DC neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 05-Sep-2017 04:17:34.
% 
% [Y] = tp5a053a78_57e1_45e7_921e_95ecda45e8dc(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1054.92998109303;-3159.48627075363;-2114.78087604941;-981.654021045392;-885.057943991189;-1580.0959481059;-466.558771320883;-686.259228054126;-578.923214789107;-527.239355792849;-526.427101249679;-436.274101764841;-464.119415341446;-602.900723427734;-237.436871082887;-426.867092225933;-362.590695988117;-284.873458506234;-290.570400999352;-350.305421104432];
  x1_step1_gain = [0.000201853701047093;0.000358308876895914;0.000501068237842808;0.000831515796852234;0.00087930290309635;0.00096790990879005;0.000979217898324433;0.00108578915137916;0.00217066128634303;0.00165661710022779;0.00119050056045196;0.00160876099240959;0.0027023011442007;0.00170182021982357;0.0026230549133427;0.00249971191480282;0.00300944378896514;0.00354914054319066;0.00406898355464202;0.00313490959585148];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.6181212098144177602;-1.9742471940017107812;1.1362116173690339771;-1.7697608313570649674;-0.3205230454893087666];
  IW1_1 = [-0.26919682663001021083 0.7195786189537913824 -0.26983219371016720078 -0.085476148898912071572 -0.30673241762065800442 0.2563416297684614209 -0.35076677804032474484 0.38212568084152642722 0.36041437220614402914 0.35159339054852967177 0.37419451138941672852 -0.057868096682681398335 -0.32608559700533923387 -0.41910627385768101094 -0.36591006596770336845 0.3174476103951460737 0.17914375898933787568 0.16106324285077835978 -0.41113791569131102888 0.34760863792612778367;1.7503138730357514774 1.5837087570297667671 1.4268030319762214919 -6.4300322015801540942 1.0305314686110182976 1.5403649706417454901 1.3930526743190254635 -0.20926553867491604066 -1.8079075797682111482 0.84933746597922432642 0.60566682300687479934 0.57132504227524905094 -1.1083661988655921782 -1.1441468062565036679 0.37713220632644206542 1.8583739583222238512 -1.4790783527655735341 -1.5997106827594131939 -0.89636486977639728835 -0.12738855627661327397;3.0250367367221908665 -0.41849232583636913896 -0.58998588764219128677 -0.65383421709380806774 -4.2804342730803810468 0.5778406765201207218 0.17920928133774968738 2.4414002266789389672 0.047980574839470713222 0.33976200532158545853 -1.1981691930027100756 -2.522165674704814009 -0.04379907049239254585 0.9027756099422861169 -0.82249430173356330442 2.5453313827907741995 -0.13879079370312355501 -1.5821889152257673228 1.5803392801166151749 -2.0860700060747214835;1.3381319510154039421 -0.43173835875440597087 0.67953870361611257156 2.103366555635034274 -0.40330672159362296325 -1.5706054302273497747 3.3620790982512471778 -3.5219363346876670917 2.3498280840595606733 -0.47414462955422892465 -2.2694513102410409644 -2.5753006502266666544 0.54576844225351983653 -0.27463221485402139477 -2.4232690460652221986 3.8206537096903230299 -0.57561251726200268752 -0.1120589156263408076 0.76803702922878458459 -0.6559086561088559586;0.21009280675513020142 0.70485985639649118006 1.5071781792153748913 2.7317774601871223084 -5.0661024871282691606 1.6856504507300280604 -0.87135552885452571825 -2.5373685042922229371 -1.8162018824878456424 2.695934946353961692 -0.81467910351698402671 -2.0558474720090593735 -0.54902043983277304395 -1.1471119313947217844 1.8321556905724045716 1.3608583067634791863 -1.2833995517278493637 0.076504598288901118353 -1.1903992076454152915 0.14867639145015215663];
  
  % Layer 2
  b2 = 1.5847652382212145117;
  LW2_1 = [1.9054819170345735913 8.6826399003510257302 -7.287669171297913806 -8.3041785495323949817 -5.7244022291388185764];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

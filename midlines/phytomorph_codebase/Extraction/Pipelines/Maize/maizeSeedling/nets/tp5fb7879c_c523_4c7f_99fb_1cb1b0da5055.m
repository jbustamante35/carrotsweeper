function [Y,Xf,Af] = tp5fb7879c_c523_4c7f_99fb_1cb1b0da5055(X,~,~)
%TP5FB7879C_C523_4C7F_99FB_1CB1B0DA5055 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 06-Sep-2017 22:26:00.
% 
% [Y] = tp5fb7879c_c523_4c7f_99fb_1cb1b0da5055(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-5310.24104946905;-3062.40716175129;-796.678021735525;-751.778745457492;-962.879682501257;-561.234234396123;-567.818719457227;-566.708636588774;-460.813029179961;-650.116847383026;-365.703888775155;-279.141698173318;-445.050021503465;-362.027565171378;-290.108959264267;-350.309427866384;-268.266206223881;-201.923452595313;-223.56242533298;-192.30021113036];
  x1_step1_gain = [0.000187746732766858;0.000517587446146427;0.000760929139769031;0.00107683880161886;0.00113410115771159;0.00154637953830619;0.00191937835803698;0.00192268942981794;0.00211835684506625;0.00196958059572075;0.00268955398662546;0.00257377430529599;0.00284234016821655;0.00279908218986808;0.00409640929201518;0.00345584818973342;0.00422505290367575;0.00549698021899197;0.00471432618261848;0.00476878567270221];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-4.3194901325942840487;3.0416887555269340737;3.4647360405508713654;1.0867953386031277141;3.1393318926409503611];
  IW1_1 = [-0.15997548953037621366 4.8372707014640488055 -0.92010679360371783186 0.30816452716742676055 0.58790711476057966323 -1.9648332415497564707 -0.5745346487015549064 2.1910523040128260241 -0.69608250895705225947 -0.38376863084850787455 -1.220704270318510698 0.52312826813381285707 -0.04233034608952975647 1.4342178795641951083 0.57659668428511212657 -0.030263127090389380786 -1.0307537259874572921 0.48006522194541867421 -1.828961069133456574 1.5500612765238737101;0.074209056334523154641 -3.7205638027211089813 0.80989238209913583244 -0.1181212888169984182 -1.2143313901461407767 1.3857458000427007594 0.16726246881791850818 -2.1798822550179468571 0.53552942799584535294 1.1972445789357148982 0.96241143817422503126 -0.348368634082322437 0.12463451841657782748 -1.7906720490332554974 -1.1123295773993033819 0.48853792256008005124 0.55527247831732584604 0.4786632490802406048 1.5563390978818647525 -1.5894419724396366966;1.1267384502525172874 -5.1929538062594060577 1.2007293435366528378 -1.2211818977615571669 -1.2166005263442198903 1.2496977936563951062 1.5980242313035857293 -0.47636588330666995716 -0.74395923386887052864 1.0916930035815477495 1.6870576272714807864 -1.0301939569917448747 1.3421225467485957683 -1.2057101602848867561 0.95244879858603415101 -0.15227668244055680979 0.42186384627836281958 -0.33883889273242506768 1.5037431420697922047 -2.0467822969102158481;6.5566102897430349472 -3.2331317210391943284 1.108193464763542746 0.89643404355364697533 3.1756770572423840271 4.485520305839776789 -3.195018311607614514 0.11330307338420511631 -0.35232106182351019541 1.5657127111780060336 2.1966010744415007672 0.55903231328194802341 0.29976504952203875121 -2.0537682822620744183 0.46338556521937657173 -1.7599930266734016282 1.8326114493541250106 -0.64566090809921250493 0.93826564584352289966 -1.2653733048298743125;-0.55086960031543730221 0.14407429751676326113 -1.0643586284271833176 -0.18053518007234395371 0.26467578257564072786 0.22662685683767910816 0.28780446983462643074 0.32115952586895890608 0.17650887138209941929 0.03872857050915912841 0.22668070937935072551 -0.37492171592527800961 0.44972565390372254424 0.23480282022061907399 0.65632106858830130403 0.062035276966099200946 0.51110541831208822217 -0.18708245916388538399 0.060504609914236041901 -0.24617325503301590306];
  
  % Layer 2
  b2 = -0.54830016382740198733;
  LW2_1 = [6.4010451573100608513 -6.0847308895407339335 -5.8921048625079377459 -9.0587611860245562667 -0.74343434829878829451];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

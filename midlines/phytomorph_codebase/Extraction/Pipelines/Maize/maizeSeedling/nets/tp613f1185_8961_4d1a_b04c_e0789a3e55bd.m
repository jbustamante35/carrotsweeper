function [Y,Xf,Af] = tp613f1185_8961_4d1a_b04c_e0789a3e55bd(X,~,~)
%TP613F1185_8961_4D1A_B04C_E0789A3E55BD neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 08-Sep-2017 13:36:59.
% 
% [Y] = tp613f1185_8961_4d1a_b04c_e0789a3e55bd(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-5466.61789079662;-862.937878923585;-1028.71862143181;-451.710971542896;-692.538815520008;-441.043793232211;-783.667639824727;-311.950474474657;-656.555828069286;-380.160028036849;-183.589471391043;-268.74339823526;-384.146123020655;-202.979007080803;-233.266353450977;-248.555985162429;-227.243600249934;-275.821003918912;-174.98234451135;-155.930294069008];
  x1_step1_gain = [0.000192953812201725;0.000635170113819406;0.0010737117105794;0.000992967389065707;0.00140247416929522;0.00179426803546528;0.00152094087103249;0.00262475201653711;0.00199415494766511;0.00251075910029923;0.00454433874041172;0.0037866200073868;0.00302237737948942;0.00448879604138527;0.00366080733460361;0.00363057230533733;0.00381924645546846;0.004275375822744;0.00592120551781172;0.00602422138644395];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.3509650347551049876;0.061282977341705451024;-3.9429658768264288504;-2.4099115859006765561;2.0757057956024547174];
  IW1_1 = [1.7921539569129854019 2.8937897669954253388 -2.3870571398084883263 -2.050745369796698192 2.361921699611624792 -0.2701939594339827222 2.2664262522106239928 2.5164869847090707289 0.35599119273109947059 1.0005455943439069966 4.8396349633530757472 0.46593659082383631631 -1.8995481511767784433 0.5875258450327001114 2.1909336285383425036 0.66820390741582835759 -0.046877469207715391497 2.0021632933437607527 -1.8220507222818149717 0.92292358664212559294;3.0047723441740967765 -1.528748600648781375 -0.61040025897437222291 0.26653988060027294926 -0.49003579583340023396 0.140850703475050687 -0.82841421684680760507 -1.9378948977124854647 -0.32376944299087284662 1.3228729274321706644 1.2592875064405952834 -1.2578942412708433718 1.4321509368600788825 -1.2683054547769734288 -1.5561930848071141575 0.45877275324460847772 -0.57019444985669531789 -1.4726630631478008215 0.38631674107396246631 -0.18295493619102026761;-0.4984075689529255393 1.5261469852358868771 -0.25355352912455847436 2.1228323627898189052 0.43286672245407253889 0.59991464624501122938 -1.1376489324238732159 0.21124746559558121861 -1.1336229455335937732 0.66358498288003420207 0.81611513171603722316 -0.58259751593399899949 -1.0704575488317156218 0.40445614940455387742 0.55407395480674681565 0.10925108732529892341 0.22418759351336417507 -0.45984989054813507625 -0.64673146571231299173 0.75097932355209262578;0.37585959291299952945 1.6849342163875868916 -0.80949944083404690165 2.5508131509282665483 -0.0012461519885850614979 0.25527236371789457925 -0.22026247217732450312 1.1026825239721060878 -1.3590538038179693636 -0.16756883909667080745 0.18528181677843577613 -0.23910936174258787257 -0.24139716301444147373 -0.26720700811816516795 1.0714560137366422321 0.60939387736539718521 1.3111074385763110683 -0.85013335668669087752 -0.20632930249393280353 0.350987650505671267;0.2190194843379891787 -0.44624449968916751752 0.10609798246366491936 -0.95777525088578296941 -0.10119068826365718028 0.26134655014176955135 0.082765406559364831929 -0.091130591000785091116 1.1764860868858089127 0.86519117985585847208 -0.38830117231926303267 -0.20673187221747812981 -0.50674668702283909294 -0.40334092477223570938 -0.53266079517122388864 0.35472725267648619329 -0.61642338819378017511 -0.38222340401130228127 0.025777301049084443835 -0.4712453135297712814];
  
  % Layer 2
  b2 = -2.6956317527183997207;
  LW2_1 = [-3.2358577995734938426 2.9480859565034789327 1.5502424481497594222 1.5378969497722552173 -2.603413059978312738];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

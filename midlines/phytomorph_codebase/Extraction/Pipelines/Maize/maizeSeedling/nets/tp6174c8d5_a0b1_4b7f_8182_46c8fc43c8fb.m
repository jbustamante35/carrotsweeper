function [Y,Xf,Af] = tp6174c8d5_a0b1_4b7f_8182_46c8fc43c8fb(X,~,~)
%TP6174C8D5_A0B1_4B7F_8182_46C8FC43C8FB neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 01-Sep-2017 07:19:20.
% 
% [Y] = tp6174c8d5_a0b1_4b7f_8182_46c8fc43c8fb(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1874.99930442496;-5454.91534726369;-869.204807020144;-780.471896742374;-460.20555521635;-234.31060487846;-540.291178237133;-572.142715533789;-192.819908210793;-263.800490630851;-210.82077992178;-258.183122033524;-286.590370604323;-169.741999038736;-271.750472270935;-218.521589353918;-373.104709120352;-213.71944994577;-260.914631799837;-176.115238468632];
  x1_step1_gain = [0.00034254044244578;0.00027748074658588;0.000806013241167019;0.00156677380853905;0.00168393926281428;0.00269046527889069;0.00198084992045411;0.00236361816544283;0.00245784730269613;0.00195235680232595;0.00282106579415896;0.00424658079482961;0.0031726176926076;0.00555458687461901;0.00429724736478086;0.00484270636687465;0.00333931608099055;0.00598913897545071;0.0038478300260404;0.00642488839732229];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.4679254044264176127;-4.4465302561220072519;-0.72450385484176504924;0.67128550234085460069;1.2857039355270696301];
  IW1_1 = [-0.37042488188280481287 0.016855608095076756586 0.12339772861228777423 0.72731631757719572562 0.63415186446457250113 -0.73877509493684312414 -0.22193250758952576263 -0.20106073028448540052 0.41391983730866654945 0.88780619078430156321 -0.37230643875924018804 0.55267945326760736791 -0.91074772482503096871 0.078722429799596690958 0.38741811553007993174 0.29141779928720118464 -0.085901935401963405714 0.24287510066411413523 0.24699235287571938424 -0.43370880213359636057;-1.5262829621172662176 -1.8826289332997712123 -1.2289557119080902758 -0.55967868470263515412 -1.9218505757330432981 -1.1996593177698093857 -0.145618813764001237 3.1043880639152292567 -2.650336195622844393 -3.4877544992022850856 -0.96006125467924285921 -0.73968207474780356403 1.1716369287602834692 0.54482573368288966797 -1.5300037290962664738 -1.7158452913009696328 -2.7373074359215037177 0.2397776029271240783 -2.8566040430412842355 0.33427627841635532135;-0.74846514436760158695 2.4303172346318313579 -1.0107202263422290223 2.5694053131255873978 1.0004348055719607391 -0.87771678021112353729 -0.17075394078877290105 0.5613749085565511443 -0.19255070276522323613 -2.6771244542879606421 2.1198001400711268261 -1.1624411050546605839 -0.27905710423363044859 0.40352585822319281261 -0.85418979891240143232 0.12053464558611845514 0.40022391389343114909 0.41185959546382666652 -1.028261372551477093 -0.76303683505503394624;-1.4892102977571537448 -4.317876748499188011 2.5346149198306768824 2.9701125944870225837 0.66164753392965947043 -1.981506080538247172 0.73203125188230055986 -2.8402262463494039046 2.1090662388050827047 -0.087956455885944931361 -1.2474479927897079712 1.6600023432181039151 -0.35248642644275485214 0.090268116775624671067 -1.8032998299303122369 2.8577222526215666498 -0.63148800918709735441 -0.13322584061754855211 0.39041859390689676035 0.16205025593252933569;4.9113616213216184647 4.4283004735858959577 -1.2619375859954262697 -1.3933816233372422477 2.0294150697933868166 -0.93852318913596599614 -0.56517602545506062661 -1.3805991814802733852 0.22677329356230035984 -2.0043981524279850248 2.7728217979491871503 -2.5125072270610582237 -1.8839475478852474311 0.73871608983732273135 0.50563852514749840772 -0.78806067457971773482 -2.1231789827626190714 0.29084846646676976167 -2.3736308365233611539 -0.65851689834826243608];
  
  % Layer 2
  b2 = -2.9895186721824327236;
  LW2_1 = [-3.8351104735431533754 -6.9008805318383990013 4.2328962632277642442 -5.7361511057424481308 4.1128488163849521442];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

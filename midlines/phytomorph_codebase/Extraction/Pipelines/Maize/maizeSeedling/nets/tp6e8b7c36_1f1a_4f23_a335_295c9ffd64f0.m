function [Y,Xf,Af] = tp6e8b7c36_1f1a_4f23_a335_295c9ffd64f0(X,~,~)
%TP6E8B7C36_1F1A_4F23_A335_295C9FFD64F0 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 04-Sep-2017 22:25:51.
% 
% [Y] = tp6e8b7c36_1f1a_4f23_a335_295c9ffd64f0(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-8184.90793418461;-2767.31086728677;-1769.06834334395;-1424.63292253515;-1115.63541033651;-861.953076142272;-996.664725988394;-421.625702789084;-721.553885286555;-557.274532479573;-502.132109545497;-541.944235264826;-543.177005191305;-167.207345824913;-344.528961662838;-294.401776402709;-391.010406370081;-285.68018453795;-174.294824484561;-303.609020442411];
  x1_step1_gain = [0.000202107905561193;0.000554219398814734;0.000742185534904078;0.0010185341647551;0.00103332655312913;0.00147681597144008;0.00118221307527392;0.00265958726683853;0.00125235891924471;0.00165285753177998;0.00232860128237179;0.00188013184297679;0.00198822427969297;0.00479968082327803;0.00252047169225123;0.00363117206158401;0.00272984263620492;0.00383651951608916;0.00502254586493051;0.00330771328744508];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [0.60933371459782625923;3.9577902453103348535;1.5179298970772028277;-2.0524095305122869171;0.916582800043568513];
  IW1_1 = [-0.51032834524867742854 -0.62554088810426977663 2.8495988874938142921 0.067426485759934706721 2.4683495436064073481 0.54066098636646398035 1.0069696413646638256 0.13642388799806423605 0.21833240679233928416 -0.20059841652256538147 -1.3650195125012003494 -0.24463146185247422459 1.0269413785670951089 -0.23805733897404970922 0.95969901686041636513 -1.8313287469924071083 -0.61711003103231765188 0.36796448325455338724 -0.020485418746652505478 -3.3016318375239137595;3.5583903243123202742 -5.5607427650335807812 -1.0060670421243254058 -1.2843014318543783947 -5.543623486406266565 -0.67319292705777800112 -0.074115786624471741151 -1.0439937221276363033 0.84063876791885838724 0.69448439041093745772 1.322084506606507448 0.61523140242856777515 2.4955531117005120834 1.1043633610039529369 5.0600139862777595567 6.8121962614253028789 -5.6914160464922636251 -2.3986711274715144526 0.52827644868795109456 -0.43009285161482196935;3.4509227833388793627 -1.9255033419444071985 -1.273495643962984758 0.90547822966537738765 -2.8246050975484706669 4.0488687953749797899 -2.0231445336127240608 -3.5082714050721208743 -3.8889136897384846137 -0.03080756288034123061 -4.017117518756542438 3.7488200081006728404 3.1185357986682014086 3.4610775933440254271 0.2944465532001314112 0.40053923396399393475 -1.5249446233904706549 -0.48219586268784148109 -1.5333959332243580764 1.6780414528972120713;4.2829690709794077108 2.2215802889978202295 4.1600678180955270591 -3.6350988024743560167 1.4321651671674335837 5.5857946204516517597 -0.51102046669260459133 -1.1720277175649691515 -0.94701072051060652957 0.023973072869565677928 -1.8158839815748726298 1.1309037143719198326 -0.44656939712574189594 8.2851016117667448668 -1.8616782973757493025 4.1403670710309494751 -0.028133544124074698345 1.3779135567641145332 3.7484404276373193277 2.5029469987919754637;-1.5481743390458195808 1.3210480056925368864 -0.7274712401055288824 1.3638744133070679343 0.72562920062348734707 0.28159938209104340423 0.56848002335104663718 -0.0091855767008485501857 -0.44539730199375621167 0.16862009187613899441 0.40973674129749410033 -0.3631705665045960596 -0.68918018421833671106 1.7838059215148556191 -1.7889317616531448252 0.96221008160042420521 0.71398952942124749299 0.73478196321955857595 -1.089135997925396282 1.4576413159900296623];
  
  % Layer 2
  b2 = -4.0330994498679535454;
  LW2_1 = [-6.8013930444711689915 -10.050394107479247552 8.1150553804240850297 5.9907036001021198857 -6.0823315482578674818];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

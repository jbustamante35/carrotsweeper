function [Y,Xf,Af] = tp6fe075e2_1728_4363_a17f_8d916ec1d288(X,~,~)
%TP6FE075E2_1728_4363_A17F_8D916EC1D288 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 05-Sep-2017 07:53:26.
% 
% [Y] = tp6fe075e2_1728_4363_a17f_8d916ec1d288(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-5310.24104946905;-3062.40716175129;-796.678021735526;-751.778745457492;-800.631435004028;-561.234234396122;-567.818719457229;-566.708636588771;-460.813029179944;-650.116847383032;-365.703888775154;-279.141698173316;-258.595524643432;-352.492361124255;-198.123504200372;-350.309427866405;-205.100647540251;-161.912675664719;-200.676357162356;-227.093768231851];
  x1_step1_gain = [0.000187746732766858;0.000517587446146427;0.000760929139769031;0.00107683880161886;0.00113410115771159;0.00154637953830619;0.00191937835803697;0.00192268942981791;0.00211835684506627;0.00196958059572073;0.00268955398662546;0.00257377430529594;0.00284234016821655;0.00279908218986814;0.00409640929201513;0.00345584818973334;0.0042250529036757;0.005496980218992;0.00471432618261875;0.00476878567270203];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-0.34824787593820760723;-2.6050526290176412303;-1.0485473210994051829;3.1164019455480804766;-1.9347894488571688587];
  IW1_1 = [5.7684405239926022091 -1.5602450172023183406 0.081455543484598200155 1.4612117016132741831 -2.039196921881543112 2.99427881227372783 -2.7483637953051154312 0.66016767006334298173 -0.80729066036471186507 1.4006261660344234699 1.7959445241863565279 -0.51047200211049559293 -0.18338133260472280761 1.1125701302025239325 0.19131706926349115183 -1.2631099009124213683 -1.3928529554861259765 0.56953951091383137051 -0.03784558474226325242 1.0488802196734763328;0.41273792077455184746 3.1829377485502758915 -0.38817166267258829127 0.095621456920959205239 -1.2946416609896993499 -0.025025250089749224297 0.32616998967795601816 0.80170648683111933597 0.0046284174669251887391 -0.36050882872014766711 -0.63823876996323702926 0.15333219770737052667 -0.53109699489941952777 -0.77108581457126146308 -0.46528914792748338192 -0.89930554826322295359 0.043754034229035114467 0.75095337174453680174 0.61796264832841574233 0.18526729354073123712;1.1520891021504289231 2.2254753438747205685 0.10065023519000626528 0.18221725741863542547 -0.60961073365571771809 -0.18995489114042918288 -0.9376555187793077506 0.44734908060610895086 -0.63310263418122103563 0.64118116325015295232 0.094681778179669856543 0.13481421137103272168 -0.23631117403987206282 0.21554579983059038439 -0.19456535667358476616 -0.96379999921409942321 -0.03494773779087454596 0.35767016862186146176 0.30658771030289966308 -0.4383176797011305581;-0.2461333664346711525 -4.2436982071510849224 0.14230446698635604297 -1.4993587711554727804 -0.022501886023651392066 0.89178953512428760231 -0.028928565829909647783 -0.96732224269596045474 0.16663412018862810982 1.3675592092248007869 1.1152786008665258599 -0.73720680036196317708 -0.13492317839898418375 2.1439463478314793043 -0.082742613181287394397 -0.23587417268072710663 -1.1651480091301540387 0.95439697739197104642 -1.6482811858822683515 1.5315945164646589394;-0.20686708021369565325 -0.31228312790318518699 -0.21675389520408983035 0.11366452322851226808 0.16123602206809822812 -0.19459579716102190505 -0.18344934295979598016 -0.44552579159026667321 -0.012935568594751509913 -0.57919415849851874079 0.28706228580249082416 0.26262185226574763508 0.46643561678477207799 -0.2723088630678380806 0.55546064580855036841 -0.13028235892790923645 0.37048270815543327128 0.43615092504359292969 -0.28707566437396925263 -0.39781555295912435222];
  
  % Layer 2
  b2 = -1.5963981556557444996;
  LW2_1 = [-7.4225952325312221092 4.9213159012687066607 3.0971673691465348988 -6.0033324023374641243 1.7926381745426382963];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

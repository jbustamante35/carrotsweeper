function [Y,Xf,Af] = tp7034f6e4_092e_4d29_b063_8cfef0e47933(X,~,~)
%TP7034F6E4_092E_4D29_B063_8CFEF0E47933 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 04-Sep-2017 04:28:57.
% 
% [Y] = tp7034f6e4_092e_4d29_b063_8cfef0e47933(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-5466.61789079662;-862.937878923584;-1028.71862143182;-451.710971542896;-692.53881552;-441.043793232212;-783.667639824734;-450.02627128992;-656.555828069291;-416.411813428009;-256.518565057539;-268.743398235247;-384.146123020673;-242.574763141835;-313.061223282001;-248.555985162507;-227.243600250301;-275.821003918846;-174.982344511249;-155.930294068971];
  x1_step1_gain = [0.000192953812201724;0.000635170113819407;0.00107371171057939;0.000992967389065705;0.00140247416929523;0.00179426803546527;0.00152094087103248;0.00262475201653719;0.00199415494766508;0.00251075910029927;0.00454433874041207;0.00378662000738698;0.00302237737948955;0.00448879604138609;0.00366080733460322;0.0036305723053377;0.00381924645546642;0.00427537582274468;0.00592120551781326;0.00602422138644395];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.2653767348004789639;1.3765792179756561886;-2.0554990477184480469;-0.14395480778607247507;3.8790649879398229061];
  IW1_1 = [-0.088224732064420163802 0.022038990988222366407 -0.29700853105985974834 1.8965397590872443701 -0.006532430399474266694 1.5735864648255344367 -1.3826064042125705278 -0.96345070800057353022 -1.2016127159393901191 0.45330052960268435447 0.31492884656405578658 0.24516675028731510499 -0.67391027075595610896 -0.23109601497057244424 -0.64741920596537394506 0.10506272093149091051 0.16096909545901549876 -0.64226489693470978359 0.19225887247913348022 -0.49090143733548913252;-1.397823459109532207 3.4898372821259431298 1.857639709073588774 3.6035450557165473739 -2.9974898594165040322 0.065849408643279774833 0.84049143235709822264 -0.30869239753854021968 1.39179752825445191 3.1853809963374932757 1.9344812099487880275 -0.42720137376601396983 2.2300243805989734547 -1.4590866760870875307 -0.74557518154801483146 0.68305014601778701877 0.44775414555502046632 0.29291276808705202228 -0.36586201770020210233 0.18997203253846958737;0.34157651591023502347 0.10170560007839879457 -0.55849708349257742857 1.3139350850043944874 0.45444979544819313899 -0.064903318866425099842 -0.74955011286002126702 -0.075809665975514722858 -0.49279531659729480797 -0.57444407853823642451 0.12679443128240339145 -0.033970249090070930853 -0.38622501633909223084 0.27113649641455167538 -0.30948363170755605056 0.2899071995210582009 0.19923094367850605058 -0.81652704103117568213 0.30135794449431857478 0.015471492302382438416;-8.0299036030208288395 -0.29494678086518688609 -0.69855207850637324185 -1.7316957817007654352 -1.2343577357081219059 -0.046603244755298915691 1.4390397855639072144 1.1580852260037843848 -0.73841191463151967245 0.10906726104465055971 2.2648600306824020478 -0.47619605609691395554 2.233213979306595931 1.583666397143872473 1.0335270236061935289 -1.0778331425425795587 0.65536644516859343668 0.083209933701152330454 0.0076352956562739642682 -0.05242195871260683232;-6.7969619734732829031 -0.88549496428188156916 -3.3159138607137927934 0.022271446691474211521 3.4518283249133552282 3.6587885010076641734 0.83242351806421377436 -2.5409082865149938968 -5.7761006832563328572 -3.6465594380244086281 -4.0340584667601877555 1.3612420415571915289 -4.7182227495736617229 -2.2030553233559784232 -3.327223536873935128 -1.6554033116283375371 -1.0746150438579622488 3.1849851526378660793 -0.8306369473340463605 2.9890823770334313814];
  
  % Layer 2
  b2 = -9.0696115444003897466;
  LW2_1 = [1.4678885406794126567 -7.664372743421333567 4.1354401247188148361 9.980311982704927587 -10.785981204966228475];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

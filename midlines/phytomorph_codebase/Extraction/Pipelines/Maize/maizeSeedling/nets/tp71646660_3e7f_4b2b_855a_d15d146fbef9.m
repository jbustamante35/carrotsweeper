function [Y,Xf,Af] = tp71646660_3e7f_4b2b_855a_d15d146fbef9(X,~,~)
%TP71646660_3E7F_4B2B_855A_D15D146FBEF9 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 29-Aug-2017 22:52:04.
% 
% [Y] = tp71646660_3e7f_4b2b_855a_d15d146fbef9(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-5466.61789079662;-862.937878923586;-1028.71862143181;-451.710971542892;-692.538815519998;-441.043793232209;-783.667639824728;-311.950474474657;-656.555828069288;-416.411813428023;-256.518565057561;-259.432124024285;-384.146123020651;-202.979007080791;-233.266353450961;-302.321350914799;-296.419908591235;-191.974128700838;-174.982344511244;-155.930294068902];
  x1_step1_gain = [0.000192953812201725;0.000635170113819406;0.0010737117105794;0.000992967389065706;0.00140247416929523;0.00179426803546527;0.00152094087103248;0.00262475201653714;0.00199415494766509;0.00251075910029922;0.00454433874041207;0.00378662000738684;0.0030223773794896;0.00448879604138513;0.0036608073346036;0.00363057230533698;0.00381924645546809;0.00427537582274537;0.00592120551781335;0.00602422138644178];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.4519018908624181652;0.63037191835921946304;-0.83719851382224996783;1.1974115839986994025;3.297803890971537033;-1.53290647766685173;-4.4692866101462049855;1.3052210830398247587;1.4116122060091869095;-2.2003267627425056041];
  IW1_1 = [3.3830204233362319854 -0.69404505306706310019 -1.8115420343852570717 -2.7771417648450524851 1.8736036538900440185 0.22650113199122354213 -1.024976099789779882 -0.33026038563374693346 -1.1483973435419836395 -0.78220946861605800127 -2.0572134889293334226 -0.9724689602069581662 -2.10061309704937349 0.5652554619938381375 -0.74189774494732851906 0.29072866740970526589 0.20781227128543153237 1.7570191500292404729 -0.24496145620208389926 1.0508843900770248325;-4.117125999223604893 -0.25943695647519449121 -0.57356311349830180202 -0.70189532523090092386 -1.3968742032752463622 -0.06668361229476192642 1.1373840917122450822 -0.44362823719685001711 -0.41508634595006771439 0.45318685423683252589 1.0237391191369291654 2.3811329883894747361 3.5700523131744339445 0.30669190001816276636 0.27318451662354820142 -0.094628945651952553475 -1.0912396502063830273 -0.43935466502732500871 0.4255962749133331835 0.75827041476146628263;3.3635395837568804467 1.8033487409158273085 -0.12240371701985806874 -0.062237641628233156266 1.4683949639854743108 0.68874987634535211889 1.4679901661675951452 0.76992084026930207585 1.0186655133540449825 1.1181697208084957484 0.68953834561966065309 -0.37405128079022298415 0.039212620728112365653 -0.061647295883641407832 0.60349591330287655211 -0.97418908999157793893 -0.13721141965480085356 -0.12630431536375669177 -1.3946610618450256958 1.0573909559302767658;-0.59456140634038057158 0.1672360031501687605 0.16627499974540613237 0.53736024487129452343 -0.71296973101646510251 0.11414997625346118282 -0.14954010033694073445 -0.24207048456526703006 -0.2101623942034681336 -0.076319583203994525999 -0.20420269617614114632 -0.47959185579221869089 -0.22819202070556626749 -0.24867589416789528944 0.057474054163853260935 0.40097790761538276705 -0.13477908278207592629 0.32857379525847185686 -0.65221534517319490476 -0.082649418723019923982;-0.93392268166872061119 2.3794706174837338963 -0.35801949357682416597 1.0210341657309531804 1.1044826649315924172 0.68592718649015915755 1.5028273458529097795 -0.49762112943672731635 -1.2731204087570224814 -0.96108375511178034678 -0.28644511023966962027 -0.19242618900892635714 -0.61897752574584230523 -0.048064239489663679317 -1.3794932540571764878 -0.043531529903604919418 -0.4181786094582448654 0.22911366764826546216 0.16108520692610595049 1.1936745271149793446;-3.329579957045763372 -0.63243513080514601743 1.2325753572796243063 0.69315375369774212544 -0.49499038898927172347 -0.46202018948950418498 -0.32236711657327332681 0.50702744587203929516 1.7767874616005985278 1.0698357740205479693 1.8681767561148749923 -0.41865665157786163819 0.86769839989508723566 0.43442736810144427784 -0.0056072456150414494783 -0.60869703549231235495 -0.17305371897147950322 -0.97741534343479341551 -0.66902910199317267015 0.74748736401493209858;-0.54863056897503015286 -2.3608930151187146329 2.3663688387703603055 -1.4297599109129377482 -0.17273155697763331595 -0.71942953401167997196 -1.4723739774781763323 -0.78581578930153306306 3.2795485238792179139 2.2471223363812589113 3.9623392714771852319 -0.12793858436206592688 1.5207598718599202314 -1.0398008650215462279 -0.54661739719770796597 1.0113336089753541813 0.5921179501571574022 1.3574497135364840261 -1.556373815261240301 -1.1606212725443580958;4.8824561143884297465 -0.6544261846515310177 -0.61553601783757205812 0.46103083024329322148 0.069774389145400225742 -0.85272811480475529944 -0.17294823753260740729 -0.21898719980681582986 1.0188747840259420041 -0.84631696757143415333 -0.19217955690834717664 -0.27738952854209658616 -0.33140619559236100811 -1.1850089967843453476 -1.3922914076842352049 -1.0719425582155699406 -0.52614678473642007006 1.2071616730956891139 0.39831772207929777574 -0.7026967622846890249;-0.22049530506273595787 -1.2647931985514211384 0.77435464739570325499 -0.24438620670255917222 -0.92131623654882954799 0.27846196596939620793 -0.57584416305651209278 0.046108030493715645992 -0.2370984224018269082 0.75380039761144046473 -0.86568603858005210849 0.1356037530946960501 0.26144349524141013985 0.006526670274941489755 0.39109449914263255677 -0.521373410342881205 0.65750840560020573644 -0.089698339796753304154 0.31477992309461988452 -0.26025755628938046504;-0.056274098077199623258 1.3223430966424971622 -0.2308062048317492676 -2.2118674521310079939 0.092992707004981078889 -0.4599125702146345529 0.94568869693325086079 -1.2535432144080929096 0.17666197023049073911 0.71878008875996790561 -1.8011578562123853331 0.60788705703953449522 1.3765640588743974781 0.47111276343153968282 0.3420986562298561906 1.116780625220092471 -1.0628558202935134425 0.72692892799582364827 0.16565117664906289785 0.67607076360348217214];
  
  % Layer 2
  b2 = -3.3713488796742208109;
  LW2_1 = [-5.2109547643645912629 2.210669437861933595 -1.7281814444761569582 0.028075455575296739963 -3.493866938028772573 -2.8574388838641908706 3.0324266559842398827 5.0842721723053267979 -3.2238225326253893144 3.7134112147388407266];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

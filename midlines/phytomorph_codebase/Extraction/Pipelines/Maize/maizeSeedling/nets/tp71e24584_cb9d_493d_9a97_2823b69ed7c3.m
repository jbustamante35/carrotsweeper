function [Y,Xf,Af] = tp71e24584_cb9d_493d_9a97_2823b69ed7c3(X,~,~)
%TP71E24584_CB9D_493D_9A97_2823B69ED7C3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-Sep-2017 10:44:26.
% 
% [Y] = tp71e24584_cb9d_493d_9a97_2823b69ed7c3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1710.79601884287;-2767.31086728677;-925.675633657013;-538.973276654918;-1115.63541033651;-861.953076142281;-996.664725988396;-421.625702789095;-721.55388528655;-557.274532479555;-502.132109545501;-541.944235264836;-462.745727182153;-167.207345824921;-344.528961662829;-294.4017764027;-341.632557540965;-285.680184537945;-174.294824484565;-303.609020442399];
  x1_step1_gain = [0.000202107905561193;0.000554219398814733;0.000742185534904078;0.0010185341647551;0.00103332655312913;0.00147681597144007;0.00118221307527392;0.00265958726683848;0.00125235891924472;0.00165285753178002;0.00232860128237173;0.00188013184297677;0.00198822427969295;0.004799680823278;0.0025204716922513;0.00363117206158383;0.00272984263620499;0.00383651951608922;0.00502254586493017;0.00330771328744504];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [7.7636960306058462322;-1.9959763465576449981;7.398083827554819969;0.88601721527113275201;-1.8564018529747365882];
  IW1_1 = [3.9797855771175290052 -2.7261231842065267728 -2.3351270057345208109 3.2780805904448659938 -0.48322666806615788282 -1.3470952678106651312 1.4208758773422491828 1.2308072789634709743 -1.4162063262423041365 2.622219283506910692 -0.12537182605403562885 -1.7906931029549855161 -4.494286529415725262 -1.8339989391935598295 1.6346693280204631638 -4.8605466471744653845 4.3099811126256595273 -2.6166170818027194578 1.0020884399266181131 -3.0076959867545789429;-1.5833679958820510159 1.6081365738593771386 -0.68386628617800626628 6.0243532702515212307 1.9892339872448880911 5.0893650988432304061 3.2158431473394348821 -1.1580714586873985805 0.70652755217120033482 1.4555400339363446793 0.049051727135480005515 2.5652041812231161089 -1.7239236980214514006 -2.7735161842138498223 4.3921433762885877528 5.5626713534057019572 4.4093583399339095763 2.5547050235994785972 -0.30392522220574014202 -8.2049304819377049114;5.5655678333621301235 -4.3522806732559091714 1.8995499996948461696 1.9038634946330765807 0.090750515986497734544 -7.2054838360092556826 -3.867320587772377305 4.4209797576050533507 3.4819046228774173102 0.46768672797909777161 5.1803663612950652251 -5.7447182745159581785 2.2530845441507070248 -4.5600687006550471025 -1.3163872673545344849 -1.2097075550571243507 -3.5026373982223675263 -1.1037864130175254473 -0.30425219679756276836 -1.9620434839352358658;3.3133642440318942235 2.6177842739728318655 -0.97514544304343120373 3.9102258447879396641 4.821273805034042681 -0.96306987303686242274 -4.6328376897402741008 2.4094508633009610321 -1.5231410208625133507 0.58093494861681105323 0.65506433259194718488 -1.5587905136985713561 1.0783346216916991356 -0.43112514138965729593 -6.0450690320661770727 -7.2740072840125966636 -4.9680785942895591134 1.2340439615786280569 0.32612715369478012528 1.4446235493761308;-0.34655962843636867188 2.0232454058427955523 1.5052222325809179182 -2.9607675247610649727 -2.0851907001343348291 -1.6625504871181360222 3.1013300016371410095 -0.003226705087550976736 1.7458233700745580119 -0.68234490945366232939 -0.018131502405130166256 0.90409183701515161147 -0.68575510190376864905 2.8629386700468884008 -2.3993879445082213486 -1.441207234502112966 -1.7317345730659492453 -0.52475788607036943922 1.2966916528866616609 0.43938115686040041252];
  
  % Layer 2
  b2 = -4.5428090094698259094;
  LW2_1 = [-12.430107124666887941 -10.000473068528185294 -17.248138730968847199 16.260569877473326272 -6.2033819941804937415];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

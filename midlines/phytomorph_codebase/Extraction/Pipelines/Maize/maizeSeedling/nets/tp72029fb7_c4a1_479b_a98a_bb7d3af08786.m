function [Y,Xf,Af] = tp72029fb7_c4a1_479b_a98a_bb7d3af08786(X,~,~)
%TP72029FB7_C4A1_479B_A98A_BB7D3AF08786 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 01-Sep-2017 00:15:57.
% 
% [Y] = tp72029fb7_c4a1_479b_a98a_bb7d3af08786(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-5466.61789079662;-862.937878923584;-1028.71862143181;-451.710971542898;-692.538815519983;-441.043793232211;-783.667639824725;-450.026271289923;-656.555828069282;-416.411813428023;-256.518565057533;-259.43212402426;-384.146123020685;-202.97900708082;-233.266353450965;-248.555985162481;-296.419908591319;-275.821003918877;-162.786711803963;-176.062817024355];
  x1_step1_gain = [0.000192953812201724;0.000635170113819407;0.0010737117105794;0.000992967389065699;0.00140247416929524;0.00179426803546528;0.00152094087103249;0.00262475201653717;0.00199415494766507;0.00251075910029921;0.0045443387404121;0.00378662000738719;0.00302237737948955;0.00448879604138587;0.00366080733460359;0.00363057230533654;0.00381924645546845;0.00427537582274418;0.00592120551781367;0.00602422138644298];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.6493420864824910321;-1.3370729436211008512;4.7201907895128858428;-1.5844530254340567499;-0.037922792275896864689;-4.4484406518479282511;1.0279504910591177325;-2.386678936060967704;3.6691851134339312779;0.15787571471463507367];
  IW1_1 = [3.0604909340046928534 3.0888048306503983476 3.349893820705580616 0.92652030852530586902 -7.067365574594084876 0.35798332208111138808 4.4857848474123835913 -1.8597879995583617152 6.3018170602226133425 2.1513458808386940468 5.4822881480331426829 3.7360078260794673533 6.2490437174963995304 -1.7557599612157710478 -0.40162662803234883135 0.6015157052406283622 -1.0923788676883054993 4.1649092610043965124 0.69390189085262332647 1.3321943063568637555;-4.0444244676865537258 -0.35584759045789221554 1.7377502327855824937 1.8981861551008176736 -3.3346847882580750166 -0.47653970153266245191 3.0697895318486527749 0.11499024184026961082 1.6546715848125510551 0.28656555398611732732 4.4410559746802169556 2.3066320775683677446 4.0618966694783749105 -0.77232838067426679007 0.24036553559879084152 -0.63311982860191962086 -0.096215032133210337539 0.10950182721282555875 -0.70036143834321651358 1.0583953852065199897;2.2800750304613064401 1.2973672780548237693 0.10369364784875581553 -3.1161471642562883488 3.1933578462709260037 -0.48071376378851071731 1.4747333861419693601 -0.77288333298011435701 1.0610372012851960744 0.12172659687375103621 -1.0027109616898939315 -0.17230516304535284378 -1.1118914870624301283 -0.20508385783376734124 0.86039826869860747127 0.32864637106654520649 -0.10432966164585501245 1.9539692663250056714 -0.12412413449120625331 -0.78117066198530538124;-0.37198961558862175814 4.2349598193957316283 0.24210639073179721081 1.6648046020940960865 1.3686656064869167082 -0.71292907857250831238 -0.86488374610656382213 -0.73324011646791742436 -0.7489289647781828263 -0.25595765703923833989 0.69474069869316690262 0.94558485450147145013 0.46388347611937152948 -0.071078823688321690621 -0.057965983780844262951 -0.4723535703047813672 0.0084658570668203082105 0.602783635789309713 0.12769632169941594335 0.29308503023296383905;-0.76867231214625841851 -1.4371119812087096435 0.60803712598775494502 -0.67888402265153535708 -0.7035963238488616156 -0.22868840325319120255 0.095557969690542171604 0.67729001652653242349 1.4296456811101672102 0.46657611638000390242 1.4139887633666308187 -1.0495085511318749116 0.12994379062504654576 -0.15417032613674680475 0.015967612241208722218 -0.76122022885163098671 0.77090561986255889959 -0.048630836946740751969 0.66604271582167084986 0.66327702722015013936;2.9387882469154167353 -2.3057451589328814556 -2.5313709900569145717 1.1253002390260680166 3.0488103989103878533 1.8571934004827592712 -0.2741146192451639485 -2.5043327495215579326 -2.7716161485726322766 -0.75978183142545085982 -2.9720614692041578131 -1.1904872181631729333 -2.65436272312441357 1.0241290514673082601 1.7539365001366984398 1.1869485258025933572 -0.91750409325356629964 0.50435969129284874413 0.68484134148565511957 -0.46987336854488181981;-4.9562341012206578839 5.2403863005797353125 2.677568123393224031 1.7195109390071694477 -4.2260584930917231006 1.3147269780327428546 1.2447054189601169938 -2.1387604310373662386 3.4976342567820557505 0.29032906600686830823 -1.0479732994085990683 -0.7852563228337799961 -1.0483719222113845326 1.3878911791006958154 0.92854103006754373784 -0.032255822172259342173 0.69002636475196388322 2.6430350211998514531 0.75331303371929014823 -1.9819139483388530376;0.21904716510900035242 -3.0920653509297744144 -0.018448893898587746809 1.0645076645448743324 -0.35353074047795290946 -0.10610637544538306654 -0.40597530769061307421 0.048049173705223970077 0.26775335906340935743 -0.13138857863970448969 -0.297030603980534047 0.31330904570698331346 0.54949227563143676623 0.25917506146175667281 0.1191685280515720341 0.14421454829870836156 -0.23898881662140983306 -0.57691085994473922938 0.23288967386688430583 -0.15740518103989262211;-1.2153078704540885013 6.2379116084636248019 1.0428116253230845789 2.5611369305704370092 0.64111067482844996679 -1.1098020270268631471 2.0088731881082004804 -2.9930734945225405674 1.2530262601760371322 0.012481707760380267302 1.5036429932256463182 0.49120621688851240361 -0.48124120063546443893 0.92062644973808283044 0.52732609469066105135 0.051138242197242625431 -0.6406768448645850933 0.88631511882707214589 0.42188480341132506002 0.38676358647362879539;1.7671693701288495593 -0.79635685030130787254 0.21697909803331338896 1.0719740975718914378 -0.34944815488737313025 0.43900807693154803024 -0.45760478784397601304 1.5263576959320694915 -1.1636424781008161133 0.90393685996890493772 0.36138698834548599326 1.5027154471228569843 0.74214563269480704477 -0.55496827755194511056 0.64794017934476155762 1.5500255498115336206 -2.0480442600775878859 0.31980721488484831205 -0.67948063926834256776 -0.79727827746441892742];
  
  % Layer 2
  b2 = -3.9093737838140132368;
  LW2_1 = [12.648942515403023279 6.1797196747900207114 -4.3128450065996402074 5.7255851587677062398 -2.8422029060979876469 -3.3473672434496948291 -6.2643795966267701303 3.5413623169067838248 -8.0601684921851273202 -2.4434266221279559161];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

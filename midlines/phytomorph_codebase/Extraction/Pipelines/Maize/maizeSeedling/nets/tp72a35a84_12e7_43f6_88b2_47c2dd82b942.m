function [Y,Xf,Af] = tp72a35a84_12e7_43f6_88b2_47c2dd82b942(X,~,~)
%TP72A35A84_12E7_43F6_88B2_47C2DD82B942 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 02-Sep-2017 15:15:23.
% 
% [Y] = tp72a35a84_12e7_43f6_88b2_47c2dd82b942(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1425.12385949519;-2639.1224350771;-1040.58146532707;-1175.93373113978;-1366.53951203701;-713.224898465736;-638.058802539165;-604.796304556691;-546.419507096567;-435.830146318439;-311.040988170573;-332.822721465589;-407.901071240812;-237.143827584629;-310.614407522923;-284.621358963185;-348.992764796108;-137.27122552935;-220.006532848185;-217.514535510761];
  x1_step1_gain = [0.000226370837385414;0.000563347828528141;0.000948114745185449;0.000858032283205083;0.00073024238319975;0.00151716399266529;0.00146770964020618;0.00151546500149801;0.00206494173697172;0.00202475070577016;0.00326439309746545;0.0022999722951874;0.00248425272472336;0.00412752991038812;0.00322794766513111;0.00343797851616051;0.00328303385537599;0.00723300236088621;0.00445727486740885;0.00407527899100746];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [2.5995218455450239681;0.69345340977335889754;0.27121028613191383583;7.0716503362160807455;1.538514570509761592];
  IW1_1 = [0.39753651309285698012 -1.6753552034760481604 2.4873734768160136177 0.94312661533974284644 -0.46805385351409023453 -1.4950653617938405304 2.0148531952178014848 1.3162615137801083609 0.39382830867690121757 -1.2084733382334773566 -0.91147201618007778201 2.0581223023918751025 -0.7953155633113286882 -1.0035618073398075989 -2.0023380318772558972 2.3636945405439946377 0.033517017545754743124 -0.33408798782378862358 0.74144853615614636499 2.8975986552672385876;-0.57201930059056316225 -1.3654405815218679798 3.0536312665504707908 1.6945877681841634566 -3.2616969988289357119 2.7504112212805913451 -1.643220084944781112 1.8310172651502036878 2.1272241747932150169 -1.9486453620651513763 -0.43528341985672097669 1.145396870726601124 0.28105583579387477533 -0.0077836983623848846059 0.44977199778896792548 -0.56255725255063004919 -0.050301503632458451076 -1.6665136166861076461 0.010101067141836478358 -0.15943070864303754419;0.017633079830959658141 2.3318259386122885957 0.89776045353757893963 -2.1356806666029788389 2.9634341144711435767 1.2680075514219615318 -0.12089199678022008455 -0.74576467054344097729 0.11926665470690429871 2.3405634210186034849 1.292042644955398556 -4.8946314505840344822 0.9402866354006662597 0.33066982036392983391 1.4612994198513478139 -1.2519440508420407454 -0.30239803912765661487 0.62463258072146743416 -0.0033949476281939861347 1.4167971154954179802;4.0866408807782494961 -12.477042461614670898 0.5339932717994023692 1.5577443920037679082 -6.2631406230234052401 -0.48297892894265337382 -2.6544208266022017995 -1.5948491506107207449 -1.8824611556689454517 -0.55735258873142279334 0.36767011903758245461 -0.85921311968249414193 0.31702923117133857689 0.34251916252121583639 0.92487203234409587349 0.319834066318180954 1.5029605198384958786 -0.38264687883220760423 -2.3134482584937505756 -1.8504043879598954803;-1.7658683562962789182 -1.8839370902382357453 3.4832821523366317429 0.7232882926140919988 -3.7673285532318985247 1.0463013152477347312 1.0291876241626207733 -0.15504066749152975446 3.9491820173468679123 -5.2166153861680433224 -3.3347214017898751948 3.9828504459204885357 -1.3145306500701841035 0.047113483678781341302 -1.7828507177866432798 0.77098926378781551527 1.543167221330051353 -0.26195197535922160048 0.19435416956524856347 -0.86181480067247162591];
  
  % Layer 2
  b2 = -8.4935619701330367093;
  LW2_1 = [7.1175131082265874483 4.9286028638423422521 -8.1032384003684061469 12.660259708121115452 5.3636068513161037075];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

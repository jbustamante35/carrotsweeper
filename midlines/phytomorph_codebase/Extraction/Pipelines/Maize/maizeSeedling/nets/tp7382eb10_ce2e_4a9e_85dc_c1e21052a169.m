function [Y,Xf,Af] = tp7382eb10_ce2e_4a9e_85dc_c1e21052a169(X,~,~)
%TP7382EB10_CE2E_4A9E_85DC_C1E21052A169 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 04-Sep-2017 14:00:08.
% 
% [Y] = tp7382eb10_ce2e_4a9e_85dc_c1e21052a169(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-5466.61789079662;-862.937878923583;-1028.71862143181;-451.710971542897;-692.538815519994;-441.043793232209;-783.667639824725;-450.02627128994;-656.555828069295;-380.160028036833;-256.51856505757;-268.743398235237;-384.146123020666;-202.979007080821;-233.266353450981;-302.32135091499;-296.419908591419;-191.974128700874;-162.786711803935;-176.062817024332];
  x1_step1_gain = [0.000192953812201725;0.000635170113819408;0.0010737117105794;0.000992967389065702;0.00140247416929523;0.00179426803546529;0.00152094087103249;0.00262475201653709;0.00199415494766507;0.00251075910029925;0.00454433874041179;0.00378662000738699;0.00302237737948961;0.00448879604138472;0.00366080733460373;0.00363057230533587;0.00381924645547093;0.00427537582274444;0.00592120551781375;0.00602422138644329];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [2.1214109730083636762;4.0365758874316313154;-2.4869783328669612388;-4.0949253473931905845;-3.0729508766172664025];
  IW1_1 = [-0.21629848003659518652 -0.64642876102612789602 0.80004329039684352054 -0.24090702650720030586 -0.40044071890759375121 -0.51010862964363190564 0.37582592090108823957 -0.32062498337195088904 0.25298112211747647571 -0.068859506097372708 -0.047456244876173073188 0.10622515395549129991 -0.078253334141884248187 -0.35889856510947176771 0.46965827840138163474 -0.46044444725623706605 -0.014245082951575289976 0.12660792682213339866 0.31497219484304816994 -0.23853789070121039773;-0.16095965874054946054 2.3153073079985739824 -0.14028866603087949971 1.7635710268394497735 0.50325501359515179001 0.034196372944824318663 0.39883161553837415125 -1.3599754244228969835 -0.29695256733808117477 0.63064034266767010628 -0.62268656172345049349 0.8309101690403217777 0.072477884381726573326 0.79057760999199411245 1.453390364718164518 -0.07403013161440191725 -0.23067524655456927984 -0.93676309925602774253 0.6914402541512295608 0.63063859009450062842;1.3338545418895577654 -4.9910982349163237615 -3.0834073149418399495 -5.4222181086179315201 4.8844079791651315858 1.3673326047551002116 -0.95240910720594795791 1.9738587902655804207 -3.3900785191698097343 2.6465443082873472136 -0.55159645401083501337 1.1136128203257564806 -0.9364958879521145807 -0.41194611864018648717 -3.4780290172316923325 -0.87340131801231457587 -0.77402268367926263526 0.94031433697683663997 0.41996885943655215545 -1.2516316861009504358;0.46116347600922485972 -2.5180808392873066381 1.4452992068999244157 1.2887339987477581804 -3.7441406633667067005 -1.7234470268725079478 -1.120937566700200394 1.5264546783972030575 4.0354748536712854445 -3.3157890357600345865 4.0396057270083991497 -3.0193655985412366505 5.7071644297924937206 -0.44069227310968950295 -0.36580858774189622951 -0.56351859447202434783 0.8526589929893451103 1.1214496503620428047 0.41785315729438560206 1.1029486226176123953;-3.620252486910281231 0.76811122655874830567 5.4614890495635934897 -0.57558341320513328743 -5.043210354891520808 -0.79983812414612198705 3.241619747443359234 -2.5098627542732332429 5.4165239155755395828 -1.9040676167961538834 5.3510981129536778766 -3.9245296302430725532 5.6913455721008023858 -2.9753657181962362976 -0.19115756149993792801 0.33478903367047774253 0.23063891678131462348 -1.0040168501831159276 0.26215025970326838456 1.9483187570649835862];
  
  % Layer 2
  b2 = -6.2257116951733282306;
  LW2_1 = [-4.2139538934190641228 -6.393967284585049704 12.528976924147912086 7.3816651861128423917 10.946561748812957404];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

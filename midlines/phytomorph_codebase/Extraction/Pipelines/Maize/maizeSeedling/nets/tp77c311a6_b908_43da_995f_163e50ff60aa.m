function [Y,Xf,Af] = tp77c311a6_b908_43da_995f_163e50ff60aa(X,~,~)
%TP77C311A6_B908_43DA_995F_163E50FF60AA neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-Sep-2017 06:00:56.
% 
% [Y] = tp77c311a6_b908_43da_995f_163e50ff60aa(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-3963.72731634938;-1752.79194273021;-1612.14400693261;-780.471896742374;-460.20555521635;-234.310604878461;-540.291178237133;-572.14271553379;-192.819908210793;-263.800490630848;-210.820779921776;-212.78401520665;-286.590370604325;-169.741999038737;-271.750472270931;-194.470619647336;-373.104709120357;-213.719449945758;-260.914631799829;-176.115238468631];
  x1_step1_gain = [0.000342540442445781;0.00027748074658588;0.00080601324116702;0.00156677380853905;0.00168393926281428;0.00269046527889069;0.00198084992045411;0.00236361816544283;0.00245784730269614;0.00195235680232595;0.00282106579415899;0.00424658079482959;0.00317261769260758;0.00555458687461901;0.00429724736478088;0.00484270636687456;0.00333931608099053;0.00598913897545103;0.00384783002604042;0.00642488839732241];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-2.7731210120188043433;5.3140645171016078763;1.3114904616895066702;-1.7372323051360731849;-1.8216411511311687565];
  IW1_1 = [4.6437294930772576862 2.2536946157297372828 1.0567679543167618483 0.47422173384738403046 -4.1932825606984698297 0.23680328560484587008 -0.082930308459742210769 1.1559903526381132277 -1.1018068935676461617 0.48358472157977322459 -0.4055475760986988476 -1.7055448356420874756 0.705594183498072125 -1.6065338495584020606 -1.855738519514975593 -1.747156016431546055 -0.55522745326068856375 -1.1191520658791729304 -0.87048544518506165701 1.545734527506913647;-4.7867897843698941074 -5.4836441345715689621 -0.41389268752479108082 0.39207907843216704968 2.2741551357482725493 2.3121667381820896203 0.33378420556257676344 -5.3054822205070939489 2.565851214708787964 2.8056310107991437874 1.394211198205117741 0.27936536710005754891 -1.1469763603954483688 -0.41591032956208395799 1.2550572214393658221 -1.4444007303995662905 0.61190829427102544358 0.88913450673892657772 3.1641335001002248717 -1.3275679889392792976;-0.36445665758237760778 5.5408618780442395746 -2.447815464144388109 0.10468942603175282469 0.36275132896082795675 -0.64020235198371366891 1.2176253409722086474 -0.46162789178034474569 0.94430334580785268983 -0.032432364291485792085 -1.2997837748326044327 -1.3777631919666921689 -0.48648532083285012106 -1.4399721935776810255 -1.4439177001794958333 -0.64456279893956713867 0.69226737362595647252 0.86132180416219483732 1.0137339493661978729 -0.040562874156978276363;0.2436104334887413958 4.842401831395355849 -0.87405648888937681473 -3.1017772598341637469 -4.354428567590903576 -0.50266948012276635449 -0.58607191337062169989 0.90524861393909672458 -0.26293301348840220077 2.4381995702135532689 -1.6808853673412320617 -2.4913043567259065547 1.3029622029545078199 -0.23519341229541171345 2.9354075962097985197 2.5164963821033419222 1.4839663098488435899 -1.7977435274194686343 -0.39107934984499109765 1.7357195186201994641;-0.1564941849111191885 -1.0788150738440798193 0.012772479130478917378 -1.6278922187624103035 1.4790731706360931152 -1.7930848264886380949 -1.3746588075698944476 1.8181591261941065785 0.82655743252638291807 0.0057761681881911535602 1.1018007545050674256 -1.5180133586318793615 0.51911528500757353477 -1.5175385747728680208 0.53116937447868450839 -0.31750399336180429311 2.3766563336152732866 -0.70248313244951510192 -0.65881710543446525552 1.0025289323916197759];
  
  % Layer 2
  b2 = -5.2278475985867780551;
  LW2_1 = [-3.7516076114218237514 7.7404071832589069757 -7.8710812207503231264 -6.9405586094480336001 6.7889784131035986192];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

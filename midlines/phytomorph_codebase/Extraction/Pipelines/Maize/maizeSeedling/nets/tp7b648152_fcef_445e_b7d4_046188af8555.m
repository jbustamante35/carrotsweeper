function [Y,Xf,Af] = tp7b648152_fcef_445e_b7d4_046188af8555(X,~,~)
%TP7B648152_FCEF_445E_B7D4_046188AF8555 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-Sep-2017 14:33:50.
% 
% [Y] = tp7b648152_fcef_445e_b7d4_046188af8555(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-839.604414481266;-7316.69285265059;-873.097427232646;-1646.05375716081;-423.333970720151;-346.884767278007;-410.542636124641;-168.317352166517;-564.25010332582;-280.547165434108;-739.082929249927;-246.980329538407;-418.782145732614;-134.941855531047;-141.91034671114;-156.623146275719;-114.307991853881;-147.229750402511;-715.253580950884;-451.498000640018];
  x1_step1_gain = [0.000435258359298379;0.000254266760874674;0.00034735300303884;0.000777513986910238;0.00172505617054034;0.00206247464333954;0.00302249934878053;0.00323098252238331;0.00220614635584282;0.00242812082773069;0.00231897377235335;0.00407495867726201;0.00341201206501331;0.0055137841597171;0.00648970220781235;0.00620026189110789;0.00633602455501933;0.00774864116843163;0.00243421857993277;0.00313801600663384];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-0.59314354055563112134;0.55947198815982890352;1.856238876045919417;-0.58357138125254182093;1.4481163145869095921];
  IW1_1 = [5.8197729721074447085 3.0046897917838562009 -1.3872254861510964208 3.7557947845857122537 1.2462052984191587246 0.78750677937943291962 0.60022180213501985513 -0.78525260889912740225 1.3964409422075900746 0.077679811068104925864 1.0741705103332892524 0.59517039814956651522 0.20419572493386237144 -1.0631792818225132002 0.61689700170449213168 -0.26297980879065330218 1.2882688613459651883 1.4611843782629434507 0.48572892542963214124 -0.25416100488368498223;-0.46269163116397565849 1.0858634758393324038 -0.17866616811052496439 0.39014698290210042542 -0.2519887442376458897 -0.40205465845772891953 0.22963736223458530716 -0.0081973247662478366388 -0.52871849781390301004 0.32288718618405787275 0.036772186976105888934 0.26423863859420937406 -0.15779198472018196586 -0.41420172635134244743 -0.021988150707696760278 -0.21734424777974956089 -0.35925732290420625548 0.31294810463794547895 -0.60502812895717328345 -0.56994035349603056062;7.5459858586844568151 1.9599540181809200767 0.042000331179509242663 3.0608521284970664489 1.3068056338864919574 0.85833423633127936547 1.6447084330157812904 -1.3418666673065307027 1.602442832456399513 -0.7589066482521541479 0.89763336177888120027 0.086722082073904929733 0.19033531597726269236 -1.1210412833002265653 -0.029871412992282912052 -0.11216536220204066654 1.1855774842804149838 1.574561966484717912 1.212099346377066178 0.26843063450823717586;-1.2981038586443505167 -1.0175382599667319727 0.60030116078894812937 -1.6319748432015077633 0.086288389137408952334 -0.48055727975146078634 0.4152411396275146882 -1.0798675851151815497 0.26568519155530784248 -0.31516561468948389724 -0.49263173740160093317 -0.97412561887938264871 0.11971895956383801773 0.22749846232942794177 -0.41493449356820283347 -0.11767415976737879979 -0.52021376195851432023 0.3175724195272415229 -0.43411931905720579916 -0.59369321690837117966;4.0561582702721814542 2.3655792323685234102 -0.69095325001083074401 3.2218371841656199273 0.47905682162859791751 0.56811410673741002952 0.10304793776560901286 0.21449760206179724342 1.0678263165398651502 0.27855605613971096135 -0.39880335250236331746 0.43567712364763150346 -0.14675696930303838705 -0.061457934398663968678 0.12698598220338414011 0.01313770736581766109 0.5711887750828317234 0.24060210120022890168 -0.35796831911307475105 -0.17032951767462908843];
  
  % Layer 2
  b2 = -2.4842915909360518967;
  LW2_1 = [8.7791047546874665386 -0.081522323214427816485 9.4821599528071178753 -3.0638450179961731479 5.9752671886945858404];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

function [Y,Xf,Af] = tp7bbb89eb_7574_4e24_bd97_d7614a8d7883(X,~,~)
%TP7BBB89EB_7574_4E24_BD97_D7614A8D7883 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-Sep-2017 04:58:06.
% 
% [Y] = tp7bbb89eb_7574_4e24_bd97_d7614a8d7883(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1054.92998109303;-3159.48627075362;-2114.78087604941;-1423.59192565959;-885.057943991189;-1580.09594810584;-466.558771320902;-1155.71902109269;-342.4549903612;-680.04022602784;-526.427101249707;-436.274101764847;-275.990547714347;-602.900723427731;-237.436871082884;-373.225105661524;-301.983936484992;-284.873458506249;-290.570400999369;-350.305421104482];
  x1_step1_gain = [0.000201853701047093;0.000358308876895914;0.000501068237842808;0.000831515796852234;0.00087930290309635;0.000967909908790068;0.000979217898324391;0.00108578915137916;0.00217066128634305;0.00165661710022778;0.00119050056045195;0.00160876099240961;0.00270230114420069;0.00170182021982357;0.00262305491334274;0.00249971191480287;0.00300944378896511;0.0035491405431905;0.00406898355464188;0.00313490959585102];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-4.1838349454669776506;-1.5029690000078814727;-1.1053697299266500575;2.1166831345203571679;-1.8019241358916293638];
  IW1_1 = [1.8480970171693062998 1.2149191602649116462 0.69838514951606300851 2.4927540440475408623 -3.2375602678312387361 3.8189955321823401135 -0.16123685867301984498 -0.37476232442038787118 3.8160888404486650316 -0.58137198684399105097 0.63278996465181680531 1.7285205099583240695 1.869273355191080066 -0.94583680389334101601 -1.105407179574967369 2.3548100478240332478 1.0015489128962462573 -0.19581916404223592698 -1.9857141295861049368 1.4954609776842104907;1.8973101829993441747 -0.5465946147550710954 1.9970158566527100863 -2.0338892705217359591 -1.4272986555255480212 -2.949941100276550543 2.9979391659776957191 2.9390103385040311501 -0.82644147732879558177 0.76902414768797933142 -5.1704292407935144027 -4.9968242167780694274 -1.0780113941254760856 -0.21577797229078823915 -2.5292790173480015348 -3.8004823220404100326 0.19549382323714892262 0.048813000068000551857 -0.37574373924529391733 -0.48485767803476437221;-0.4513894140943230382 3.5963061787033949734 1.2002393592672915279 3.2403889631875233412 6.1838550949529578205 -1.8051886763389100032 0.26738254335547934071 0.17407632683653972983 -1.1149428712662337038 2.6032886012609308679 0.20400669290964551505 4.466915184780589243 -2.6814838035115733383 0.86774291760793120787 -1.2486403233791074641 3.0476901605490480662 0.69367277396374249498 1.1601311698006775419 -1.8144850884900072252 0.61262315107261122726;0.27542254688109840677 1.405773838996074776 1.9900692017466687922 -2.8158437374472491399 -2.20216008181285261 0.46284524541479943327 0.78943964130930788237 -0.85373077310297451614 -0.85276890577884734146 -4.5652312340191594231 -0.52233727861888157307 -0.38469627855213728296 2.8640048206886827842 0.18041031597963955169 0.53933869238669229773 3.9258835237308833399 1.8647975133547269877 -3.2181699890584796186 1.1555603110068219941 0.43905930876753607173;-0.028651346865364236277 -0.83724057960860298611 0.33514322768391718865 -0.40915904870814173711 -0.020733399815915560388 0.25230341695877506192 0.4820767808279475819 -0.16940599556181426544 0.062853062853041333224 0.38929571736846968477 0.40840792846728046772 -0.58824408785798432131 -0.031627560289336359434 -0.19695241351524350737 -0.20465611694546326227 -0.21330877296868255844 0.20985752590179637678 -0.58248350737849530212 -0.27066196293150607266 -0.23916869511542734883];
  
  % Layer 2
  b2 = 1.8958312806593562438;
  LW2_1 = [9.0086470625110504074 -10.281385584719094695 7.4952136537836500096 -4.9240257089629277942 -3.0553594504174714785];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

function [Y,Xf,Af] = tp7cbe5958_56d8_4511_a7c9_95c81cc46c47(X,~,~)
%TP7CBE5958_56D8_4511_A7C9_95C81CC46C47 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-Sep-2017 13:29:53.
% 
% [Y] = tp7cbe5958_56d8_4511_a7c9_95c81cc46c47(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-8184.90793418461;-841.368302509967;-925.675633657013;-1424.63292253515;-1115.63541033651;-861.953076142264;-996.664725988397;-421.62570278907;-721.55388528655;-557.274532479568;-502.132109545495;-541.944235264819;-543.177005191316;-167.207345824941;-344.528961662831;-294.401776402711;-391.010406370099;-235.625647900199;-174.294824484547;-303.609020442456];
  x1_step1_gain = [0.000202107905561193;0.000554219398814734;0.000742185534904078;0.0010185341647551;0.00103332655312912;0.00147681597144009;0.00118221307527392;0.0026595872668386;0.00125235891924471;0.00165285753177998;0.00232860128237179;0.00188013184297681;0.00198822427969295;0.00479968082327779;0.00252047169225129;0.00363117206158387;0.00272984263620494;0.00383651951608905;0.00502254586493055;0.0033077132874446];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-4.349311613430421275;-1.7912693229737881584;-1.2129588842689966732;-1.736096835952620987;-0.58132643823197538424];
  IW1_1 = [5.4312958730593470236 -1.5053559920982750864 -0.16842985524951986642 3.0821665263292086223 3.6809809857609265826 -2.0955580594567959629 1.6409131289945813048 2.4960533928289843075 -0.31380469546322981023 0.71073241594519109832 4.958942103043554539 -2.5433872660764600404 -2.3444649240425845527 3.7536208892851039565 -1.8238978302211759086 0.54748712751910832974 -3.2834982137318271533 1.574907098793737692 1.4534746048901940885 1.9412850716550709151;-1.6626782405797699838 0.27160911549755284433 -3.3003567746359014912 5.7883692445640742008 0.25179265780347909187 0.0071688176293403637479 2.089950024018648822 1.1072584402109231227 2.1106751024637415703 -1.5481298717951976762 -2.393924349279190178 0.32414919457471091935 -1.7295899626376887159 -1.0321804878141940254 2.2777191898473394538 -0.60963039036600430443 1.743408385133897065 -0.49501595120015445817 -4.1311468689271668708 2.124796817975398433;1.0498528192904641454 -3.5850298675859177955 -0.93138071227714125389 0.39484254844026678288 1.8808949028374777335 -0.85819073773103682345 0.93027954991457317835 -1.9172779338152019513 -0.5618964230413076022 -0.53930677870455934197 1.144608323370203129 0.53855522267745448151 -0.24862543534346814855 1.5105291836290721808 -1.3414531360245824931 -1.3301237448472726932 0.51910564583301477271 -1.4874562099888901656 -0.1446196518799008901 0.21851702590132557336;0.72162820401505733958 2.731863245026465048 -4.0874853187057036408 1.7660953881934766674 5.0965282407542753518 7.2785561950596164849 2.5404873161679013549 -1.1676803412686711514 0.67315107317353439775 -1.1520868186825781176 -2.4299502242171464594 -0.034102882847481870432 -2.7855174821554231634 4.64097881938871204 -6.3950635439688285899 0.57304413440508450428 2.2207997170624276251 -4.459061839895897883 -0.18644542165884722684 2.3917860844110396812;-2.8392146407525014062 -1.3884264802013934759 0.21612954792358260447 -0.062505887523145550744 2.3324362776164413447 -2.289680967957885116 1.4527355890583966147 2.3096966342305575992 0.87838285458959763918 -0.016975801838244514164 2.9028642235864592358 -3.0457689622520427442 -5.189051723785202519 -0.85942639588875502366 -1.155239627053102236 -0.076556432171711014112 0.38951366044139629219 -1.302847379947589701 1.9145730648374368332 -5.0029618778403026624];
  
  % Layer 2
  b2 = -2.7732878376303786716;
  LW2_1 = [10.41656634707728557 -10.590644344598409532 -7.844962495554955062 9.7024995267198299587 -12.161528169987493087];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

function [Y,Xf,Af] = tp7dffac45_5268_49fb_aea6_3a05d916d2b8(X,~,~)
%TP7DFFAC45_5268_49FB_AEA6_3A05D916D2B8 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-Sep-2017 04:51:01.
% 
% [Y] = tp7dffac45_5268_49fb_aea6_3a05d916d2b8(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1054.92998109303;-3159.48627075363;-2114.78087604941;-1423.59192565959;-885.05794399119;-1580.09594810587;-1575.88755591873;-686.259228054125;-578.923214789101;-527.239355792853;-526.427101249668;-436.274101764837;-464.11941534144;-602.900723427737;-237.436871082882;-426.867092225919;-362.590695988136;-284.873458506248;-290.570400999382;-287.671508962945];
  x1_step1_gain = [0.000201853701047093;0.000358308876895914;0.000501068237842808;0.000831515796852234;0.00087930290309635;0.000967909908790057;0.000979217898324413;0.00108578915137916;0.00217066128634304;0.00165661710022778;0.00119050056045196;0.00160876099240958;0.0027023011442007;0.00170182021982356;0.00262305491334266;0.00249971191480281;0.0030094437889651;0.00354914054319067;0.00406898355464161;0.00313490959585113];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [2.0634507552093217519;0.71362629955094669665;-2.4356132593339019365;-2.9355993095227295164;-1.4022426847006177475];
  IW1_1 = [-0.39115669291505644756 -1.6158587255031511276 -2.1813834436083192614 0.058227817552349847574 0.29464679394183856953 -0.90368044468036567984 -0.053603628532771924187 0.086438947554951309216 1.4711349353729690215 -0.76966802286749724793 -0.14896657734785492821 -0.26123170465730444212 1.67886319384342797 0.7868611207778076766 -1.0946458746783853666 0.3969924059227410984 1.574093729564274069 -1.669187475565070633 -0.29056758439866270383 -0.15350521530880695265;-0.50702961795801715361 1.6710427655673176783 0.52150770760712716889 4.5550890988155803285 2.8206138037532464402 -0.78605694430350181445 0.8447753312150354521 -0.47772267258131972945 -0.81139075444697295048 -2.3368699487475619314 -0.65889019556844230507 -0.68738263103896213302 1.2584799006135301003 -0.075523210298590187639 2.985363178209262891 -0.32816775066653625093 0.81816057782600337678 3.1389435247816486196 -1.7430560365759426578 -0.29527065923459122621;1.5054151176115107003 2.3330823391794837107 1.1390549859018421763 6.4508031795523370633 3.9624690951418855001 0.6821089214810026613 -0.14835818504574316279 1.1299831766873265071 -1.1272867812605193993 -1.9451817169322176415 0.67871728922124663352 0.86784267082389177084 -0.73083816883693653033 -0.038662048260289898216 -0.36000716593627168916 2.7629254889567320674 0.0097785514765030782242 -1.7876772432204979246 -0.38932209932869799029 -0.50743058844278132735;1.4242959857734975859 1.4604533782460829006 1.7280718802416101809 -1.5895864953031400013 -1.1838780117649869705 -2.264937091476387554 -2.5410704759557396493 -4.1774715339541073078 1.207899934245003859 -0.48504252530566605017 -4.2155774807826373873 -4.1233577150371898412 0.997680153498041844 -0.94327372982865864692 -1.6169847149151856947 5.0215118769908357876 -0.51996423769738209231 0.41276196632343881143 0.0035599869667186610778 0.7955741120600865468;-2.2124072308210349647 0.21217434127895867801 -0.77854562980241437398 0.068806085190100549354 5.7535832140663814016 -1.494404535474058715 -0.89507764681295065579 -1.5530400150636169965 2.7952315803246499115 -1.6538873864152039417 0.91015998949717702438 3.2809147878612368032 2.6443027236772671529 0.54723082950003443248 -0.99852513092201966582 -1.8999000821558162944 1.255926377394057436 1.3220263921979495958 0.39967406490816004272 -0.085865684254981450296];
  
  % Layer 2
  b2 = 3.1621918367580974518;
  LW2_1 = [-6.6479155877841407118 5.0505546620571610816 9.4171211151084381896 -9.5228310118543024743 7.5514957052954230221];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

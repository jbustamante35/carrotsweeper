function [Y,Xf,Af] = tp7e1c25b2_5f87_4957_98a4_a2526bb90876(X,~,~)
%TP7E1C25B2_5F87_4957_98A4_A2526BB90876 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 06-Sep-2017 15:12:21.
% 
% [Y] = tp7e1c25b2_5f87_4957_98a4_a2526bb90876(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-2001.76879548539;-2528.40271623793;-1416.92748927618;-923.044887924524;-718.635970677916;-534.736579087549;-636.87763073167;-474.328050496922;-408.756773605255;-437.689914113487;-597.158358369109;-252.737018064958;-357.743301501274;-455.326587536777;-262.500890231175;-420.955237007943;-168.878309979169;-265.923075543786;-279.30601052607;-382.085749121052];
  x1_step1_gain = [0.000250772026915415;0.000457175383291266;0.000795694570296744;0.000975455655635304;0.00136867839470428;0.00177765334299387;0.00147664952758212;0.00196526984478522;0.00211681540578915;0.00191395299404995;0.00213803411115011;0.00313745816598816;0.00239499394158854;0.00262802245354376;0.00340299377226971;0.00307580218448467;0.00420342200465327;0.00353937526659756;0.00305696135696247;0.00320422591704741];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.784507101245957017;2.3390391286093286105;1.0838424016380587833;0.20202695163700373771;-1.1913378850097644523];
  IW1_1 = [3.0471007827596738871 2.8528069755583072009 0.97329557543734357417 -0.01578505796684297191 2.1458214264535162563 -3.6328966504398771953 -2.7840709530275820072 0.73882929011902143124 0.15913751799864445102 -1.5076133496478689722 0.63577287852178310246 0.69924612689198994975 0.54920217944612670369 2.2715901031231866547 -1.8834849312934647259 1.7907174323354413392 1.4576987464147694862 1.9824391906843692457 0.62445270282074172297 0.87556273369418613495;2.7627454166287517268 0.8304711059711694654 1.9791828955825963021 2.1319950066059600857 -0.70121249111663341846 0.2708417289458568411 -2.2517026266150277358 1.3770773709778569849 -1.8449759075617184756 0.7004010600975721923 -3.7563081783958565119 3.4641895729741563059 -8.860314108268767086 1.5998768083279306662 -1.7987847881769063463 2.2214202751710461214 -1.4250028292034879751 1.173367184994371426 -0.53876396308741902885 2.4358240374721100707;1.1181112880757735351 -5.1019172640060235224 2.7131426832000902216 -0.20457885171721484907 -1.6687748516436042845 0.27654030726194533951 1.7467241299645588359 2.2268960015193672852 0.011452705384442976241 3.4284898449389986652 1.5558638734595051645 0.66911555244704701284 4.9032812621813066656 -0.43320665168627325858 0.46140720489953329642 1.3142195848397029145 1.4190336510705248152 0.30442432273493241768 1.3780700142442170453 2.5125565730672079212;-0.82805265830038665698 0.82329354546827360206 -1.5362581216314243893 2.7864468440981071673 -0.55624592285545371162 1.7929237348448936462 -0.75905025572494910779 1.2740703453336836848 0.94063455717887134444 -1.4287465304041622183 0.30066886113336493969 -2.8393249523558856673 0.55726745982432024373 -0.68652470594717740493 -0.58943804212313533064 -1.340238343709798885 0.76728289792019543913 0.28030496535698784522 -1.3365944871475778921 1.0848913563344249056;-1.1254476181708163995 1.2998296509680338229 -0.91004696545180385758 -1.2483360797371385598 1.1122840024208058285 -0.018206603643759838862 -0.48186354858771218712 1.4288885027725155563 1.7628047393138834842 1.0047044297439065019 -2.7554537467976221166 2.035975258483312178 -0.14401804141262111725 -0.45353160653867241603 -1.275704778989486865 0.40628622684980386648 -0.1500701129828863889 -0.11749772527588800419 -1.8734757087145192944 1.5463385241584071128];
  
  % Layer 2
  b2 = -5.8905918841541806685;
  LW2_1 = [6.9411153563262537602 5.8389927593852446464 -4.6026685981480612853 4.6839873678728496387 -2.8290130260853811883];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

function [Y,Xf,Af] = tp7f31d8b7_cd88_4711_addc_439866194f91(X,~,~)
%TP7F31D8B7_CD88_4711_ADDC_439866194F91 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 05-Sep-2017 00:09:48.
% 
% [Y] = tp7f31d8b7_cd88_4711_addc_439866194f91(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1425.12385949519;-2639.1224350771;-1040.58146532707;-1175.93373113978;-1366.53951203702;-713.224898465726;-638.058802539173;-714.930642633139;-546.419507096576;-435.830146318437;-311.040988170568;-332.822721465586;-407.901071240798;-247.407476323911;-308.974324228939;-284.621358963198;-348.992764796119;-137.271225529371;-228.698126275213;-273.249410813696];
  x1_step1_gain = [0.000226370837385414;0.000563347828528141;0.000948114745185447;0.000858032283205086;0.000730242383199751;0.00151716399266531;0.00146770964020616;0.00151546500149801;0.00206494173697171;0.00202475070577019;0.00326439309746549;0.00229997229518745;0.00248425272472346;0.00412752991038797;0.00322794766513118;0.0034379785161605;0.00328303385537589;0.00723300236088597;0.00445727486740895;0.00407527899100776];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.6535699035265447598;-1.7342731573159302361;3.9106586613725897728;8.3920290487182267469;2.0787206245122669124];
  IW1_1 = [1.2255626104408030574 -1.2343469384077512263 0.36492748143028092001 0.42858201871987233744 -0.25917313208508963029 -1.0749080009154428073 2.2084079408423988866 0.88513195337433314691 0.76943584909481910206 -1.7234007956783596871 -1.6473502883078445791 0.96236831648884568757 -0.98228657060064017426 1.4651041669441515758 -0.77454087117822323361 -2.4025029777652928686 -0.83829254478192505307 0.57334003203635275359 0.11100793579445901449 2.2649886805028436321;2.2441783206390417682 -0.57835822949483295385 2.3096673273255041714 0.98037300172205810167 -3.0532101319155917629 1.8475407035355346785 0.22105098962506655735 1.1421577682599328707 2.0308948280240746165 -0.58535063694573619131 0.55710341769168003623 0.41846247458048940748 2.2854391846633528296 -1.1164730761411276738 -1.3086793740613760217 0.075911424200517149674 0.270018332444005138 -0.36639945206393231825 0.46085128536859260029 0.46341991726185632894;-0.0022059436220967232334 -2.8887580160259225259 5.8698745767438209597 0.46643854349496444156 -2.9734122238044768949 -2.4304574374467380338 1.6924480370472734236 -1.6373588794370437238 -1.3121208772247425767 -1.0604220712217331535 -0.48028284702478213353 3.7436668456664401461 -1.932311236026071688 0.86640426515706070454 4.3485345393081109577 5.2853422863137584642 1.7138093038687658431 0.065267682712887756247 1.1871291156996706118 -0.58270661675652313249;5.9052985230976018372 -11.206077520051891838 -1.2176129842291361083 3.6690647294099356657 -6.0406418960866155032 0.2909013668920241158 -2.8676525956089533587 2.6837744352885901655 -0.10890167685716449497 3.2013682135600860512 0.040278606976681986807 -1.6718503447987524968 1.3232262650479245103 -2.4503748338385307193 -1.4776808371603729064 0.46076709999670328877 1.6438657050622538236 -0.71648377230577420249 -0.5514416332308031965 -2.6983854028719362894;-1.5790779003258323954 -2.923573122241789779 1.2761514536910347761 2.193956042381731919 -4.1357131975342396046 0.68807410607895069798 -1.0199429149404608541 -1.1252349763390372406 3.509822799948087102 -4.4551718785987448612 -2.3294311759660537575 4.8931133228941714464 -0.75402540003224527432 0.38380575418543411148 1.1350484039192589858 0.68721228261120237413 0.89670446293002903371 -2.5004198483580832857 -2.069232207675542945 -2.548420190194819579];
  
  % Layer 2
  b2 = -6.4443769572189957273;
  LW2_1 = [7.0701609065193560255 6.7614703019665309824 9.5276858315466039784 11.73138263192862496 9.747196613601644799];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

function [Y,Xf,Af] = tp802b9238_9035_4b4e_880d_df2cb50843c4(X,~,~)
%TP802B9238_9035_4B4E_880D_DF2CB50843C4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 06-Sep-2017 14:26:53.
% 
% [Y] = tp802b9238_9035_4b4e_880d_df2cb50843c4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1710.79601884287;-2767.31086728677;-1769.06834334395;-1424.63292253516;-1115.6354103365;-861.953076142278;-996.664725988399;-421.625702789083;-721.553885286549;-557.274532479555;-502.132109545505;-541.944235264823;-462.745727182158;-167.207345824938;-344.528961662814;-294.401776402702;-391.010406370093;-235.625647900177;-174.294824484558;-301.03830724206];
  x1_step1_gain = [0.000202107905561193;0.000554219398814735;0.000742185534904078;0.0010185341647551;0.00103332655312913;0.00147681597144007;0.00118221307527392;0.00265958726683853;0.00125235891924472;0.00165285753178001;0.0023286012823717;0.0018801318429768;0.0019882242796929;0.00479968082327775;0.00252047169225137;0.00363117206158393;0.00272984263620495;0.00383651951608925;0.00502254586493054;0.00330771328744472];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [6.1132061561699737595;-2.0002822450613981786;-1.6183162761450302636;1.9720067798171576623;-1.606640065395155581];
  IW1_1 = [2.2589850905743253939 -2.6710483474805331028 -2.3746547355388418765 -0.29254148801649948464 -6.2297728418039142184 -0.77672023285916280688 2.8567397247672405847 -0.45159068719089323629 -1.5526495586104460678 -2.6941143154924418468 0.31937863508983416194 -0.99976707905434858414 -4.4870824482176461245 -0.99441445480560897163 3.3648140447214260895 1.7790499561643533522 -5.2830084996958053267 2.0820379546874585586 0.94603199805179238879 0.94594084114507270833;0.65958259062458268751 2.1373646137683590673 -0.72359733859236508025 -3.2078621684016268567 1.4238544166042748085 4.5652307382147983006 1.8879036732056184711 -3.0753008818771023769 -2.1096367845913666095 -2.918967623943320433 -3.3051426585994247986 3.9655573360962086404 -0.50568839451688396558 0.74181704521428570853 -0.50690713841435985909 -2.3438235786982613007 0.85433832729658853999 0.19707901757589063596 2.4343431013816383413 3.4096711670389909798;-1.7631579849787903935 4.4375027430587614674 -0.21324405152087250181 1.2422435499175561446 1.8544757911453273458 -3.1902011188178174272 0.53114053254491577771 -3.2422509222234299209 -2.0953036340663682147 -1.7218793995228269811 1.6960218032547680345 -1.2619463698996491452 0.52259652435851311481 -0.037761348318200139984 -1.2928253623057972543 0.93273347541327467081 -0.82315595084140880111 -0.28120377180957706331 0.047189361260705074697 2.5766167879054671097;3.0842275784362205293 0.48220998802013381734 -0.47004095075216556499 1.0475865580156640267 -1.3762746546544888382 -0.70743162493892985943 0.59978359812048032129 0.86106351387017732169 1.9649023678893167144 -0.35976765768910551335 -0.28173583625746700942 -1.4781379572855177784 0.19146787184768032652 -0.89216659314629243038 -0.30983359318701714225 -0.61351527106551184687 0.51463098679367724753 -0.093436082901901640341 -0.36612813883545108906 -1.077853155520645867;-1.6619510290274752684 -0.77821958389219181296 1.8257703263539626359 -1.2680472086533607357 1.2685915329619430469 1.9404598076159909059 0.29421900497443836953 -0.19511686094338648312 -0.1084952264072121253 -2.3204167036272775881 -1.9197942404310102127 0.49103343352566009017 -0.19320985834136800152 2.6752167812670317737 0.19494583395623460431 2.4365407121828135395 -0.94442863637290574985 0.32885680131714090102 1.8826522862659784696 0.041752804212293041786];
  
  % Layer 2
  b2 = -4.1339600222697594489;
  LW2_1 = [10.740735664145066863 -7.6890174766847501076 -6.5095678820831084366 -13.467778845261074494 5.515720305961337111];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

function [Y,Xf,Af] = tp82096a6e_e0cd_449b_98b2_08b86c19f793(X,~,~)
%TP82096A6E_E0CD_449B_98B2_08B86C19F793 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-Sep-2017 21:37:30.
% 
% [Y] = tp82096a6e_e0cd_449b_98b2_08b86c19f793(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1425.12385949519;-911.082072190466;-1068.86784991252;-1175.93373113978;-1366.53951203701;-713.224898465725;-638.058802539172;-604.79630455669;-546.419507096572;-435.830146318455;-311.040988170565;-332.822721465589;-407.901071240795;-237.143827584647;-308.974324228959;-297.115842301683;-260.199856451153;-139.239122485353;-228.698126275204;-217.514535510735];
  x1_step1_gain = [0.000226370837385414;0.00056334782852814;0.000948114745185447;0.000858032283205084;0.000730242383199752;0.00151716399266531;0.00146770964020616;0.00151546500149801;0.00206494173697171;0.00202475070577009;0.0032643930974655;0.0022999722951874;0.00248425272472347;0.00412752991038785;0.00322794766513103;0.00343797851616055;0.00328303385537583;0.00723300236088673;0.00445727486740898;0.00407527899100759];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.6673786821267349012;4.6003855822104888773;-6.1019895956368719325;1.8907765744890396853;-3.1576970119570826334];
  IW1_1 = [0.64639453779056021965 -1.8994972037186750313 -1.6168086186137780036 -1.2826223748813354586 -0.19051836729942853155 1.144109179788404651 1.2592818867001631666 0.19118752908930114476 -0.90671276520835064616 1.0504333216706986942 -0.092961893875274065335 -0.40232863640423965901 0.28485687788056990311 1.0993540232558993708 -0.10555558788103905354 0.45620815654254082139 0.89742914285490937853 0.079001665723348865611 0.30313938737275547552 0.35975321718472219601;0.68511467792993352433 3.0169403734439979026 -4.8370820292367291415 1.9490426778527041307 -3.3779537152578558157 -1.3785991125170673488 1.5534626819057129055 1.7847156780134625365 2.5384383123915061908 -3.0363554500784895041 -2.5602040014465101692 5.8950000895073442209 -2.1214885374800580564 -1.9206132819583672244 3.0806683947291095826 -3.5215667202227511901 -3.2068603845166121502 1.8942684731874663839 -1.5857915450208583952 1.8774168015745633653;-5.6898359111398342236 -6.198301470643825084 -1.2865805262188547697 -2.2664651258047951998 3.7475413157027799294 -1.7546058027616642239 1.388047086877685965 1.773547910884310852 0.56634088573956364865 -4.9038182886656302983 -0.34444904379832536057 3.4927211274161038546 1.1484331722482619131 -3.0481263686267769941 1.9210666216481890878 0.95725385681889119116 0.71544833786139772069 -0.036406945563401585386 1.3936219217576510943 0.29941960968044495361;-0.80934645732142462826 2.1071406760002235892 -4.9563730984894389664 -0.55684585633749739131 0.54577652294139067379 -2.1181061636129747683 3.0005783730009909505 1.6344194925386117401 1.3968643579156403423 -1.6867669495123003287 -0.75828475783701065893 0.29063621271761802545 -1.1712950424989749809 0.15573071326037571382 0.41455388425036926447 -0.20699288792802394976 0.27804895628999792834 1.3479294974449078648 -0.00015009217357811856577 2.4520065851433194837;0.32397670308195392064 -3.4155707905285255244 3.1836059092666650905 1.5273525790574422611 9.6067230022743892448 1.5656827791456386922 -0.96086794691601928875 2.8796636759863321053 -0.73364778504720296048 4.4202231526689921282 1.4345555291075469118 -2.4710674051629779591 0.13754820381209037494 0.57036504079919947419 -0.54043093164278965812 0.045902803409608339269 -0.52679137661942754267 1.5541126492022587779 -1.4258003301482056191 0.64213833166703981892];
  
  % Layer 2
  b2 = -11.268447287503118304;
  LW2_1 = [-9.2272300902253938659 7.1592809199302145373 -6.7255420889038983745 3.9496426763635916757 -6.4933162387948222261];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

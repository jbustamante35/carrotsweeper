function [Y,Xf,Af] = tp8502d19a_97fa_46bd_b2b0_8a33a6cc67bc(X,~,~)
%TP8502D19A_97FA_46BD_B2B0_8A33A6CC67BC neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 05-Sep-2017 04:35:02.
% 
% [Y] = tp8502d19a_97fa_46bd_b2b0_8a33a6cc67bc(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1874.99930442497;-5454.9153472637;-869.204807020143;-780.471896742374;-460.205555216351;-509.055241799413;-540.291178237134;-572.14271553379;-192.819908210792;-263.800490630852;-210.820779921775;-258.183122033517;-286.590370604324;-190.320782432691;-193.663740648596;-194.470619647334;-373.104709120362;-213.719449945751;-260.914631799827;-135.174215342508];
  x1_step1_gain = [0.000342540442445781;0.00027748074658588;0.00080601324116702;0.00156677380853905;0.00168393926281428;0.00269046527889069;0.0019808499204541;0.00236361816544283;0.00245784730269615;0.00195235680232595;0.00282106579415897;0.00424658079482965;0.00317261769260761;0.00555458687461899;0.00429724736478087;0.00484270636687464;0.00333931608099046;0.0059891389754511;0.00384783002604034;0.00642488839732235];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.3991362369840023572;-0.0035194790648151504792;2.1354881555277342997;3.5989010579068620999;-4.206079284803833751];
  IW1_1 = [-1.3984470443086365332 -0.33528656665744799303 0.67598734591177567221 0.73322681555621904703 1.6626693013262907606 1.5837984478882487505 0.2339900750101052973 -0.17787959278995071899 1.0310010990666720332 0.17772699020214158261 -0.32625515586569286963 1.0235163286330710708 -0.7148113440468917279 -0.16037013026992757991 0.39503677841476048105 -0.71847276547616012454 -0.35766638108094350734 0.2877415028044970069 0.40688441242528933239 -0.34106847478929641637;0.85420078290964984724 3.5815242976165033717 -1.7518731943012249008 -2.7106447074780235518 -1.0853989751370045624 -1.6281984996879046435 -0.62943462499502211838 2.0835708191934982914 -1.6247181994757680101 0.2911006052901958796 0.58882519672624777929 -1.9873548418391888681 -0.80953191532786639151 0.27597180820022665371 -1.480263052269913171 2.5619817450909256884 -0.79088586238705438358 0.45553617115249755987 -1.0532605820417515474 0.0067152793019203023406;2.7389178108978544657 5.0872538315970343703 -0.12128444645202404728 0.97566297212500574521 3.4351922119581268511 -1.1738747995709006844 0.17395910657514443431 -3.527755363217983664 1.0980405817592535644 -2.4949951200528599493 1.8347690507331233523 -1.1127838214381711168 -1.850118900631728458 0.62668422481797003698 0.18200429651111682539 -1.063238645309239061 -0.70868362435386500486 -0.055328104670574695945 -0.66585741831826950055 0.69026016465810402511;4.5389239912470396021 2.4326013125731229536 2.291140711824252385 -0.88455631940793089107 1.7888133246885229433 1.4433079866204465702 -0.6864853232933276761 -3.2914428417052907783 3.2991258109427681333 1.4848305120045566241 0.22035195441654908954 1.0395753109011527382 -0.48319122129034491886 -0.17120053950316518887 -1.2605785377058482677 -1.8011657754550749466 3.2817264805292936103 0.84752019289208124775 0.48582718110684303126 -0.057158685053349256311;-0.54419946367422800115 -1.7407927941321488241 0.17815333283551754162 -1.0921123432707964263 -2.6020649452652722111 0.75001012809826006489 -0.4429818924721559692 1.6298235339851261383 -1.0775730012590321039 -5.2131095220790024669 -3.9216904155963936418 -0.9660079824052221209 2.0557649529006227773 0.0037227505253804461099 1.52866992237489141 0.79132781194233026145 -2.3218420571384292828 0.71255244439057163763 -4.5484855461148949729 -0.017784087726865287216];
  
  % Layer 2
  b2 = -3.0925412993504708403;
  LW2_1 = [-3.464846954275922819 7.5868555616928450291 4.7117995401636267871 3.5951516806351215827 -4.9823483596387561079];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

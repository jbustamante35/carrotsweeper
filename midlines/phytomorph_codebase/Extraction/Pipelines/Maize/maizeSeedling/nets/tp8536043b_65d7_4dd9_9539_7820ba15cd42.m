function [Y,Xf,Af] = tp8536043b_65d7_4dd9_9539_7820ba15cd42(X,~,~)
%TP8536043B_65D7_4DD9_9539_7820BA15CD42 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-Sep-2017 20:52:50.
% 
% [Y] = tp8536043b_65d7_4dd9_9539_7820ba15cd42(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1710.79601884287;-2767.31086728677;-925.675633657014;-538.97327665492;-1115.63541033651;-861.953076142274;-996.664725988391;-421.625702789083;-721.553885286557;-557.27453247955;-502.132109545503;-541.944235264838;-462.745727182154;-167.207345824899;-344.52896166283;-294.40177640272;-391.010406370091;-235.625647900188;-174.294824484558;-303.609020442428];
  x1_step1_gain = [0.000202107905561193;0.000554219398814734;0.000742185534904078;0.0010185341647551;0.00103332655312913;0.00147681597144008;0.00118221307527393;0.00265958726683854;0.0012523589192447;0.00165285753178004;0.00232860128237174;0.00188013184297675;0.00198822427969294;0.00479968082327821;0.00252047169225126;0.00363117206158397;0.00272984263620486;0.00383651951608915;0.00502254586493017;0.00330771328744481];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.4207440174897778551;-1.4353958057674240933;0.13377843554962046135;5.9150422959823520941;-4.6200565217425015874];
  IW1_1 = [2.2587380642849210766 1.3822408282157558901 -1.4052486828515136086 2.0927214200525940946 2.9080173341104331719 -0.98579567186209138274 -1.9620345951957460784 1.4827897033175216901 0.038084396266809220077 0.47676924342324628059 0.54929481897115572941 -0.45758641269292632536 2.7895812611611683351 0.061030992882646170616 -5.2948863233843725951 -3.067983501637500332 4.1452463728622941375 -0.80490192026059725894 -0.015035118347002836281 4.9206386730978248778;-4.5203702524308519983 -2.0180841481405007443 0.16743994849267368474 2.9158002681375680964 -0.11789889556107845114 0.18536606497717397768 -1.0193232812240595742 0.77886416019592175086 1.1166125860090920785 0.949053914296680734 0.20624074428291064298 0.98076031625214366017 -0.19870566739238976206 -0.59311152069304029499 1.7887682207519299826 -1.8740607357338510131 -1.4032449632731716083 1.8668569513985462383 1.7323975487787888206 -1.0553258845624735596;-6.7003916710857867045 -5.3642286758199793084 -1.5177355074818827951 1.0632014331576318256 -2.2413339576082176308 1.1842039714721368515 -0.48202262893481134798 -0.94575356326820347874 0.62079359302962477951 1.8024081972842538324 -0.073912516701698294241 -0.91820176933952124543 -2.9665331319402952204 3.3582048428188584488 5.1954695017316776529 7.0323906688384489883 -5.4205754240994572513 3.468356366789373979 1.6567357384100538376 2.9621315507142074175;3.6239310387857237572 -3.6089027998898113303 2.5293129439556385485 2.0044084714800138869 -1.9762772934479941878 -5.0314708760785054054 -0.9779746030214429009 3.0232626177025196945 0.87175412958793208063 -1.1723664747368780503 4.5889202904495256519 -2.0877865262662376189 1.0724599804226295774 -3.6636772045434824463 -0.69552553219784574168 -0.45431543050860762056 1.0602908156349271085 0.81924268743174744056 0.20980573811830871556 -3.1700113681116488529;-1.3243827397499972065 0.19628320157360357179 -2.579994935326298755 -5.0961300338346600114 -0.4312981544803098366 1.5099453982672750296 -3.0582947943082059439 -0.51755086007973483131 -2.1606646471027781686 -0.27518421939906134721 -0.202898601875004303 -1.3078996453785098897 1.9109402082594741934 2.243958658966661357 -3.1805996181323186178 0.11469123635814471029 1.9227526364077196508 -0.2848224637248413238 0.36567978782383103731 4.2074515032771495626];
  
  % Layer 2
  b2 = -5.8409681491405383014;
  LW2_1 = [7.3470981960570229674 7.0271382473551495806 -7.8862679440177538837 -10.939154527150439122 5.9874606939518182358];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

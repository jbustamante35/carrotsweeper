function [Y,Xf,Af] = tp869b98f8_430d_4242_81e7_7fc601fa1c0b(X,~,~)
%TP869B98F8_430D_4242_81E7_7FC601FA1C0B neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 04-Sep-2017 20:10:57.
% 
% [Y] = tp869b98f8_430d_4242_81e7_7fc601fa1c0b(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1874.99930442497;-5454.9153472637;-869.204807020143;-780.471896742376;-460.205555216351;-234.310604878461;-540.291178237134;-572.142715533789;-192.819908210792;-263.80049063085;-210.820779921781;-212.78401520665;-286.590370604325;-190.320782432691;-193.663740648594;-194.470619647335;-373.104709120363;-213.719449945748;-260.914631799827;-176.115238468631];
  x1_step1_gain = [0.000342540442445781;0.00027748074658588;0.00080601324116702;0.00156677380853904;0.00168393926281428;0.00269046527889069;0.0019808499204541;0.00236361816544284;0.00245784730269613;0.00195235680232596;0.00282106579415897;0.00424658079482956;0.00317261769260759;0.00555458687461898;0.0042972473647809;0.00484270636687465;0.00333931608099042;0.00598913897545118;0.00384783002604034;0.00642488839732244];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.0255172741773723732;-1.5109245126468227038;-6.9698091517231670622;-1.871499255537640849;1.7941795326497793628];
  IW1_1 = [-0.87242815268147044794 -2.7980233550876425497 0.70202934387876703148 1.0848934873503806031 -0.93236183686302998019 -4.3689802129520938223 -0.10844740188588065932 1.4128320990816540803 0.33731848506313943936 2.82885733686935259 -2.8847351596160857312 -3.1228872257301176774 -0.027292073424271867665 2.8984107293729350907 -2.3196426637785618752 -0.95381771095412049011 -0.86425558003297997534 -0.086038983756062947794 1.7498939931296173533 2.8649586797688106898;1.6924045879354574495 2.4413715030668412531 -1.2562368271261616925 -3.2551678070483007765 2.7132721658777301244 -1.8077764443218984347 -0.64420872721269373251 -3.4684788295038000427 -2.7702439532926601551 -1.1458098591352039453 -0.186670890071418627 1.7901545919176586885 -0.94970419471460443273 2.2641137263339765617 3.2773537226241833409 -1.8540227309191752436 1.8882967843786802042 -0.55636062432051269777 -2.6251012942398692651 0.27601651028375923103;-5.9519100591341409512 -6.3649973801380790306 -1.0956110191053600733 -0.93674323321579300305 -3.9694889973547202722 -1.1005215988064982469 0.32398892068786344645 5.6471776926699934762 -4.4436084565387323764 -1.7485658898703366759 -2.9734448624336740075 -0.40848396593322439108 1.1686815161175716504 -0.14278579149375797419 2.033708477061700215 2.0743316927804977823 -1.0410748871283233008 -0.63121625430710714966 -3.5587163370417309594 1.5331479399389915663;0.21404440863254425853 5.3585632723439609038 -0.2979432050763010098 0.25490808974789697094 -0.32645158629297332809 0.48831089284161754982 -1.3863254004373934958 2.3403242071100098798 -1.2685367368866151683 1.414875479537430536 1.5739691565084270586 0.30858923450813940947 1.8871278775164850305 -0.53707508770572220946 -1.5542350059633309733 1.3835450645697133787 3.2663537599626257801 -0.99385560838965603114 0.68702352253405152283 1.311169886419567554;1.4685584121376069611 1.5505826691623656455 -1.1084139127280148163 -4.6083840211600888281 -1.3673406547074709039 3.0653554514831351518 0.17112430779665430136 2.89884866065092206 -0.073235976157968118994 1.6009476986017874278 -1.612526451864731758 1.7173945785962221322 -1.0514934733564313962 1.7971578737636826339 -3.2955857896701257204 2.4550656769530081469 -1.3190927512891044149 1.507513764949738988 -0.90725029717416239006 -0.70995167345597498532];
  
  % Layer 2
  b2 = -2.4369249274060855726;
  LW2_1 = [-6.9322170069937980585 4.5075894610512614591 -12.831151706322449613 9.1834915064669466744 6.8860486964030140911];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

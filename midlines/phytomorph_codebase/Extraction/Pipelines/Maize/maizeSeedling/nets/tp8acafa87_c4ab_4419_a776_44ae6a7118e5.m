function [Y,Xf,Af] = tp8acafa87_c4ab_4419_a776_44ae6a7118e5(X,~,~)
%TP8ACAFA87_C4AB_4419_A776_44AE6A7118E5 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 06-Sep-2017 18:35:57.
% 
% [Y] = tp8acafa87_c4ab_4419_a776_44ae6a7118e5(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1054.92998109303;-3159.48627075362;-2114.78087604941;-1423.59192565959;-885.057943991189;-1580.09594810588;-466.558771320888;-686.259228054127;-578.923214789093;-527.23935579285;-526.427101249705;-436.274101764848;-275.990547714333;-602.900723427734;-525.032869762641;-426.867092225891;-362.590695988137;-284.873458506266;-200.952843845991;-287.671508962944];
  x1_step1_gain = [0.000201853701047093;0.000358308876895914;0.000501068237842808;0.000831515796852234;0.000879302903096351;0.000967909908790055;0.000979217898324422;0.00108578915137916;0.00217066128634306;0.00165661710022778;0.00119050056045195;0.0016087609924096;0.0027023011442007;0.00170182021982357;0.00262305491334272;0.00249971191480293;0.00300944378896501;0.00354914054319034;0.00406898355464177;0.00313490959585118];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [2.9530616794405948333;-0.30112985909053219258;-0.30553576589067471536;0.11282523205285183154;-0.09771952957168475451];
  IW1_1 = [-1.2664548460524427398 -2.5592271826154426861 -2.4104090492366041509 -5.1408817944530831312 -2.3997780509681043704 1.3406531489431900983 2.5847021571309820587 -1.1329507652287249542 0.70949186131932806543 0.77490089495182590262 -1.0691463837952457361 -1.124786138434171745 0.85954898484354180788 -0.69922496987669047197 -1.9897364175084804039 0.17897526990636061783 -2.2289587913193358304 1.1452662394911652388 1.7329181454790647532 -0.10536859014740637686;1.7048060404857432459 0.9627617276549598202 -0.91131975943353082936 -0.9402999090301199514 0.68343598401414606958 -1.1879326481795411397 -1.7970984681197652577 -0.76719501638151144096 0.78871767478261356477 -1.1164863602993226888 -0.17465769081133306062 -0.029193442366520445941 -0.39458424092318816756 -1.7390691029198357409 0.091074623574803073578 -1.9934186535377085292 -0.92232612388874923859 2.0691148268118380038 1.7148603589332893637 0.33975457472019499061;0.89422273663951490352 1.2399878837928330899 2.1047610131683289758 -2.2209513377608489648 -1.8127840106502606243 -1.9862455376886734015 0.72340164694331610118 -3.0757875006329942202 1.8187102514078468118 0.98331796807829208174 -2.1696507049634248254 -2.0506567677586478027 -0.047918558641696522293 -1.0690418549798692549 2.1904873249390131029 -1.1373432386495052615 -2.0042395335434179948 1.0768643574256566708 -2.3646250542332225564 2.6020417889163658387;4.8970120637447989154 -0.079301634771988677164 -1.1417067688517468227 -1.116952622997263278 -3.424186928800742713 -2.5399824004592241877 -1.0445355490711820678 -1.0388304782066504206 0.6886819401419761455 0.17927394530465692868 -3.3848422512515337068 -2.156200477538798399 -1.1729791439973167311 1.8389982261356576654 1.4461745614803556137 4.8847858120514935365 -0.35688653798219571733 0.18638590170858934658 1.2543383765434970023 0.86233105518429109537;-3.6024154553115512734 -1.7082052154075819672 2.1906113627555838796 -0.11999218731119530579 -1.4955465855812204445 0.66873857286540783207 0.80533464141466981623 1.8898532196919415327 -0.71245335679889021385 0.26448435442653811522 -0.24706863010758078891 -1.1027013782039702949 -0.69069485792731444285 0.84542695170210480082 2.0516762742836642808 1.4228786524273500103 0.80674321572955598469 -1.0360408973594750215 -2.3016362054837355977 -0.59791510709401629597];
  
  % Layer 2
  b2 = 2.5502270578900665399;
  LW2_1 = [-6.1186624874047161882 4.2229163168540164719 -6.0626231882955776697 -11.229121454828749904 -5.7049292825868880286];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

function [Y,Xf,Af] = tp8c46d43f_c9fb_4f41_99c3_e048eada2ff7(X,~,~)
%TP8C46D43F_C9FB_4F41_99C3_E048EADA2FF7 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 06-Sep-2017 07:14:32.
% 
% [Y] = tp8c46d43f_c9fb_4f41_99c3_e048eada2ff7(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1874.99930442497;-5454.9153472637;-869.204807020143;-780.471896742374;-460.20555521635;-234.310604878462;-540.291178237134;-572.142715533789;-192.819908210793;-263.800490630849;-210.82077992178;-258.183122033518;-343.803894881912;-190.32078243269;-193.663740648595;-218.521589353924;-373.104709120368;-213.719449945757;-260.914631799837;-135.174215342513];
  x1_step1_gain = [0.00034254044244578;0.00027748074658588;0.000806013241167019;0.00156677380853905;0.00168393926281428;0.00269046527889069;0.0019808499204541;0.00236361816544284;0.00245784730269614;0.00195235680232595;0.00282106579415895;0.00424658079482964;0.00317261769260759;0.00555458687461901;0.00429724736478089;0.00484270636687458;0.00333931608099041;0.00598913897545098;0.0038478300260404;0.00642488839732221];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [0.95775536963569829485;0.94060922024039195222;3.8088587907697650792;-1.8771081022340421196;-0.65351466892648635287];
  IW1_1 = [-2.6966396996550714427 -2.7335709605521234522 1.6256160489460067531 1.2122951606095919708 -1.3667567825654960423 1.2596274413001020687 0.16770794605229905061 1.2231479499871118488 0.97076493056065105147 2.3857140309758184671 -1.1157018158766804916 0.72877240265259246588 -0.32033276500995833125 0.42759881476871991479 -0.030605856783791532405 0.6714789426752468815 0.54273391531098702512 -0.88320009260299192633 1.3893873453350988889 -0.81889342720368252238;0.96449198001428682048 2.8921372201752886255 -1.9437819883038358615 -3.2598576907030309968 -0.37801707572069104257 2.2064770814518093189 -0.31738783741530318672 2.8570407736230607476 -1.5992598420664148051 0.55196481857249102276 1.0950769770611401555 -0.60408063370760545219 -0.40755826466841105216 -0.14113111979978107402 -1.8196989091742292732 -1.4043069043182843103 -0.38274168155526255841 -0.60393066928506256019 -0.51451386060063342143 -0.42956739431903345761;1.2663618822104176775 2.5547329428197866896 0.43664828817938028394 0.93143159954465770678 2.5633137840533959384 1.1979427363687638053 0.75100052547857343299 -2.5389605165109707663 2.2891721542233840481 3.7710076564550507605 1.3443860979284041335 0.7796735071245544102 1.8863466068488627947 0.41864668533998855571 -1.732543101052397061 1.7012480038243034119 2.0273662453394725169 -0.050814640183823249486 4.0575260499651877311 0.46180340700243621699;3.1938009248086118852 2.4881269693739973548 1.89652256814132536 -0.52930757313084930704 -1.3245044342064979936 -2.1743550858964639794 -1.6283964387688520947 0.48322615844070554436 0.90079752214142927436 -2.5481907609232825607 1.6289407465667455899 -1.5959890383435120231 -0.59536716622484786576 0.50886057426402531156 0.93952250776967616286 0.26784784223444169093 1.1030762788670327446 0.43550967302578119655 -2.3965425143905143557 0.90428439789057568632;-1.0561955154959337122 -0.36881848010282486383 -0.3501869717482652411 -0.55425601257392831389 -0.65504578387207224033 2.5764442743450657325 0.5799569991390469692 -2.2132368379386302415 -0.37041534887918037278 -1.963169723836034386 0.64068302096166984683 -1.0654154495072412079 0.59161488215027291382 -1.3752897345857393319 0.91874443606408406904 -0.37849830824297675536 -0.34447330672136045049 0.20002572049957981215 -1.215911877953010034 0.36137263262539776054];
  
  % Layer 2
  b2 = 0.98358054826364504919;
  LW2_1 = [-3.8326417183664158728 6.6199825320757312852 7.1155035665057937422 4.6117296800985965177 3.752590384439793425];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

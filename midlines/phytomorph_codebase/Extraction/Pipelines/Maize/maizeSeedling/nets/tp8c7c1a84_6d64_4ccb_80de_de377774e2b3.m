function [Y,Xf,Af] = tp8c7c1a84_6d64_4ccb_80de_de377774e2b3(X,~,~)
%TP8C7C1A84_6D64_4CCB_80DE_DE377774E2B3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-Sep-2017 11:44:46.
% 
% [Y] = tp8c7c1a84_6d64_4ccb_80de_de377774e2b3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1710.79601884287;-841.368302509967;-925.675633657012;-1424.63292253515;-1115.63541033651;-861.953076142261;-996.664725988399;-421.625702789094;-875.432385395492;-557.274532479571;-502.132109545494;-521.810951623237;-543.177005191324;-167.207345824941;-344.528961662807;-294.401776402727;-391.010406370095;-285.680184537948;-174.294824484564;-303.60902044243];
  x1_step1_gain = [0.000202107905561193;0.000554219398814734;0.000742185534904078;0.0010185341647551;0.00103332655312913;0.00147681597144009;0.00118221307527392;0.0026595872668385;0.00125235891924471;0.00165285753177999;0.0023286012823718;0.00188013184297683;0.00198822427969291;0.00479968082327778;0.00252047169225142;0.00363117206158393;0.00272984263620481;0.00383651951608926;0.0050225458649304;0.00330771328744475];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [0.97846815938732956131;-0.42795870696243404341;-2.8006055652849854987;7.0711065468009257629;1.9308215809119615436];
  IW1_1 = [1.9593836060957769973 3.9160521175175566633 1.1239635044886091553 -0.21937320765185350235 -0.65156930592384054712 2.8677414337930562382 -0.22656102138992320616 2.3370984843753621618 -1.5288103084686650579 2.0365091390831060458 -1.2436498410254190894 0.20834807017184373001 -1.3277881721973825435 -0.15769621992928842258 -0.59782865438370935696 1.083062027927920612 0.76244061558808451373 0.19224132759166459583 -0.94431474891988809173 2.9809314845701266883;0.99129615837127726952 -0.57437495516281023011 -1.7848248054426911757 -3.047234275987590113 3.447889972417243154 -0.88869814736965246915 -1.8945356906451031875 0.63446258211775019564 2.5993990472419405968 2.8581110971058825143 -0.23869315921250566781 2.0254593644889640203 -1.2431070467100930887 0.38027729997546405594 -4.5601034072027850641 -0.25779069082172817451 3.8550780516310889645 1.032026328494366485 1.0117365659171917436 1.1868840337568071774;-4.2962482327169526641 1.544973752894547081 -2.4993299610344199557 -1.242540139426057122 0.77511656153869101793 1.0661275909658509686 1.2237597210601964814 -0.65436727340067957215 2.3452463190664376569 -1.8397853023815227136 -0.77573878379007765727 -2.834412986441380955 0.21596079011196397945 1.250702926918916047 1.717791851787122237 1.6073504525047510594 -1.002201228586767634 -0.94704499886897375305 1.547461849057113259 -0.56961340525103898447;-0.59314449437486804761 4.7015990344133449241 3.4051279820300619505 -1.3677264903054975331 -4.0861452341629078688 -3.4711566130064559488 0.16709757796289911869 1.4176462225420582985 0.12425539238893545946 1.4784027935844723523 2.6180337483282687394 4.4967398897790529233 1.7728414864879404877 0.60957434009356337157 0.70167460355796684723 6.0785494702406062117 -4.6930182515069107652 -0.47545951146063331061 -0.1242630575966702372 1.9483962701404722306;0.12817056497894999123 1.339682358756090208 -0.89488531408984439697 0.074584083917335286529 -1.2328444007824481687 0.95001575145286742963 0.63175583204548280136 2.3637248145108116226 -1.1903453977773279515 -3.1387770046944876157 -1.3025335948469176639 -2.1729196587745778224 -1.094311188266957835 1.1301836518638603835 -1.5069657939094305288 0.63673729714785043399 1.5622491148416293161 -0.052902415272532782309 -0.083010949283366747276 0.077482873064335489044];
  
  % Layer 2
  b2 = -3.6862163292495209177;
  LW2_1 = [6.1592801408436308463 -5.7684978324764664137 9.6280146719905204122 10.284237832553902336 -3.9796523978642444064];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

function [Y,Xf,Af] = tp8e89fef7_40b2_41e5_bc92_72e73586bfe8(X,~,~)
%TP8E89FEF7_40B2_41E5_BC92_72E73586BFE8 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 05-Sep-2017 04:24:32.
% 
% [Y] = tp8e89fef7_40b2_41e5_bc92_72e73586bfe8(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1054.92998109303;-3159.48627075363;-2114.78087604941;-1423.59192565959;-885.05794399119;-486.212064486033;-1575.88755591871;-686.259228054126;-578.923214789103;-527.239355792852;-526.427101249686;-436.274101764843;-275.99054771432;-602.900723427734;-525.032869762656;-426.867092225846;-362.590695988155;-284.873458506265;-290.570400999357;-350.30542110451];
  x1_step1_gain = [0.000201853701047093;0.000358308876895914;0.000501068237842808;0.000831515796852235;0.000879302903096352;0.000967909908790052;0.000979217898324425;0.00108578915137916;0.00217066128634304;0.00165661710022778;0.00119050056045196;0.00160876099240959;0.0027023011442008;0.00170182021982357;0.00262305491334268;0.00249971191480298;0.0030094437889651;0.0035491405431904;0.00406898355464204;0.00313490959585083];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-3.6157227114319701045;1.0890914063813872392;-0.40782171125941796275;2.451719367991263443;1.4782053253969380524];
  IW1_1 = [-0.61435288986180747184 -2.4236204065375628325 -1.4344815951531124654 8.5756979340450705251 5.5384856826194530655 1.8185650727581799124 1.8652094833581744915 0.83344898651693055669 -5.149650983250224634 -5.4412522030777488169 -2.8437400342364815842 -0.99667949333301619763 1.6888694678346425349 -0.56268757298514626708 -0.24670183215597005222 1.3691579405078859732 -1.7621734500658805533 -7.8104806904314187932 0.93062749512530473783 0.78250806249025872674;-3.2557663873724282944 -6.1675562586669752108 -3.3747670701943839333 -6.3820595922831353519 -3.7250051612860479722 0.62834873921840039834 -1.5482814143356546932 -0.6473764750029740167 0.3109770793170257841 0.60636392197101807167 -2.386518483157033188 -2.0470791339472067527 -2.5066087912638024271 -1.5946705877186697631 -0.78250774828940761196 3.2872146282159055986 2.7748288444425805999 1.5216640528209117722 -0.60645958672612432228 0.61336666986539611912;3.8816109384578965091 1.8367190843856775473 4.3666666191347998094 -3.3936574540983102111 -8.8437050795476785936 -2.5971925971662908061 -2.7371296055551326276 -0.2351138657229264739 -0.95521774562966554889 4.655913120039993025 -3.2082820026368321642 -6.7359370888686536105 4.5316575653078041697 4.1226491866879548809 0.51194687684118411752 1.203172049465611293 -3.7097368892870594692 -4.6884065737120144135 3.1112017485957514928 -0.28226523559811073083;1.9283391601483257372 -2.5786088242276310467 -5.5529294497414314336 -9.2577577879984165321 -6.8594320414274196906 -0.13644698195583887523 1.97409270954986793 2.0814872816833607239 -3.6266536727469116386 -0.64523918336157781717 2.8114586970573021141 6.2180776678665070634 -4.5510121250504198542 1.6138654586625418297 -2.8292041330023862677 -1.0738414542613770042 1.3807296862760807254 -0.24458652136984393444 1.0283495781512845824 0.74562072670621992732;4.7739068770002566211 0.44679197264090303454 -2.6436494789173998754 -0.95806116630286897173 -0.73481827164964985677 -2.2252378478354306601 1.3683163928121038211 2.0027080978975466685 0.88312023336573985954 3.3569790081737096443 2.9614113626883802333 0.97854599683866672066 0.20706094376013681191 -1.1600116737768104702 -0.3687180640932448128 1.5203407330165528144 1.5999433255891859496 -2.4219283557311901411 0.028879827492809165279 -2.9073389133221816394];
  
  % Layer 2
  b2 = 6.8644131547884663647;
  LW2_1 = [10.721322054823566816 -14.982256938034144156 -12.43943228271558965 9.0455428575910623579 -10.065492635919902398];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

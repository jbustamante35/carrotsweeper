function [Y,Xf,Af] = tp91036047_ab2c_4ac7_8878_bae5e79e6964(X,~,~)
%TP91036047_AB2C_4AC7_8878_BAE5E79E6964 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-Sep-2017 18:02:47.
% 
% [Y] = tp91036047_ab2c_4ac7_8878_bae5e79e6964(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-5342.4077105154;-3062.40716175129;-796.678021735526;-751.77874545749;-962.879682501261;-561.234234396124;-567.818719457225;-566.708636588773;-460.813029179955;-650.116847383008;-365.703888775159;-279.141698173311;-258.59552464343;-352.492361124272;-198.123504200369;-350.309427866379;-205.100647540257;-201.923452595315;-223.562425332989;-192.300211130384];
  x1_step1_gain = [0.000187746732766858;0.000517587446146428;0.000760929139769029;0.00107683880161886;0.00113410115771159;0.0015463795383062;0.00191937835803699;0.00192268942981791;0.00211835684506624;0.00196958059572079;0.00268955398662541;0.00257377430529601;0.00284234016821656;0.00279908218986805;0.00409640929201515;0.00345584818973344;0.00422505290367579;0.00549698021899197;0.0047143261826186;0.00476878567270175];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.1954424907730674121;1.9332920030845888171;0.050402552428580625621;1.9845780539618680383;4.0473469085114812671];
  IW1_1 = [-0.8260166260007753003 1.4274113365283669363 0.082722403263113947203 0.49828571986599728971 0.15193409786748518497 0.076724494694041661669 0.059457573327665554086 0.96071463458933170632 -0.88417084817198521307 -1.2067426281765536444 -0.56339141932542946556 0.71073086280307229412 0.76824499444020721839 -1.3621078536056732133 0.59028747585505270123 -0.050984017548340809789 0.77079853211758742049 0.21355396091480760568 -0.79780616233897660994 0.70738448828873268237;1.3378595539125648362 -3.3145624060303213732 -0.087614633442547329434 -0.2607454654863226029 -1.6508947137158818119 0.060995074541540988955 1.2137219293910461726 -0.85034451949358957901 0.26272565459297930746 -0.39006008639668415805 -0.28120207563599219913 -0.26812023873361445769 0.087405848139809783071 -0.19914707327064795628 0.28743709191253824509 0.92807567493731202291 0.37002263076836744427 0.17402789638912996573 0.32641338376350653716 0.30896659422474914702;-5.1580776581452045804 -1.7893264656913010491 -0.041034719481913811689 0.70057988037340268583 1.9716907675146724266 2.1191629475345554745 -3.8251753799440160186 0.52846645101301381597 -0.49213880812152754896 1.109034696078264659 1.5263768522624958646 0.07310311706218289296 -0.16498187241186262897 1.7117930147407438568 0.20940864992638807962 -0.97433512551699930082 -0.090799864147713807427 -0.075868526754600970619 0.15520539113835490896 -0.82047345452976827573;-1.631434962219481033 -2.9511672940299540358 0.40644375823739281595 0.88882233363201379461 -0.3991653903757869104 2.72880452442328858 -0.98753518671239137738 -0.11260676095461133461 -1.1486067737712239989 1.1453551084772104485 0.94634692341285486794 0.19700681370821385152 -0.31416211215922917876 1.2290143941025419849 0.7273863145644468009 -0.34414772513038377477 -1.3277887417018676697 0.28314373087009242491 0.17969679327743920405 -0.95938845145888329569;0.13250988155652218548 -4.0829025863610635128 1.8152009650709346467 -1.2593169828887411654 -0.49078227630781667834 1.1797206204221435399 -0.13896080614698258504 -1.6519289175792721824 0.77705566450046303917 1.4063213967543497507 1.4342831899874592949 -0.58682925512607742036 0.41563879945467940846 1.9876997104981433129 0.70660608111815226273 0.21519686392299436362 -0.37188449566028841664 0.1552250830836941764 2.0405061306127261211 -2.230741780186071388];
  
  % Layer 2
  b2 = -2.1699115244493318855;
  LW2_1 = [2.9371477978625839533 -5.0062752652731132841 -6.5109074063903289442 -3.8704409291048222919 -7.8618931663120426023];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

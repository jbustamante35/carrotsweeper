function [Y,Xf,Af] = tp915c5796_e165_43cb_80c4_3e1ddb4c9964(X,~,~)
%TP915C5796_E165_43CB_80C4_3E1DDB4C9964 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-Sep-2017 02:12:27.
% 
% [Y] = tp915c5796_e165_43cb_80c4_3e1ddb4c9964(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-8184.90793418462;-2767.31086728677;-925.675633657013;-538.973276654921;-1115.63541033651;-861.953076142263;-996.664725988394;-421.625702789084;-721.553885286549;-557.27453247957;-502.13210954549;-541.944235264827;-543.177005191323;-167.207345824925;-344.528961662829;-294.401776402708;-391.01040637009;-285.680184537942;-174.294824484569;-303.609020442417];
  x1_step1_gain = [0.000202107905561193;0.000554219398814734;0.000742185534904078;0.0010185341647551;0.00103332655312913;0.00147681597144009;0.00118221307527392;0.00265958726683853;0.00125235891924471;0.00165285753177998;0.00232860128237179;0.00188013184297679;0.00198822427969294;0.00479968082327796;0.00252047169225128;0.00363117206158397;0.00272984263620491;0.00383651951608931;0.00502254586493011;0.003307713287445];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-0.72548922737123699989;0.94229026823490913412;3.6954099549921499701;-2.8514089113104814643;-1.1553616898981895478];
  IW1_1 = [2.5449074331212506728 5.3131147283865090003 1.3343151629582423734 -0.90977238115863723333 3.8190678632849661689 -3.0223538342167812765 2.68918828415511868 -3.2199999610374643311 -1.4165248048840066719 0.14616594334131130517 1.2557376661551216124 -2.3226342902363392717 -2.4236819880789730597 1.7241005517466003738 -0.88959001783014912679 -1.8662199846619127452 0.19332614405649217737 -0.60743482169755547151 0.70126389005717826297 -2.1412092636607442664;8.1102140849723873828 -5.5508578611328118768 -0.31544817814649056542 1.030490617306409673 1.1114302870294532344 -2.8011651548620037921 -3.6983699088048656023 1.8571866626855144666 1.1778020657495902324 3.8724153763255126925 4.7212903160476651365 1.0950200034538311034 -2.849451888320207793 3.6063085410388109331 4.6603231606104511542 7.2322061045899284082 -2.0167558728190102535 -1.8309061697649180456 0.50495972837731084581 -0.66658446467042931083;-0.83018586818318418352 -3.7602589965969124286 2.8353117276107635547 -2.9850591249706002195 -3.5015247835688221301 0.48510863866568260105 4.5346410421819136616 -1.4352341669582935335 1.4561617625031861856 -0.95185562988494498704 -0.67730233354942770418 -3.2183432265095897051 4.8073670187622470351 -1.2112507658481770356 5.923271648902278308 4.7915025811706080106 -4.6321506739398996544 -1.8300709223402773507 -1.3356078891895304395 -0.40121615610869781898;7.2898618468832445672 -0.54439961470282771661 -2.5420693544469159519 2.7498999862596624766 0.90708366831868736391 2.4872364887190494542 0.35517428485226565371 -2.882885342565606468 -2.8854342939268255996 -1.8028057839474469493 -3.2515428172654132766 2.8298422036098433985 2.1172286808218108156 3.2867182991451864282 1.2181704653143581307 -1.2459973664720336295 -2.5676196730231413135 -1.7424665607968330416 3.1856681707387171087 -2.7490109150224388834;0.23153779405129898405 -2.5415744168884981669 0.21947709500761891643 -5.2364766062007674918 -5.3069890360853753108 -1.9867425261826399119 1.9200236558042182988 0.25557559790919409659 -0.63921462225029501703 0.48170754764712969687 1.2336261799245786808 -2.0044114336983600566 0.41590464996298076583 3.1936731079761289109 -1.0409841875637515507 -0.053115599723465294069 0.70017110834361484528 -0.2532984022930750978 2.5026947345331085337 -0.65809931987147318733];
  
  % Layer 2
  b2 = -5.9680607414196096272;
  LW2_1 = [-14.590614800713625598 9.4688516792088801566 10.15115071155419102 10.145654275882353801 -4.1715363186307499177];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

function [Y,Xf,Af] = tp928b60d5_c5a3_4359_a69f_f51423b21059(X,~,~)
%TP928B60D5_C5A3_4359_A69F_F51423B21059 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-Sep-2017 16:54:38.
% 
% [Y] = tp928b60d5_c5a3_4359_a69f_f51423b21059(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-5466.61789079661;-862.937878923584;-1028.71862143181;-451.710971542891;-692.538815520001;-441.043793232208;-531.307871775743;-311.950474474656;-656.555828069286;-416.411813428009;-183.589471391044;-268.743398235222;-384.146123020672;-242.574763141895;-233.266353450973;-302.321350914757;-296.419908591265;-275.821003918821;-162.786711803908;-176.062817024438];
  x1_step1_gain = [0.000192953812201725;0.000635170113819407;0.0010737117105794;0.000992967389065709;0.00140247416929523;0.00179426803546528;0.00152094087103248;0.00262475201653712;0.00199415494766509;0.00251075910029926;0.00454433874041209;0.00378662000738744;0.00302237737948969;0.00448879604138555;0.0036608073346035;0.00363057230533711;0.00381924645546785;0.00427537582274518;0.00592120551781336;0.00602422138644134];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [2.4695473230328772729;1.8200523154381498259;2.5124534703310450467;-5.9742442069210790478;-2.0049204960639270823];
  IW1_1 = [-0.13636725606314745174 -0.084224946976911602148 -0.21295127851010406395 -0.075650534324841769984 0.27206440692652239521 -0.094262426640908322795 -0.19033664216124815405 -0.38262069423351757758 -0.25867830127991631173 -0.26701238265561544338 -0.55463834410550028053 0.098725590271443605661 0.35066916728220437482 0.44455058204725139692 0.0057515740989698164662 0.0074640608567296783116 0.35613778153851921582 0.10539608278052613188 0.19375655613489822793 0.16207509174755121983;2.4891113644962907792 -1.0476271944581976303 -5.2228700802662011426 -0.29840760951621136954 4.0710313682774295074 1.9057442245378040102 -0.304095710429526489 -1.1549713049620915495 -5.8764420617994126417 -3.9973928675324628124 3.6535551227699092358 1.1014040268340103967 -3.6785200321446400729 -0.68952253077937131209 -0.92236442136527907465 -1.6020773468411435569 -0.40868287626831789616 0.08812349655659126868 0.33695783386023531181 -1.8463551852754398475;-1.6007269268779684701 4.5315498988136777569 1.3808770787609279118 3.7263793476403042071 -2.2814696690831044457 -0.57546947367995748834 -1.5465427725823601701 1.4876596148656913154 2.0314268158528450137 1.0388093937148823453 -0.73593047005171807751 -0.76536827694234177422 0.47732106583391431531 -0.43063191219115382058 0.60544547289154315717 0.29944402178252865765 -0.34915300504323748543 0.025781086339068226554 -0.15931850500418831551 -0.036274666401706519292;0.67120291310070134827 -4.0755529396446199542 0.31058112686153815929 -2.009344118324645212 -1.364700148245340694 -1.491451111625999193 2.3409879518093603679 -1.2800383882753265663 1.562791486865888535 1.6545024522667053368 -2.0662739263691469738 -1.7310792952219877794 4.2021822830086739131 1.7980621563121845785 -1.6079136921282408679 1.0727622737322650703 0.74548115854806007441 -2.2569695527690192272 -0.51624291998420857031 1.0586703307335958435;-0.37724909040722659492 0.38110731685679638536 -0.29989541450737328132 -0.29998775606500721613 0.28861586809472677961 -0.23379624745656799045 0.21090270951432596447 0.046513358653746082749 -0.50422518680864525376 -0.52822027330486065466 -0.17489797893828540332 -0.079258057228526995752 0.15955955882351879893 0.083623078923706559151 -0.19805741470844306917 0.44343518355360356242 -0.39857263493412159461 0.30592375972984148236 0.24587920108058919366 0.29381663022324677748];
  
  % Layer 2
  b2 = -2.8741632867503374982;
  LW2_1 = [-4.5941834426025502935 -11.301498716188653759 -9.6665213642244758319 9.4804915552735344875 1.9238138970399949468];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

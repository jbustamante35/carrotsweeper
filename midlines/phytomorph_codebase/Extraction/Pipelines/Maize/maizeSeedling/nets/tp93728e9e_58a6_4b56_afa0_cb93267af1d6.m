function [Y,Xf,Af] = tp93728e9e_58a6_4b56_afa0_cb93267af1d6(X,~,~)
%TP93728E9E_58A6_4B56_AFA0_CB93267AF1D6 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-Sep-2017 21:54:31.
% 
% [Y] = tp93728e9e_58a6_4b56_afa0_cb93267af1d6(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1425.12385949519;-911.082072190465;-1068.86784991252;-1175.93373113978;-1366.53951203701;-713.224898465728;-724.608543380189;-604.796304556694;-546.419507096576;-435.830146318451;-311.040988170548;-332.822721465582;-397.169999063709;-247.407476323912;-310.614407522915;-284.621358963202;-348.992764796152;-137.271225529376;-220.006532848169;-273.249410813701];
  x1_step1_gain = [0.000226370837385414;0.000563347828528141;0.000948114745185448;0.000858032283205085;0.000730242383199752;0.0015171639926653;0.00146770964020617;0.00151546500149801;0.00206494173697171;0.00202475070577013;0.0032643930974656;0.00229997229518746;0.00248425272472343;0.00412752991038782;0.00322794766513115;0.00343797851616057;0.00328303385537571;0.00723300236088587;0.00445727486740912;0.00407527899100783];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.6335919177353619425;-3.400996278404841533;1.5158462752298706988;7.8550679048083758005;-2.729656018675721274];
  IW1_1 = [-0.043816537423212092994 1.5149598857660093731 -1.6221077877135305911 0.69159876775235229474 -0.21516861305831178064 -0.042802706717335166353 -1.3647309009717982775 -0.35364097557822465889 1.2929499767153471712 -1.5286068300584865209 -1.3412283790588181986 0.73876737779264944894 0.98248637478221956254 0.72312105733332965318 -1.2400879164400981924 -2.0827172875028439059 -1.0299671066499702654 1.1956418619656505875 0.50040639074947068643 -0.67035965603607439167;0.88319118037596000548 -3.3564703808101890026 4.2221026591756301016 -1.9188612064433525628 1.1848387060982601415 2.2708004725814476821 1.5778749271002003862 -2.8542153807501731144 -2.3202815076349510015 2.8303275926123854234 1.6682008366086069628 -3.3523007813726901638 0.084509824891214210818 -0.90329454331796521505 2.1524395848372308571 -1.0242529806538946957 1.1997590781009896954 2.1986770944000300076 -0.38821764804799013815 3.7871640939333737208;-0.41669842982669497156 1.0114883058611447986 -5.9180650354619812603 -2.0765126896745762508 -6.9486380598219090743 -0.11509829290199133367 0.15278054310566760443 -2.3168447448491904517 0.2962002413176711979 -6.1130539155494947323 -0.85292595609839527704 3.7788909761645435026 0.054637861083349038849 1.3078771925276269084 -0.69055300417104359401 2.028324446650470847 1.9518709649287071528 -0.09067053138473367413 -0.76590322484146866611 1.9958872268278731177;6.9082306630474841214 9.2115471140021387697 1.5932152615237591409 3.8076694065152625335 -5.6058895678841160759 2.0513061067383020486 1.8316889928410744481 -1.6870982446300872848 -1.000430506568711353 5.0315306122422889246 1.0707369593336848457 -4.1866127030642283913 0.81207791575864951561 -3.8195412397533909932 2.7168274158316849665 0.27769564517487760336 0.99546988569693184434 0.81291823161219256555 0.57972748983501742881 -0.41041922548828613238;-1.3676362074978340999 2.7304795105670400801 4.0458955905665421326 1.566360956755214362 0.24881894689896685846 -1.2960723755657601597 0.81745813577044901255 1.7135240424013717941 1.4463018053489011816 -1.4600793628117976208 0.38915563281291143394 2.1858194663947956293 1.6545946311196555456 1.3917690716375128446 -1.38503779554200257 1.8840813771071283078 3.4567623314304971593 0.78707397141613133495 1.2842569470355338357 0.99343926489896250409];
  
  % Layer 2
  b2 = -6.7577112404971568793;
  LW2_1 = [6.1575617440178547213 -9.9405976809634424285 10.930294150524451524 11.881044104475893874 8.0711521415016385106];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

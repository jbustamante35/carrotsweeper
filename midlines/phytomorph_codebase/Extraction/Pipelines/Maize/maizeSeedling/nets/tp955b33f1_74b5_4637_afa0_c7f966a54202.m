function [Y,Xf,Af] = tp955b33f1_74b5_4637_afa0_c7f966a54202(X,~,~)
%TP955B33F1_74B5_4637_AFA0_C7F966A54202 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 06-Sep-2017 18:28:44.
% 
% [Y] = tp955b33f1_74b5_4637_afa0_c7f966a54202(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1054.92998109303;-2422.29003723604;-1876.6914403967;-1423.59192565959;-885.057943991189;-486.212064486033;-466.558771320886;-686.259228054125;-342.454990361202;-680.040226027843;-526.427101249676;-436.274101764836;-275.99054771434;-572.31154441531;-237.436871082882;-373.225105661542;-301.983936484978;-284.873458506247;-290.570400999417;-350.30542110445];
  x1_step1_gain = [0.000201853701047093;0.000358308876895914;0.000501068237842807;0.000831515796852232;0.00087930290309635;0.000967909908790054;0.000979217898324425;0.00108578915137916;0.00217066128634305;0.00165661710022777;0.00119050056045196;0.00160876099240959;0.00270230114420069;0.00170182021982357;0.00262305491334276;0.00249971191480286;0.00300944378896506;0.00354914054319056;0.00406898355464135;0.0031349095958513];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [0.07325629024975999215;0.19503588680938463429;1.6986008317565273185;-1.3392065467627107811;-1.5509470000566984993];
  IW1_1 = [4.2594914062512385655 -0.043012721243070137223 0.11250401898854309191 -1.1083935973784229123 -3.2553497112182747664 3.2425573135089611476 0.28744357275886389669 0.62379872313641482329 -0.74862978112772038397 0.044989956998768419749 -4.2764047898218207067 -2.6479253099538393457 -1.6223365091428587625 -2.6395036924792485422 -2.0077135655195550434 -4.7899096810352919107 -0.47710790163737198943 0.40301335938412569115 -1.2936851638367012907 0.29377761941200142282;1.1411814835575948557 -2.410532516440643036 -1.4225301284626921117 5.6526773319910983417 5.117116588639629704 1.9220488986822634736 -1.2578918617407390812 2.8916290899607712817 0.72647731141950422362 2.9906507441209586595 1.8036596926793890816 2.3808144505065884644 -0.33105302548627452142 -2.1275660812303169855 -0.5836974396921267294 0.79685297627990514524 -1.3504847138855200495 -1.4841381590570488225 1.4943121694916665643 0.91571841070373016791;-1.0518531622457714114 0.43339194024374266823 0.61125420638524130545 -3.0868801480581473662 1.5603288337441676425 -0.16275334348775133408 -0.99047961259781380772 -0.98644642613107436091 -1.6070950770294727405 -1.1715283698586000938 -0.2246499104355543508 -0.045770156949547946557 -2.2236423573443273582 -0.34703796263692493484 -0.37287560700635646871 1.2415253868182614116 0.20709168334412991763 0.61773423793432169493 1.1838818264574306749 0.3216159090251051178;-1.5495452440807448991 -0.31840769746741298674 -3.5433484732933422379 1.5131104139600293212 -0.91331164794443409072 0.056604865137283286169 -0.022855810896965700341 1.6294970315609988987 2.1679156294719521547 -0.24616447856849116294 -1.503286131633016387 -1.0448033587180387549 1.7836758341969969344 0.61208804940456429389 -1.9336570424794385925 -1.0940285050627402974 -1.0781174295988000811 -3.1230792383087320196 2.3515492132889983523 -0.39096054690646026009;-1.1416092233376888831 0.3261264930292544495 0.16870486569813680777 2.012973260531775832 0.066077773130543582258 -0.54205332760294466787 -2.4565594227572953301 -0.50352204741854711401 0.69757132001742849781 -0.39728694017911420078 0.43150048808530960809 1.3955825282221805406 -1.0939663443143892163 3.0517046693922642575 0.97539736942283472576 0.69857327377795386258 -2.0106092360047354006 -0.70241760379870776809 -2.7431464184680360852 1.371808874391029498];
  
  % Layer 2
  b2 = 2.6179806522489115217;
  LW2_1 = [-7.9351377126311293253 7.5223707895438405302 -5.2670059801842050717 -6.5998821209619080719 5.0873643460264581506];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

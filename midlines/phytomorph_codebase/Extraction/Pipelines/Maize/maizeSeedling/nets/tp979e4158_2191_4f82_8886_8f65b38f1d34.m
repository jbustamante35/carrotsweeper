function [Y,Xf,Af] = tp979e4158_2191_4f82_8886_8f65b38f1d34(X,~,~)
%TP979E4158_2191_4F82_8886_8F65B38F1D34 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 04-Sep-2017 00:36:54.
% 
% [Y] = tp979e4158_2191_4f82_8886_8f65b38f1d34(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-8184.90793418462;-2767.31086728677;-1769.06834334395;-1424.63292253516;-1115.6354103365;-861.95307614227;-996.664725988396;-421.625702789073;-721.55388528655;-557.274532479573;-502.132109545497;-541.94423526482;-543.177005191311;-167.207345824933;-448.973304658444;-294.401776402713;-391.010406370102;-285.680184537942;-174.294824484558;-303.609020442437];
  x1_step1_gain = [0.000202107905561193;0.000554219398814734;0.000742185534904078;0.0010185341647551;0.00103332655312913;0.00147681597144008;0.00118221307527392;0.00265958726683858;0.00125235891924471;0.00165285753177998;0.00232860128237178;0.00188013184297682;0.00198822427969296;0.00479968082327787;0.00252047169225128;0.00363117206158388;0.00272984263620486;0.00383651951608922;0.00502254586493041;0.00330771328744478];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [3.9575632183413214094;-4.7621911002191810169;-2.9744355174029206701;3.6558210181288890439;-0.32666834803685751432];
  IW1_1 = [-1.9296895928968906819 -0.64590203456495776102 -3.9686457300649338187 0.1832579619418639727 -1.501229495551690496 -2.4530572893506983334 -0.3120722863649864065 0.46558827539361252734 1.8103696144620866626 -5.1525854298949704813 -1.8824124541677673683 1.7090887737850515293 -0.83155134825080889716 -0.45660067167593115789 -0.27750770980214195527 -0.65644637610291478591 3.2311098839954874862 1.2953271379329518442 -3.1556228296242041509 3.7313842853997880589;1.5339495918574999056 1.3629941338433180231 -1.0260770757966397593 4.6980765322349871127 -0.38948102031861553396 -6.4406977934389644247 1.3544112899429958663 1.3405417277302029699 0.84629149599000641491 2.1337594468528919833 2.0001879797513435477 1.3509082049951384175 3.8940656569008478272 -5.4844846662856223674 -8.654054469992734866 1.344664392908828443 -4.5692908931045872478 -3.1646170458957261218 0.46526760879801104531 1.5214801317099400091;-5.2150073263157574743 3.1190026842037821275 2.127643711254977088 3.2650129283454929485 1.4909305193842761206 -2.8476695365784285841 0.88329161809805312178 2.5881592889241993305 -0.084839906268439554959 -0.94429764311165675927 5.1353477152887254675 -2.5994154498379518081 -4.1590891181829627854 -2.744121768143216844 0.48907644473910039107 -1.9250126680560262216 -0.86976218418230188956 -0.39560368060448813932 0.93127856795911623244 -7.7195290677024051007;-6.0256799487243934976 -0.98425813436014830682 1.3710297981496222253 -2.6009161274422578636 -3.6035581452347291709 3.3906663374866408134 -1.7033082776023584781 -3.087947310910308385 0.33994822367721011513 -0.94440713660386510497 -4.7815498122513817592 2.4402075882582372479 0.36132367057472475347 -3.0870455657645057279 -0.22174215700926308559 -0.61025877988599019908 3.1687134877121412302 1.6601518881034380559 -0.3676138254315837739 -2.3693089286526318737;3.9369201121256667264 5.0729315939601837826 -0.61597624611838408537 -2.1738935367821596856 3.5644991669430639014 -0.8378523798544857959 1.9866810829327521404 -2.978707673282912971 -1.427764546249199018 -0.39253739885144700583 0.20208274155326549915 0.30410349777013256922 0.98233145219143536142 3.7461966130422941212 2.9440668650998658151 -1.8460765349085479503 3.1875457566042992852 2.1885648839367148888 0.25673803679759898966 -1.0939850999069904436];
  
  % Layer 2
  b2 = -2.8801447303084621865;
  LW2_1 = [-9.1023228743513620032 -9.5965865694464156377 -12.586284648645246875 -11.72149488315988819 -11.137425014010363];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

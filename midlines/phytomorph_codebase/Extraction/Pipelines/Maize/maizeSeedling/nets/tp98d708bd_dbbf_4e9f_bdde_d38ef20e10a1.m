function [Y,Xf,Af] = tp98d708bd_dbbf_4e9f_bdde_d38ef20e10a1(X,~,~)
%TP98D708BD_DBBF_4E9F_BDDE_D38EF20E10A1 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-Sep-2017 08:27:16.
% 
% [Y] = tp98d708bd_dbbf_4e9f_bdde_d38ef20e10a1(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-5310.24104946905;-801.67419279183;-796.678021735527;-751.778745457494;-962.879682501259;-561.234234396123;-567.818719457233;-566.708636588774;-460.813029179954;-650.116847383023;-365.703888775158;-279.14169817332;-445.050021503466;-352.492361124262;-290.108959264277;-350.30942786635;-268.266206223864;-161.912675664716;-223.562425332985;-192.300211130382];
  x1_step1_gain = [0.000187746732766858;0.000517587446146427;0.000760929139769029;0.00107683880161886;0.00113410115771159;0.00154637953830619;0.00191937835803697;0.00192268942981793;0.00211835684506624;0.00196958059572077;0.00268955398662541;0.00257377430529594;0.00284234016821656;0.00279908218986813;0.00409640929201504;0.00345584818973365;0.00422505290367577;0.00549698021899197;0.00471432618261858;0.00476878567270168];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.6250606139035648212;-3.4117995867945465349;2.4527292012887991213;-2.7673972103855386528;2.1066039596379484422];
  IW1_1 = [-0.61833768680891798564 1.3609624912626596682 0.055809622908521518136 -0.35944080951481860442 0.44029291640212925296 0.31831546674284499909 0.58064557840781327869 0.37577820681351647991 0.023272279752123523067 -0.60151144800716416228 0.12678975224937746868 -0.19101919453149496242 -0.075706702170671102969 0.42444485648933599764 0.81371939249708447051 -0.10350745033376483606 0.47900074105425866078 0.39909127291541157678 -0.11239844643927390799 -0.29102855442292530075;-7.1797732198840282791 -6.941355207055193155 -1.4312274059477283483 -2.1421058078852479589 -3.0911500218165199882 -6.9601241028793072729 4.1250414823009160514 1.7033453775727038781 0.97495219894124141025 -2.8234987518284939689 -4.0166520984825719864 1.444460488223829886 -0.027948118925554720632 -4.1177224849333651235 -0.58862638833084279799 2.4884329137097953577 -2.9162025762203773738 0.041189162336745105408 -2.8281496179916225664 2.1798843429047041198;-0.25034368375661120165 2.7137782106611996191 1.243635559168747351 -0.29711796094238807076 -0.13141707163114199619 0.87018882518374496282 0.25526358775808244417 -1.4213622752774806024 -0.36128505031948565662 0.71432296710556952846 0.26296034763015874169 -0.82848601900664298192 -0.25162426491954698049 0.85341139754037298459 0.7813926261222218228 0.52584931382152699797 0.084190279359835057393 0.19363087539153603367 0.98896632564295172685 -0.18826535104912076046;1.2762031233418287268 -4.9237034879803953658 -0.68754799857125159512 0.52693232309827264803 2.1969257612293144888 0.058269252084739604769 -1.3673317915588181215 1.6133105164999006487 -1.006672910049870806 -0.3416046938744455308 0.12535417570566997902 0.69065281668983535823 -0.4388548552482002818 -1.6444858387593856985 0.41132315189426160718 -1.3490507637786688377 0.18527519915178827792 1.2548641076689317497 -1.2200490253689302289 0.38100522781828016772;-0.17753939008227628826 0.044481395374026864997 0.39642467560062866205 -0.45857456950725056233 0.010105418098216020079 -0.085756850953033647578 0.16843163265435473486 -0.54362012319096764124 -0.25260881338105473093 -0.30323656212374205943 0.34706579327507663946 -0.23740530733429449084 -0.12337121377432955227 0.32958331877346858096 0.62807193574167541339 -0.27195126284156234675 0.24499805150244471919 0.088816902421921792299 0.1402837783129663729 -0.37216442598311644252];
  
  % Layer 2
  b2 = -3.1074305888875253245;
  LW2_1 = [-3.2865458931715920698 14.273900499160108168 -5.1745042356151387253 9.4222328652809981264 -3.4582580457111848915];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

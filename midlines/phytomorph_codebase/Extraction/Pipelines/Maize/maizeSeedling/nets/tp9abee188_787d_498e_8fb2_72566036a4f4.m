function [Y,Xf,Af] = tp9abee188_787d_498e_8fb2_72566036a4f4(X,~,~)
%TP9ABEE188_787D_498E_8FB2_72566036A4F4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 06-Sep-2017 13:29:57.
% 
% [Y] = tp9abee188_787d_498e_8fb2_72566036a4f4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-7409.93644730062;-911.082072190467;-1068.86784991252;-1175.93373113978;-1366.53951203702;-713.224898465736;-638.058802539165;-714.930642633142;-546.419507096571;-435.830146318456;-311.040988170568;-332.822721465584;-407.901071240809;-237.143827584623;-310.614407522918;-284.621358963192;-348.992764796131;-139.239122485376;-228.698126275196;-273.249410813681];
  x1_step1_gain = [0.000226370837385414;0.000563347828528141;0.000948114745185447;0.000858032283205088;0.00073024238319975;0.00151716399266528;0.00146770964020619;0.00151546500149801;0.00206494173697171;0.00202475070577009;0.00326439309746547;0.00229997229518739;0.00248425272472341;0.00412752991038809;0.00322794766513111;0.0034379785161607;0.00328303385537583;0.0072330023608855;0.00445727486740925;0.00407527899100792];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-2.3838367479155424533;-2.127422886334486396;-5.5663417742615903805;1.5947830939522387173;-2.2146360374975340157];
  IW1_1 = [0.5644690349471160884 -4.9572046257619826193 0.23956484887156404007 0.4523801736435608678 0.28661831637826501451 0.13163703730885381593 0.089018442531886871061 -1.1600762569355047571 -0.71017761302470205909 1.0880389863935422401 0.6350003797682344242 0.79837054118247818835 -0.77322866389171274193 -1.4805730666865255518 1.922056813219112037 0.30938931362820509818 -0.79428516854080144505 0.64895786860141846386 -1.6459941330276901539 -1.5779120155432722061;-2.4202641573671201947 4.3132848249149597919 -0.15637848032816337174 0.092411378078404535219 -1.5251163145150123945 0.35785426573793432947 -0.15123259938920691203 1.279261005755913061 1.1540105668074014389 -1.7725677758792706129 -0.93688394441939182311 0.22725179998197644893 0.49763364590705816415 0.98756526283289003398 -1.4096910422516175654 0.1137863082062351705 -0.57256442652904460111 -1.0323142972017784746 -1.1170237658357675681 -0.060499030976448958663;3.8659625108539952265 -7.1684642781257297273 1.0934726691930356512 -1.5018257165047290691 4.7438371742090916783 1.0728964963667488863 0.80049764063996975416 -1.2358576747519594008 -0.25539738003860729121 -2.0893833274565944969 -0.7784038557014432147 0.5154991757627481741 0.31645853501739468205 0.062454258929695076474 -0.2265460169729256179 -1.2656998201498408374 -1.356695399335304808 -0.10972078796011774937 0.45909473804046607714 0.22127157644138698012;-0.49665602162092992167 -1.5983327106280962315 0.16950211026297828942 0.78137755932699226591 0.02225591603972904009 1.6027241447189206625 -0.65300817940221878022 0.13795196767944445382 -0.72119723097265420186 1.872385782917620034 1.3045431807527465562 -2.7611031715144696008 1.9001168705035413886 1.0458870072290542552 0.16929811427242952293 -0.62288914232388037373 -1.2395030202171448686 0.32689430557717635839 -0.38887347572509251004 0.18676737414110405888;-1.7668987474744188848 -1.7171278093795894204 3.9761768125051153433 -1.3745636593760310884 4.3953163925738722995 -1.3688061766463366364 -0.80932390309601265344 0.47393077886358564443 -2.7648721825659103857 3.9127829249693202307 2.5973051195847500772 -3.9332345350482436075 1.4049077246561332277 -0.11367773390865297534 1.1483505837103882286 -1.2206956243419984087 -0.92511925080627110951 -0.84275767386512334678 0.45683024408897199287 0.093925020362752034697];
  
  % Layer 2
  b2 = -3.4817695322542663305;
  LW2_1 = [-1.7238582111987936774 2.5007607420592732339 -6.547272986459978128 -6.7705811933255173329 -7.8197809808495168937];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

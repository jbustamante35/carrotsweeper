function [Y,Xf,Af] = tp9d672b99_4f02_4cfc_91ee_39549e232a17(X,~,~)
%TP9D672B99_4F02_4CFC_91EE_39549E232A17 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 31-Aug-2017 11:23:42.
% 
% [Y] = tp9d672b99_4f02_4cfc_91ee_39549e232a17(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-5432.71936019575;-869.862833785136;-1049.49991804754;-443.772627598192;-714.411086543189;-480.217047911221;-777.126138223052;-423.084215360182;-653.051662017859;-389.58011173162;-196.783309561032;-287.5657553453;-297.646678764097;-218.810003102133;-353.098081769934;-223.467299701571;-286.654695058552;-204.435550163961;-158.324230994374;-152.060020549266];
  x1_step1_gain = [0.000193471702868436;0.000632867989749187;0.00106564221979597;0.000997750888431902;0.001370891058533;0.00172046072827865;0.00151665899401731;0.00273255835343164;0.0019281669968399;0.00237191709373279;0.00442707648453809;0.00359646519879083;0.00297276865939899;0.00492600826026234;0.00330719979527493;0.00368145234991299;0.00334825051970355;0.00421974226135623;0.00627715281361347;0.00572404098867785];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [2.230393215231296633;3.0921078690174339521;0.29257750134357801697;1.9248464388696857608;-0.61118164797147589429];
  IW1_1 = [5.7727659890219227279 4.1528869477026635337 0.9040380788102891918 0.67857950123789834151 -1.4331271351139518444 -0.12913698592626016159 2.0376833695528659973 -0.74822803774414037292 2.1504952573759426038 -0.58077295403364659343 0.24111406119668341019 0.46355071563637989529 -0.32864918116007801885 0.31108358105661243487 -1.3656522316608146195 0.59727414849788285078 0.93079409762237408366 1.0088264093184393655 0.071215927255562791465 -0.67711290205792429298;-0.73156547824359796639 5.9333250607324963255 1.0054104974118687199 3.1217786338940345381 -1.465899343292337953 0.049137345506183816024 2.6221358635874318921 -0.99248703626746281881 1.7722404031199217034 -1.5816774861118663154 -0.5736299200844390267 -1.1775836731916609068 -0.41850297756487064849 1.1371942954661129477 -2.0384546930004754373 0.071024358323355213374 -0.65464278601950620651 -0.47603156041812177968 0.86301341476626425298 -0.24009887949314584477;-1.8535499469788416782 0.75121156210464412606 -0.83092268674280800322 1.7513881190207629679 1.1352817409359137191 -0.74226406970043290467 1.8390228643132207065 -1.1843835593792484406 1.2809877198504686646 0.249166067800517671 -1.6128057925112970761 -1.4711162316633143998 -1.6220520352017497867 -0.68392132880894651592 0.11601231755919395872 0.27871535470831787507 0.28654946464813391138 0.5962762563182991693 0.1657875170509537921 -0.5984325121028961636;-0.0057062607595377810854 -2.0363032747774791886 0.4475570930271733916 -0.61876676413132247756 0.24366109971665309009 2.113595854593402823 -1.4621815039812195991 0.53590839885245289409 0.97861313192017018725 -0.58499594583301983697 -1.3143904415532028374 -0.41864705170020094505 -0.7662045524610232583 -0.62507651237820083256 -0.4021906966135471162 0.040803297291262842494 -0.86383424359156091299 -0.26116257927319885823 -0.69263691369082058813 -0.56766739299027657584;2.5407937309171177986 -0.73819078996833953354 -1.7530190625124100201 -2.7839505120819745265 2.517135918190664956 -0.43431252775850270886 -4.4698688345355348517 0.38601290701979534825 -2.695415368665150968 0.057726440190822327081 3.3253584687828978694 2.9384521090100275131 2.8003576092542461495 1.6300450103719326123 -0.790028911500352371 0.066712450624491118067 1.1668202397553342209 3.1177955787358873074 -0.78394730719740246538 0.43511035412034432257];
  
  % Layer 2
  b2 = -3.9708836156461146949;
  LW2_1 = [5.7464520652191968253 -8.7021697902008163794 2.9183055522727530118 -4.9547468847669602354 -8.4620003225127735647];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

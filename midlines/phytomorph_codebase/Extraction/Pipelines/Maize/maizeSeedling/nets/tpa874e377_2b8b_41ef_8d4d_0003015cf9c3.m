function [Y,Xf,Af] = tpa874e377_2b8b_41ef_8d4d_0003015cf9c3(X,~,~)
%TPA874E377_2B8B_41EF_8D4D_0003015CF9C3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 07-Sep-2017 22:41:20.
% 
% [Y] = tpa874e377_2b8b_41ef_8d4d_0003015cf9c3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1874.99930442497;-5454.91534726369;-869.204807020144;-780.471896742375;-460.20555521635;-234.310604878461;-540.291178237134;-572.142715533789;-192.819908210793;-263.800490630851;-210.820779921779;-258.183122033532;-286.590370604324;-190.320782432689;-193.663740648593;-194.470619647337;-225.820325675024;-213.719449945758;-258.858847398812;-135.174215342504];
  x1_step1_gain = [0.00034254044244578;0.00027748074658588;0.000806013241167019;0.00156677380853904;0.00168393926281428;0.00269046527889069;0.0019808499204541;0.00236361816544284;0.00245784730269613;0.00195235680232595;0.00282106579415899;0.00424658079482953;0.00317261769260759;0.00555458687461905;0.00429724736478086;0.00484270636687459;0.00333931608099048;0.00598913897545096;0.00384783002604033;0.00642488839732245];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-0.62607775947673793837;0.51183422735369876744;-0.027655926969770733281;-4.2606547043482976278;1.2425458589413704846];
  IW1_1 = [0.056790450295272354442 2.8519783926557695786 -0.97891565631676258352 1.3386990681097761247 1.5812754497572614198 0.22259571078726719806 0.23537018093936284968 -1.2275010340530798647 -0.5386796880456616865 -2.6128335974061331903 1.430000231903775898 -0.66094043376125866107 -0.043955434835628068302 0.19570845677052725597 1.33628109554762875 -0.24048445721448730161 -0.43891723473335531036 0.26055403811242872081 0.63051731253505050034 0.46432014385586123373;1.7365806380741073411 3.3601657639425033253 -2.6670131849565543725 -2.7255533679879713205 -0.44989704523930634794 1.7742864591866518431 -0.35349080083218509252 2.3663143082815931706 -0.83080676793810637193 0.2740355733734239907 1.3438948296802224469 -1.8586752173759379936 0.16963296745769979035 0.49925362018854635426 -1.564910664353804437 1.6102103366799704887 -0.23287024794974656161 -0.46383268894938400884 0.4344201168574191585 0.090310847277892264406;-1.8843666568894867908 -2.5187825555771539143 -0.37579127654518645896 2.5374841955608880006 0.33423718374818356391 0.89660295145879553846 0.91590605992641938027 1.3707481170025910266 0.86107674569928294162 1.4791622681927338867 -3.0417643453479716875 0.38005898283294087259 0.68652143672774934569 -0.35487849523456377332 0.5139409324914147037 -0.55053908235673465477 0.12016611970087183459 -0.14913238769555661745 -2.5457358698546301845 -1.2909161874925387803;-2.2429544375074428331 -2.169444074914341769 -1.1516117120057787204 -1.5240639463530345488 -2.4594047314251077374 -0.99431490552694834495 -0.43335599441276884125 2.1754757710344279076 -3.1035190435189394798 -4.05238131970306803 0.22853619099465735665 -0.54185292775393845144 1.4614605313709243539 -0.037351286708670709824 1.7354368764148611071 1.8888810357103151816 1.6684815709442712972 -0.15660681747014940091 4.2171060375566886691 -0.065602235365178077076;0.60686260053286467109 -0.32714286177249235488 0.75719858756017799362 0.049871054782498411284 0.17317425000297381743 -1.8299177699334501224 -0.87791768294422334318 0.82392582639808831235 0.62647745448547076386 0.31383505365920000285 0.24196365744612038928 0.041066950127921428293 -0.039601958071581733201 0.58641884091881046892 -0.22706180914003432081 -0.28022210756951626554 0.16968946792657457756 0.17881113223912195598 -0.32279015985216996665 -0.2341501850124683981];
  
  % Layer 2
  b2 = -1.9187466544538815949;
  LW2_1 = [4.0560104226630633306 4.7301309547454284399 -5.2256504175452445082 -6.8995611605004842914 -2.3461408000731482915];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

function [Y,Xf,Af] = tpb12a2f3b_cf11_4851_81e5_f496e22452c9(X,~,~)
%TPB12A2F3B_CF11_4851_81E5_F496E22452C9 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 08-Sep-2017 13:06:16.
% 
% [Y] = tpb12a2f3b_cf11_4851_81e5_f496e22452c9(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-5466.61789079662;-862.937878923583;-1028.71862143182;-451.710971542899;-692.538815519988;-441.043793232211;-783.667639824726;-450.026271289939;-346.375264292284;-416.411813428011;-256.51856505755;-268.743398235235;-384.146123020666;-202.97900708079;-233.26635345097;-248.555985162471;-227.243600250108;-191.974128700895;-162.786711803946;-176.062817024279];
  x1_step1_gain = [0.000192953812201725;0.000635170113819408;0.0010737117105794;0.000992967389065699;0.00140247416929524;0.00179426803546528;0.00152094087103248;0.00262475201653711;0.00199415494766511;0.00251075910029927;0.00454433874041199;0.00378662000738725;0.00302237737948971;0.00448879604138546;0.00366080733460348;0.0036305723053374;0.00381924645546752;0.00427537582274363;0.00592120551781409;0.00602422138644369];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.7552551184079896451;-2.3399788871195879025;1.4740902822748265244;1.2506527505285027768;-3.7191321473477647608];
  IW1_1 = [0.15374417802900958163 1.2326738624231283747 0.093032087434793117597 0.25347833699335003965 0.57595406911811075634 -0.63017911160673778515 0.5951992074972443092 0.28583807990328669035 0.20016126374564480184 -0.034368927054607402438 -0.22643309827734350859 0.074104594567036469188 0.12144078821378512245 1.0393740250959713212 -0.43093609931445187033 -0.48416083150468863794 -0.24579703619744250331 0.6115683983044201133 0.093883973324908692737 0.60917943089456516592;6.3676105019717423872 -0.8243607264889105668 -0.92587343487004503118 -1.7604933027517553068 -0.18125739349378303111 0.72025455880406519249 -1.3866009519345037226 0.48618543287520243901 1.7235914426037153291 -0.37561782788892084106 -1.9872027078849754389 0.6481614889614926156 -2.8886489083211710494 1.1193924135059301062 -0.32926229611174756551 0.01493510560322298085 -0.28780741371892420988 0.41340072679520067922 -0.49252090762130074086 -0.029115154369242085552;2.8620074178603878146 4.1994447617562613573 1.9443052647310099523 2.0109574059415677993 -3.4089135263983130208 -1.2003122733929174615 3.2501496874442810103 -0.65034161683349756 -3.6642141864981465638 0.33687368982577281518 2.1985976361596777373 -0.89783944971288309755 2.5293841154443836849 -1.6181206421642455595 -0.57540877380209820569 1.4934053519262970866 0.67720986711776587352 0.0026026198702818110521 0.76325331236577553806 0.71448281597105745;3.5350436015886472774 -0.57089060057512119872 -1.6021803719040730307 -0.61958332540166138891 0.79969928923157251877 -0.48425188093869597772 0.22428100451188964781 -0.73660884755917810374 1.2720430273611755823 -0.55263571463899285874 -0.78744903411735378551 -0.3807879762492569764 -0.49305894028741747981 -0.42094729370287059522 0.11729403173912376912 0.33896632981552327069 -0.087078161089956682139 0.76882432246338150428 -0.59191629847918725282 1.0082105861245496126;0.45008191033113909008 -4.5752985317999614878 -1.1028596737107831949 -3.4435583332067736251 0.77034656864927497644 0.11479719879959889017 -1.1693993753159439564 0.68418562825169126906 -0.14171353999886354691 0.88424227126139953725 -0.28513271086524388798 0.48336997824519722933 0.086602014645254618563 -0.41087206933453779278 0.14235828108847689566 0.19143819445947998781 -0.76280679124600614394 0.63672075712513531709 -0.71186444654156055822 0.54332170934168089182];
  
  % Layer 2
  b2 = -4.8728182953393766041;
  LW2_1 = [5.9413238635558460743 -4.9374098912504758019 6.1314503067662613489 3.6565763484233215763 4.7603324035535576897];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

function [Y,Xf,Af] = tpb8aaabdb_d649_4df4_9e13_60abf43650fe(X,~,~)
%TPB8AAABDB_D649_4DF4_9E13_60ABF43650FE neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 04-Sep-2017 05:22:33.
% 
% [Y] = tpb8aaabdb_d649_4df4_9e13_60abf43650fe(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-3289.74882371951;-1498.84051842406;-977.818006857929;-2473.29678142316;-579.957172766839;-720.151909430008;-474.399996307271;-522.242249232238;-420.226401116415;-417.475292942102;-306.200888877846;-388.367090162114;-291.39584507413;-376.41158617709;-312.430500619524;-321.397730757893;-187.250317730238;-207.6057814029;-300.292838284029;-183.531087713646];
  x1_step1_gain = [0.000377693156370527;0.000577456077299579;0.000763241531595339;0.000656175798642299;0.00207889551360641;0.00132289146378879;0.0021050120182425;0.00188095402340317;0.00237297796658717;0.00258788322162196;0.00300539389135355;0.00292429008303261;0.00346972867854873;0.0027353103189004;0.00311974005335499;0.00346508516159045;0.00478122411926405;0.00448287798328073;0.00393490060972037;0.00521177147160682];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.2336626177901275359;3.7906575715681505301;0.52844737158944166122;-2.4202580310093275706;-1.2493854559555475081];
  IW1_1 = [-0.57719063039875262433 -1.3113620985846534683 -1.9658950599758067135 -0.73793997280520784443 -2.0946436509166050932 -1.3182408847764981452 1.5597776823036786364 1.9846675113598524209 -2.1010405298599890145 0.45416762187745002288 -0.4127279273818086347 0.49790029977842059639 -0.44785203987784055757 -0.32554542131885150225 0.30806813899012164271 1.7799754320517879869 1.6360273646861105412 1.182689236823848189 -0.045442870877672764118 0.5746694459567032176;-5.5734549115082030468 -1.9794516077770396567 2.3682529735937256632 -2.5539806102008522082 -0.36080760097468106418 0.78615340407857958738 1.4268626712665741785 2.0639787685465975642 -1.159142516571536774 1.5118889606563461481 -0.23683371476671297162 1.3427722387924043712 1.0263723135019471311 -3.3277892712116243779 1.2744153127450861263 3.2801630411365079176 -3.5452613606893121911 -2.1793268028695349514 1.2311685102335570008 0.39639784067078115415;-1.2670761095879512492 -2.8702319329509200507 2.8687852753120823834 -1.065842111790279656 3.232013368087687244 0.37573374298426875928 -2.8356982057793547192 4.5486635863134896596 3.0683268617522263533 0.72786262390200417993 0.81479202684866813833 1.0628594256106431715 -1.6591136342955483673 0.91408222298077701495 0.3324671952980916001 2.5607928323347866062 1.6109982631405681541 -0.3115219108649007751 1.4768388349208960708 3.6435791868721172371;5.2754239498048374202 1.3507823650625863099 -0.67433146688189704587 4.9022022773601099388 0.64791430704814678698 1.3021070059172081823 -1.8446528014537073581 -2.3326968316840570594 2.3209477107791425254 -2.5862953637580039512 -0.1692252761907294123 -1.4032798121449558959 0.39226658674835007679 2.4070474550134246527 1.5374177898068450698 3.0155069236563751822 0.50307596562446388333 0.062258749442233925209 -1.8721009152100511752 0.87812869535029980383;0.75999781510617270275 0.1925042530123398099 1.1245615613544850397 -0.48824337584604127205 -0.0019741972357615713077 -0.22854101367090090546 0.33436872714493215408 -0.79901757258873906675 0.43716082332048594727 0.74552865413394620031 -0.31018989617800829528 -0.96281819289202874579 0.035182511646396207039 -0.22409070704178726818 0.1555022400548039252 -1.1836054834202409669 0.52319019667911847993 -1.7528302868265546177 1.2729007192165482376 0.62579685977463572755];
  
  % Layer 2
  b2 = -1.5657656544597318149;
  LW2_1 = [-5.0514822876151654896 -9.0387950904602014646 -7.9262994059557554394 12.061312268203584708 3.1060467949290990752];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

function [Y,Xf,Af] = tpbd1418d5_7505_469a_a54e_f3f3469cd061(X,~,~)
%TPBD1418D5_7505_469A_A54E_F3F3469CD061 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 01-Sep-2017 00:42:43.
% 
% [Y] = tpbd1418d5_7505_469a_a54e_f3f3469cd061(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-5466.61789079662;-862.937878923585;-833.978767721889;-1562.45386611791;-692.538815519985;-441.043793232208;-783.667639824726;-311.950474474653;-346.37526429229;-416.411813428014;-256.518565057565;-259.432124024252;-277.58461039875;-202.979007080803;-233.266353450971;-248.555985162467;-227.24360024981;-275.821003918882;-174.982344511226;-155.93029406899];
  x1_step1_gain = [0.000192953812201724;0.000635170113819407;0.0010737117105794;0.000992967389065703;0.00140247416929524;0.00179426803546528;0.00152094087103248;0.00262475201653712;0.00199415494766509;0.00251075910029925;0.00454433874041188;0.00378662000738729;0.00302237737948981;0.00448879604138561;0.0036608073346032;0.00363057230533682;0.00381924645546921;0.00427537582274443;0.00592120551781351;0.00602422138644137];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.8896581180139002676;2.3571391340672178671;-4.7986683438872681506;0.86577692517493809454;2.450389463771005083;0.52198385734875984987;2.5115749242990084156;2.2094491771528712576;1.1140331726561558678;1.1500310188798266164];
  IW1_1 = [-0.37044234742331832999 -0.35482996594816362812 0.061477208247054562773 -0.57843081120210415591 0.20848639862088205743 0.18009651449509947452 -0.19931524025890473562 -0.42378828834101722745 -0.23502647178621249857 0.31428023417708095266 -0.29823187290608765831 0.39177747939130197485 0.15660101813940482951 -0.4391274324359333292 0.013051080642332115941 0.19005749041841721314 -0.13799230316025415388 0.55175578615941356375 0.57798997156300113698 -0.28590914444722165255;0.17075898658731705759 0.18085839853102658736 0.067740758303732523382 0.032879802948336672719 -0.21387719628779841563 0.0565743912349930822 0.13633878076023264736 0.29611559086198263602 -0.34880389945238343685 -0.1858821879152388612 -0.10849573393203711114 0.44560534389545580769 0.063748381631260897517 0.2903647215682380045 0.53389610912938445519 -0.23073358142008473792 -0.05999781172690365344 0.53578628597325383964 -0.13672867458626655757 -0.24439530558280989081;0.00061515313751234548811 -3.4294481922030874976 -0.54104828282133032857 1.4816747252590412032 -0.40301119344444480408 -1.0843489399392431949 -3.5182485350370398258 -2.5255307976160512595 -1.3645639077437459186 1.3779972571691756489 2.0017887752193042061 1.4626616847480824468 -3.1130431973445276128 -1.655041514730105412 -1.5969055361433817097 0.49888105707711333237 0.15293824339688863456 -1.2018344998853345285 1.0463942710909981404 -1.5747746200416783413;-0.89108728253224933624 0.38072115239582376978 0.47300035557110131634 0.008345605072421343959 0.13862168127770499448 -0.26197725636706775676 0.13028499048762548496 0.11147970470030715839 0.86754730384878764315 -0.10464453112797346412 -0.06924607944732076581 0.096971874406166863603 0.52210100509684431724 0.82493228002679475086 1.0204111081915816506 -0.49185314888794229304 0.086102335736179147485 -0.2535535811726457589 0.16982999244286850482 0.0076992145391818166134;-1.7844708919845833073 6.1371846887161503048 -1.6067374265513585385 -2.205816775949156483 -2.4876309020454869803 -0.24939673068863199568 2.5929806679308224915 2.1132932554915311307 -1.4740931631396281265 1.4715311623315248113 0.86542544527750497885 -0.31218016204103510303 -0.22362263619662173242 1.2552135870552985075 0.92016130253337169442 -0.55368060991717482633 0.45187358390605697478 0.77916788186395014026 -1.0734142571081941586 -0.006241280698548517733;-0.91953118319179560913 0.88175265367581490139 -0.43169548040479832629 -0.31257562147527662155 0.13646325983451026986 -0.0034350702175645567854 0.73687718410381153333 0.5762940501560833706 -0.18519252146865169961 0.031721626233501075409 -0.003992136685494467041 0.26816683604174501587 0.37989757246015393166 0.11448011219302782482 0.35958318228663382898 0.69947687453049056661 -0.61057266931176756852 0.27337204158980715762 0.23661200198910173342 0.27833559714527722484;2.923341704394997187 1.0685197400367010268 4.1924836792278386 1.041563050537682944 4.7012398308566227811 0.2487035633521713085 -0.32718686924683815231 -0.26553623574080559289 6.2508306970638010114 -4.6246790821126211313 -5.9556476586248940919 -3.121703536896933695 4.5427702006156414072 0.071084711445127540808 -0.57877324448375588872 -0.61093795447605259152 -1.0371151494628572109 -0.06465608438243988787 0.028979136290378054025 0.99277082116453418958;0.017694378905687584147 1.4380634515205639179 0.24927728871277057832 -0.72284926037461783022 -0.35324354741713209771 0.49345404201872550276 1.0227127122016579364 0.55488655769270123219 0.46376889817859540122 -0.053500530146632092887 -0.89508896451227670799 -0.52931283217067404134 0.58353213909468304443 0.60317337615175581345 0.62414526178644824661 0.55149487533526231342 0.4495184143411448674 0.63394736787433614289 -0.35236661569707639075 0.1805943860757582009;0.40696943356992687502 -0.10913313838739731321 -0.37343861154409757619 -0.18367635619959662985 -0.37553773361023895516 0.41448815176748854405 -0.50758564482841184162 0.082706760665543818667 0.1704516650835186109 0.61081802901621384816 0.45673677384726474315 0.095844798364228836474 0.047830379726185888456 -0.54900472990099180581 0.19144888522549741161 0.10725931180110169494 0.25081350788282780195 0.5107638786380782614 0.53187591617647156372 -0.21293599303170118731;0.46681448400394848219 -0.58237164734987612036 -0.39405815548710393381 -0.17806020248483739321 -0.45576057325335034287 -0.23652218905491617651 0.17707553620760660418 0.47300359207285108676 -0.40347340501216394371 0.37234157908231380052 -0.51764614722554003201 0.064301872822655037343 0.4784645141097320642 0.036075127919720256786 0.40249949122952238811 0.50724893223819866872 -0.43914915033357543317 -0.075659803516797657919 -0.60249174479055367382 0.12338327819911222571];
  
  % Layer 2
  b2 = -3.3004565920394881573;
  LW2_1 = [-1.9084031337112556947 -3.0777476848642808527 7.4948290945262190377 -1.2308339254146625219 -9.7402881540108161573 -0.92110666726388268355 -12.99345280792200974 -3.0529292742835094643 -0.63020186392598431802 -1.3433771627216941624];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

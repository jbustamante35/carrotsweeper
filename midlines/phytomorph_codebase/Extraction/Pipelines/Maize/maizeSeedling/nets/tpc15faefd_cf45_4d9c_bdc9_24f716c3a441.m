function [Y,Xf,Af] = tpc15faefd_cf45_4d9c_bdc9_24f716c3a441(X,~,~)
%TPC15FAEFD_CF45_4D9C_BDC9_24F716C3A441 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 31-Aug-2017 19:43:21.
% 
% [Y] = tpc15faefd_cf45_4d9c_bdc9_24f716c3a441(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1874.99930442497;-5454.9153472637;-869.204807020144;-780.471896742376;-460.20555521635;-234.310604878461;-540.291178237134;-572.142715533789;-192.819908210792;-263.800490630851;-210.82077992178;-212.784015206651;-343.803894881911;-169.741999038738;-193.663740648593;-194.470619647342;-225.820325675014;-120.218367860412;-260.914631799827;-176.115238468633];
  x1_step1_gain = [0.00034254044244578;0.00027748074658588;0.000806013241167019;0.00156677380853904;0.00168393926281428;0.00269046527889069;0.0019808499204541;0.00236361816544284;0.00245784730269614;0.00195235680232595;0.00282106579415897;0.00424658079482958;0.0031726176926076;0.00555458687461902;0.00429724736478089;0.00484270636687441;0.00333931608099056;0.00598913897545113;0.00384783002604036;0.00642488839732227];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.4385571855499084126;-1.3106065890982787625;-0.091334034562750715525;-0.320467432996389745;-4.5103327714621279654];
  IW1_1 = [0.95699178909258753034 0.73079742352107424086 0.14287225864945363174 -1.883071423106537079 -1.9212010316264942489 1.499738629097008058 0.6843317099390486824 -1.0079945911860119789 -1.5739805575356102807 -1.993661393750742139 1.968772608636249366 0.69767684173263988523 -0.26581520607130360023 0.52194840243449391881 1.1069814871718814953 0.025287850883836247851 1.1594966208321397794 -0.58015719841612367613 -2.3901260508756645429 -0.92324045465480764072;-2.1809899712242351022 -3.3471026303100508414 -0.93617037179638151745 1.362899839070365049 -2.1920210899327519094 0.49492734923126752156 0.32637732398624297314 2.1466045087603351504 -0.23022822311315344068 -1.2099267532277802051 -1.2727810685956484349 -0.30611026619662790038 -0.84764361599644955092 1.3878023455863217617 0.025568205899308395213 2.0498787937487885635 1.8140563434847090107 0.12871804477701012659 0.5859505139166808485 0.47377359501272831022;1.971395492110300518 -1.0941656444547100957 0.63956405863175358473 -1.8190343298923450366 0.084868543985397254525 0.88046306542064278755 0.4983583223505461679 -0.1594933503892378146 0.020108298394681055343 1.6901732007837857452 -2.1412518491189862502 -0.94266417838501836979 -0.62931096597179547736 0.15100622522119577784 -0.82918413250425315741 -0.20204255111555621816 -0.34115562277964173177 0.070481234724985672435 1.3731435811780807743 0.57500969363465015416;1.067093034171449073 2.7807779984877050161 -1.7756828346579816014 -2.1043649451471964085 -0.56482239724763894095 1.3280281489550171958 -0.3069763542054162464 2.0079001601930479559 -1.7641292263754351222 0.43653499637621484553 0.81775466738497037955 1.3181054294579350739 -0.062034528536476243876 -0.04149207723071365872 -1.3105408037665620125 2.2506623609057454516 -0.19173867875849426312 0.12855853679080170293 0.18345391554478029938 0.16212458013183145278;-2.1980636950379466299 -1.8419322142888283622 -0.63459059696173503173 -1.550418454258890133 -1.9020240572736066831 -0.84022159870022439243 -0.26574236562503406045 2.7531976462788931848 -3.5802335638165816434 -2.6044750967316154799 -0.42494011645433671376 0.615192602455550408 -1.1532091267988626715 -0.15639276889322151209 2.1418256928605661216 0.70676079440071026827 1.5011180276613855789 0.095658146517188819002 -2.9659902163265914332 0.67586102929629299219];
  
  % Layer 2
  b2 = -2.445902086210232973;
  LW2_1 = [5.4400968470259822851 -4.7265348918331451245 -4.5630735318894632968 6.1252610448046551639 -6.3121720007091557392];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

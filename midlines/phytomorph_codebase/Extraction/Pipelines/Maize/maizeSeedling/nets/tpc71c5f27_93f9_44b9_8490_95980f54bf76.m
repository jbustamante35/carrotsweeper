function [Y,Xf,Af] = tpc71c5f27_93f9_44b9_8490_95980f54bf76(X,~,~)
%TPC71C5F27_93F9_44B9_8490_95980F54BF76 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 04-Sep-2017 02:32:49.
% 
% [Y] = tpc71c5f27_93f9_44b9_8490_95980f54bf76(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1874.99930442497;-5454.9153472637;-869.204807020144;-780.471896742375;-460.20555521635;-234.31060487846;-540.291178237133;-572.142715533789;-192.819908210793;-263.80049063085;-210.820779921777;-212.78401520665;-286.590370604325;-190.32078243269;-193.663740648593;-194.470619647337;-373.104709120357;-120.218367860417;-258.858847398808;-176.115238468632];
  x1_step1_gain = [0.00034254044244578;0.00027748074658588;0.000806013241167019;0.00156677380853904;0.00168393926281428;0.00269046527889069;0.00198084992045411;0.00236361816544284;0.00245784730269614;0.00195235680232594;0.00282106579415897;0.00424658079482964;0.00317261769260759;0.005554586874619;0.00429724736478088;0.00484270636687461;0.00333931608099049;0.00598913897545096;0.00384783002604039;0.00642488839732228];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-0.21849340482800691521;-0.49479272223804632302;-0.18750797512537970002;-1.3961657368770521437;5.2209493186618498584];
  IW1_1 = [-1.1302936397235650023 1.8105931617372077458 -1.6643219724634696899 3.3130707457120158743 1.0093747891517799165 -0.28711291246686054812 -0.3331220344922877219 0.60244758017722122023 0.027693160947800658789 -3.5959978399717655861 2.4990407840775961112 0.62507390585721178677 0.51939973166001496274 -0.29908179677733665036 0.82931823089947109828 1.2333440505184189995 0.57903058897619752443 -0.12597859909802841538 0.89517444693471792672 -0.66943995313341941866;-4.7920907877310625622 -4.748165461223699424 1.4648407385465178621 0.94741185745058853485 -2.5268039721462440816 0.33599401566984909984 0.30063077877534066795 1.4813859881020672304 -0.16160667368821496348 2.8797467355397921018 -2.136151180854596987 -2.0306340709979471271 0.94264824459552343239 0.42507714776762406395 0.814918793368114458 -0.35300595023299369268 2.0027687934207270004 0.63950164601905301609 -3.7751457131731069872 0.65276300128033182268;1.1505965352050813166 4.248087464250741796 -3.1439611737862231955 -2.679290733651718881 -1.3359651523762625658 2.3884321146508904476 -0.15115389577165863622 2.254915322710385972 -1.2243324549637610854 0.62980605777222797848 0.71561347539780706395 1.4486962065607411621 0.34225337151815587999 0.38226376422658459031 -1.9824678058213154319 2.6486343177634523727 0.018516751273562892521 0.11588797278433350668 0.42429476123582227087 -0.45509796327351870193;2.0993629375338365151 4.0007171898053215386 1.6374654146872622551 -0.33266936442534328355 0.92960913100165110112 -1.820415940187902093 -1.6742502257884730454 0.56524223144791985174 1.9916491716619628694 0.94985789344746340834 0.40134020857983870867 -0.030094974035562944981 0.8882034796506101948 0.5818740424405335343 -0.70066575910372208558 -0.54202348096696018054 3.9264190493155455286 -0.15130175617370833496 0.32526436273947245681 0.61859439662260951032;0.98242247411290251069 0.48317486226510897307 0.80962476484837253565 0.35388978155155181859 1.4817466505814127498 1.6940421602738300333 1.3709942660357297139 -3.026521237654081542 1.4385576488667908279 3.6858700253097458344 2.2810088779079933374 -0.27110795577236018739 -2.0178748563234014668 -0.018473137772992458822 -0.51726014585085022812 -1.0918263256506999248 1.7061510189907258539 0.32683733969265971187 -3.3806067991052590749 -0.79943547151996141586];
  
  % Layer 2
  b2 = -3.3883146307398974706;
  LW2_1 = [4.4445066438445977042 -4.2300156429266291269 5.6975173801499012782 5.2880451008825684056 6.5005846387405128439];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

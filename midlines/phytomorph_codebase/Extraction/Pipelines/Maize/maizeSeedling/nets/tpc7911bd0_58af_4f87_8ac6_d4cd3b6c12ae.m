function [Y,Xf,Af] = tpc7911bd0_58af_4f87_8ac6_d4cd3b6c12ae(X,~,~)
%TPC7911BD0_58AF_4F87_8AC6_D4CD3B6C12AE neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-Sep-2017 01:50:40.
% 
% [Y] = tpc7911bd0_58af_4f87_8ac6_d4cd3b6c12ae(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1710.79601884288;-2767.31086728677;-1769.06834334395;-1424.63292253516;-1115.63541033652;-861.953076142257;-996.664725988395;-421.625702789083;-721.553885286553;-557.274532479575;-502.132109545512;-541.944235264826;-543.177005191315;-167.207345824929;-344.528961662814;-294.40177640271;-391.010406370096;-235.625647900174;-174.29482448456;-301.038307242048];
  x1_step1_gain = [0.000202107905561192;0.000554219398814734;0.000742185534904078;0.0010185341647551;0.00103332655312912;0.0014768159714401;0.00118221307527392;0.00265958726683853;0.00125235891924471;0.00165285753177998;0.00232860128237173;0.00188013184297679;0.00198822427969296;0.00479968082327791;0.00252047169225138;0.00363117206158384;0.00272984263620493;0.00383651951608932;0.00502254586493048;0.00330771328744488];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.5314908540755358679;0.32777795513568475094;-7.128575276676819783;-2.5366602592179110509;0.13936226164996518007];
  IW1_1 = [-1.6700222733814178433 0.77128232092939985609 1.769073074360911102 0.91506418471815720306 0.60705216464609823568 0.057898054470761184387 0.10130899937043719161 0.43606968530373335646 0.48682313075410704739 -0.36099227756987034565 -0.61716578299875024527 0.67128676465034897713 0.16404527096957843835 1.0473183475690115429 -0.37582093359091983675 -0.67751725357369441127 0.7111616061022631996 -0.26036072741525279062 1.9401250796153983735 0.22274730886690632947;-1.3543831534113224269 0.76166659373858647264 0.88881354498193543279 -0.82078075711921938407 0.74968447350966582743 3.876185081312156111 1.2281488834760689866 -3.8047863819201817037 -0.054762012344493640748 -1.9991939071502882186 -3.5870511381805028073 1.9853855663667583364 0.55735916989748190975 1.084398800336280555 1.6869665754224829612 -3.2513882286386266429 -2.86486290203453553 0.2019596936103977558 1.4737355584477316306 1.9213715424151094346;0.3689949570210515617 5.4263023086227111236 3.3341051682677620427 0.93364360953472158577 6.140044922751256351 1.998476906402553821 -1.1173996953872114002 0.63813433131579988533 -0.9473505290871794271 0.64094942555688194652 -1.0620940773548117608 1.6893538176968307951 -4.8252669283860400995 0.5508851192255331819 -3.7474567383333727832 -6.1712599911494585569 6.6273777376625906399 -1.1106050518836640961 0.51124823684351239361 0.45937812130192107185;-5.746237697255170751 -1.691712825060285974 0.36338624931266633178 -1.0167098077848248927 2.1855462079006207077 -0.35209167912261046807 -0.43721841051267534839 1.0163322795518163755 -1.0308667362014403146 0.76557267380956384173 1.250225402134547803 0.25775396185902427204 0.017432396992356692655 2.2870888460787903718 0.16274413159671385909 1.9663466666001629957 -1.2110147426154926897 0.40745333078625078915 0.55592620649779123099 0.35626946260609460015;2.509609265939834355 -3.7500193226968887572 1.7035150765443429766 0.33607669664457129333 -3.2481706841340325376 1.3805541989356628907 -1.6106767846169383063 3.2991429552785640489 1.6527184713187441645 0.37721190106977764422 -0.08218719072541109949 1.75223397460848207 1.3674750067659600106 -1.3412164395435364206 0.74176599693880573838 2.1113208492756028178 1.0552395213966561105 0.44567671459420910018 -0.81134182445348501656 -2.0768745674054134298];
  
  % Layer 2
  b2 = -2.6030250623789239484;
  LW2_1 = [-5.2634210651782664669 7.5925360757746105378 -9.9046210876365918807 8.9074350556184871408 8.1262175459901371255];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

function [Y,Xf,Af] = tpc8f3e13f_2fcd_4975_8c91_7586200b9cd8(X,~,~)
%TPC8F3E13F_2FCD_4975_8C91_7586200B9CD8 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 05-Sep-2017 04:10:44.
% 
% [Y] = tpc8f3e13f_2fcd_4975_8c91_7586200b9cd8(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1054.92998109303;-3159.48627075362;-2114.78087604941;-1423.59192565959;-885.057943991188;-486.212064486037;-466.558771320891;-686.259228054124;-578.923214789105;-680.040226027832;-526.427101249692;-436.274101764841;-464.119415341445;-602.900723427737;-237.436871082883;-373.225105661544;-301.98393648499;-284.873458506241;-290.570400999404;-350.305421104519];
  x1_step1_gain = [0.000201853701047093;0.000358308876895914;0.000501068237842807;0.000831515796852234;0.000879302903096351;0.000967909908790058;0.000979217898324414;0.00108578915137917;0.00217066128634303;0.00165661710022779;0.00119050056045196;0.0016087609924096;0.00270230114420067;0.00170182021982356;0.00262305491334273;0.00249971191480281;0.00300944378896509;0.00354914054319066;0.00406898355464168;0.00313490959585073];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [0.32223482658895624686;0.91985560492781170971;-0.49402593978979636447;1.724840842956343101;-2.2376093157782599441];
  IW1_1 = [0.1324283219252610222 1.610023979990152343 3.4713556077844160974 3.4300342635873510844 -0.12144794764314388591 -1.3006929355769123458 0.1863270380103715651 1.38972528225462022 -1.7225037133337945949 -0.69372820286430536552 -0.32804703679761942903 -0.82481664016582556531 -1.8007208863410872901 -1.2922753430428546295 0.64718907776648548769 -0.46666168957298209685 -0.90298624033457919325 -0.88012222392982641939 -1.3517904864251955033 0.90526060783181494518;3.3267373078167867817 -1.815652141815103926 -0.84552662535596945226 0.20503272649550485784 -5.2034892655208535572 -1.0898689141216588716 1.6401260531908061768 3.3786654031841880652 -0.89880790523353770727 -1.3894066499737074416 -0.82141737405687698104 -4.5743393231520350639 -3.1696229150282704268 1.6549883734010804037 -2.7481588596705139871 -0.49707810601865648481 0.51411244501076069913 -1.9671432395632950652 3.7510187892959074851 -5.6780417938273402001;-0.38873234935057326966 -5.0080884390934770067 -1.088514180783228591 -6.0482841111977689863 -3.6494534048576237062 -1.5766025279428308448 3.1822109111530818559 -2.9883666194283096118 2.1178542993665603333 -0.55023576686976416461 -2.2606146421965260807 -5.9678201655105240775 0.42411348105319041091 -0.8821557943354703113 -0.83559688468243764614 -3.0614052972387764129 -0.24452634289993796513 0.14049340611156696523 0.69794072607961432642 -1.254110025264452366;0.90473496235688122269 1.3557303220198497762 3.2361768163627644412 -2.1892672810451032639 -0.95817002113229365889 4.3424612337343644342 -1.4139550836918042265 -3.0159512572428952559 2.2476081178016702466 -2.9622209707853199845 -1.2904036602573547565 -2.0605283217119363393 -0.26378820360748206353 0.14722150376839193697 -2.4047960701977415532 3.5504608944396305326 2.9988241396326285049 0.95335827241131687604 0.88881013060397850989 -1.2567976669025917591;0.51831378620113888189 1.5631762913201021625 2.2405618977397638858 -1.2962965907844943292 0.52400158042100108968 1.2713962549023345439 -0.7461516560263643516 1.4155165925724182419 -0.2108774797945180135 -1.0794406196849981594 -0.65638377597729480328 -1.6920400283306076261 2.1000039925658233742 1.6662165064796776726 -1.063844882103283318 -3.8547947435337004407 -0.79489206917332611013 0.71256517275023745217 -2.1523426386348343264 2.5601940491216472751];
  
  % Layer 2
  b2 = 1.134943858024043406;
  LW2_1 = [-5.3765197649211007302 -7.770993927343601726 -10.062459004854172662 -8.39270642422244606 -4.6579731892986036002];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

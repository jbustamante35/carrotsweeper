function [Y,Xf,Af] = tpc933046c_01fc_4190_bba8_50db009913db(X,~,~)
%TPC933046C_01FC_4190_BBA8_50DB009913DB neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 04-Sep-2017 00:59:51.
% 
% [Y] = tpc933046c_01fc_4190_bba8_50db009913db(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1660.06224852336;-1969.79757456081;-1377.69545894784;-1183.76616946853;-711.642931835561;-629.490616020366;-447.378118638317;-450.686587111716;-682.765477573457;-606.219316949419;-622.812481590521;-410.039334332744;-387.578117402333;-429.961560001116;-321.305329962882;-359.072122656301;-277.037336897457;-301.078315473972;-400.794724948408;-285.384637074661];
  x1_step1_gain = [0.000244911356138662;0.000507837665104201;0.00085908003133827;0.00102992699402406;0.00116476174985821;0.00153608271588201;0.00186490882819871;0.00229564725234538;0.00140550898923533;0.00187872252206336;0.00209870879134676;0.00237421637966942;0.00249683918257883;0.00271795669482113;0.00287765136194792;0.00323536160952172;0.003149651355242;0.00399550556362176;0.00295376821702634;0.00375051214875976];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [2.926733998473862286;2.6299435508356423519;2.0570136461796502125;3.5612957401890219522;0.12625645190299844556];
  IW1_1 = [-1.3759745398725595766 1.859957667178994356 -2.473002441166755272 -1.3744078067197098569 2.9878916420265930753 0.60414384352661820721 -0.49862941714598385534 -0.048469631838071493279 1.5798896017240871004 1.9401139660091606398 -2.0543089953306044038 -2.2445582728820951957 -1.007789143728597292 3.3312083833121342025 1.0504215935437111185 -0.86341993907963066057 2.3494031261083674345 -1.8246685711381351869 1.3539195392843943466 -2.2850432835609990612;2.963661794909418834 -0.63822704719678913232 3.1014149683351117659 -2.2107887520408744386 -1.1064718016672523415 1.7464042988672665579 1.0209400842303089085 -3.2091960875030940414 -5.9569172246173538454 2.7111187780820351634 -2.5037347249736141563 -3.2955923509042848174 -2.2418693190227472201 4.8053972208820168177 -1.8582284874076295811 2.4790739795070906304 -4.0297273671876387979 1.4517775297365909104 -1.0460337375343200517 -0.94914372804937252592;-3.8431587981543682275 -5.591514662242871303 0.73632512948833916955 3.1592880257183524328 -0.76584917992412360199 -3.710080471534907165 0.22761244462064630922 4.5642992605284655738 7.146290472770555624 -0.62368898392884919435 -5.3844915948824842999 -5.80883524272666385 0.95302079956968588359 -3.1650743567914152443 -0.00052891481808803927217 1.6389162169063862251 -0.63509551808338760015 -1.3850348610719924736 -5.0963777319095671103 -0.11347394969098643924;1.7077890337690144751 -1.5089421795847872687 -4.1377924867821489485 -2.4225742822957676559 0.48697975738592530481 -0.8687380801163350208 0.033236719280254380104 0.7270363113900029095 -1.5507073154971509066 0.74628456956993149962 1.6465660377269877301 0.86846119942840127592 0.60004856101649428624 -0.87414361472264945352 -2.2693939305801547057 2.8540841835242760638 -0.48345790997031240499 1.2332380654345604931 -2.034492961519971832 -1.5030543355707308706;3.1008342380422506679 -2.6525688972741696681 1.8765952864006898437 0.28637444885121954297 4.2264708742184495804 0.34957155138505846548 1.2061713114105379052 -2.0175056901191412706 -9.4901658546020719598 5.0418188424559442495 -0.5798142244327625372 -0.28904613748418306329 -1.3085996000908013404 -0.41698427492778306069 2.7394401133746062449 0.47570477483645057237 -2.2515589526427430833 2.5020461550361514647 1.9105171028278893353 -0.078861537115132496201];
  
  % Layer 2
  b2 = -0.78990645288484606645;
  LW2_1 = [5.6864582290609915205 8.531919501987470511 -10.6833934907153143 -7.5958304477597229365 -7.0323611282028473113];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

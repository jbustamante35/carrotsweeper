function [Y,Xf,Af] = tpcb223402_e950_44d7_8dc4_84ad49605523(X,~,~)
%TPCB223402_E950_44D7_8DC4_84AD49605523 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-Sep-2017 17:09:46.
% 
% [Y] = tpcb223402_e950_44d7_8dc4_84ad49605523(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-3289.74882371951;-1498.84051842406;-977.818006857931;-2473.29678142316;-579.957172766838;-720.151909430019;-474.399996307269;-522.242249232238;-420.226401116416;-417.475292942103;-306.200888877846;-388.367090162115;-291.395845074131;-376.41158617709;-312.430500619521;-321.397730757885;-231.052600123315;-238.536185311163;-300.292838284031;-183.53108771364];
  x1_step1_gain = [0.000377693156370527;0.000577456077299579;0.000763241531595338;0.000656175798642298;0.00207889551360641;0.00132289146378878;0.0021050120182425;0.00188095402340317;0.00237297796658717;0.00258788322162196;0.00300539389135356;0.00292429008303262;0.00346972867854873;0.00273531031890041;0.00311974005335498;0.0034650851615905;0.00478122411926412;0.00448287798328075;0.00393490060972031;0.00521177147160695];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [2.3740954407655392444;-1.9742485093814752251;0.41388412338403535173;-3.5773670049312094044;-2.619507690618041007];
  IW1_1 = [1.5827853733596175534 1.4450383308418661699 -0.36031257334816541027 1.3330502540897253283 0.91847764551155630652 1.1715971637136919359 -2.0414304666369664787 -0.63645105402141655127 3.2035141052033577758 0.87184996512542956015 0.45586241669978661006 -0.38064758462522696458 -1.7450086153009840562 0.0095913240569742708175 1.0402523307044271306 2.7568718402556919855 -0.074866907523456302509 -0.75207922714687658328 -0.079200134424415327694 1.2591854450891393213;-0.94457634593939066026 0.14790904074128111145 0.58649704606216856995 -1.1916145119067775848 -0.11054025260717409429 -0.028676413633737709435 0.025487876182310707784 0.35779544708872240699 -0.047756324179822159937 0.44954462863410388218 0.27275230160073654639 -0.32253210872022874955 0.28729992010909893851 0.098880762428166485423 0.22867113293958532538 -0.20938203474485203581 -0.43295782003740507227 0.23660767188640552394 -0.40204948969187487284 -0.45248646513236839839;-5.2782595553427418267 -3.7648229920621885114 0.45833762531809646434 1.7712357156917957202 3.265204359987963656 -3.4352102138604854176 1.8877825739783400394 0.99776552603289470067 -2.1868085047362781914 0.95668181504700933182 -0.22039822981445733596 -0.59037545184876072391 1.1438485992448481632 -2.1955463824844732024 0.7587574933688148171 1.93967433805544065 0.48725847396205956841 -0.18727711825096532428 -0.53300996435630276782 -1.1117177995634950349;0.83761517676994379222 -0.071812953923744399232 -1.041960793192812762 2.7975628619364814043 1.703826191716199645 -2.2076639689249364373 0.98000847522309586513 -0.99888589173289465961 -0.46956626313571453446 0.11795430038373660997 -0.51480752343943192439 -1.4860795113868787709 1.8243238727211983363 0.15218847705750296329 -1.0290524998152197345 -1.0164072432997488526 -0.96880458730897678343 -1.1829361287402302416 -0.85355513585555276013 -1.9607786141377638867;4.2731860393817830968 0.3859943078594773036 0.81811463755400348763 4.9841555713771912295 -0.38615382179298179954 0.67145116323584741469 -0.17156895438174246671 -1.7895246770796342517 -0.094572501508119188873 -1.0135023179502509194 0.48365545667281384379 0.9548496882109158701 0.16672431378024843429 1.0892500845248136443 1.009552096131353105 -1.3486039339127926517 1.1132407565571942332 0.067191276435420957402 -1.4266621510127799333 -0.33673179864770119707];
  
  % Layer 2
  b2 = -1.8703585265454569786;
  LW2_1 = [5.6815333218269410409 2.3502375756104614268 -5.8043782665310459379 6.5049924712137485727 9.3781534386685443394];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

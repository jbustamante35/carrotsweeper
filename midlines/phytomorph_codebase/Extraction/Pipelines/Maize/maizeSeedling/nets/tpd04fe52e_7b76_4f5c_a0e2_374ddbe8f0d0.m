function [Y,Xf,Af] = tpd04fe52e_7b76_4f5c_a0e2_374ddbe8f0d0(X,~,~)
%TPD04FE52E_7B76_4F5C_A0E2_374DDBE8F0D0 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 31-Aug-2017 20:25:36.
% 
% [Y] = tpd04fe52e_7b76_4f5c_a0e2_374ddbe8f0d0(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1874.99930442497;-5454.9153472637;-869.204807020145;-780.471896742374;-460.20555521635;-234.31060487846;-540.291178237134;-572.142715533789;-620.900292310247;-263.80049063085;-210.820779921782;-258.183122033528;-286.590370604326;-190.32078243269;-271.750472270931;-194.470619647338;-373.104709120359;-213.719449945754;-258.858847398807;-135.174215342513];
  x1_step1_gain = [0.00034254044244578;0.00027748074658588;0.000806013241167018;0.00156677380853905;0.00168393926281428;0.00269046527889069;0.0019808499204541;0.00236361816544284;0.00245784730269614;0.00195235680232595;0.00282106579415896;0.00424658079482957;0.00317261769260758;0.00555458687461901;0.00429724736478088;0.00484270636687456;0.0033393160809905;0.00598913897545106;0.00384783002604039;0.00642488839732223];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.4391009971414321367;-0.48730267135330290751;7.1213817865384720918;-2.9080958526139650822;2.136077086104350542];
  IW1_1 = [5.1945996208349152212 4.66950084464745796 0.52840911492105024916 -1.6299170893900036816 -0.60565256298416703107 -2.2783669295082753514 -0.74976657591336426378 2.4260660961659645807 -1.4441122431632660295 -1.4091917029909990511 1.2786681224315816774 1.084821290887402423 1.8733563708092975109 0.78987248737475690419 -2.6317597790502795796 -1.2345591996422844439 -0.38231554403454720559 -1.190487054724960192 0.74789021053994664268 0.72003346319765504369;-2.9410392925462698344 2.2211429273915941351 -1.6278692025363068474 1.9670106166496295064 -0.076466800596611192442 0.48655933825731501052 -1.1376793278136887455 -2.2175793150929585806 1.9919022722857753216 -2.5522282870808656874 2.3946042439422150494 0.084542770981109571782 0.28056940390333828805 0.94995684663336177334 -0.85487344364573647493 -0.25942418331323396918 0.33779035623492031926 -0.022075169423536423335 1.452545914955295947 -1.3577736798450981137;4.8760769983182763454 6.8457630831154112627 0.57628706395809548013 1.0447154092542281223 5.9417472134588207311 2.352241879197435992 0.5023425887451601346 -6.1716613378608586871 -1.9189961584744505974 2.1476091638857250921 2.9113710380552215717 -2.79315319917172733 -2.4210532671127817927 -0.73920240745340881627 0.16819101520925064386 -1.3004254187135144694 0.99116492809200285041 1.9576880493842567788 -1.8386080853185138295 2.693366014776353623;-3.8151777239409763176 -4.1980545762247043484 1.2775193910912916451 0.85974948710655396678 -2.8447830443786203958 -2.9833441345152547086 0.079498709441338979986 1.8145823429187417641 -0.51156315604875790548 -1.9460121284199189962 -1.3755940299682405392 -0.64507947526718889542 0.11973296430939704693 0.57770497901039352673 -4.1402792922030000611 -1.5541151039798986044 -3.6169891080687319729 1.7836012263073832695 4.3612661203333660254 0.11278855423609308872;2.0842103902954369765 -0.20887513792299225446 1.9644965662670368367 -0.081924637198188182685 -0.31379314081983022966 2.3351550268566576563 1.5117781794341167423 -0.01674889037022336824 -0.88512684882613779092 -2.7714378640878187809 -0.31896477332115175107 -0.42757639935492963712 -0.17943673272540583419 0.37823219470856367375 -0.95868837455032807071 1.5271578200598658892 0.13278491304233716597 0.42203405121103282349 0.20664297785973639865 -0.18475083317250992621];
  
  % Layer 2
  b2 = -3.4670607975648204402;
  LW2_1 = [10.07396169818461118 7.180174074921538363 11.523423401247480768 -9.2453311831689060085 -5.0228545814783904788];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

function [Y,Xf,Af] = tpd2936922_1b7e_4cbc_b452_f00fc1d7d891(X,~,~)
%TPD2936922_1B7E_4CBC_B452_F00FC1D7D891 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 06-Sep-2017 13:07:46.
% 
% [Y] = tpd2936922_1b7e_4cbc_b452_f00fc1d7d891(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1710.79601884287;-2767.31086728677;-1769.06834334395;-1424.63292253515;-1115.63541033652;-861.953076142258;-996.664725988396;-421.62570278908;-721.553885286553;-557.274532479567;-502.1321095455;-521.810951623235;-543.177005191329;-167.207345824932;-344.528961662819;-294.401776402707;-391.010406370085;-285.680184537946;-174.294824484551;-303.609020442415];
  x1_step1_gain = [0.000202107905561193;0.000554219398814734;0.000742185534904078;0.0010185341647551;0.00103332655312912;0.00147681597144009;0.00118221307527392;0.00265958726683853;0.00125235891924471;0.00165285753177999;0.00232860128237175;0.00188013184297683;0.00198822427969291;0.00479968082327789;0.00252047169225132;0.00363117206158391;0.00272984263620498;0.00383651951608921;0.00502254586493043;0.00330771328744494];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [2.6840037480514600254;1.6507977580170662968;1.164210415515681607;-1.8095464150596134445;3.161988265033270018];
  IW1_1 = [1.3115752936652431693 1.7733963306408024874 -2.6252812480728531241 0.92480230129755325308 0.17060565938966509858 -1.8738223872358619193 -0.31921820726468630447 0.30375613658593247912 -0.069809072801515714701 1.0673411883092183139 0.59564433155886853388 -0.70632489978000645436 -0.39904652631020953724 2.0389296993046657214 -1.1834585594801552144 1.2512476946329231797 1.1270039793186445998 1.5379945802249836984 -1.868023869500973877 0.81108540736015821704;0.97719363125975189366 -1.0675170030644440811 5.1824814323934811355 -0.33189837702746172177 3.7227828791039905276 -1.1636081025141904455 0.27102680165261794354 1.1353739658403048107 -0.24249850721971966117 0.60289567319436920823 2.1613769882926359145 -1.9207980105732509468 -0.44629482991450636353 -3.0416111503708855857 3.5758283635345575746 -4.3029797716667195218 -2.1831548362645456507 0.65717312937413463469 -0.3902074185768386605 -5.4607238210085968788;5.6017744573598013957 -4.1934436096185967457 -0.26716977751189485701 2.1863429768136120046 3.9543489477272868449 -7.3911289934733348517 3.7193847903631831464 6.6797486476234313457 0.25937644793925745956 -1.6391600440813205442 6.2348756264240456915 5.6923978078299590777 -2.6223717591684483352 -8.3501184027021082557 -1.2773543012509847028 -2.8083456243656943485 1.0866421712404292776 -0.25568241789824658339 -0.58213999312288433607 -2.8778602568756435076;0.61180973111448888613 1.5903818696208962269 -1.1559307443729385234 1.5930411192404483334 2.8639151155524502634 -1.7388146366946324317 1.0719701081858099556 1.3335818062409265927 0.59227009216060177987 -0.80197197292160271598 -0.58299476067971101045 -2.3334313885303941127 -2.7970254647026004946 -1.9398185807317815943 -2.9603394516358418898 -3.7938995092415246368 2.2563191681457568372 2.8465396304450822917 -2.0360147673717654548 -4.3346087252158334024;-1.5644034817712484386 -2.3192442242831092791 -1.1786054918299175842 0.2963761386075097759 -4.3887494034999576797 -0.20008161524400347453 -0.45153450845449882856 -1.9251359196910686755 6.8109738009430609296 2.825118846092011804 -1.0541866289024732772 -0.56939878987576508784 2.1991816536116135516 0.31255215405045333465 5.3099283706528543902 5.5878413894463134781 -3.9084598547454261208 -1.6756633176389266193 -0.7459646873944800749 -4.214638685139826535];
  
  % Layer 2
  b2 = 0.66378964947939400609;
  LW2_1 = [-6.2534203518380300224 -10.272619496160196206 -11.792592234069498858 7.1113447165864238642 -12.510203150577076769];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

function [Y,Xf,Af] = tpd3dd62ef_6ac0_41d7_8bc7_6409368cf1ea(X,~,~)
%TPD3DD62EF_6AC0_41D7_8BC7_6409368CF1EA neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 07-Sep-2017 16:34:13.
% 
% [Y] = tpd3dd62ef_6ac0_41d7_8bc7_6409368cf1ea(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1874.99930442497;-5454.91534726369;-869.204807020144;-780.471896742375;-460.20555521635;-234.310604878459;-540.291178237133;-274.017645408135;-192.819908210793;-263.800490630849;-210.820779921778;-258.183122033518;-343.803894881913;-190.320782432686;-193.663740648594;-194.470619647333;-225.820325675016;-213.719449945766;-260.914631799825;-176.115238468632];
  x1_step1_gain = [0.000342540442445781;0.00027748074658588;0.000806013241167019;0.00156677380853904;0.00168393926281428;0.0026904652788907;0.00198084992045411;0.00236361816544284;0.00245784730269615;0.00195235680232594;0.00282106579415896;0.00424658079482965;0.00317261769260759;0.0055545868746191;0.00429724736478087;0.00484270636687467;0.0033393160809905;0.00598913897545074;0.00384783002604036;0.00642488839732234];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.7935145681676878393;4.156292197019344492;-2.3062502958486525984;0.041670642220666645472;1.2754194349283760612];
  IW1_1 = [-2.8375396749104218053 -4.263969438771708198 -1.7019331852116776904 0.66229713949801272133 0.428515568362368926 1.8292161943113407485 1.9290916134800852877 0.45466620139497776476 -1.2470238472378178951 0.1462991859640316028 -0.86629828778590012295 1.1972956406033179455 0.77777678228441526898 -0.48165721895303548195 -0.39610384336183718235 0.49504107331246860468 2.4969406949136105922 -0.56550896253344673514 0.49268760128538513499 0.46696664117668673644;0.42972898398755277061 1.4172985800483068886 -0.42904523739654493175 0.97717239481466144913 3.1040192061008169411 1.3455237648524513983 2.0730665434239137213 3.4292497011416638308 2.4405036019559345206 4.8829327204136889762 2.0771740678372054845 2.0351153317867844983 2.7241152849660510427 0.35865797914483432685 -3.0829925500003834138 -2.0954703136519463591 -2.5548766190399865295 -0.034631889887101724446 6.1004939892584211236 -1.0672263500014678161;-3.7427256359692089305 -3.3460624126852107629 0.2561591047738996374 -1.2672634589399489613 -3.2869623502558011907 -0.66698004553039391684 -0.56389220161881492555 -1.1457263126902628159 0.84119405672407887575 1.1615566200396840735 -2.8091777476811601311 1.0736823692212094095 -0.72644475330878410801 -0.16541614483859959361 -0.90519008203508266597 0.1361306638409720271 -0.25891836054605948947 -0.20264191154072255796 -0.20916924121510643841 0.75170830899964935501;-1.7132538715286327324 -3.0456087918554617389 2.0557134856105410137 2.721565000616056107 1.4783524828541234619 -2.412924380393608903 -0.012494557677098906343 2.2608974389247511461 2.4196923908476657417 -0.25436366499466006585 0.28362442023563960714 1.6831156227475649878 -1.2969216164333932095 -0.29162562079744303034 1.7935639334492099461 -2.3382746291855753817 -1.1485631952825707813 0.25584647597955134657 1.0938877278598577725 0.34096273420138051291;0.13087770286790650909 -0.027906691801902555605 1.6700662037973710294 1.9203857853905934583 0.604788782803567182 -2.2646913691353844911 -0.99513856907952358277 -1.9954536593418050749 1.3924337850671821837 1.6989308178363224933 -1.5598100051061223326 0.27058182662681928843 -1.2990451864758207901 1.35743471195008647 -1.4762824673365035899 -0.86583590295482160126 -0.4046248701437318851 0.38451176545817328245 2.1927794039092431966 0.37488969627661694606];
  
  % Layer 2
  b2 = -0.22851871657608338606;
  LW2_1 = [-5.1957599707847164083 6.2448818105985468563 -4.9627945350652593604 -8.5445013208089637402 -2.667906290907685829];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

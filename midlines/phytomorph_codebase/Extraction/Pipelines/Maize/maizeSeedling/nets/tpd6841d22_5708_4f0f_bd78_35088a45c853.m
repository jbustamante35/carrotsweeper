function [Y,Xf,Af] = tpd6841d22_5708_4f0f_bd78_35088a45c853(X,~,~)
%TPD6841D22_5708_4F0F_BD78_35088A45C853 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-Sep-2017 00:50:26.
% 
% [Y] = tpd6841d22_5708_4f0f_bd78_35088a45c853(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-8184.90793418461;-841.368302509965;-925.675633657013;-1424.63292253516;-1115.63541033651;-861.953076142268;-996.664725988393;-421.625702789071;-721.553885286558;-557.274532479568;-502.132109545498;-541.944235264826;-543.177005191313;-167.207345824939;-344.528961662832;-294.4017764027;-391.010406370098;-285.680184537947;-174.294824484567;-301.038307242073];
  x1_step1_gain = [0.000202107905561193;0.000554219398814735;0.000742185534904078;0.0010185341647551;0.00103332655312913;0.00147681597144009;0.00118221307527393;0.00265958726683859;0.0012523589192447;0.00165285753177999;0.00232860128237177;0.00188013184297679;0.00198822427969294;0.00479968082327782;0.00252047169225125;0.0036311720615839;0.00272984263620491;0.00383651951608913;0.00502254586493017;0.00330771328744478];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-2.3024339582448400954;-8.1291084885011652972;-1.6575147024254572869;-0.58543176349046055496;-3.0493759338131969372];
  IW1_1 = [3.4241080994553589889 3.3756211071535777712 -1.5226682590883457991 -0.11743046430469415708 -1.0818542263418722271 0.27741751766944561242 0.43887845044585410692 1.50925017102738801 -0.045747176462000355146 0.070019294828257638841 2.0285460269918704768 0.94697400972004697195 0.14998791029335559188 -0.65960073180838185714 2.7572805361334244978 0.77063232256506664086 -1.1166400205789301925 -0.58327296433773212492 1.204954357417009625 1.5635883669746015734;2.8268243258151466435 -3.8730267105460964849 0.9506409116610948784 3.0711593198372306723 2.8621557360711471496 1.7128953603374361681 -1.3142565046638394755 -0.92001966936781287565 0.092293279009745682329 -0.97089793071668128999 -0.87241665852456606878 0.11607352249032076852 -3.164910987604505177 1.1401666883138796837 -2.4592814681168535529 3.1960337812214838493 3.085238282808252297 3.7825347639119355492 -0.86159992217056868835 -3.2729387093914956708;3.8464006533195806981 2.3419222417618201781 1.0707962092810305865 4.3384644621242518525 -4.3865358547420605362 0.95979159353322662795 4.0603161638360250052 -2.1767548367895441785 0.99605858796682822387 -1.5277662975808525836 -1.3135689271749533269 0.43720203394169276923 1.4029103433647356347 0.40498562988464970047 3.633264518354002437 6.4428887242989709705 -4.333450867079311486 -1.6452637615809027061 -0.70494561000624367253 -0.81744808334411456219;1.1023130898367448083 1.1088946062743934018 0.47917885389601205803 -0.5084634466225438354 -1.1736927762808324616 1.4094645732979911301 0.62158498678025653206 -0.66077435156924435589 1.7091471795512782617 2.6734451853290273071 -0.81463281134701670538 0.063263914441952062706 4.1116164409589126549 -0.73951194486220006574 2.962205630470483797 5.1900056358844190996 -1.4292049219947478012 2.6115237107372686332 -0.18272903010889804398 5.6074262129647811648;5.0380610223384154622 -4.0706723886344269303 0.28480925149336566715 0.55266635588527002199 -1.623293542781041543 8.8296767075132791547 -0.2451572284926374079 -6.126637333541925301 -1.5424843895914979175 2.4398088581894255 -7.9574632029244556364 4.4064820738345389373 2.9129118604766217615 7.2009093120982106129 1.6087481196013784235 1.8200858583730816775 -0.31584277791914117106 -0.38643771626399897601 -0.020683313356394995158 -1.357289209070508651];
  
  % Layer 2
  b2 = 0.52469259969846437919;
  LW2_1 = [7.0983255668668086003 11.696487854328506018 -13.325740798794553754 -10.046984484381207281 12.40964900735609433];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

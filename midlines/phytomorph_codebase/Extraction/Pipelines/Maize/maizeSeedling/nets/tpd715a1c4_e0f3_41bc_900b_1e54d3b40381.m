function [Y,Xf,Af] = tpd715a1c4_e0f3_41bc_900b_1e54d3b40381(X,~,~)
%TPD715A1C4_E0F3_41BC_900B_1E54D3B40381 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 07-Sep-2017 16:20:27.
% 
% [Y] = tpd715a1c4_e0f3_41bc_900b_1e54d3b40381(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1874.99930442497;-5454.9153472637;-869.204807020144;-780.471896742373;-727.485737554805;-234.31060487846;-540.291178237134;-572.14271553379;-192.819908210792;-263.80049063085;-210.820779921779;-258.183122033528;-286.590370604326;-190.320782432691;-193.663740648593;-218.521589353919;-373.104709120357;-213.719449945757;-258.858847398808;-176.115238468632];
  x1_step1_gain = [0.00034254044244578;0.00027748074658588;0.000806013241167019;0.00156677380853905;0.00168393926281428;0.00269046527889069;0.0019808499204541;0.00236361816544284;0.00245784730269613;0.00195235680232596;0.00282106579415898;0.00424658079482956;0.00317261769260757;0.00555458687461896;0.00429724736478089;0.00484270636687464;0.00333931608099047;0.00598913897545104;0.00384783002604036;0.00642488839732229];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [0.94334037885855537287;-0.25280587513059704641;-0.78077441621539900307;-4.0595612548352972837;-2.2021415492903853028];
  IW1_1 = [-0.54885500371602591319 -0.98334758451255854794 -0.58144331040441010749 0.040986634043377698222 0.46654279135693221825 1.8503580042502003611 0.69200244309927394504 -2.2113022070413261844 -1.5158328035924764077 -1.3322778431381663289 -0.73237643496538418209 0.1801409395916366285 0.97059495074219759303 -0.010151476303581119867 0.932111018769957278 -0.66009973804792410057 -3.3365481245277592848 0.7096414561336197302 3.1930377920155983418 -0.64352855438969092106;0.64195557097753019882 -2.8332574888220802833 2.057656210008241171 -2.2625723689152885676 1.3439420412372138358 0.39428708378225552078 -0.16620607192120051554 0.276365829554409137 0.42710752726436707061 3.0916315656751640617 -1.9248136578603509683 1.912852279997723004 0.11207781929687822553 0.76402629800105725799 -2.1874360786312205818 -0.25466565960769371735 1.4623434089501985422 -1.0991087425730243776 -0.91072158203003783505 1.5115711396105784292;1.2206898919748261356 4.9085184164701329834 -3.0445858129488208021 -2.9280324910758297463 1.0884825603070138467 3.1420932693076135678 -0.086548875176170922408 2.2130958330335053219 -1.2463163189093917627 -0.30693080362468849742 -0.44202050087476069118 -1.6113411462085320824 -0.85338153443191022696 0.84862032594964842414 -2.1528692844066839029 -2.623578039017458341 -1.0464723155304285207 0.5813392068049849648 1.0988842259365323439 -0.86478417815373342936;-2.6176666828158952072 -2.8592555762019173926 -0.622874943221725208 0.37025711428322882757 1.5814556036625222468 -1.765893459065918103 -0.37625599870799941726 3.6645196077007584634 -0.68137950215566200907 -1.6077903873427139558 -1.9662410352606511932 -0.15791735630135272928 0.36193901894179525414 -0.26638671495591115246 0.56338171600491016022 -0.16253724993058327186 0.13614678816006473006 -0.53750197300954749569 -0.57368007258404762894 1.3409078536667922155;0.95668720620104186203 0.059669970433765810724 -1.1035084262423058288 -1.0847373489903557875 -0.46248472190716527486 0.035210409986042155717 0.040366990538610800221 -0.37860231699672691752 0.60907817153288257295 0.13096208579472085054 1.0579721557088466177 -0.33643414412357480758 0.75318327916014482515 0.073162805967323135681 0.037228673753877665475 -0.13345441221177223312 -0.12530334106964374774 -0.64598795688513666047 0.59409083065507517496 -0.61642288436683900787];
  
  % Layer 2
  b2 = -1.9726351706875757674;
  LW2_1 = [-6.7218660905928633298 -6.5496748437548832911 5.1023236599674417491 -6.5225921889995781555 3.7807674945953548828];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

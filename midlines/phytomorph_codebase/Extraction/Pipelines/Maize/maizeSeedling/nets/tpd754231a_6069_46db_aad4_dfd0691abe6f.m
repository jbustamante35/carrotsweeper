function [Y,Xf,Af] = tpd754231a_6069_46db_aad4_dfd0691abe6f(X,~,~)
%TPD754231A_6069_46DB_AAD4_DFD0691ABE6F neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-Sep-2017 23:35:03.
% 
% [Y] = tpd754231a_6069_46db_aad4_dfd0691abe6f(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-2001.76879548539;-2528.40271623793;-1416.92748927618;-1127.27896682562;-742.627689023617;-590.342170311175;-636.87763073167;-474.328050496921;-408.756773605254;-607.267828431692;-597.158358369106;-384.721680725416;-357.743301501269;-455.326587536772;-262.500890231162;-420.955237007944;-168.878309979171;-265.923075543787;-374.938438931832;-242.089965006867];
  x1_step1_gain = [0.000250772026915415;0.000457175383291266;0.000795694570296744;0.000975455655635302;0.00136867839470429;0.00177765334299387;0.00147664952758211;0.00196526984478523;0.00211681540578916;0.00191395299404992;0.00213803411115013;0.00313745816598807;0.00239499394158855;0.00262802245354381;0.0034029937722697;0.00307580218448465;0.0042034220046533;0.00353937526659746;0.00305696135696251;0.00320422591704707];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.8570983438493060547;-0.11616285467498620176;-2.4241612511842847155;-0.03601709621952862983;-3.4774535666490846708];
  IW1_1 = [-0.45020762571344757896 0.21380355114741542155 -0.30466406966271086798 0.42361199933967386144 -0.006826819264346803591 0.26681974847258388417 -0.0048285767935669103232 -0.69408816371148818192 0.1928701862851555926 0.23432243608930916623 0.4190809996895471512 -0.48096195567618116318 -0.056120512357913980572 -0.37481556218943667957 0.7098895037969884525 -0.46523171800219154104 -0.94494699930323311499 -0.46292076180132701868 0.47528511436331966067 -0.17554236304211787156;-1.5897473693177157639 -4.4585178613159195393 5.8928586179221955632 -0.69394751518411135205 2.428338694958286581 -1.2049431386460967008 3.4697617513372653875 5.666335063372091696 -1.6655586603479548558 -7.9448992787700847273 3.0435255277713437749 -2.2111973691324648961 4.5617029058170066591 0.72422560153771808888 1.9094750150894614915 -1.4531532520840011458 2.7385988482405299038 -1.3191854531934850137 -2.2545496561238342892 0.36380081773027111991;1.6753210416672827954 5.1359820935654800778 -1.5217882046058026635 -2.3892423617437841266 0.29414406101511370029 -1.3598213263699483466 -2.8991559757983997869 0.34745572942710323261 -2.5666386170977890657 3.186460249691795088 1.9151837035082932559 0.3912701730808009204 -7.1471432648661163967 2.8567143063184956553 -0.58177070051681945007 -0.23195665491174494166 -0.31564390788195773041 -0.25058746064100767548 3.3402618542590327699 -2.7867097449024544886;-0.89247270240253995244 -2.2368443909813091608 -0.021218290405176230135 2.0803015701864251419 1.087345768186517514 -1.4126845736190585257 2.3646162243653572332 0.095008900394145695545 0.53667469277349000301 -2.9958417401200283514 -0.82609020413712075381 -1.1477121672234484873 -1.6301810754870389442 -0.4288864959935622112 0.63240385187319758664 1.0767159965796666565 -1.7582978270229845386 -1.1508540783768619331 0.87033182600102509952 -1.6704470022478048463;-3.4372250571819331633 5.2041254718016434211 -1.2472910059399249239 -1.0416964658026626189 -0.90524096758951644315 -0.96797506369760399902 -0.49735565146271726311 -0.89144921809783506106 -1.9561536047568517382 -0.49860028600054179249 0.91798943403094179772 -1.1136331688102389936 -2.3995793180352582574 -0.76393756271654245094 0.1804252348815053586 -0.71863274235553675773 0.06872970877331693873 0.11105104390279531279 0.20486808530361097502 -0.46031347654695481397];
  
  % Layer 2
  b2 = -3.7215782092715699036;
  LW2_1 = [-2.4398902331036502744 -9.6010527336279167798 9.1250627242311619369 -6.9981409505243323821 8.7656699071937147494];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

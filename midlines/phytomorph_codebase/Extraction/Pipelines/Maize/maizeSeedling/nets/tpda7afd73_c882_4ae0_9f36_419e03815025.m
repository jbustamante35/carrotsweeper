function [Y,Xf,Af] = tpda7afd73_c882_4ae0_9f36_419e03815025(X,~,~)
%TPDA7AFD73_C882_4AE0_9F36_419E03815025 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-Sep-2017 01:12:32.
% 
% [Y] = tpda7afd73_c882_4ae0_9f36_419e03815025(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-7409.93644730061;-911.082072190463;-1068.86784991252;-1175.93373113978;-1366.53951203701;-713.224898465726;-638.058802539176;-714.930642633141;-546.419507096581;-435.830146318437;-311.04098817056;-332.822721465596;-407.901071240811;-237.14382758461;-310.614407522918;-284.621358963194;-348.992764796122;-139.239122485378;-220.006532848186;-273.249410813682];
  x1_step1_gain = [0.000226370837385414;0.000563347828528141;0.000948114745185447;0.000858032283205086;0.000730242383199753;0.00151716399266531;0.00146770964020616;0.00151546500149801;0.00206494173697168;0.00202475070577015;0.00326439309746562;0.0022999722951874;0.00248425272472333;0.00412752991038811;0.00322794766513115;0.00343797851616052;0.00328303385537585;0.00723300236088568;0.00445727486740883;0.0040752789910078];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.6191732173593669231;-5.5640661355323910442;-3.1711606802015843698;2.9316735563514302321;-2.1061651812083996838];
  IW1_1 = [0.55635877551872003899 2.2816887671079633115 -0.1272952509123677356 0.13767606159931847221 0.4227936482403741314 -0.075745111589009539443 -0.35763930522417120006 0.18065706909405140901 0.58631085592620424407 -1.8869086454816428322 -0.88291154873263077985 -0.43898835394085655714 -0.136756164074275266 0.15325229409275759052 -0.47088504457886043442 0.091879947851599308439 0.56679946606910158735 -0.2792693002187674467 -0.52935591195305575773 -1.3588768075598112173;3.4791109800181097 -7.6157367437262717402 -0.7019595100280017208 -3.0887702142958750606 4.2294856102891689176 0.48672988742735551204 1.0262696822023686938 -1.2439942901644063245 -1.262960325918726312 -1.5065265552081155143 0.15889783384381503395 0.48137153950236399869 -0.33104250768954890383 -0.859618845268879328 -2.0849033384166282268 -0.23259121731078674644 -0.79520538159179254833 -0.48328966477405022051 -0.42186955318397900694 1.1763605126422516101;-1.6691802123212764464 -1.6617533198766858415 2.6362089126152041807 -2.2870022900079844952 3.6623530271715378781 -1.9412583066609592208 -0.27448519377321062285 1.3151711056013526413 -2.3182751706858151231 3.8018275653189856911 1.3205158107898034014 -4.8680559629561281909 0.90805630441306617318 -0.011385108266667991195 -0.12656397064882363157 0.81330283909590217473 0.47025700327116670696 -0.73993026061399613802 -0.19908333607068270932 0.38450595463372255756;1.2354231536385811285 3.2243371221416685657 -5.5634841740778018249 0.42467745630476760876 -3.9001728015488437151 -2.3989706938912140899 1.8478370000734933853 -0.83488230019812070815 1.0146794960589848866 -3.7314289898287862357 -0.90523106836640621076 3.8134809424227520402 -1.2016979170512602781 -0.072861757255532635935 -3.7773549938828723249 3.5353086077602164927 0.28407900756669479669 0.40316235319711218876 -0.88821976142365388629 -0.037362107039796463304;-0.15966130066032468982 1.2532475142543206825 -0.33944386849242436099 0.032079608673991594214 0.7610677107166894384 -1.7151983032928852513 1.4371469784042940621 0.36505408004399791944 0.4252651712463527689 -0.52036066143234926962 -0.86647131431573776172 0.8219130363314807175 -0.50057815287023743611 -0.83923934391099508368 0.70698188653062066233 -1.3020228958238186934 -1.1351210657899069023 -0.15413371915850263005 0.08798115194280595186 0.9582027065623875961];
  
  % Layer 2
  b2 = -4.8626350347886724279;
  LW2_1 = [4.6561760854758187378 -6.9280265591918031021 -5.4796768793766137406 6.1907675269552830954 5.9233064469331209168];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

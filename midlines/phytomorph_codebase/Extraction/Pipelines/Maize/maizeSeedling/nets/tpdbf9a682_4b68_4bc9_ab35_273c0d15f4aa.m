function [Y,Xf,Af] = tpdbf9a682_4b68_4bc9_ab35_273c0d15f4aa(X,~,~)
%TPDBF9A682_4B68_4BC9_AB35_273C0D15F4AA neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 31-Aug-2017 20:16:35.
% 
% [Y] = tpdbf9a682_4b68_4bc9_ab35_273c0d15f4aa(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1874.99930442497;-1752.79194273021;-1612.14400693261;-780.471896742374;-460.205555216351;-234.310604878461;-540.291178237134;-572.142715533789;-192.819908210792;-263.800490630851;-210.820779921783;-258.183122033522;-286.590370604326;-190.320782432689;-193.663740648593;-218.521589353916;-373.104709120357;-213.71944994577;-260.914631799832;-135.174215342513];
  x1_step1_gain = [0.00034254044244578;0.00027748074658588;0.00080601324116702;0.00156677380853905;0.00168393926281428;0.0026904652788907;0.0019808499204541;0.00236361816544284;0.00245784730269613;0.00195235680232596;0.00282106579415895;0.00424658079482961;0.00317261769260759;0.00555458687461902;0.00429724736478086;0.00484270636687473;0.00333931608099052;0.00598913897545066;0.00384783002604042;0.00642488839732219];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [2.5397584761983997836;-0.50256408136776076212;-4.3618945051855950723;6.4819143867353181676;-0.76640097179035127084];
  IW1_1 = [3.1676555857338795086 2.5711833885258865706 -0.91837038075154597827 -0.25766443876187139495 -1.517193240537450416 -5.3089315693935779095 -0.032502848764335422194 0.44324866659722167439 1.0589560095670011997 3.8924048616509439036 -2.9641342806613857341 2.90650375213399359 -0.24058093745951025788 1.4855298619647996361 -0.79717986048413980171 -0.83565669440107515076 1.1697327012567406701 0.28041482100974840508 1.9615946318563366457 -0.39868159617099468983;-0.26999366052140250094 5.2464570099023504213 -2.5120243995472706366 3.9528987590639528271 1.5640758962351248851 -4.4276369934685622098 -0.17394886504253617709 -5.1904443992722644197 1.9548240132050025419 -1.9539206756309102087 0.43826758028419809943 2.2458709495151762958 -0.09916663181421850326 -0.84809880243038737735 3.9608785603453187107 3.0685261235413303638 1.110245864371984581 -0.24725608438983276427 1.2240701467693511084 -1.6570380175080321461;-4.5702817682303562563 8.6026430076046604967 1.050261337426577013 0.093329241766521700563 -3.4360289084334922904 -1.2053894172697032783 -0.057927896881387754002 4.6075583345311530437 -1.9416457621183145221 -3.1468890221721586009 -4.113086080178861792 0.56645761447566422842 1.8836986201992025336 0.32287973166549471804 2.5950351611039601529 -0.98363159225862373258 -2.6262537035589614831 -0.56902759920821988082 -2.2165495330011650843 0.42273911587709978033;8.0914607275942209696 -4.743906358918225763 -0.84090101713976339592 1.7204088962908130611 3.4652092753843124484 1.3949098120132570333 0.17517364496312892719 -4.1018020886275738945 3.4080397859268423133 1.4852665219800265106 1.9741330199069311302 -0.86907191708016084952 -2.1259887737921978612 0.47145768551103323096 -1.1941581603651549859 0.93732915989937781731 1.999730485158283777 0.15595802356218865792 1.1270400882259827835 0.93037248694588381426;1.6246740465369196027 -1.6909388536333178621 1.8986101730063171811 -2.9040048084293492714 1.9889625265919048669 -3.1097915377514677715 -1.0649090519400248311 -0.43763720733177069455 0.045199518252318805767 0.3518755273321517163 1.4696363716937863586 0.6393672706024049468 0.7575371595326606533 0.90762959841890045176 -1.419685313608617605 1.5959159914354463794 1.8435745586734726409 -0.25458205493550373211 -1.4095249646251784004 3.4579624581183217025];
  
  % Layer 2
  b2 = -2.9509932842113610896;
  LW2_1 = [-7.1695182037724398683 -12.038007375374734309 -10.490699042325410062 9.1150590582719690502 6.4174755806635941369];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

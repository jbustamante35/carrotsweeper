function [Y,Xf,Af] = tpdf1b0c37_45be_4eaa_be04_1be46961d80a(X,~,~)
%TPDF1B0C37_45BE_4EAA_BE04_1BE46961D80A neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 06-Sep-2017 17:49:56.
% 
% [Y] = tpdf1b0c37_45be_4eaa_be04_1be46961d80a(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1660.06224852336;-1969.79757456081;-1377.69545894784;-758.119043371399;-1005.44642162532;-672.522601966806;-447.378118638316;-450.686587111716;-682.765477573458;-458.333844314367;-622.812481590516;-410.039334332748;-387.578117402332;-429.961560001124;-373.705895665987;-359.072122656298;-277.037336897482;-301.078315473952;-400.794724948394;-247.875867270426];
  x1_step1_gain = [0.000244911356138662;0.000507837665104201;0.000859080031338269;0.00102992699402406;0.00116476174985821;0.001536082715882;0.00186490882819871;0.00229564725234538;0.00140550898923532;0.00187872252206336;0.00209870879134677;0.0023742163796694;0.00249683918257883;0.00271795669482109;0.00287765136194791;0.00323536160952177;0.00314965135524193;0.00399550556362198;0.00295376821702648;0.0037505121487596];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [0.92059599367989641827;0.32691309877811131068;5.6504958761147934254;-0.61969125852910755814;2.785678606056515072];
  IW1_1 = [-0.67106475271555265927 0.44560514068685780353 -0.1271787037678775989 0.67744264974283541214 0.57874310013493157623 -0.49439855493470752368 1.0654049066821855707 -0.22972130986380756568 -0.39692379819162065813 -0.31344235460000563487 -1.4588099858926169006 -0.06138862767301847545 1.6301755407077880289 -0.82740656311620919272 -1.5381034155267154784 -1.3951920198438767518 0.61723753125473568293 1.8971743650136863035 0.76218138401462853793 -1.0199658604132371131;-2.7188847926922208309 8.03894254494034044 -1.349495427115156021 2.6249634439819660159 1.3938885882598932575 -0.78716625707178788929 1.0051125159537888099 0.49819230139519571354 2.5096288275337692575 2.4071995413217948112 -2.5692955334734337569 -1.4319121981862110715 -1.7707151542193115823 -1.7385197642833487564 -1.4498390343207196995 -3.8380696881598557191 1.4261740703521690321 -0.86421891383913929108 2.6030964233865980795 2.5383316901527877008;0.16193678824076673806 7.4722504572205084017 -6.9927031991111681108 1.013922090187058922 0.5026578422361290821 -1.061179536049893235 -0.97305463061551389359 -1.5176202889574685884 7.4768976870915899724 0.23464792363045328116 -5.9640164448391947971 -1.0592115864542972492 -4.1046776597101448658 5.1169088777691058567 -1.9122897794377982095 -2.0856958928082938165 2.5820007169536851599 -1.748963672169956407 1.5462542312194358374 1.5628752553093547828;0.85706883903843233963 2.7774504138256785879 2.6186859906005341969 2.0923759915736188653 -0.43461834656499631624 -2.6670557923310815873 -0.92685043914479070537 -3.0198853594353232133 -4.2522043521335737282 1.7231202405991030702 -0.021028046980895276352 -0.49457651637244826048 -2.4155598499526829137 6.4679520591319086265 3.0729707997176949341 -0.094615596148342445693 0.74305099205600666501 1.3559782677411356122 1.6368205621802178751 -0.34444866544777696937;4.0452516899047585852 -6.1680692254303632893 2.2500561721337577481 -3.2240427412689363074 2.0256826753543961672 2.8285718362168190687 2.5107870254224367024 1.3347723715763066821 3.4360413903870128394 -1.2955995448638686351 -1.1112662541689457552 -3.1430688980779719621 2.7723903876520545886 -3.6726182050920277433 0.93460001105070966698 1.625363482975290319 -1.0950606474210233809 0.91348714981806233837 -3.8908866406799003101 -1.9537235958996455043];
  
  % Layer 2
  b2 = 0.10930095805975623136;
  LW2_1 = [-3.3673448922080613244 7.2635387571108926963 14.322681359378616861 15.58313103847968506 -11.595978641480609639];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

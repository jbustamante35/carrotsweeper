function [Y,Xf,Af] = tpe1827b26_de59_4850_9f4c_6844e538c67d(X,~,~)
%TPE1827B26_DE59_4850_9F4C_6844E538C67D neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 04-Sep-2017 01:17:27.
% 
% [Y] = tpe1827b26_de59_4850_9f4c_6844e538c67d(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1660.06224852336;-1969.79757456081;-1377.69545894784;-758.1190433714;-1005.44642162532;-629.490616020367;-447.378118638323;-450.686587111715;-682.765477573458;-606.219316949415;-622.812481590512;-410.039334332741;-387.578117402328;-429.961560001107;-321.305329962897;-359.07212265631;-277.037336897466;-301.078315473942;-400.794724948412;-247.875867270407];
  x1_step1_gain = [0.000244911356138662;0.000507837665104201;0.000859080031338269;0.00102992699402406;0.00116476174985821;0.001536082715882;0.0018649088281987;0.00229564725234539;0.00140550898923532;0.00187872252206335;0.00209870879134678;0.00237421637966943;0.0024968391825788;0.00271795669482118;0.00287765136194781;0.00323536160952171;0.00314965135524199;0.00399550556362211;0.0029537682170263;0.00375051214875982];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [3.1138359190775979357;-0.44280686097704585746;-0.11381427062643004189;0.26540571553138847527;-1.9108364502144938868];
  IW1_1 = [-0.75507757627385696519 4.0477093883484887016 -5.6873697465469730261 -0.034986163813414378199 0.1411141200609201396 0.97859700904376045738 -1.2376921614621039236 -1.1495917616329560662 4.849352090869382792 0.85054656183980392736 -3.9073614583718634385 -0.24545435976310814308 -2.0407056877662141936 4.08940648523890804 1.6777582336108005645 -1.1187893386364791137 0.55175891027064094541 -2.0742179369308826331 0.67922005007623720285 0.68283464344876232399;0.59254037970274708869 0.2224105264002871063 -0.45239911438124519316 -0.56722903719186723581 0.31127054180019975149 -0.25304018579411263756 0.16262639797383202089 0.92883663974685171105 1.9229776726660539055 -0.01337842718293865904 -0.69872186587765361399 -1.3977883333348479766 0.076318336255593158257 -2.1852305796501054758 -0.34709247575623736193 -1.1596790021009248939 0.60569103667954216075 -0.29450450406190348263 0.010354816733436767243 0.2945527357161588089;0.17139072350030393199 3.9398005550732908553 0.8218075218703865259 1.9629472053635041995 -0.9273108165125676372 2.1179002117011394013 -0.58773046097487469108 -1.45405819855086893 -4.1568378766246345535 -1.5547552568241700399 0.34940147451032987913 -0.69794273887377711318 -2.8374859943673338414 4.5834315867506232323 -1.5140205329777296495 -0.38407628153583611708 -0.22398107784137116782 1.3506910828245071166 1.2422675343064957243 0.11769224374505742048;2.5685049327082087878 -5.3842882423229427857 -0.16154609624298305048 -2.2649043968869864152 -0.54731820850194468076 -1.3932561494842898853 0.50885960490105497378 -1.2627875655350053741 -2.029487964810937406 1.6367185360934692895 0.38343124482650586815 0.64301378444999779393 0.56729453193323298166 0.46493106967312625155 -0.92495016721764611312 4.05523782255305143 -3.6943910636788968027 3.5039150996528385384 -3.1114074263630153716 -3.4019871228059477275;2.1141311065617061082 1.2416556476271758402 1.6480774773097306429 0.33830517588229647163 0.94958860664748390157 -1.3935819473560593362 -0.21000245594397998206 -0.72893233117278843913 0.32609306783996544477 0.085149958374059336874 0.52798032420882379245 -0.17484928763441576205 -0.063204842463769894678 0.56512186816067744299 1.9606369915883437027 0.35349870748257444797 0.51743631238142639983 0.98968593862445886078 0.34293075127693828374 -2.702003967404069229];
  
  % Layer 2
  b2 = -2.8575166432898471136;
  LW2_1 = [8.7782989973882017409 -4.5259280417062557333 9.7743768669631485579 -6.5097775432717135402 4.7354246480910244799];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

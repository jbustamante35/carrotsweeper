function [Y,Xf,Af] = tpe22203d0_69cf_431c_a958_f344f7adf546(X,~,~)
%TPE22203D0_69CF_431C_A958_F344F7ADF546 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 08-Sep-2017 13:21:39.
% 
% [Y] = tpe22203d0_69cf_431c_a958_f344f7adf546(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-5466.61789079662;-862.937878923584;-1028.71862143181;-451.710971542895;-692.538815520005;-441.043793232209;-783.667639824726;-311.950474474657;-656.55582806929;-380.160028036827;-183.58947139104;-268.743398235236;-384.146123020666;-202.979007080805;-233.266353450978;-302.321350914725;-296.419908591228;-191.974128700851;-174.982344511208;-176.062817024328];
  x1_step1_gain = [0.000192953812201724;0.000635170113819407;0.0010737117105794;0.000992967389065706;0.00140247416929522;0.00179426803546528;0.00152094087103248;0.0026247520165371;0.00199415494766506;0.00251075910029927;0.00454433874041192;0.0037866200073872;0.00302237737948967;0.00448879604138558;0.00366080733460347;0.0036305723053372;0.00381924645546712;0.00427537582274441;0.00592120551781366;0.00602422138644295];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [2.9536294207048547911;2.60527498752785025;-1.3133513664186431402;1.9776851589606738724;2.3601274308447202088];
  IW1_1 = [-5.7422477734178762887 1.6394822020699566512 0.97005265684472052889 2.1599290952795584531 -1.4993291743789500803 -0.26777642937212875474 0.35461916131098425442 -0.33317569371459826444 1.0943091819125676523 -0.71130718962544248196 -1.0792671038422438912 -1.1233636207991979372 1.3651510526760284314 0.21898769519859206945 0.98484262524003807204 0.95470648184174788931 -0.39942430362818281964 -0.36479543754855697779 0.52536549480698502279 0.39089215284596168232;-7.2548270841026667455 1.6657936133467881046 0.49059327184970519253 2.3125212673221176019 0.76687480277924513494 -0.41693448006077515888 3.7610552490876862919 1.1688056421151984399 1.622163411480075812 -0.44149923511367528128 -1.8042256960100357954 -1.7064362618512476377 3.2675750767868541047 -1.5267780405595925419 -1.0847770472320221735 0.037938673944483913836 -0.20698130506192685685 -1.4393689506577083126 -1.1573847531866707783 0.22535600948806905341;1.3093992246883263686 -4.5987193935249282006 -0.83625769274662187236 -0.4602477211182504635 2.0424396008093874677 0.055965964434951331885 -3.5639108572179010181 -1.2645386967486045293 -0.25886213900836696489 1.8965080090298989113 -1.6887328127810370404 0.80799066054215940014 -0.51517316687246839102 -1.9656007150620329327 -0.64234659189757792319 -0.44311528805234490225 0.63668537503878075423 1.4519460453140327072 -0.33145510334462419122 -0.28726985108735975105;4.6144325601438946904 1.38156791230581244 -0.32497684048524194678 1.9315691048636445259 -1.0931757290435482055 -0.15401117728594290734 -0.69924863196437958557 -1.5179477910930581075 0.54715998211633687376 0.018840293704028024391 0.70458402545638654235 -0.9063104089823269538 0.86212380974344948736 0.051774854419928018068 -1.2365294061019282967 -0.62611645008962779624 -1.0555088614447816209 0.81922710331128134609 1.0139637977940814118 0.28273795702501519633;-0.86208729490076019264 -1.3836654797403129535 0.47728846037924838042 0.18998541289526152398 -1.4638489202523674582 1.4508281561720588471 -0.83145806345587747188 -0.59270339630790580543 -0.6279477647117811534 0.17432187788872957612 0.41243355884129040412 -0.050823862744882486453 -1.4759866494302382733 0.22141762357496197478 0.30749105901864609569 0.080035549160127852919 0.14863353777141150025 0.047976325223662436015 0.60362189318594738907 0.19590276419792496121];
  
  % Layer 2
  b2 = -5.167365515683962407;
  LW2_1 = [4.8871699463534072905 8.7780818119011758682 7.4946451936436258023 5.9493205368271544486 -5.5491520165745047422];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

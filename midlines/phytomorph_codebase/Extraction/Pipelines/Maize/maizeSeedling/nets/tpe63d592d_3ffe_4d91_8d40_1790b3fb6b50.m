function [Y,Xf,Af] = tpe63d592d_3ffe_4d91_8d40_1790b3fb6b50(X,~,~)
%TPE63D592D_3FFE_4D91_8D40_1790B3FB6B50 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 05-Sep-2017 02:18:05.
% 
% [Y] = tpe63d592d_3ffe_4d91_8d40_1790b3fb6b50(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1710.79601884287;-2767.31086728677;-1769.06834334395;-1424.63292253516;-1115.63541033651;-492.311800916006;-695.077686466815;-421.625702789068;-721.55388528656;-557.274532479564;-502.132109545493;-541.944235264829;-462.745727182147;-167.207345824938;-344.52896166282;-294.401776402711;-391.010406370093;-285.680184537943;-174.294824484565;-303.609020442443];
  x1_step1_gain = [0.000202107905561193;0.000554219398814734;0.000742185534904078;0.0010185341647551;0.00103332655312912;0.0014768159714401;0.00118221307527392;0.0026595872668386;0.00125235891924469;0.00165285753178;0.00232860128237179;0.00188013184297679;0.00198822427969295;0.00479968082327779;0.00252047169225133;0.00363117206158394;0.0027298426362049;0.00383651951608918;0.00502254586493009;0.00330771328744457];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-2.1264259860152630033;-3.7166148533359404382;-6.6163744520977259;-0.47876195413072947238;1.087824217913825775];
  IW1_1 = [1.0479500847582330358 4.1166469916082677472 -0.82788797528091651046 -0.37176961775758976536 -0.074900855583447598085 -0.14194163780419463694 2.2833765167640058813 -0.16575360497917307478 0.84811225503268261594 1.6661824301909657908 -1.2126198376800516598 -0.27782540978902209305 -0.43393537167537404864 0.19236784878847387747 -0.65771702906241424902 0.52336338838696494502 0.29389691980990617637 0.67035410139011375463 -0.36075743790888653573 0.96954966084018934236;0.15571904007464751341 0.84510608445788704124 0.042657956842406856424 4.3008180432808318372 -0.90305414141192641431 4.1604226056454924887 -1.5130378225475511478 2.2404142426529736198 1.642626578430893769 -1.9521283342140591799 3.828302478811056897 -1.4133242321184249501 1.1608949523365368339 -1.7509496366419035063 4.0559085049895013952 0.84088718268549289547 -1.0972506985392356249 -0.83445032511039662904 -1.178988533098556557 -3.8535671406991225396;-6.4930345418015296133 1.3131368783627266339 2.3564478407836628726 3.5833732446247461567 1.0834585615296421501 -2.7975272602676741762 -4.2246516100338258326 -2.2888293631375282722 -2.7954077061371096491 -1.0453637660260117759 -2.1741912763023107935 1.1948326351689813052 -2.5061377845541046305 3.1238187926046663279 0.51395388613207904083 -0.074673343845147108211 -2.5268506692163033023 -1.6335951689311636326 1.3439282961323357757 1.1118358184742438421;3.4687431360420863946 -0.81349304787570408948 -0.35073330834509386378 1.8066389736502022068 -3.5784934660200375944 -1.7374691063364935406 -0.40967619805286975554 -3.091461263290100181 0.95526614525825104263 1.3223773746452269773 -5.6730734990783586724 2.7224493296236111917 -4.1105067840499733833 -4.2148176403046377914 1.2347041963940212916 1.553575628551352894 -0.96511815052702232265 0.28357247594262113832 0.41166334763372031125 -1.8028229046399248947;3.0346587381098522052 -6.4668554709512049428 3.0730032771937070279 -0.57249705686649565717 -3.4454781438722577036 -2.2507242239236493475 1.242795175812883679 2.6879748603504745041 3.3220635147645358742 0.14546869594844799578 0.56333507999790244369 -0.46662673564312573404 -1.7181947498452638801 -2.9363300187903300653 5.2313715129403588477 1.4785588761682946224 -3.9154745946351279251 -1.0956598275050666302 -0.52859484189972494317 0.4669334381452571181];
  
  % Layer 2
  b2 = 0.0019196538072584236334;
  LW2_1 = [8.0384974642645286025 -7.5720012504149822874 10.753427714934151282 -9.3546752701034154853 13.291909627187640908];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

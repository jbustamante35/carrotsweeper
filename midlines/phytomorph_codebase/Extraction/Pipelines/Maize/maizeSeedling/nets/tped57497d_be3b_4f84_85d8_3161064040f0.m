function [Y,Xf,Af] = tped57497d_be3b_4f84_85d8_3161064040f0(X,~,~)
%TPED57497D_BE3B_4F84_85D8_3161064040F0 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 06-Sep-2017 19:38:20.
% 
% [Y] = tped57497d_be3b_4f84_85d8_3161064040f0(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1874.99930442497;-5454.9153472637;-869.204807020144;-780.471896742375;-727.485737554805;-234.31060487846;-540.291178237133;-572.142715533789;-192.819908210792;-263.800490630849;-210.820779921778;-258.183122033523;-286.590370604325;-169.741999038738;-271.750472270933;-218.521589353916;-225.820325675022;-213.719449945767;-260.914631799827;-135.174215342504];
  x1_step1_gain = [0.00034254044244578;0.00027748074658588;0.000806013241167019;0.00156677380853904;0.00168393926281428;0.00269046527889069;0.00198084992045411;0.00236361816544284;0.00245784730269615;0.00195235680232595;0.00282106579415896;0.00424658079482961;0.00317261769260758;0.00555458687461901;0.00429724736478089;0.00484270636687469;0.00333931608099047;0.00598913897545072;0.00384783002604035;0.00642488839732247];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.153397273216847374;2.16592442897713644;2.0816219770642074849;5.7397467568988451703;-1.481425587627656526];
  IW1_1 = [2.0839725634847980906 -7.1525088540543961813 1.1841397841430729709 -1.5134832768185833007 0.049147369606837680578 -0.77840502150312906871 1.2611243568142953553 -1.3649626980816573774 -0.16477776389330370255 0.33792641446046817189 -2.4505633595221953946 1.3374614593011109331 -0.35096681017723557749 -0.63448665840275075833 -0.54248152620733136597 1.7586051298642755292 -1.1371808065535911059 0.71948677523015747148 1.8803553516966202697 1.4102786665075723871;-1.1326856068183168702 -0.1298871816688098868 0.42213304134966761483 0.29926602582348893478 -0.20306840068340006877 -2.1938884334135062559 -0.29733275831204936113 2.4338506297721029803 1.1048090818136249158 3.3885105522483445206 -1.1978222067326369515 1.8369546976593953413 1.2942067657674207748 -1.4838893536786286198 0.51931624711307011744 1.4504674211955923546 0.59447166237195403493 -0.96429411376124563038 0.53879148134138432624 -1.3488167062191249723;5.4797230418744176106 0.1115985569673520611 -0.022033299946625138632 -0.48564008525758006751 -2.8947600487686506732 -1.2067449268295018516 1.9959433846371177346 -2.5657410091568788602 0.43990753243048091869 -0.82032122397011097981 -0.95607167978082785442 0.85481069017922040043 -2.0088343941414406046 0.89410267503311913195 0.30481753579695924916 -1.4301034367018499172 1.3664513919231571215 0.49032795597501793727 0.45965784342579735222 1.4999628603729533438;4.4973363520178724073 7.4551807354489270097 0.70933736979990480442 -0.11664411034079702478 -4.8325674455143863284 1.6629748308982681415 -0.47714560280215723154 -5.4055655071607908724 2.5750761399864030565 2.05948752474099539 2.5784713582398155474 -0.18707694668296520613 -1.6779979122447237216 -1.400560405845636458 -0.35697663442740062978 2.7452993255735194111 -2.0083357217997823696 0.089819482275767983936 2.2667282753353528157 1.2772922055774227346;2.1147442944867012038 3.7386545609298389437 -1.2194381589600844507 -3.5627620515557825165 1.3520680560729256836 -0.62192564998971255896 -1.668913619088161937 1.1295826435052960246 -1.4513113662566661244 1.9956607593149402469 -0.17407600017680507909 -0.043903050374682880963 0.81609420407509458695 0.21076393318388414455 3.2771080762293496313 0.27675204040317658016 -2.6186833194782126455 -1.2491129916306973335 -0.24915169840834675008 -1.3944538677262099391];
  
  % Layer 2
  b2 = -5.0318554286951160393;
  LW2_1 = [-8.9689364788506544812 -5.9698221398596462706 5.8625050877075199907 11.12573394429378304 7.6537354381868434317];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

function [Y,Xf,Af] = tpef70bd9e_5506_4750_b9d2_49ff91fbf86f(X,~,~)
%TPEF70BD9E_5506_4750_B9D2_49FF91FBF86F neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 04-Sep-2017 13:35:50.
% 
% [Y] = tpef70bd9e_5506_4750_b9d2_49ff91fbf86f(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-5466.61789079662;-862.937878923585;-1028.71862143182;-451.71097154289;-692.538815519996;-441.043793232208;-783.66763982473;-311.950474474654;-656.555828069274;-416.411813428012;-256.518565057544;-268.743398235241;-384.146123020665;-202.979007080814;-233.266353450985;-302.32135091496;-227.243600249583;-191.974128700902;-174.98234451108;-176.06281702448];
  x1_step1_gain = [0.000192953812201724;0.000635170113819406;0.0010737117105794;0.000992967389065705;0.00140247416929523;0.00179426803546528;0.00152094087103248;0.00262475201653708;0.00199415494766514;0.00251075910029924;0.00454433874041198;0.00378662000738713;0.00302237737948962;0.00448879604138621;0.00366080733460318;0.00363057230533615;0.00381924645547041;0.00427537582274333;0.00592120551781537;0.00602422138644047];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-2.0134739754396941969;-2.9044739625154640805;0.69222715018754965577;-0.038282599898111759062;0.61297873259353496955];
  IW1_1 = [-4.8622942409793434848 -3.4826409994758233957 -0.47167468614371449442 -0.50280751363325226766 1.3189267172927665595 0.60262571020232758023 -0.61697393246384268917 -1.2564593314567589211 -0.43808447118479265647 -0.77181551009263660301 0.43535792830554392863 -0.48807411897930835787 0.58540223042323324965 0.37927424144575622167 -0.96753590771029018835 0.17578679747184849935 1.3904702153781749452 -0.023147117378061413812 0.055400274018568881895 -1.0762583868413364563;-0.92122091423583918335 -0.90011801291316284601 0.44217407490722065999 -0.10244600531087962036 -2.3683991768009837742 -0.54671146260199932065 1.9613160420170148157 -0.22180751643577181764 2.0808439498008373114 2.7329834634220842027 1.5542405473252560721 -0.90144542747041622732 4.3036783169608776589 -0.022466068372460110125 -0.44789272715541678105 0.98473126740848726524 0.64624337944319820703 0.71830249144897373448 -0.28170487062248644738 0.65078459178214220771;-1.0181323643038078242 3.9087088027421286185 1.5346101559629725664 2.1564205546992760709 -3.4578238483866741149 -0.39013705546368238064 1.4567241600883642505 2.0191536007382877571 2.2313953992789770098 1.5947445714462138433 0.58581590512324099862 -1.1845692895692143676 0.94566894723716887761 -0.35245265896279587281 1.0312238945596625683 0.39800978887658150507 -0.54358109055692205303 -0.79260836977934101544 -0.4115406317843283146 0.41208089263290420545;-2.3458202338732072612 0.38508286063009511402 2.1178452399620102398 1.4833599366205769687 -4.8059974139656782555 -1.0528365588215249371 2.3380698830089898799 1.4554328685968063173 2.9756757694312643281 0.57147068051560534485 3.2760266080683355661 -2.5598719837125112342 2.0196699514779576923 -1.1155029848844606466 1.0486034989792436534 -0.3332267476480700874 0.50473338822980162721 -1.1181913049949412375 -0.27999387985729368156 0.11164405874076585579;0.072164213616199013313 -2.3884896599499403358 0.26060646972980033853 -1.74423166420750686 -1.4947792127241443794 0.18963152483668774262 -1.1565320042584601445 -1.3156368755987415398 -0.12043332107456349023 0.60715691507304747621 0.26268668273286910342 -0.020604742289423841339 0.42405283702724128059 0.26459593469809478128 0.44283102340768454308 0.38599050556514552524 0.16379298193508029513 0.28759794132076005324 0.65066369319266503801 -0.039369694362302198876];
  
  % Layer 2
  b2 = -4.4481712348328716899;
  LW2_1 = [-4.9021718782965963968 2.9156943010820306483 -7.6362282742434688387 7.4922163241859385252 -4.997923476192823955];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

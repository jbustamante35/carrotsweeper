function [Y,Xf,Af] = tpf056c67f_410b_4a5e_bcca_9d90dc3d3a17(X,~,~)
%TPF056C67F_410B_4A5E_BCCA_9D90DC3D3A17 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 02-Sep-2017 21:27:47.
% 
% [Y] = tpf056c67f_410b_4a5e_bcca_9d90dc3d3a17(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-7409.93644730061;-911.082072190466;-1068.86784991253;-1175.93373113977;-1366.53951203702;-713.22489846572;-638.058802539182;-604.796304556689;-546.419507096572;-435.830146318447;-311.040988170571;-332.822721465577;-397.169999063714;-247.407476323898;-308.974324228949;-284.621358963181;-260.199856451146;-137.27122552937;-228.698126275196;-273.249410813691];
  x1_step1_gain = [0.000226370837385414;0.00056334782852814;0.000948114745185443;0.000858032283205086;0.000730242383199751;0.00151716399266532;0.00146770964020614;0.00151546500149802;0.00206494173697172;0.00202475070577015;0.00326439309746549;0.0022999722951874;0.00248425272472337;0.00412752991038806;0.00322794766513106;0.0034379785161605;0.00328303385537608;0.00723300236088548;0.00445727486740938;0.00407527899100775];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-4.4410692319301316999;-1.1733934288481779884;6.7641439701855992084;1.2564973713258451582;-2.3076672199268148944];
  IW1_1 = [4.7169323609588582613 -5.9661225265137387552 0.12897146803044418073 -0.69427177693512753809 4.241842144839929496 -0.64339686666711937146 1.3802395551986090805 3.0360008743868589498 2.0307176621558169494 -0.73753789513722201043 -0.33106325759428040234 2.5819199143226798654 -1.2355664751879824603 0.83073341103024056498 -0.74628623053844078683 -0.54713067090785172386 3.0021718813198381426 -0.21800923447006920197 -0.78511370447393458161 -1.366778649529676759;-0.60126076063189271004 -0.94297525724455533158 4.1912387117766956024 0.25129544665525904712 4.5503692772278423462 -2.4825724561085058539 -1.5585856873860057803 2.320968288750221209 -2.4555727765589487888 4.5690218642205584487 2.9953023772230689126 -2.0174886568374112983 -2.2199576742265287876 0.48673096321320385993 -1.2714751143057345661 -0.44362359746451240916 2.6722735596821451942 0.0012314825371224150108 -1.0677275854638228481 -1.9632287196148641151;-3.0544330616557733293 11.49691221752805248 -1.0900400037355648664 2.401683321266749882 -4.5266508708531523197 0.12046307146101208063 -1.8785625299164048219 -0.17469380724896327317 -0.28054186951750753609 0.45320037885284852885 0.58114313752390001078 -0.3906703545940239386 -0.84852892452671002665 -0.16808699122979503526 -2.0866327425292290343 0.48368257625877336681 0.8171578378992788716 -0.40982632728478646245 2.5466260600621692944 -0.10852410664711875654;-0.96008441220036999653 -1.4493890761264671685 -2.0763650458490059414 0.4657385261957449063 -0.74831828010806444862 1.5051053853525691029 -1.1772163661522978551 -1.4290121366417003479 -0.6985944411226798767 1.4572230162215200622 1.0327635206991041539 -4.0806067771722664972 -2.2291444137073250786 0.15479478320959905169 -1.330130468976339797 -1.2661402435823949642 1.4758747572153083638 -0.40782978180421103342 0.68599390849138874859 -1.250249242943297201;-0.64758485640590512933 -1.8692786152684204293 3.4713687643093429358 -1.2195133124038497474 3.47842816576501912 1.2385229037398892693 0.58600264644763677691 -1.8377812186430206864 -2.086103808367187451 3.4390739691766554209 1.7479508938898560277 -2.970915808282576176 0.84189202633930904085 -1.1299801811773753091 -1.8355524071162394595 -0.96675863222802893571 -0.48452976244012052609 1.4461653459163117397 1.3097779105025904034 2.2887937914181959442];
  
  % Layer 2
  b2 = -9.6355528054570083185;
  LW2_1 = [-5.3435770072673500763 -7.4724675620601628268 7.1925520942539211688 -10.144117352238595231 -9.6658928672689903294];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

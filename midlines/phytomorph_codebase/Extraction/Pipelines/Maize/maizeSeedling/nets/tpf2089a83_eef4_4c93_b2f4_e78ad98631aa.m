function [Y,Xf,Af] = tpf2089a83_eef4_4c93_b2f4_e78ad98631aa(X,~,~)
%TPF2089A83_EEF4_4C93_B2F4_E78AD98631AA neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 06-Sep-2017 14:48:55.
% 
% [Y] = tpf2089a83_eef4_4c93_b2f4_e78ad98631aa(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1710.79601884287;-2767.31086728677;-925.675633657014;-538.973276654921;-1115.63541033651;-861.95307614226;-996.664725988399;-421.625702789084;-721.553885286552;-557.274532479563;-502.132109545495;-521.810951623246;-462.745727182155;-167.207345824922;-344.528961662824;-294.401776402721;-391.010406370096;-235.625647900181;-174.294824484557;-303.609020442439];
  x1_step1_gain = [0.000202107905561193;0.000554219398814734;0.000742185534904078;0.0010185341647551;0.00103332655312912;0.00147681597144009;0.00118221307527392;0.00265958726683853;0.00125235891924471;0.00165285753178;0.00232860128237178;0.0018801318429768;0.00198822427969293;0.00479968082327794;0.00252047169225134;0.00363117206158395;0.00272984263620485;0.00383651951608918;0.00502254586493059;0.0033077132874448];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [0.52440686167754979596;-0.39746255165853422442;-3.1065736776213741521;-4.2461926500810447394;-2.7263656689354704987];
  IW1_1 = [-1.125480631246071006 -0.15864478766049350256 -1.6703375197298802046 3.6288902329613703657 1.8678178520161972109 0.44776167686611234586 0.11507315336076121004 -0.99150830409674872712 -1.4116539808804215994 1.495785536258901427 -1.0746019946025036074 -1.0447428727977716711 0.13548289531811744113 -2.3337344422404702193 1.2310393427542312139 1.2457623180792523065 -0.43614841730211539872 -0.68376065730005419763 -0.8476038793489867329 0.34706102869249549903;1.9054457897048262538 -3.8210517759542339533 -2.0848948657356616287 -0.062513332970734317162 -3.0226333802732168188 2.9817360908980026224 -1.6612796695244793632 2.3962353008641974483 1.5569417029947352216 0.26558526774708529627 -0.35729752532157899036 -1.3437016346835273239 -1.1036708581934657758 -0.62500407283007575199 1.0914152607270828366 0.49804019008146060976 -0.65538259736451276449 0.70347581996491259648 -0.77610165491829496975 1.6996873758208526084;1.1780651925643270683 4.0005091242742540913 -2.3623007068459558333 2.4641443539012084507 3.5622629798577256643 0.87974485621566489435 -0.12260438776227673696 0.8331305966033956123 -1.3692613305033063398 1.4106826598241544168 1.3076335586248002407 -2.0638515090287050668 5.1645395709381221039 0.99729284287961794675 -3.9658976223927546734 -2.5871364525557924985 2.9191780514834957394 -2.0988135889543491075 1.0026127716791350952 -1.1092568893424057386;-1.3370816468394728371 2.2844307911030399261 -0.98657604432294354613 -0.54084410703804564058 1.2971044884050184631 -0.23245982913483206889 1.3788610573223183398 0.26008618950286982452 0.51099402359272749763 0.27147968580750214684 -3.8143397453766683114 -1.8130468903398517799 -0.60945530382861690111 -1.8076843021863493455 -1.3793478260732512375 -3.7176446324627954176 2.7329162261659742938 -0.045174374129965590152 -2.0222743264540117281 -0.084676575916020430101;-6.092012318233321011 -0.76293726227545966001 -2.4951007772589801625 2.8950975466318302765 2.264171017449894574 3.1080386732891756019 -0.08615730690519193824 -1.8574792511810878093 -3.8528226378301644317 0.33602386694805730372 -1.6503201360559094368 -3.4403524153336757507 -1.2643941302682046857 3.6493487087714879813 -0.16768030813076709173 0.00027496861319702137205 -0.43323941912412800015 1.9610588708050131768 2.8861528259703512767 -3.1320532362286805927];
  
  % Layer 2
  b2 = -5.2961222532493117399;
  LW2_1 = [6.0737083046717161849 10.860374193843876256 -10.403602324373078858 -8.2590973585867875073 9.2057536400087958128];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

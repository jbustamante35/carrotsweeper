function [Y,Xf,Af] = tpf21d6c59_7473_4823_9013_e3959aedcae9(X,~,~)
%TPF21D6C59_7473_4823_9013_E3959AEDCAE9 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 04-Sep-2017 04:17:19.
% 
% [Y] = tpf21d6c59_7473_4823_9013_e3959aedcae9(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-5466.61789079662;-862.937878923585;-1028.71862143181;-451.710971542897;-733.512404378787;-441.043793232209;-783.66763982473;-311.950474474654;-656.555828069282;-416.411813428025;-183.589471391036;-268.743398235233;-384.146123020653;-202.979007080767;-233.266353450986;-248.555985162457;-227.243600249941;-191.974128700873;-162.786711803943;-176.062817024386];
  x1_step1_gain = [0.000192953812201724;0.000635170113819407;0.0010737117105794;0.000992967389065704;0.00140247416929523;0.00179426803546528;0.00152094087103248;0.00262475201653715;0.00199415494766509;0.00251075910029918;0.00454433874041191;0.00378662000738716;0.00302237737948972;0.00448879604138596;0.00366080733460349;0.00363057230533698;0.00381924645546834;0.00427537582274437;0.00592120551781421;0.00602422138644189];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [2.4028043081597694197;-0.46987247614171506749;0.90337101843989042749;2.013971669772162354;-0.040521264987973551475];
  IW1_1 = [-5.8087018951765525543 1.0335834426294034927 0.76700999114138179724 1.5981192407647886178 -0.32190864829839488381 -1.0732544329448794329 1.5387561533712001971 0.40332660221673449774 1.5013515510170216682 0.11329126871354584793 -1.8036837210701459622 -0.77492256479826249205 2.2933713479799098245 -0.81923750492060110062 0.53833361791389033879 -0.11843360311841423516 0.49094052447488023549 -0.0066714182154517295137 0.64035861886207701144 0.39790701482758583651;0.4767328912746997549 -4.1689681800501059428 -3.5388725212409952725 -3.2341465024848243814 -2.6409851646327195951 1.2482952269904141751 -1.4567032916748388072 -0.4008644339040389748 -2.6551705641183445117 -1.7643132892726298699 1.4290236526058339717 0.81064840917756464389 -0.26669512255349753227 -1.0881750684951472241 0.23421750595801513195 -0.82303170012404747169 1.0044710602973700997 0.87553361265381757228 -0.44452249162795670623 0.33681688617902055816;-1.2263759283055422067 -0.34532786741399162933 -3.46415778153732834 -2.7098287901376267861 -3.5825550896308651083 2.2266017011001348891 0.40287846359873780155 1.1604350190109993246 -3.4932659016036655686 -3.1130721318829031041 1.7666874596547357257 0.29623073076216244193 -2.4182803214688104454 0.039088744428536388587 0.75579838436205670771 -0.61275488857269033716 0.1649948571755082416 -0.94844921372244561653 -0.12754058195114162388 -0.43567021016400564459;-0.33326275858153181497 -0.16662866116568969543 -0.38947255314624329436 -1.4521978848304448739 -0.19111727883904075509 -0.35352987153696813216 -0.3019330476255373541 -0.34975694822302877407 0.47751996042674732523 -0.17582994063373363902 -0.12312847076996535911 0.21559070941371560881 1.3861338892530119526 -0.35504456462263189742 0.58676781813957690215 0.19846967853330274578 0.53551332504219040231 -0.53427416138975813986 0.2363913017830087393 0.71532034738127103779;3.5734784385014446428 1.5228203003687204031 -0.64947065209041809908 -1.5686312610977766191 -0.21899501564720411095 -0.34841556637560683329 0.54843711877333389815 0.42218354891540021967 -0.21204352856692407214 0.49050552879470032952 0.10162524031910163957 -1.2304782108939100738 -1.1321066783869027095 -0.94734488679170958392 0.58048739873771204589 -0.0062009794762073137259 -0.025706989648482836408 0.21276771382005016386 0.22717060737380748159 1.2029697276434296871];
  
  % Layer 2
  b2 = -3.9951731761442030866;
  LW2_1 = [6.6584337127400408107 5.9110679926373208559 -4.7966672191851893459 -5.4576087576762457587 3.745768748686366667];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

function [Y,Xf,Af] = tpf54f8278_c1b4_48e3_8a1d_8f4a277f5f4b(X,~,~)
%TPF54F8278_C1B4_48E3_8A1D_8F4A277F5F4B neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-Sep-2017 01:29:49.
% 
% [Y] = tpf54f8278_c1b4_48e3_8a1d_8f4a277f5f4b(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1425.12385949519;-911.082072190465;-1068.86784991253;-1175.93373113977;-1366.53951203702;-713.224898465725;-638.058802539168;-714.930642633139;-546.419507096577;-435.830146318427;-311.040988170578;-332.822721465592;-407.901071240796;-237.143827584652;-308.974324228954;-284.62135896319;-260.199856451163;-137.271225529353;-220.006532848211;-217.514535510742];
  x1_step1_gain = [0.000226370837385414;0.00056334782852814;0.000948114745185443;0.000858032283205088;0.00073024238319975;0.00151716399266531;0.00146770964020617;0.00151546500149801;0.00206494173697169;0.00202475070577023;0.00326439309746534;0.00229997229518741;0.00248425272472352;0.00412752991038771;0.00322794766513106;0.00343797851616056;0.00328303385537571;0.00723300236088723;0.00445727486740861;0.00407527899100764];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.9126441063318260216;-3.5341624279384467044;-1.1434131831278613323;-2.0556926565636239879;-8.717858668274002909];
  IW1_1 = [1.6498151304496031511 -0.34893064260359218931 -1.6121050405859951304 0.13581428791078117846 -1.1036801723907294637 1.7110870132343520833 -1.6274284422409350803 1.8364826861108123346 1.2991998876907351335 -2.0150067075256035132 -0.0204997682958104957 0.94223193715182684826 -0.25657563040009384592 -0.017702826781191838279 -0.056791243699475156548 -0.80730563763225560159 -0.098143198222641378492 0.53426341465144600029 -1.5772652749406141925 1.5359601403571925271;1.0757590585360781166 -3.5651435200869978637 5.1910794117378378232 -1.710354563694343355 4.6105497882171997404 2.4902988494951250331 -1.3790294138053782458 2.8820117493564896272 -1.5174558605484176343 4.5690609884965205367 2.1317756626817443433 -5.6253089566083138706 0.55147631407559694061 0.5991138383692420355 -3.2945528832857995383 -3.0739167156622464461 -0.0028669328596267144166 0.91970047425747392111 -0.28055019101332201448 -1.0589194699993615956;0.075341235459944977393 1.0420889440560276995 -0.024749168458697602679 1.1365877978236971213 -0.81562271150615361925 -1.7069090967430957662 1.0765484213540823522 0.30412118758979039823 0.69759017571825265858 -1.9315190339011765186 0.18601898298019778344 2.7009559826341131838 -0.72584580321399172487 0.41343298822911439538 0.99280391513053800612 -1.3491581577010345327 0.12687380625656782818 0.62613221205106228684 0.15586029918970334407 0.84370177978254223827;-0.22156882088599041958 -4.7339398087343562693 2.5547188010116377299 0.47614412888848683947 8.5675135135465669833 -1.2135346598284648678 -0.80687703639698971081 -2.6085838362704665272 0.53446664775194052677 5.1516744216339729334 1.1269285662040253726 -0.033939098613037822771 2.056618802168881377 -0.97042768741095108975 -0.82847646207735980983 0.96605766156425543212 2.1489876740288846868 -0.57788423310710601566 3.4112976357599289479 2.1862585494624759974;-5.6679107915038358101 -11.943542752802748907 -1.3720608633889490591 -4.8430243111553021862 6.188369145541716243 0.38640407310756158532 1.8878362609393273264 -1.8134080697353756051 -0.9513328998837280448 -3.2184011468314346338 -0.38598166225926355821 0.97901259837564669208 -0.90846246303416566814 -1.6895908158234076435 2.6534709716930864332 -0.37818502473275683595 1.4806409881758346714 0.75160104758730894581 -0.92108094833581999339 -2.1645069299464192447];
  
  % Layer 2
  b2 = -8.8917119970769462611;
  LW2_1 = [8.3899362886189070565 -11.502687330549681732 5.791772441123138826 -9.3528568738409401107 -12.733769028430687698];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

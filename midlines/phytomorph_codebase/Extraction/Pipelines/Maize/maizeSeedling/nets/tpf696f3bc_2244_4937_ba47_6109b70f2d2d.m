function [Y,Xf,Af] = tpf696f3bc_2244_4937_ba47_6109b70f2d2d(X,~,~)
%TPF696F3BC_2244_4937_BA47_6109B70F2D2D neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 06-Sep-2017 18:21:43.
% 
% [Y] = tpf696f3bc_2244_4937_ba47_6109b70f2d2d(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1054.92998109303;-3159.48627075363;-2114.78087604941;-1423.59192565959;-885.05794399119;-486.212064486045;-466.558771320898;-686.259228054122;-578.923214789106;-527.239355792855;-526.427101249702;-436.274101764846;-275.990547714342;-572.311544415311;-237.436871082882;-373.225105661518;-301.983936484946;-278.643250866452;-200.952843846002;-287.671508962957];
  x1_step1_gain = [0.000201853701047093;0.000358308876895914;0.000501068237842807;0.000831515796852234;0.000879302903096349;0.000967909908790067;0.000979217898324397;0.00108578915137917;0.00217066128634303;0.00165661710022778;0.00119050056045196;0.00160876099240961;0.00270230114420073;0.00170182021982355;0.00262305491334266;0.00249971191480289;0.00300944378896526;0.00354914054319072;0.00406898355464161;0.00313490959585103];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-4.1344397433342869874;-1.232511680086411987;-0.53862506440271196162;-0.72144943424358520812;0.261622769198111782];
  IW1_1 = [0.57623432985974076814 2.9831317168301683118 3.7688548085254276465 6.0794767100624502731 0.92258088530987847342 0.40262874631395512148 -2.3822821616411324896 -2.1043016497859938774 -0.90399913926057973157 -0.25155359530726106865 1.2234088661609243687 2.2368180380459801171 0.40911159706417182802 2.2870737267738241449 -0.90819215580744205862 3.2314470297040500668 -0.80373299154691335566 1.5920782185068089731 -0.099781937353568286864 -1.5755099446700935317;-1.2614195806567631841 -0.74927753673408048485 1.191851055860902342 0.39929543505051051655 -1.1967992914240663804 -0.48243124925989355756 1.5567420666115252548 -1.8781377134800709694 0.84447488200375619982 -0.13059617473707235691 -0.21266835323635407962 -0.61542954009399397641 1.0648924768682175301 1.0581195392366202768 -2.8689318281327800264 -1.6072671888216207847 -0.62690267099055030364 1.0591511002661988528 -2.7144596580785433915 1.1341247396746063636;0.91590095822842854112 1.4461291477206241751 2.822544689170529697 -1.5925534855371592524 -4.5082175012016074689 -1.0552953276424412721 2.1229125451826575954 -3.747635518453546144 -0.97440371112686996469 2.8256788414766851325 -1.9250068575097418755 -2.8694670313216827928 2.9252663839490189446 2.1959844377727684162 0.13631227879159463212 -0.66000293089846528982 3.2131674223196640128 2.4452078645521884148 -0.75373010643954707621 0.40603818055355400674;2.6745285358929762332 2.0648109375937737653 -0.7055115575202096645 5.3832565224781516733 3.1352382886425287367 -0.97022366589506203738 1.0108967527524133079 -0.32633362534502224905 -1.5185937928392201357 -2.1607105653763758468 1.1800820174948636332 2.2406926104676379019 1.6032582973931963632 0.064251953084268134675 -0.46811276212089919513 -1.5263692657265135466 0.45732774402213360876 0.91907163436617023144 -0.77984957227485773856 1.0548660541670662472;4.3755967764322649671 0.085353099061901693823 -1.2690386244970430774 -0.79123436801248736572 -2.9946632360239715531 0.99383851503291509299 -0.64716507829651337413 0.3645567323406193605 0.57819488844826583129 0.53669798584784333961 -1.2020538116100198955 -1.3561264822067189417 -1.1582044116724423688 -0.96625690802738506413 -2.6169529817510248648 -4.9454262214201252235 0.55881127946481645719 -0.35779746393135170024 2.2274888651126727446 0.52932525794503682004];
  
  % Layer 2
  b2 = 2.9425050479344898591;
  LW2_1 = [8.4199176020287982425 -5.1708913377014784629 -7.775012960887512925 7.3932152347813868687 -9.4395628290757471746];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

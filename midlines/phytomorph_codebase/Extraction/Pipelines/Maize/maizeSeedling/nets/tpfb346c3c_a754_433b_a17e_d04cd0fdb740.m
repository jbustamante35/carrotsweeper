function [Y,Xf,Af] = tpfb346c3c_a754_433b_a17e_d04cd0fdb740(X,~,~)
%TPFB346C3C_A754_433B_A17E_D04CD0FDB740 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-Sep-2017 15:49:35.
% 
% [Y] = tpfb346c3c_a754_433b_a17e_d04cd0fdb740(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-3963.72731634938;-1752.79194273021;-869.204807020143;-780.471896742374;-460.20555521635;-234.31060487846;-540.291178237133;-572.142715533789;-192.819908210792;-263.800490630849;-210.820779921778;-258.183122033521;-286.590370604325;-169.741999038737;-193.663740648594;-218.521589353922;-225.82032567502;-213.719449945768;-260.914631799831;-135.174215342509];
  x1_step1_gain = [0.00034254044244578;0.00027748074658588;0.00080601324116702;0.00156677380853905;0.00168393926281428;0.0026904652788907;0.00198084992045411;0.00236361816544284;0.00245784730269613;0.00195235680232596;0.00282106579415897;0.00424658079482961;0.00317261769260759;0.00555458687461901;0.00429724736478087;0.00484270636687458;0.00333931608099051;0.00598913897545076;0.0038478300260404;0.00642488839732232];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.7070436875222416706;-0.078918340838199318998;1.3290960939467149071;-1.2156453241964604306;5.1786569146278775833];
  IW1_1 = [-4.0888673900807281925 -3.2851987755417177972 1.3701808100129582169 -4.2880754677973866862 -0.13024634915051744311 -3.6223989601440638175 -1.8152110306238427029 -1.2113091474647976753 -0.32266422751243906131 -3.0765740934973764276 1.2450487208046268073 -2.2790646616924208345 0.18915866669956332702 -0.19295833738013112857 -0.9918278367924732164 -0.6439475895259008098 0.091569666127130286415 0.88127622763942681239 -2.7525846560446844968 1.7892205138268035824;-1.3314726102166387633 5.3790376710665839255 2.1452586846389753994 3.6957227865190200866 0.94356819273591785446 -1.6087230391981528488 1.3428337401350207703 -3.1134523401207347959 -0.40225141641528550096 -1.6959797881459806046 0.034372174022159029949 0.39506504080423232583 -1.375120424682140241 -0.32242516445556296256 2.9176226199821240215 2.3561949215791551104 -0.17664303335795816796 0.77258404832803395657 1.5538003099842401245 1.6298019875841536219;-3.3614117348890522052 -3.5089478227700960922 -0.2997945304863125493 1.1927243504235514049 1.3891759452994936197 4.271458628940580482 0.78393445555219576359 -2.3126096294130049635 -0.017434497271282663189 -0.46456824478167385584 1.0119939187826412219 -0.65683159969890470009 -0.26360291005651953489 1.2376445897824097653 3.00174052539446512 -1.0409723357710067848 0.24885524535361025489 -0.029394189854598851142 0.28128354361143426132 0.093554899635898414179;3.205773795474186727 -2.4353117643100139489 -0.48146184356503518575 1.7058684154111727338 0.64787505681456747375 0.11901067161011956441 -1.2717700147503134822 -0.16261925407942379174 -1.2775592358971350482 -2.0888746154463939675 1.6208112717659084456 -0.65060267027636453641 0.47006412642289052695 1.0300510300217322612 1.4084228571657566587 0.064104484176241594007 -0.80996760939835521498 0.21146492652796244904 -0.47253949500814629303 1.2544081206467778689;-4.4773701432401713518 -6.4884620911000627785 0.54837528561881010436 1.0223855516354427575 3.5243027875689700856 1.6600296538692156378 -0.58516514711549072469 -3.9179380494427737958 3.516820292972779427 3.4076905820613312414 2.1273441661893750521 0.0047360270222662464307 -1.4585661454394283076 -0.39674199671961890568 -1.7987241758698144789 2.2134613080532772322 -2.0550478818226367572 0.47600864452130220439 3.7304165206710000469 1.1993079455136010925];
  
  % Layer 2
  b2 = -2.323386768203745234;
  LW2_1 = [7.774728156959957559 -9.4997635211363338215 6.183721277193084731 5.9905482103144347406 12.562888780847869086];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

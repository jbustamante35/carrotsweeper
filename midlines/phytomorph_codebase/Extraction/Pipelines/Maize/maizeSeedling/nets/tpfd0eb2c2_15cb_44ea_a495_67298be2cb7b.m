function [Y,Xf,Af] = tpfd0eb2c2_15cb_44ea_a495_67298be2cb7b(X,~,~)
%TPFD0EB2C2_15CB_44EA_A495_67298BE2CB7B neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 02-Sep-2017 19:28:11.
% 
% [Y] = tpfd0eb2c2_15cb_44ea_a495_67298be2cb7b(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1660.06224852336;-1969.79757456081;-1377.69545894784;-758.119043371399;-1005.44642162532;-629.490616020365;-447.378118638321;-450.686587111715;-682.765477573456;-458.33384431437;-622.81248159051;-410.039334332754;-387.578117402338;-429.961560001124;-373.705895665981;-359.072122656298;-277.037336897485;-301.078315473931;-400.794724948413;-285.384637074671];
  x1_step1_gain = [0.000244911356138662;0.000507837665104201;0.000859080031338269;0.00102992699402406;0.00116476174985821;0.001536082715882;0.0018649088281987;0.00229564725234539;0.00140550898923533;0.00187872252206335;0.00209870879134682;0.00237421637966933;0.00249683918257881;0.0027179566948211;0.00287765136194794;0.00323536160952185;0.003149651355242;0.00399550556362222;0.00295376821702632;0.00375051214875956];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-2.4963111508380122494;0.13420986346938945655;0.4803886374188502395;-2.0650717558378111072;-0.0066342364184830224932];
  IW1_1 = [1.9040609768027483284 3.8799989018722156331 -1.4992536809090570848 1.2653939651485210938 -1.9553325402828267698 0.85279653981979119948 -1.6121917403194454543 -1.5940004702052357199 -3.6648007479569186806 0.67405595729443146258 3.0377728088264670525 3.3895069162962787601 -0.50288712586593886655 3.4429379141943297071 -0.88872849053278868414 -0.80705894180245119074 -0.58525880134856633763 3.46270670185221352 2.1583030383337837854 1.9886382196137368794;-0.74930916515500367581 -2.5774405988189394989 -2.4742492585684545681 -3.7402974991804467386 -2.1804602604641973862 -2.8475973927451310175 -0.23215629597461207023 -0.06471827505685766313 5.349643701364304782 -1.1480694400428144153 -3.457232885570336034 0.18278423448171188248 3.6108284716478062926 -2.3090371994490754837 -2.9372440020634464908 1.1428144387662346748 0.67145531111346490327 -0.96397836052050867028 -0.40893202581560422759 1.2927090694973082385;-1.3773360286599289903 7.7321912586509338183 -0.57243947829880459377 2.3226176222962839901 2.4121483577542361942 0.099633143113127820012 0.27201757414350391517 -0.0084788326118757847971 2.4007713138779971374 2.6175849841689982078 -1.7059569134824468239 -0.51990871541541305856 -1.1616715971307352007 -2.0106488404010836035 0.45079286287545061729 -5.4231879911415186157 2.823857086318306564 -1.5856830165810902322 5.1978282104445057143 -0.61622639838848836114;2.9874188066958002885 -5.9860820663768787853 2.9277264331196066749 -2.7994672350950979833 3.9198734818060305685 -1.5660530839933644032 -0.33788099413744843158 -0.15239963202268863585 -5.7868833447119403246 -3.3422829190590781501 1.7444014807126040356 -1.242303641453557761 2.4085117175669652489 -5.6185009274797614864 -0.17582412150733045531 0.54552562518977176786 -2.0261022383826987614 1.3177180804575194806 0.099555193617475543078 1.793506910553242184;0.66602713805352220522 -1.6658554368715998706 1.3657821678298018853 -0.093437442921476779323 -0.74493980047732555327 1.6071854524584654467 -2.0063146838715559817 -3.4719155112008710518 -4.9223180971591249389 -1.4457735179966697547 -1.9403145191292812122 -1.2491646459991829765 -0.40795249231563107672 3.1194184442222478992 0.8800902505146078747 0.42602789803038926264 0.4735140829572216381 0.97468557420960000304 2.1140246286513226792 -1.9808976435937710736];
  
  % Layer 2
  b2 = -3.2632269626185714806;
  LW2_1 = [10.449126386476280004 -10.065374477522874841 7.636143796536441819 -10.32432069529757257 7.5286177171906816241];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

function [Y,Xf,Af] = tpff02e1a8_a58c_4515_b12d_90f38754ea17(X,~,~)
%TPFF02E1A8_A58C_4515_B12D_90F38754EA17 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 31-Aug-2017 19:05:44.
% 
% [Y] = tpff02e1a8_a58c_4515_b12d_90f38754ea17(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-5466.61789079663;-862.937878923584;-833.97876772189;-1562.4538661179;-692.53881552001;-441.043793232209;-783.667639824726;-450.026271289942;-656.555828069296;-416.411813428011;-183.589471391044;-268.743398235205;-384.146123020658;-202.979007080817;-233.266353450974;-248.555985162478;-227.243600250039;-191.974128700885;-174.982344511255;-155.930294068986];
  x1_step1_gain = [0.000192953812201724;0.000635170113819407;0.0010737117105794;0.000992967389065708;0.00140247416929522;0.00179426803546528;0.00152094087103249;0.00262475201653709;0.00199415494766509;0.00251075910029925;0.0045443387404116;0.00378662000738741;0.00302237737948981;0.00448879604138543;0.00366080733460358;0.00363057230533721;0.00381924645546775;0.0042753758227439;0.0059212055178132;0.00602422138644447];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [2.3662460184033218269;-2.0354051060184343847;-1.6012479287672503059;-4.2776648710811198129;1.5161932596139535701;0.54968271113332722866;0.58627389437152488405;-0.33287902043816464115;-1.8581333964013855287;-1.6186594315571105618];
  IW1_1 = [-5.0841499155349554329 0.76210969399547867642 -0.63870783738145608943 -1.8583023327265084657 -1.299781626781992161 -0.24981065927896459189 0.38003974204094748135 -0.62451169337191603237 0.1616324002021851669 1.0944204100593550866 -0.13865642728270607953 0.066651253007455127375 1.0029261058504121973 1.0673527954220061176 0.99402174840551837942 -1.4466343338418041764 -0.74933810895740404767 0.33878711301954134161 -0.036760381111952469824 0.4418245741287694095;-0.031839985194388180367 0.010773832590890259145 -0.41793433000845781056 -0.6269996216572537584 0.38217670449597973548 0.16590669791800449762 -0.41989248193165351619 -0.23314680022012360117 -0.48605344665387956171 -0.54755884645925623211 0.19176382460555427278 0.30373238578676126087 0.0029904181991860651069 -0.21847674677461351167 0.20021510475263923357 -0.20333907138357068534 -0.28357700688133002931 0.0019052441220360415933 0.32261300808182563626 -0.5229689834496077383;-4.9927904462204368841 -2.9944206499896743878 -0.65618699827501725252 -1.3400853033764323907 -2.0379311026898756509 -0.88165637783652539561 -0.30048206308058572622 0.14468629340255087512 2.4195286562764000138 -0.382092522840692006 0.10559969198921100031 1.1365847278173113466 -0.57070288369381882987 0.53939572789502987504 -0.21004812806397538116 -1.6220317252322320467 -2.4147696442324431132 1.6640728383064529172 0.40325864809953559931 -0.32990461608027221718;-0.071546628271535739341 -5.2778768058081428904 0.16767299174203284529 -0.35234235817863773788 1.3749795841483050118 -1.2730731852815413419 -0.99510971360963051957 -0.18648879339797092003 1.5796141494527748961 0.86049584834024051005 -1.654415272063789466 -0.92148021668913415727 -0.26841235311279265652 -0.1874110219069228811 -2.0418849331995239105 0.66286466615086403475 0.12100119687570004556 2.7688472437346298705 -2.3361566946514420451 1.4552564656690707423;-0.15664259037254896212 1.6026100258848396951 0.30015815487555225216 -0.12200410701530395308 -1.1910324200488371371 0.068825009263201952781 1.1655119049704985024 0.98513268617164539975 0.40409564689478194577 -0.46021028951126491391 -1.1579828189873335731 0.66174158864877741237 -2.0374851160947464734 0.92811086816702326185 1.6312083018247254262 -0.30154307706977462322 -0.24076352626342481522 -1.2623233727392138004 -0.12988130729498936766 0.4667026935446715874;-3.3968767639203027997 3.3182925841329882211 -1.6277738932266350158 -1.4105307091362591088 -1.148280677571037911 -0.51170835191760299931 0.73771842202336956884 -0.63045986819280386282 1.3735771614233165394 0.87840680395281189874 -0.7293221589884261169 0.19596578739901496236 -1.3000613485441625539 0.36446960231048830536 1.2420062654489592013 -0.6002092822089620805 -2.5155469489729060939 0.11918576756675766659 -0.69510821859834304171 0.16689794605560848151;1.6703544966095389412 0.68710561805706060756 1.5240780748999078753 -1.0179494766383345716 -1.4731284096979766485 1.9863609229237346732 -0.14433548190325626304 1.0127250550974387089 -0.20973732476161122129 -1.2299051784306131996 -0.10512230198206344578 -3.2750537993079511523 3.4315076746434831634 -0.41130129779576118931 0.64685800520670855285 -0.69771683445314081062 -0.21031348488033146937 0.1017114133127562936 -0.47476165603024739204 1.040507081018148039;-3.1324994786141155956 0.075412411417962621485 -1.8582101154453929404 0.69825930945872582978 -1.5618969314037711715 -1.4650187227849449378 -0.57367514728391966194 -0.54187072590508322811 2.0874991592314562361 0.70519417525742189579 -3.0324638320988182016 -1.7213418353433125318 2.7257222864758920977 -0.49999502280265190057 -0.43093946367128327379 0.45860912694218508578 0.89884962560172798618 1.1692371979884921274 -0.3728036941531710502 1.3065702011156481444;-0.34631970966245256838 -0.10945942520879524407 0.039233016465055128852 0.78101141355892933493 -1.2608162145388419617 1.6977982195885512606 0.051943973424741066158 1.0207392382913522688 0.29345993146476168079 0.056443144625495794697 0.47817519509204930994 0.21863332317918188208 -1.5249626262705233692 0.32050959049354554864 -0.13257222538115570609 -0.97434938839587370563 -0.060634531411696446224 -0.6044387198880222245 0.40745640751351130948 -0.16345385308376844669;0.029879602565601376396 0.048176246832313023016 -0.77361555716161312102 0.43242016923044279686 -0.19192336972070522805 0.21005095789973729503 -0.0071700531946234311031 0.071424973522833459794 -0.26149280494999571633 -0.22862667917713938581 0.46335211218937061295 0.32458064984258849783 0.13837303092934893911 -0.66372110786468452304 0.42212052220249668411 0.21696285734720355265 -0.16190628740538426378 0.5581856093670271024 0.12935099139636424548 -0.71301824142814917984];
  
  % Layer 2
  b2 = -1.3872056490678141838;
  LW2_1 = [4.5843131310391056488 2.2680863533420043687 4.0917248694480070625 5.539154330614030286 -2.5374242574730949684 -7.2238049744865548973 4.2153530272812300694 4.713215394843827788 2.4788481446465580049 1.039046184616820856];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

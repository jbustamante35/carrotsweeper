function [Y,Xf,Af] = fftNN6(X,~,~)
%FFTNN6 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 23-Mar-2017 03:53:42.
% 
% [Y] = fftNN6(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 3xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-0.913045608368196;-0.697742834656546;-0.455258159808926;-0.350773478419453;-0.341510968401377;-49.0053039056943;-74.2569817395322;-54.4179107076702;-54.0173944572861;-49.3577555023209;-0.000809726559050569;-0.0013602606530604;-0.00146328627525471;-0.00149716143554126;-0.00168341702480117;-0.00216755798705442;-0.00195351338232348;-0.00251211702556918;-0.00180428615074732;-0.00268405977928543];
  x1_step1_gain = [1.20478154368001;1.48846702877638;2.11403974925536;2.72216108078322;3.77210398358307;0.0124437578985053;0.0144281183648748;0.0162992707192427;0.0167582333008573;0.0190784070422653;1036.50533353783;712.60385144272;620.397298639487;686.558993024048;573.223015277061;498.654879142627;507.971506982535;479.181570477997;411.884775569176;443.322639512792];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.5956186475218672172;1.6655850314610347596;1.3174096395871430776;-1.0815233433760758075;1.1493039746955013847;1.3613496911482627638;0.76937496398274884957;20.978614204453847947;-0.49116158793790209991;-0.27364060411617702195;0.43343447424198722207;0.1897169466193197318;0.091270625947291919577;0.27475668178643530837;0.11486998513812340939;0.10294064719892180582;0.49833168444228803651;0.87393393690414988839;-0.8796728484518192559;-0.82229599934950969864;0.99762244620284545871;-1.0940848403804754874;-1.0835457184577286238;0.2767746261619244974;-1.9436777547542152256];
  IW1_1 = [-0.54653334252116003711 -0.16744927673180873273 -0.22167566372895169957 0.82841323591849513885 -0.93155521289290987852 -0.041756814612693690658 -0.11798316319928335572 1.7261067935805467499 0.26183925497681870276 0.40486191243462410494 -0.70004434075836940998 -0.17298534845182381159 -0.52537125775571524855 0.87737885513009605809 0.54856973307120171501 -0.62864417095486679887 -0.11504976598626535933 0.79857655911930591763 -0.41580804359298273454 -0.10375134439956278098;0.025958086795899580623 -0.76474392938509516693 1.9827481606385177759 -2.1660216558372495932 -0.17958797301967446836 -0.69839501738355214133 0.97015003397892440873 -0.47938424972201210128 -0.17316020660184155977 -0.29984565124905643296 -0.30143085696489074765 0.11412187700107849497 0.57236939079443061029 -0.43873105106287801913 -1.4038363250905891988 0.27707806002074314433 0.28311173133927941548 0.50173971819111573556 0.39932561698966961838 -0.23873477119967870252;-0.081580084815324624414 0.55064035347303608159 -0.29195367220226853266 1.3264904474099838971 -0.67677682055718857423 0.6087266325592116667 0.32435931625673541934 -0.29937382863017980572 -0.1854050468806296148 -0.006142105818005134249 0.18754236892438255757 -0.092582067506605386642 -0.51507099057240324225 0.21476892738276040506 -0.55222391274487403479 -0.031093355157655426513 -0.2737149449435417603 -0.35332833489686893413 0.35511497496062105483 0.5129404128613700431;0.79080348491539353972 0.06439913929045497365 -0.96946355191863475831 1.8436618504150268372 4.3701579783301118809 0.084427917510433270198 -0.25788532405135516923 0.72154763111443087631 1.1808154796354892735 0.3204662461043138455 -1.0102899431407552644 0.22113979873810010734 -1.3216826379786938972 0.67158669140799953645 -0.41031290521565039198 -0.51264431287399159221 -1.3949069377292568905 -1.018839897231202718 0.86661991875597532697 -1.7397541608019806425;-0.52803996594982682833 0.69400218471056474012 -0.31331153885889784227 -0.82452865518867046735 -0.34049714600111719021 0.22402318551554076254 -0.3880019314742025327 -0.340554764319826897 -0.10788292394850484968 -0.2514073743152183682 -0.52495616142949053096 0.57501084913289268741 1.9435150577789357396 3.1088839413083690921 0.63539002452934678633 -0.0019949158353059744456 0.30819619016354393715 -0.3320407262250907876 0.32000338034153757993 -0.22827985567580810766;-0.0087824773090860713126 -0.51527792410094985787 2.7102621505837469762 3.3013523020970647615 -1.8271605350296276082 -0.37712214596538523592 0.94217779918581956444 -1.9734308859017328786 -2.056520506909023549 -0.85048491185758678945 0.3826276826530611852 1.5481346934599735654 0.20315084182618811659 2.8927306619574428836 -1.5552438114450162221 2.9050314078578809429 0.8484606453024172712 -0.80871160348455728428 0.14514865037083532484 0.771512238350727797;-0.45514862575668157962 0.48270806403001664808 0.33676765458163571143 0.64058184614663871148 0.0069489640643883767573 -0.35043377108816342602 -0.06776296765820838397 -0.5051229705709875395 -0.65653137671301176059 -0.32599061174141941155 -0.33810453670727341757 -0.26458311969359665783 -0.68721046553864606476 0.029394211938378579652 -0.14110248714840761819 0.23907822196358516353 0.31822451560369263701 -0.45200145080709430712 -0.26784032434377302856 0.32770845324303676804;-0.67638992920492457817 -0.046299367003647617924 0.054144068299263672928 0.095531786855879083364 0.0095577793540700013708 -0.52985523944549228759 0.043443470085058395747 -0.033260734123246503413 -0.56291205710335390222 -0.1917060549027338745 -0.28089441082930000082 -0.069804785180740194783 -0.12248114061466097713 0.023274696849361658363 -0.09306876559654858605 0.86308463821330549948 0.34184886248349466431 -0.2115783789564026629 -0.30138233657394813969 0.32005456136947496582;0.52158799581833747983 0.097247843473087722255 1.3780292262400424264 2.2513509901483894637 -0.26084142512325642072 0.18559478940314025341 0.043232545867963857733 -0.56941351965678832503 -1.1119159008696852808 -0.18607445444606440788 0.21126979335594073262 -0.67430129568896068903 1.9290416187350627464 -1.7262965991607350791 0.020229679765543497061 0.39546577215727723997 -0.79593648177804732224 -0.33799293078249142974 -0.24381824676698862775 -0.085596541662971217801;3.6562051903557120092 -1.6016069782496693552 0.5980591635966250319 6.0559550102866044341 -1.9866039612992596464 -0.58780952514550532939 0.63771218867473888903 -1.8652771948550903591 -1.0766563221665592653 0.42448963536828221432 -0.49760794480955178321 -0.079877909734604388148 1.3670978173887180507 1.8345847496237854823 -4.324428003722317726 -0.087761335796688849653 1.9516511661718700665 -0.89470212538260684987 0.45706327280435299354 1.2490430677011246097;-0.29336007790874540913 0.74544038536432488673 -0.14628050973203307605 -0.79745262521354920437 0.057246186369522319981 0.49572901638697619564 0.46165671449551071159 -0.36114965275074073503 -0.35071807546888988938 -0.20273728510927077617 -0.29037851835076228246 -0.70156601575598154241 -1.2872197252701651493 -0.19023479215744901194 0.1983352204153908116 0.13373365047387639204 0.021546111437424145252 0.27483754817365169121 -0.45964047711646566219 0.5113496006622330059;-0.054712497363847610587 -0.50057332622289818502 0.16944415620364586261 -0.71497775286291131991 -0.90376642685869501559 0.4643142657457735023 -0.40719053235811630831 0.29526615940612715994 -0.036291756416572777677 0.13655067206548324177 0.098353449346588489588 -0.68964276160723814169 -1.6850436769139007787 0.36226682088192074804 -0.2385128230369545077 -0.34100236572286191095 0.46608286391466385856 -0.44366171980125307384 0.36201861200604706914 -0.058394392382428904342;0.32639868532005555934 0.54170451843663947056 0.62793937934976462589 1.3358577820499151212 2.5909764732728475245 0.054789288884753963027 0.38850960021871749905 -1.0884391376922428751 -1.1872760522148904094 -0.34972522661277183342 -3.7016569284975311405 0.070630786618147714528 -0.64390217529334803359 3.1569639767782513573 -1.4187798679908503185 0.8524331404619989172 0.2496425273826657909 0.52456670269329286338 -0.76741567991238701651 1.1965317310881002921;0.68069472600269964602 1.2110160872015613975 0.70613446558884263027 0.47249669571264951706 -0.31347773985206539571 0.12587475554767801889 0.079593205308428005562 -0.39277820611573976972 -0.55902851421972732382 -0.1076845124267777204 -0.11663621346147762248 -0.15887047650027452672 -0.75260924054741795697 -0.093998791919107343995 -0.38112918265967199449 0.16764100334464840381 0.51087407433088227737 -0.2244510304005918333 -0.39565338797959526129 0.36940292081361625343;0.10271012889615857566 0.32913922184952498773 0.91976658534845001647 -0.12838417055658984944 -0.53783077118311539699 -0.3561580898212626245 0.11064752659358001452 0.72612742979521027742 0.39903685847139291898 0.26448677909028378563 -0.047502913573658392399 0.33269223964156147133 0.54480266505494467921 -0.38848364961677456231 0.72192312451319418098 0.50305545623979908143 -0.2625275874617296612 0.23300494221329043354 -0.30307179664570266242 -0.5343979433208598806;-0.73744192911592854056 -0.55152062723617656381 -0.37538100344193436886 -0.57121876518944803003 -3.9347805322253459615 -0.68027850062634021011 -0.10890345769389392361 -0.10245195906909415617 -0.41467994115225448315 -0.23714814335552611424 0.14544979739160981969 0.95337766733246254169 0.097529304423662213641 1.5091942382495919794 0.99059941134732154566 0.57931171362550204496 0.5049665142555508357 0.75035159803141127099 0.048929033524450687986 0.76655190494856162431;-0.1003566274497703914 -1.0020674571203085357 0.79270648082970995851 0.82002931419515578959 -0.35210212375998989343 -0.4549008780730162127 0.28517386387041382401 -0.69944880969142986249 -0.44031183195139328435 0.17694006294992994932 -0.26292628798666067835 0.028074238409520318321 0.32133703421490844576 0.46286723260096251931 -0.2609658104146426183 0.489323277293831016 -0.23178331465359514052 -0.16891826320824046559 0.62890239135160252992 -0.099966385706105859166;0.89663848419488545449 0.36851478424102962483 -0.3177053631548804602 2.9368441085048329064 -0.99026029522799219329 -0.54542134072783299281 -0.24951229153788564985 -0.1987830535770312157 -0.00090820109959897357341 -0.24198014926987918005 0.2002560945210271337 -0.86602931484286960195 0.18176117289912316344 0.21721608746572773629 -0.43101503645482303062 0.011564909858841242868 0.14932840252049045526 0.37272789365237729564 -0.41921566460182785319 -0.011517899930147118895;-0.21801498501462848734 -0.48256210133250448946 0.26108720902900278693 1.2531360178316792719 1.3314719166578874443 0.022313698776607233248 -0.58051463596568719794 -0.28328046529173744883 -0.76250159893640212516 -0.045163129741173958787 -0.49590658613798527243 0.1410573057311400591 0.30540241359583314429 0.24721803168813599738 0.14161392691910462682 0.207981643123077653 0.097870017704717926499 -0.23289722089413295025 -0.088686110013532493124 -0.1129962680204578962;0.04126422758732643109 -1.4904115468625549479 -1.1264844701982437147 1.1732591773166023419 0.65628080788863496497 -0.54175761408760148008 1.290450990409231391 1.0359523036509994398 1.1127981000910858178 0.42001012408745530546 -0.31754891945710239654 -0.33834919146567465909 -0.97146949185918629599 1.6310978936692317465 -2.4362713037481968925 0.11521709180318416565 -0.73314520142645744905 -0.076306419434900768506 0.1494470346206709932 -1.4748039897896123573;-0.86274299331281523173 -0.83527954114790126106 -1.1280234583023147632 -1.2054792653348005427 0.82202023063620499599 0.087752194576489195299 -0.12460851101675855801 -0.53776222842267296098 0.52810246191465592958 0.19470783079652428937 1.5994843027558260928 0.25521225164477534531 -0.93661381030777546286 -2.6037577428618519093 1.3312552592648054794 -1.32625002015667115 0.12593470116173380302 -0.66639857690849169103 0.55891081002175990733 -0.25619060965103396255;0.53371336536873004164 1.601416173222100614 -0.24710430314709078137 -0.87464805402630285691 0.5731733496055088084 -0.58462492158785084317 2.6311102067106584279 -2.1842790150774300528 -0.46549273154603104663 0.28647246569328121968 0.14674014047183178699 -0.67254682454939473946 -0.48017809515684128918 -1.8737570538206531623 -0.45140167023522409506 1.1416288192292352033 -1.9404373471215088376 -0.43019947840993616461 -0.28782463971440830353 -1.3697434008365538816;0.90010825103214975318 0.018756160887685675853 -0.69809913068054652019 -0.39312633194207052822 1.4796666045095989706 -0.73478286412049476084 1.1299074828323347752 -0.15997968416662847191 0.20715321226877120298 -0.051816299439931205739 -1.0528218111667715373 -1.6542298480120047888 -2.9643311770047962028 -0.45494959690841629829 -2.2771910486650961403 1.0479887702967776164 -0.98891368697435177992 0.64512088542480627851 0.32291561018550529738 -0.32793558827237201392;-0.31574900020532747913 -2.6426238232708518794 -0.99527628076579477412 0.50976276540693021833 -0.86791601030587506305 0.99899986938174800688 -1.392096914770516447 1.9183600709242660809 0.77519305067418509125 0.31349930002754505809 2.994169047844660092 0.34393003374363478875 1.0924672599562075259 0.5871372773417746771 -0.030366108918603317707 -0.8626471869394867209 -0.60007121967961885023 1.0130936570444772915 -1.4914988535700739458 0.03783880527057272708;-0.29482146195863889737 -0.0045068084991620321889 0.090842242696620070785 -0.54864561307613446406 -1.813786952890099613 0.15460768463478488655 -0.59264671336268825996 0.78795879036559712816 1.2636107050683540454 0.84037523317883255913 -0.041089525574451099543 0.29070706502833848495 0.11418734972371234748 0.19810204013178320248 2.1047337176249962809 -0.013646822448347566831 -0.94864514830392632216 1.1093643958234753466 0.20051038848776137069 0.31436289502158237807];
  
  % Layer 2
  b2 = [0.40417386722022891066;0.22855646467684098688;-0.52898769619418739563];
  LW2_1 = [0.2182724859656155203 0.23199328054820125833 0.67570161230642944439 0.67030169682589291202 -0.69597146310721402784 1.5187119241676001469 0.014759967617960671055 1.0489047035021752396 0.13965954504732497332 -0.16329891348269889861 1.1007416366520863527 -0.89255800801920570642 -1.0378484114822790207 1.0034352619148689811 -1.4971127032730602302 -1.1588219758822493333 0.88801999344442328344 0.68445391290420687369 0.38037776055293515132 -0.017061473493009474134 -0.6717834988253719164 0.55401877851651437634 0.47271090743623295216 -1.8798259225618509927 -0.53378229895188589182;0.27050880635510055061 -0.8311677285409183602 -0.92969469656435232974 -0.69693587316946348231 0.70722250287438614968 0.47786188930138639996 -0.84288828792773140552 0.4062760620557540614 0.70442451254957971774 -0.15967351215241018525 0.088563501795168017572 0.57096968907462863907 0.73079208172938925347 -0.42757372201434068471 0.26325361849389761204 -0.091145263590108452356 -0.96034638091236446122 0.53043390144375657247 0.015629848718994983348 -0.9722740801045679504 0.98206188424076645838 0.84614441006831131453 0.082297097316554879143 -0.64236777641035192055 -0.477415139057922433;-1.5858831521404173071 -0.4880300109792042873 0.21535477703794425608 -0.52107341412948404713 -0.31660818255080697137 0.24027441276344443932 -0.21953519546031932674 -0.015286787188552959302 -0.60448759376848815172 -0.96044925769260325321 -0.042558324943982608901 -0.57206252192075002228 1.0170644469288043776 1.6583823140591871237 0.2497509814646060311 -0.41592149413911494449 -0.28567844888759374999 -0.82377689530599040868 2.0292759065976540001 -0.33555734584952878752 1.0328932862909523394 -0.53551459265654266506 -0.8936880476979937038 0.21152578778830158357 1.2551757123299407404];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = softmax_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Competitive Soft Transfer Function
function a = softmax_apply(n)
  nmax = max(n,[],1);
  n = bsxfun(@minus,n,nmax);
  numer = exp(n);
  denom = sum(numer,1); 
  denom(denom == 0) = 1;
  a = bsxfun(@rdivide,numer,denom);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

function [Y,Xf,Af] = current_sorghum_network(X,~,~)
%CURRENT_SORGHUM_NETWORK neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 06-Dec-2018 14:22:57.
% 
% [Y] = current_sorghum_network(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 39xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-430.026335633088;-444.819398483955;-248.289733421504;-210.438644484323;-179.999772507955;-172.703252667592;-116.861672134158;-123.845422406652;-129.108340999912;-109.384255257989;-100.379313879095;-106.617040385154;-93.8971131708157;-224.76515961121;-213.877072374426;-175.758908659739;-201.420560636267;-194.611869587179;-179.664892126251;-159.26596811552;-160.463501525335;-154.084973881519;-154.310223117438;-136.73435812512;-143.731619061286;-128.92272353732;-207.00765138822;-210.63660811912;-207.188324356569;-192.426749317275;-188.20310035679;-186.710963149668;-178.336130615569;-175.010391828364;-166.275419048367;-157.71787884282;-161.276975440941;-139.019202525854;-158.964657920505];
x1_step1.gain = [0.00281056749180146;0.00293860490748094;0.00289734511748745;0.00508894241980759;0.00577255756667235;0.00610710711573936;0.00802351782175727;0.0084015604370522;0.00757077283120828;0.00912372864221935;0.00832334729905142;0.0104581469026832;0.00919405585386518;0.00406244450589323;0.00445416922762762;0.00533921135332905;0.00483148106130291;0.00529340948120529;0.00569291914866415;0.00579108243713661;0.00660232528293778;0.00666598198241318;0.00673612942102724;0.00711029967693081;0.00683953157050495;0.00761031626066419;0.0035526031232784;0.00434854734270772;0.00496852300719043;0.00523090060917459;0.00385299066770022;0.0042862736284756;0.00389428417356747;0.00587159454910165;0.00614473857051202;0.00639794461786341;0.00668272516663032;0.00716763951523658;0.00673863015549265];
x1_step1.ymin = -1;

% Layer 1
b1 = [1.208697263855236459;1.4653565796359915296;1.7418060987884542712;-1.7482718348285717358;-1.3159264322892441079;0.50677047408321207467;1.4489315861891036707;0.29634230665462313326;1.3637323476019687085;-1.2319845169002205942;-1.4852380138781451357;-1.0306214571117782164;1.0957508996163167758;1.0636477447514149919;-1.3733789374782794379];
IW1_1 = [-0.41935752035400220006 -0.052564552319263040114 -0.48975599904007693919 0.0061651044189256834493 -0.54255963714629162897 0.42654885629252536905 0.15338219639299641162 0.065472313922144420584 -0.47994820355106787568 -0.034848006234542414083 -0.0032680581163590984722 -0.37807727490224785072 -0.1539896926454373538 -0.23918483588879557722 0.027817671929264289193 0.60974440005182928282 -0.13986374585742325505 -0.02111653757650841165 0.095502533269323203191 -0.34095922521201105226 0.25467864282366908801 0.28443200436463966785 0.1845859768063819184 0.1939076824028438395 -0.11088191395141663853 -0.12387796560905163512 -0.1799052890536493865 -0.68395596456106755312 -0.14786655659219075098 0.10120189856898854919 -0.35778165311901471979 0.18010196222576882463 0.38857908301294663556 0.4250363327920657075 0.087353521449818199995 -0.33170473179914172768 0.22931203093824117922 -0.14969687162027256466 0.41436034733473614544;-0.77379720643538951741 -1.6356996887216492809 0.070619002804775565796 0.27538938379284638724 0.28663152185031326447 0.150435694788235097 2.7120743047866850972 0.91819084425540031802 -0.20066200238934256417 -0.35986919323852406549 0.59736051075687324197 0.5998124439990717427 -0.29520273529368495913 -0.8228266551571324916 0.32642740500077160881 0.67403670410539973101 -0.54395722949897507004 -0.099258616487641768145 0.17651859027371022415 0.93062923814789766386 -0.024776195140981820825 0.16668788945710039107 0.18022202569417899998 -0.20863677682076370301 -0.021207364927412496874 0.14959439454415907056 0.49220043368560778552 -0.026872349568400802355 -0.41212470484364160939 1.3171063792497652578 -0.41351328372991397186 -0.1384031159032711733 -1.1892901278720808822 -0.2307917465968936932 0.12433597123299716669 0.042384642103726596907 0.36172993906956496524 -0.25497124968560114233 -0.069635237430296356709;-0.24293011296319089176 -0.44625335299862234351 0.019287432794691784788 0.55836400027413435332 0.17409766632612011517 -1.5429945067877954834 0.27394568950795439299 -0.031491531092119579016 0.28865002216099977517 -0.22745137466412021499 1.3458713978853162896 0.014370012512448942371 -0.553927325363423817 0.2250522042412931023 0.094759575498803746973 0.043489589496176622729 0.080462785080322563047 0.18563633370372076281 0.54793725499363776787 0.31252547817413312004 0.26930595615857838565 -0.25198443902579442666 -0.06578341168378959436 -0.25152652224376875756 0.1652344044105293619 0.16538603650879302176 0.052466962423027986573 -0.18771184123402248622 0.18831800252096947412 0.024217032434283355252 0.051949006432370541109 0.016475582293957489327 -0.081870794893897841371 0.015681918354554087031 0.16883092011633649143 -0.15059104591121968975 0.18050839939718288374 -0.13965914112180918827 0.10071096836630161198;-0.047676402954850323479 0.12831998409266168193 -1.0345210277225347362 0.013032735956147073128 -1.0628484876926336256 -0.056132413569635372652 -0.69022618903587229511 -0.31236852110584856224 -1.3373230269587201846 -0.41284727819012456695 0.52640778647422670211 -0.1753512027288411379 0.84417557302015278076 -0.37747872595594239575 -0.027447925451583268797 -0.11629059231593134871 0.066165096712433368875 -0.1562993509473542264 -0.43027239102491965372 0.11684022106412908504 0.32819550213017029128 0.30045982920506530967 -0.15198176719593731177 -0.051185128725643243286 0.13938000079941079146 -0.0089618484319540000355 -0.42075073472145546605 0.046620335368120671693 -0.16821204972018471979 0.085284891559187073207 0.46566011382875188707 -0.25958359013227333412 0.20470680850572203768 -0.094668740136195625445 -0.28271159178126326061 0.11625965165150949077 -0.17091687263349650272 -0.00087117549944744051074 -0.0010181699208270719031;0.03939748592239875058 0.74356168597616456584 -1.2255998962500544991 0.57928042464338991291 0.83058419567093333402 0.33768299620926545135 1.3934170543084813954 0.24925244204032240281 -0.82414226210315399967 -0.59786221279885864988 -0.19263402172969770754 -0.32758718080328219635 -0.29192599791390705377 0.43178858393560892726 0.77331451750229485143 -0.6614069713045130916 0.74081721943123601815 -0.79765360887148673008 0.14482584675465579038 -0.067968926322219888614 0.2332402233957519555 -0.34558086068834703575 -0.48636329639033143435 -0.13303486468081673899 -0.28471308169482667516 -0.16287377313039139159 -0.74446195866085840276 -0.61855812458434900059 -1.21450482353228284 -0.15391287398372985318 0.88237325679263090006 -0.044138772691959413108 0.85694621363291734184 -0.31217041424452962595 -0.35577787927252885192 -0.31903125130851206492 -0.25653346929519754704 0.13467893934371030773 -0.17881284771138589162;-0.14489246780362383116 -0.010249810357501915048 0.23495485278321986966 -0.12368210054739403603 0.30929670481227816703 0.084858201758852780383 0.040589147862043185866 0.084761514992936756729 0.17853025251656004513 0.027982732840443225175 -0.51640398088789341013 -0.058602082541281193262 -0.26018196699295159657 -0.19719719599297436119 0.14887935648407885081 0.38837918270808935439 -0.284333036623687474 -0.11524216422357269618 0.22342646073964492204 -0.14306342393007495661 0.2884762811650183334 0.53328428975134789525 0.23687515251337248889 0.39842584638567507538 -0.29373003657694651825 -0.18185466215050316574 0.11090068048074767926 -0.11823854424343087366 0.06729230572647129649 -0.31810717319825165816 0.28485052976952307535 0.16644430953201666545 -0.26398872655779143104 -0.23183891045104723649 -0.045216152658690597632 -0.17735539958316989817 -0.036334088412659976131 -0.20870326808744235625 0.12943586274476021059;-2.8545768847981642935 1.0172991907748649698 0.16825989316974415688 -0.26643959144804901795 0.79525898572430220312 -0.88225249314028131309 0.038302478854963184496 0.78679154622117430939 -0.63785132005801714605 -0.63182817550293390862 -0.32503379518386943392 0.34270711326866332147 -0.26621807073799458321 0.25658427858943205768 -0.33627817513220331636 -0.57369817245291532259 0.63163579865729113649 -0.33070614595661945723 0.4283244491069967963 -0.12434235826290124249 -0.12239157745850870462 -0.087246288215069453531 0.24385264230819345133 0.029860087927478125985 0.089426797849468248058 0.16821166158930611623 -0.081727317088411327584 0.068051380283322387976 0.72903308947999301282 -0.20831857302282072442 0.39739430343794801548 0.13380034017004457936 0.43113131048311553739 0.39142565307672755326 0.055871676717395429845 0.1848965717283530541 0.17548963264510206161 0.19437180128789799394 0.15132197259259019817;0.14196508617081377013 0.37152139071579604046 0.24143577601326837723 -0.37886801467804948063 0.74594881727204875865 0.16184081490099858081 -0.81496083662507567968 0.2167004801276449788 0.10104137754546885231 -0.5833279235168710164 0.11709320635229941709 -0.26413653421100341534 0.28234230364765450227 -0.21154133815474993052 0.32502537093031602655 -0.7170466482748938386 0.04891506283942762684 -0.49010211955527538397 0.64426409479611712605 0.30497961713239979398 -0.057296366627072076172 0.17008503851632705839 0.2781988694058328826 0.0023023202022340125833 -0.1167372951880055465 0.15509417741952308267 -0.19935264243822611863 0.20644591441101819984 -1.0690869757707335275 0.33353529910616480647 -0.674260936832934199 0.032879989272840873249 0.17253248622666086942 -0.22017226501803552341 -0.35340202855198016296 0.029763864087914961021 -0.14118856588144410025 -0.20074419784982808213 0.16566641407056004187;0.74219368325505941097 -0.13332620750138413079 1.626724659648712823 0.85684280857253214414 -0.25654897787519470587 -0.075880411034282446714 -0.68409535723364733872 1.5511329504962161341 -0.03377112907031584732 2.8933045309282685587 -0.013304363876339179648 -1.3282667701363524149 -0.39404055909009799707 0.074553501358608526006 0.047503849427206486233 -0.22698622237234655774 0.95048468322784385176 -0.45815346324795563904 0.13817246524228676829 -0.091072907637868405484 -0.11359730469640474948 -0.24390168083502494767 -0.28464565128834196095 0.10421858196737128488 -0.50164151847402904671 0.19705087692762507379 0.015256905023116110881 -0.19647300549393556524 0.48511623973081446914 -0.1011772484014972634 0.31045290974880151991 -0.4938554934743531466 -0.39605320831877749432 0.16859829042047699832 0.15312813197754124306 -0.087193512880533119436 0.17231699131053096474 0.21908799477034907044 -0.17068529925044975681;0.071673509696253287493 0.14549785606758744438 -0.079487905895703273029 0.23196776010609507224 0.0032377527982473900542 0.34066990133555830056 -0.95192448454336364705 -0.84199465849403842821 0.7982880206381371968 0.1931708358579147522 -0.05753041628883671238 -0.094055094718912546359 0.91730859108344253716 -1.3582216704806644447 -0.59751619366121355714 0.56874467287527086246 1.613568268274302886 -1.8501599447692986811 -0.15511984168581297028 0.44438854010404538197 -0.39577673264736756842 0.25862426727513204705 0.39075251896758095294 -0.1993038726580571296 -0.1932989015456783588 -0.0056099578420431830614 -0.9100636922785866334 0.57797097802609875838 0.40868504960435586559 0.73963594863890702591 -0.57825828255865630023 0.6844895105214395814 0.028251343160957176348 -0.11235234407583671867 0.1137745234036862535 -0.01857897166532647415 -0.0042546029997079376495 0.086659977766783011233 0.21020547555807228557;0.29054039714128659933 1.2265527304042282974 -2.7167200612914355062 -0.28022869376205611358 -0.85008305036185116688 -0.24749502035385378962 -0.45458913583474785947 0.26672818925432595361 0.19250689385305572165 0.62855160426723399869 0.17441858091254303087 -0.35982442890357302367 0.4140777459647128067 -0.072427123413985661227 0.1655503037822827761 1.3274549154054113842 -0.096177818226424294235 -0.064038953133724943467 -0.90589466955867847808 0.30277001244345902453 0.52059077866430536474 -0.064655290629994421892 -0.15035303757596954477 -0.065420097691662515427 -0.30467062860143528935 -0.17391890643544261064 0.31397651325512432319 0.038259486720257418479 0.15806170433268457165 -0.30006132167295634927 0.20473391525011230829 -0.24744290360752355107 0.17432443398456101691 0.12667401023332855448 -0.37581041279070881433 -0.63633448857672092469 0.081260590652004291434 -0.055491710787226374013 -0.16793589727190696981;-0.12835424124295710668 0.99430038645341234371 0.921772945472814631 -0.05077081777819531655 0.26342641762765722779 0.38885940074426128543 -1.4372718108687840832 0.89475784430391747115 -0.19214212271627451045 -0.63135517019654430193 -0.033375526268334516911 0.031405501373549318811 0.63085845988648880933 -0.53503134313896483221 0.92603278321820081675 -0.032909792723147764104 0.00021318277141083464415 -0.26523151078233503375 -0.24154875613440160431 0.43105682363803654589 0.32260154382805650286 0.17681949371042249286 -0.1654698791075030484 -0.34285737399574589546 -0.31068225626359258218 -0.18500017410183774991 1.3931445966614455223 0.21631933827029245498 0.46838021482351460678 -0.61408109670572674776 0.047169908622162942669 -1.1608887244529941807 -0.11127788044929984301 0.83293783036622270899 -0.62176918124101065999 0.49611538075532252146 0.50557147906148791616 -0.28693697032681103609 -0.25748200412082039579;-0.30888305441498170589 0.15697703156396181079 -0.61496315848589744313 -0.14106795036647482022 -0.36766182280706333207 -0.015248375497581189569 0.35101634932010805645 0.10420586250724640787 -0.28275263469216982415 0.31001316197180989187 -0.47158731025005445892 -0.18592152501608549819 -0.096212109965732789396 -0.29427999431968648869 -0.26298007552484009564 0.17691608283024298776 0.20735103813671065809 0.44757452730366220628 -0.33517088008007650535 0.53599350503976406213 0.039978802598767806953 -0.80033402235636375011 0.10314476845713665965 -0.55700127831642909371 -0.056579721542813821156 0.35110227045665270973 0.013967056765623573483 -0.032095309145475391099 0.14248112333669121776 0.10301260084910376924 0.41289767611152577986 -0.12242229061019034575 -0.12430228195776785172 0.0043320547048142131821 0.030268495746957353038 0.32649156010960223018 -0.15228024563037514949 0.19893303044966212378 -0.23330787312466619299;1.4166815724394166143 -1.307540701104812797 2.7978953959685659569 0.038873377698325516094 0.65011121396349869084 0.025395044629596710134 -0.20974932017259709238 -0.024722800142998893613 0.25360512203005647347 -0.46652451856307208811 0.0037096708318237340066 1.108371650516403184 0.24579069295931849082 1.123462602169365665 -0.021507532694197209477 -0.82837609948752954914 0.16998979898804578159 -0.19052799963362862523 0.23139450069145220401 -0.20669413205842246395 -0.24112474966521502129 -0.085510241703437933625 0.37165275219497995174 0.54675113107217165886 0.059157875201406348586 0.39400978229608790704 -0.24271686278294263284 0.21069697328213393694 0.12145951971642231226 0.2437724298428149694 -0.087264368183330123796 -0.063654583418175217369 -0.15924904836668163366 0.16912649810146701546 -0.0017995876468051823921 -0.10251106772927409683 0.16237212168897335873 -0.053222850356978268493 0.0071167163554848493837;-0.35214360775235914458 1.8672078523232680247 0.63589119653926906572 -1.0511618895653578321 -0.13200886798225397456 -0.33923760243526773772 -1.5178055261948839583 0.14546662544014454799 0.065018284125546568775 1.7561845406785010493 0.25562773997568855044 -0.94237304964319312806 0.24698507957505622112 0.21807810062060556389 -0.062479511311657118244 -0.42090140477747495229 -1.3123779365751908621 0.5335278889105348199 0.56554898035749934238 0.33712640708038538184 -0.031724828067363257389 0.36493159016565629438 0.0028747132185752699574 0.13107653015221545911 -0.0028017207892610408032 0.2251828078953871104 -0.22680086764819662459 0.15849620416522391952 -0.90316286648840371498 0.99703196415069161862 -0.12432967361244517956 0.012164420743335707664 -0.3484568383921100021 -0.1818486267607679896 -0.081599032433701396139 -0.071432989503349642035 -0.05281822933074802745 -0.070606398026072186846 0.12966335560675956717];

% Layer 2
b2 = [2.1565120150452421477;-2.661369726013947723];
LW2_1 = [0.81155883776701132071 -1.5891034852229168894 1.1276572822657136008 -2.0473490513509151612 2.0126698442310559933 -0.41735808071189750557 -1.6978616006135518468 -1.2698801484896757863 -1.1302389116417985715 1.3352649300151413492 -0.56971201514961911094 1.4824849369062644833 1.7024621341729380131 1.2925454006993652989 2.5121941830526828277;-1.7053083171360898795 1.4869872705104498767 -1.9066591536298849174 1.4857814585239756955 -1.231634774333444371 -1.0622000956977262209 1.6161457479133363169 0.89145299277899259227 2.4642089996010483333 -1.3693911396530733526 1.3734242252591231104 -1.5254169845094947 -1.4700519989107552199 -0.86036885081269953712 -0.89768930129370261284];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = softmax_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Competitive Soft Transfer Function
function a = softmax_apply(n,~)
  if isa(n,'gpuArray')
    a = iSoftmaxApplyGPU(n);
  else
    a = iSoftmaxApplyCPU(n);
  end
end
function a = iSoftmaxApplyCPU(n)
  nmax = max(n,[],1);
  n = bsxfun(@minus,n,nmax);
  numerator = exp(n);
  denominator = sum(numerator,1); 
  denominator(denominator == 0) = 1;
  a = bsxfun(@rdivide,numerator,denominator);
end
function a = iSoftmaxApplyGPU(n)
  nmax = max(n,[],1);
  numerator = arrayfun(@iSoftmaxApplyGPUHelper1,n,nmax);
  denominator = sum(numerator,1);
  a = arrayfun(@iSoftmaxApplyGPUHelper2,numerator,denominator);
end
function numerator = iSoftmaxApplyGPUHelper1(n,nmax)
  numerator = exp(n - nmax);
end
function a = iSoftmaxApplyGPUHelper2(numerator,denominator)
  if (denominator == 0)
    a = numerator;
  else
    a = numerator ./ denominator;
  end
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end
